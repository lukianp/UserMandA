<UserControl x:Class="MandADiscoverySuite.Views.DataExportManagerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1200">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Background="#F5F5F5" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Margin="10">
                <TextBlock Text="Data Export Manager" FontSize="16" FontWeight="Bold" 
                          VerticalAlignment="Center" Margin="0,0,20,0"/>
                <Button Content="ðŸ“‹ Preview" Command="{Binding PreviewExportCommand}" 
                       Width="80" Height="30" Margin="5,0"/>
                <Button Content="ðŸ“‹ Clipboard" Command="{Binding ExportToClipboardCommand}" 
                       Width="90" Height="30" Margin="5,0"/>
                <Button Content="ðŸ”„ Clear History" Command="{Binding ClearHistoryCommand}" 
                       Width="100" Height="30" Margin="5,0"/>
            </StackPanel>
        </Grid>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Export Selection -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Export Selection Controls -->
                <GroupBox Grid.Row="0" Header="Select Data to Export" Margin="5">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Button Content="âœ… Select All" Command="{Binding SelectAllExportsCommand}" 
                                   Width="80" Height="25" Margin="0,0,5,0"/>
                            <Button Content="âŒ Clear All" Command="{Binding ClearExportSelectionCommand}" 
                                   Width="80" Height="25" Margin="5,0"/>
                        </StackPanel>

                        <!-- Export Items List -->
                        <ListView ItemsSource="{Binding AvailableExports}" Height="200">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Width="40">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected}" 
                                                         Command="{Binding DataContext.UpdateSelectedExportsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    
                                    <GridViewColumn Header="Name" Width="150" DisplayMemberBinding="{Binding Name}"/>
                                    <GridViewColumn Header="Category" Width="120" DisplayMemberBinding="{Binding Category}"/>
                                    <GridViewColumn Header="Size" Width="80" DisplayMemberBinding="{Binding EstimatedSize}"/>
                                    <GridViewColumn Header="Last Export" Width="120">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding LastExported, StringFormat='{}{0:MM/dd/yyyy HH:mm}', TargetNullValue='Never'}" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </StackPanel>
                </GroupBox>

                <!-- Export Configuration -->
                <GroupBox Grid.Row="2" Header="Export Configuration" Margin="5">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Export Path -->
                        <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Margin="0,5">
                            <TextBlock Text="Export Path:" Margin="0,0,0,2"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" Text="{Binding ExportPath}" Height="25"/>
                                <Button Grid.Column="1" Content="ðŸ“" Command="{Binding BrowseExportPathCommand}" 
                                       Width="30" Height="25" Margin="5,0,0,0"/>
                            </Grid>
                        </StackPanel>

                        <!-- Format and Options -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,5,5,0">
                            <TextBlock Text="Format:" Margin="0,0,0,2"/>
                            <ComboBox ItemsSource="{Binding ExportFormats}" 
                                     SelectedItem="{Binding SelectedFormat}" Height="25"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="5,5,0,0">
                            <TextBlock Text="Description:" Margin="0,0,0,2"/>
                            <TextBox Text="{Binding ExportDescription}" Height="25"/>
                        </StackPanel>

                        <!-- Options -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,10,0,0">
                            <CheckBox Content="Include Metadata" IsChecked="{Binding IncludeMetadata}" Margin="0,2"/>
                            <CheckBox Content="Compress Output" IsChecked="{Binding CompressOutput}" Margin="0,2"/>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="1" Margin="5,10,0,0">
                            <CheckBox Content="Show Advanced Options" IsChecked="{Binding ShowAdvancedOptions}" Margin="0,2"/>
                        </StackPanel>

                        <!-- Advanced Options -->
                        <Grid Grid.Row="3" Grid.ColumnSpan="2" Margin="0,10,0,0"
                              Visibility="{Binding ShowAdvancedOptions, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                <TextBlock Text="Date From:" Margin="0,0,0,2"/>
                                <DatePicker SelectedDate="{Binding DateFrom}" Height="25"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                <TextBlock Text="Date To:" Margin="0,0,0,2"/>
                                <DatePicker SelectedDate="{Binding DateTo}" Height="25"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </GroupBox>
            </Grid>

            <GridSplitter Grid.Column="1" VerticalAlignment="Stretch" Background="Gray" Width="5"/>

            <!-- Right Panel - Export Status and History -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Export Status -->
                <GroupBox Grid.Row="0" Header="Export Status" Margin="5">
                    <StackPanel>
                        <!-- Selected Exports Summary -->
                        <StackPanel Margin="0,0,0,10">
                            <TextBlock Text="{Binding SelectedExports.Count, StringFormat='Selected: {0} items'}" 
                                      FontWeight="Bold"/>
                            <ItemsControl ItemsSource="{Binding SelectedExports}" Margin="0,5,0,0">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" Margin="10,1,0,1" FontSize="11"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>

                        <!-- Export Progress -->
                        <Grid Visibility="{Binding IsExporting, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel>
                                <TextBlock Text="{Binding ExportStatus}" Margin="0,5"/>
                                <ProgressBar Value="{Binding ExportProgress}" Height="20" Margin="0,5"/>
                                <TextBlock Text="{Binding ExportProgress, StringFormat='{}{0:F0}%'}" 
                                          HorizontalAlignment="Center" Margin="0,-18,0,0" FontSize="11"/>
                            </StackPanel>
                        </Grid>

                        <!-- Export Actions -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,15">
                            <Button Content="ðŸš€ Start Export" Command="{Binding StartExportCommand}" 
                                   Width="100" Height="35" Margin="5,0"
                                   IsEnabled="{Binding IsExporting, Converter={StaticResource InverseBooleanConverter}}"/>
                            <Button Content="â¹ï¸ Cancel" Command="{Binding CancelExportCommand}" 
                                   Width="70" Height="35" Margin="5,0"
                                   IsEnabled="{Binding IsExporting}"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Export History -->
                <GroupBox Grid.Row="1" Header="Export History" Margin="5">
                    <ListView ItemsSource="{Binding ExportHistory}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Date" Width="80">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding StartTime, StringFormat='{}{0:MM/dd HH:mm}'}" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                
                                <GridViewColumn Header="Description" Width="120" DisplayMemberBinding="{Binding Description}"/>
                                
                                <GridViewColumn Header="Files" Width="50">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding ExportedFiles.Count}" HorizontalAlignment="Center"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                
                                <GridViewColumn Header="Status" Width="100" DisplayMemberBinding="{Binding Status}"/>
                                
                                <GridViewColumn Header="Duration" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Duration, StringFormat='{}{0:mm\\:ss}'}" HorizontalAlignment="Center"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </GroupBox>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2" Height="25">
            <StatusBarItem>
                <TextBlock Text="{Binding AvailableExports.Count, StringFormat='Available Exports: {0}'}"/>
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" Margin="20,0"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="{Binding ErrorMessage}" Foreground="Red"/>
            </StatusBarItem>
        </StatusBar>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3" Background="#80000000" 
               Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="10" Margin="10"/>
                <TextBlock Text="Processing..." Foreground="White" FontSize="14" Margin="10"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>