{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "M&A Discovery Suite Configuration Schema",
    "description": "Schema for default-config.json",
    "type": "object",
    "properties": {
        "metadata": {
            "type": "object",
            "properties": {
                "version": {"type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$"},
                "companyName": {"type": "string"},
                "projectName": {"type": "string"},
                "description": {"type": "string"},
                "author": {"type": "string"},
                "lastUpdated": {"type": "string", "format": "date"}
            },
            "required": ["version", "companyName"]
        },
        "environment": {
            "type": "object",
            "properties": {
                "outputPath": {"type": "string", "minLength": 1},
                "tempPath": {"type": "string", "minLength": 1},
                "logLevel": {"type": "string", "enum": ["DEBUG", "INFO", "WARN", "ERROR", "SUCCESS", "HEADER", "PROGRESS"]},
                "maxRetries": {"type": "integer", "minimum": 0, "maximum": 10},
                "domainController": {"type": ["string", "null"]},
                "globalCatalog": {"type": ["string", "null"]},
                "logging": {
                    "type": "object",
                    "properties": {
                        "useEmojis": {"type": "boolean"},
                        "useColors": {"type": "boolean"},
                        "showTimestamp": {"type": "boolean"},
                        "showComponent": {"type": "boolean"},
                        "maxLogSizeMB": {"type": "integer", "minimum": 1},
                        "logRetentionDays": {"type": "integer", "minimum": 0}
                    },
                    "required": ["maxLogSizeMB", "logRetentionDays"]
                },
                "connectivity": {
                    "type": "object",
                    "properties": {
                        "preferInteractiveAuth": {"type": "boolean"},
                        "proxyBypassForExchange": {"type": "boolean"},
                        "maxConnectionRetries": {"type": "integer", "minimum": 1, "maximum": 5},
                        "connectionTimeout": {"type": "integer", "minimum": 5, "maximum": 300},
                        "retryDelaySeconds": {"type": "integer", "minimum": 1, "maximum": 60},
                        "haltOnConnectionError": {"type": "array", "items": {"type": "string"}}
                    },
                    "required": ["maxConnectionRetries", "connectionTimeout", "retryDelaySeconds"]
                }
            },
            "required": ["outputPath", "tempPath", "logLevel", "logging", "connectivity"]
        },
        "authentication": {
            "type": "object",
            "properties": {
                "useServicePrincipal": {"type": "boolean"},
                "useInteractiveAuth": {"type": "boolean"},
                "credentialStorePath": {"type": "string", "minLength": 1},
                "certificateThumbprint": {"type": ["string", "null"]},
                "tokenRefreshThreshold": {"type": "integer", "minimum": 60},
                "authenticationMethod": {"type": "string", "enum": ["ClientSecret", "Certificate", "Interactive"]}
            },
            "required": ["credentialStorePath", "authenticationMethod"]
        },
        "discovery": {
            "type": "object",
            "properties": {
                "enabledSources": {
                    "type": "array",
                    "items": {"type": "string"},
                    "minItems": 1
                },
                "skipExistingFiles": {"type": "boolean"},
                "parallelProcessing": {"type": "boolean"},
                "maxConcurrentJobs": {"type": "integer", "minimum": 1, "maximum": 20},
                "batchSize": {"type": "integer", "minimum": 10, "maximum": 10000},
                "excludeDisabledUsers": {"type": "boolean"},
                "includeGuestUsers": {"type": "boolean"},
                "discoveryScope": {
                    "type": "object",
                    "properties": {
                        "includedOUs": {"type": "array", "items": {"type": "string"}},
                        "excludedOUs": {"type": "array", "items": {"type": "string"}},
                        "includedDomains": {"type": "array", "items": {"type": "string"}},
                        "excludedDomains": {"type": "array", "items": {"type": "string"}}
                    }
                },
                "compressionEnabled": {"type": "boolean"},
                "powershellModules": { "type": "object" },
                "adDns": {
                    "type": "object",
                    "properties": {
                        "dnsServer": {"type": ["string", "null"]},
                        "detailedZones": {"type": "array", "items": {"type": "string"}}
                    }
                },
                "externalIdentity": {
                    "type": "object",
                    "properties": {
                        "getGuestAppRoleAssignments": {"type": "boolean"},
                        "collectSharePointSettings": {"type": "boolean"},
                        "collectTeamsSettings": {"type": "boolean"},
                        "topPartnerDomainsToAnalyze": {"type": "integer", "minimum": 1},
                        "recentGuestCountForInvitationFallback": {"type": "integer", "minimum": 0}
                    }
                }
            },
            "required": ["enabledSources", "batchSize"]
        },
        "processing": {
            "type": "object",
            "properties": {
                "chunkSize": {"type": "integer", "minimum": 1},
                "includeDisabledUsers": {"type": "boolean"},
                "generateWavesByDepartment": {"type": "boolean"},
                "maxWaveSize": {"type": "integer", "minimum": 1}
            },
            "required": ["chunkSize"]
        },
        "export": {
            "type": "object",
            "properties": {
                "formats": {
                    "type": "array",
                    "items": {"type": "string", "enum": ["CSV", "JSON", "Excel", "CompanyControlSheet"]},
                    "minItems": 1
                },
                "excelEnabled": {"type": "boolean"},
                "powerAppsOptimized": {"type": "boolean"}
            },
            "required": ["formats"]
        }
        
    },
    "required": [
        "metadata",
        "environment",
        "authentication",
        "discovery",
        "processing",
        "export"
    ]
}
