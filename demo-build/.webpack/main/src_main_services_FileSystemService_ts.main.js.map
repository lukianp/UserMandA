{"version":3,"file":"src_main_services_FileSystemService_ts.main.js","mappings":"8SAKO,MAAMA,EACTC,SAAW,IAAIC,IACf,WAAAC,GACIC,KAAKC,qBACT,CACA,mBAAAA,GACI,EAAAC,QAAQC,OAAO,gBAAiB,CAACC,EAAGC,EAAaC,IAAaN,KAAKO,WAAWF,EAAaC,IAC3F,EAAAJ,QAAQC,OAAO,oBAAqB,CAACC,EAAGC,IAAgBL,KAAKQ,eAAeH,IAC5E,EAAAH,QAAQC,OAAO,cAAe,CAACC,EAAGK,IAAaT,KAAKU,SAASD,IAC7D,EAAAP,QAAQC,OAAO,kBAAmB,CAACC,EAAGC,IAAgBL,KAAKW,aAAaN,IACxE,EAAAH,QAAQC,OAAO,oBAAqB,CAACC,EAAGQ,EAASC,EAASC,IAAYd,KAAKe,eAAeH,EAASC,EAASC,IAC5G,EAAAZ,QAAQC,OAAO,sBAAuB,CAACC,EAAGU,IAAYd,KAAKgB,iBAAiBF,GAChF,CACA,eAAAG,GACI,MAA4B,UAArBC,QAAQC,SAAuB,oBAAsB,OAAU,kBAAyB,gBACnG,CACA,UAAAZ,CAAWF,EAAaC,GACpB,OAAO,OAAUN,KAAKiB,kBAAmBZ,EAAa,MAAOC,EACjE,CACA,cAAAE,CAAeH,GACX,OAAO,OAAUL,KAAKiB,kBAAmBZ,EAAa,MAC1D,CACA,cAAMK,CAASD,GACX,IACI,aAAa,WAAYA,EAAU,QACvC,CACA,MAAOW,GACH,MAAM,IAAIC,MAAM,uBAAuBZ,MAAaW,aAAiBC,MAAQD,EAAME,QAAUC,OAAOH,KACxG,CACJ,CACA,kBAAMT,CAAaN,GACf,MAAMmB,EAAUxB,KAAKQ,eAAeH,GACpC,IAEI,aADoB,IAAAoB,MAAK,OAAUD,EAAS,WAC/BE,IAAIC,GAAK,WAAcA,GACxC,CACA,MAAOP,GAEH,OADAQ,QAAQC,KAAK,gCAAgCxB,KAAgBe,GACtD,EACX,CACJ,CACA,cAAAL,CAAeH,EAASC,EAASC,GAC7B,IACI,MAAMgB,GAAU,IAAAC,OAAM,OAAUnB,EAASC,GAAU,CAC/CmB,eAAe,EACfC,YAAY,IAYhB,OAVAH,EAAQI,GAAG,MAAO,KACdlC,KAAKmC,oBAAoBrB,EAAS,SAEtCgB,EAAQI,GAAG,SAAU,KACjBlC,KAAKmC,oBAAoBrB,EAAS,YAEtCgB,EAAQI,GAAG,SAAU,KACjBlC,KAAKmC,oBAAoBrB,EAAS,YAEtCd,KAAKH,SAASuC,IAAItB,EAASgB,IACpB,CACX,CACA,MAAOV,GAEH,OADAQ,QAAQR,MAAM,6BAA6BR,KAAYQ,IAChD,CACX,CACJ,CACA,gBAAAJ,CAAiBF,GACb,MAAMgB,EAAU9B,KAAKH,SAASwC,IAAIvB,GAClC,QAAIgB,IACAA,EAAQQ,QACRtC,KAAKH,SAAS0C,OAAOzB,IACd,EAGf,CACA,mBAAAqB,CAAoBrB,EAAS0B,GACT,4BAAkCC,gBAC1CC,QAASC,IACbA,EAAOC,YAAYC,KAAK,iBAAkB,CAAE/B,UAAS0B,WAE7D,E","sources":["webpack://enterprise-discovery-suite/./src/main/services/FileSystemService.ts"],"sourcesContent":["import * as fs from 'fs/promises';\nimport * as path from 'path';\nimport { ipcMain } from 'electron';\nimport { watch } from 'chokidar';\nimport { glob } from 'glob';\nexport class FileSystemService {\n    watchers = new Map();\n    constructor() {\n        this.registerIPCHandlers();\n    }\n    registerIPCHandlers() {\n        ipcMain.handle('fs:getCSVPath', (_, companyName, fileName) => this.getCSVPath(companyName, fileName));\n        ipcMain.handle('fs:getRawDataPath', (_, companyName) => this.getRawDataPath(companyName));\n        ipcMain.handle('fs:readFile', (_, filePath) => this.readFile(filePath));\n        ipcMain.handle('fs:listCSVFiles', (_, companyName) => this.listCSVFiles(companyName));\n        ipcMain.handle('fs:watchDirectory', (_, dirPath, pattern, watchId) => this.watchDirectory(dirPath, pattern, watchId));\n        ipcMain.handle('fs:unwatchDirectory', (_, watchId) => this.unwatchDirectory(watchId));\n    }\n    getDataRootPath() {\n        return process.platform === 'win32' ? 'C:\\\\DiscoveryData' : path.join(require('os').homedir(), 'DiscoveryData');\n    }\n    getCSVPath(companyName, fileName) {\n        return path.join(this.getDataRootPath(), companyName, 'Raw', fileName);\n    }\n    getRawDataPath(companyName) {\n        return path.join(this.getDataRootPath(), companyName, 'Raw');\n    }\n    async readFile(filePath) {\n        try {\n            return await fs.readFile(filePath, 'utf-8');\n        }\n        catch (error) {\n            throw new Error(`Failed to read file ${filePath}: ${error instanceof Error ? error.message : String(error)}`);\n        }\n    }\n    async listCSVFiles(companyName) {\n        const rawPath = this.getRawDataPath(companyName);\n        try {\n            const files = await glob(path.join(rawPath, '*.csv'));\n            return files.map(f => path.basename(f));\n        }\n        catch (error) {\n            console.warn(`Failed to list CSV files for ${companyName}:`, error);\n            return [];\n        }\n    }\n    watchDirectory(dirPath, pattern, watchId) {\n        try {\n            const watcher = watch(path.join(dirPath, pattern), {\n                ignoreInitial: true,\n                persistent: true\n            });\n            watcher.on('add', () => {\n                this.broadcastFileChange(watchId, 'add');\n            });\n            watcher.on('change', () => {\n                this.broadcastFileChange(watchId, 'change');\n            });\n            watcher.on('unlink', () => {\n                this.broadcastFileChange(watchId, 'unlink');\n            });\n            this.watchers.set(watchId, watcher);\n            return true;\n        }\n        catch (error) {\n            console.error(`Failed to watch directory ${dirPath}:`, error);\n            return false;\n        }\n    }\n    unwatchDirectory(watchId) {\n        const watcher = this.watchers.get(watchId);\n        if (watcher) {\n            watcher.close();\n            this.watchers.delete(watchId);\n            return true;\n        }\n        return false;\n    }\n    broadcastFileChange(watchId, event) {\n        const windows = require('electron').BrowserWindow.getAllWindows();\n        windows.forEach((window) => {\n            window.webContents.send('fs:fileChanged', { watchId, event });\n        });\n    }\n}\n"],"names":["FileSystemService","watchers","Map","constructor","this","registerIPCHandlers","ipcMain","handle","_","companyName","fileName","getCSVPath","getRawDataPath","filePath","readFile","listCSVFiles","dirPath","pattern","watchId","watchDirectory","unwatchDirectory","getDataRootPath","process","platform","error","Error","message","String","rawPath","glob","map","f","console","warn","watcher","watch","ignoreInitial","persistent","on","broadcastFileChange","set","get","close","delete","event","getAllWindows","forEach","window","webContents","send"],"sourceRoot":""}