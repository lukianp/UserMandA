"use strict";exports.id="src_main_ipc_moduleDiscoveryHandlers_ts",exports.ids=["src_main_ipc_moduleDiscoveryHandlers_ts"],exports.modules={"./src/main/ipc/moduleDiscoveryHandlers.ts":(e,s,r)=>{r.d(s,{registerModuleDiscoveryHandlers:()=>i});var t=r("path"),c=r.n(t),o=r("electron"),a=r("./src/main/services/enhancedModuleDiscovery.ts");function i(){o.ipcMain.handle("module-discovery:discover",async e=>{try{const e=(0,a.getEnhancedModuleDiscoveryService)(),s=process.env.SCRIPTS_ROOT||c().join(__dirname,"../../Scripts");return{success:!0,modules:await e.discoverModules(s)}}catch(e){return{success:!1,error:e.message,modules:[]}}}),o.ipcMain.handle("module-discovery:get-by-id",async(e,s)=>{try{const e=(0,a.getEnhancedModuleDiscoveryService)().getModuleById(s);return e?{success:!0,module:e}:{success:!1,error:"Module not found"}}catch(e){return{success:!1,error:e.message}}}),o.ipcMain.handle("module-discovery:search",async(e,s)=>{try{const e=(0,a.getEnhancedModuleDiscoveryService)();return{success:!0,modules:e.searchModules(s)}}catch(e){return{success:!1,error:e.message,modules:[]}}}),o.ipcMain.handle("module-discovery:get-by-category",async(e,s)=>{try{const e=(0,a.getEnhancedModuleDiscoveryService)();return{success:!0,modules:e.getModulesByCategory(s)}}catch(e){return{success:!1,error:e.message,modules:[]}}}),o.ipcMain.handle("module-discovery:get-categories",async e=>{try{const e=(0,a.getEnhancedModuleDiscoveryService)();return{success:!0,categories:e.getCategories()}}catch(e){return{success:!1,error:e.message,categories:[]}}})}},"./src/main/services/enhancedModuleDiscovery.ts":(e,s,r)=>{r.d(s,{getEnhancedModuleDiscoveryService:()=>i});var t=r("fs"),c=r("path");class o{modulesCache=new Map;lastScanTime=null;async discoverModules(e){console.log(`[ModuleDiscovery] Scanning scripts directory: ${e}`);const s=[];try{return t.existsSync(e)?(await this.scanDirectory(e,s),s.forEach(e=>{this.modulesCache.set(e.id,e)}),this.lastScanTime=new Date,console.log(`[ModuleDiscovery] Discovered ${s.length} modules`),s):(console.warn(`[ModuleDiscovery] Scripts directory not found: ${e}`),[])}catch(e){return console.error("[ModuleDiscovery] Discovery failed:",e),[]}}async scanDirectory(e,s,r){try{const o=await t.promises.readdir(e,{withFileTypes:!0});for(const t of o){const o=c.join(e,t.name);if(t.isDirectory())await this.scanDirectory(o,s,t.name);else if(t.isFile()&&(t.name.endsWith(".ps1")||t.name.endsWith(".psm1"))){const e=await this.parseModule(o,r||"General");e&&s.push(e)}}}catch(s){console.error(`[ModuleDiscovery] Failed to scan directory ${e}:`,s)}}async parseModule(e,s){try{const r=await t.promises.readFile(e,"utf8"),o=this.extractMetadata(r),a=await this.extractParameters(e,r),i=c.basename(e,c.extname(e));return{id:`${s.toLowerCase()}-${i.toLowerCase()}`,name:o.name||i,path:e,category:s,description:o.description||"",parameters:a,dependencies:o.dependencies||[],version:o.version,author:o.author}}catch(s){return console.error(`[ModuleDiscovery] Failed to parse module ${e}:`,s),null}}extractMetadata(e){const s={},r=e.match(/\.SYNOPSIS\s+(.*?)(?=\.|$)/is);r&&(s.description=r[1].trim());const t=e.match(/\.DESCRIPTION\s+(.*?)(?=\.|$)/is);t&&(s.description=t[1].trim());const c=e.match(/\.VERSION\s+(\S+)/i);c&&(s.version=c[1].trim());const o=e.match(/\.AUTHOR\s+(.*?)(?=\n|$)/i);o&&(s.author=o[1].trim());const a=e.matchAll(/#Requires\s+-Modules\s+([^\n]+)/gi);s.dependencies=[];for(const e of a){const r=e[1].split(",").map(e=>e.trim());s.dependencies.push(...r)}return s}async extractParameters(e,s){const r=[],t=s.match(/param\s*\(([\s\S]*?)\)/i);if(!t)return r;const c=t[1].matchAll(/\[Parameter[^\]]*\]\s*\[(\w+)\]\s*\$(\w+)\s*=?\s*([^,\n]*)/gi);for(const e of c){const s=e[1],t=e[2],c=e[3]?.trim();r.push({name:t,type:s,required:/Mandatory\s*=\s*\$true/i.test(e[0]),defaultValue:c||void 0,description:void 0})}return r}getModule(e){return this.modulesCache.get(e)||null}getAllModules(){return Array.from(this.modulesCache.values())}getModulesByCategory(e){return Array.from(this.modulesCache.values()).filter(s=>s.category.toLowerCase()===e.toLowerCase())}searchModules(e){const s=e.toLowerCase();return Array.from(this.modulesCache.values()).filter(e=>e.name.toLowerCase().includes(s)||e.description.toLowerCase().includes(s))}getStatistics(){return{totalModules:this.modulesCache.size,lastScanTime:this.lastScanTime,categories:Array.from(new Set(Array.from(this.modulesCache.values()).map(e=>e.category)))}}clearCache(){this.modulesCache.clear(),this.lastScanTime=null}}let a=null;function i(){return a||(a=new o),a}}};
//# sourceMappingURL=src_main_ipc_moduleDiscoveryHandlers_ts.main.js.map