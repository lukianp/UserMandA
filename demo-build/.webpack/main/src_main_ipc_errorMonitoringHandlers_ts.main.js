"use strict";exports.id="src_main_ipc_errorMonitoringHandlers_ts",exports.ids=["src_main_ipc_errorMonitoringHandlers_ts"],exports.modules={"./src/main/ipc/errorMonitoringHandlers.ts":(r,e,s)=>{s.d(e,{registerErrorMonitoringHandlers:()=>i});var t=s("electron"),o=s("./src/main/services/errorHandlingService.ts");function i(r){const e=(0,o.getErrorHandlingService)();r&&(e.on("log",e=>{r.webContents.send("error-monitoring:log",e)}),e.on("error-reported",e=>{r.webContents.send("error-monitoring:error-reported",e)})),t.ipcMain.handle("error-monitoring:get-reports",async(r,s)=>{try{return{success:!0,reports:e.getErrorReports(s)}}catch(r){return{success:!1,error:r.message,reports:[]}}}),t.ipcMain.handle("error-monitoring:resolve",async(r,s)=>{try{return await e.resolveErrorReport(s.reportId,s.notes),{success:!0}}catch(r){return{success:!1,error:r.message}}}),t.ipcMain.handle("error-monitoring:log",async(r,s)=>{try{return e.log(s.level,s.category,s.message,s.context),{success:!0}}catch(r){return{success:!1,error:r.message}}}),t.ipcMain.handle("error-monitoring:report-error",async(r,s)=>{try{return{success:!0,reportId:await e.reportError(s.error,s.context)}}catch(r){return{success:!1,error:r.message}}}),t.ipcMain.handle("error-monitoring:get-logs",async(r,s)=>{try{let r=e.getRecentLogs(s?.limit||100);return s?.level&&(r=r.filter(r=>r.level===s.level)),s?.category&&(r=r.filter(r=>r.category===s.category)),{success:!0,logs:r}}catch(r){return{success:!1,error:r.message,logs:[]}}}),t.ipcMain.handle("error-monitoring:subscribe",async(r,e)=>({success:!0}))}},"./src/main/services/errorHandlingService.ts":(r,e,s)=>{s.d(e,{getErrorHandlingService:()=>c});var t=s("fs"),o=s("path"),i=s("events");class n extends i.EventEmitter{logsDir;errorsDir;currentLogFile;logBuffer=[];flushInterval=null;errorReports=new Map;constructor(r="C:\\DiscoveryData"){super(),this.logsDir=o.join(r,"Logs"),this.errorsDir=o.join(r,"Errors"),this.currentLogFile=this.getLogFilePath(),this.ensureDirectoriesExist(),this.startFlushInterval()}ensureDirectoriesExist(){t.existsSync(this.logsDir)||t.mkdirSync(this.logsDir,{recursive:!0}),t.existsSync(this.errorsDir)||t.mkdirSync(this.errorsDir,{recursive:!0})}getLogFilePath(){const r=(new Date).toISOString().split("T")[0];return o.join(this.logsDir,`app-${r}.log`)}startFlushInterval(){this.flushInterval=setInterval(()=>{this.flushLogs()},5e3)}log(r,e,s,t){const o={timestamp:(new Date).toISOString(),level:r,category:e,message:s,context:t};this.logBuffer.push(o),this.emit("log",o);const i=`[${o.timestamp}] [${r.toUpperCase()}] [${e}] ${s}`;switch(r){case"debug":console.debug(i,t||"");break;case"info":console.log(i,t||"");break;case"warn":console.warn(i,t||"");break;case"error":case"fatal":console.error(i,t||"")}"error"!==r&&"fatal"!==r||this.flushLogs()}debug(r,e,s){this.log("debug",r,e,s)}info(r,e,s){this.log("info",r,e,s)}warn(r,e,s){this.log("warn",r,e,s)}error(r,e,s,t){const o={timestamp:(new Date).toISOString(),level:"error",category:r,message:e,context:t,error:s?{name:s.name,message:s.message,stack:s.stack}:void 0};this.logBuffer.push(o),this.emit("log",o),this.emit("error",o),console.error(`[${o.timestamp}] [ERROR] [${r}] ${e}`,s||"",t||""),s&&this.createErrorReport(s,t||{}),this.flushLogs()}fatal(r,e,s,t){const o={timestamp:(new Date).toISOString(),level:"fatal",category:r,message:e,context:t,error:s?{name:s.name,message:s.message,stack:s.stack}:void 0};this.logBuffer.push(o),this.emit("log",o),this.emit("fatal",o),console.error(`[${o.timestamp}] [FATAL] [${r}] ${e}`,s||"",t||""),s&&this.createErrorReport(s,t||{}),this.flushLogs()}createErrorReport(r,e){const s={id:crypto.randomUUID(),timestamp:(new Date).toISOString(),error:r,context:e,resolved:!1};this.errorReports.set(s.id,s);const i=o.join(this.errorsDir,`${s.id}.json`);t.promises.writeFile(i,JSON.stringify({...s,error:{name:r.name,message:r.message,stack:r.stack}},null,2),"utf8")}flushLogs(){if(0===this.logBuffer.length)return;const r=this.getLogFilePath();r!==this.currentLogFile&&(this.currentLogFile=r);const e=this.logBuffer.map(r=>{const e=[r.timestamp,r.level.toUpperCase().padEnd(5),r.category.padEnd(20),r.message];return r.context&&e.push(JSON.stringify(r.context)),r.error&&(e.push(`\n  Error: ${r.error.name}: ${r.error.message}`),r.error.stack&&e.push(`\n  Stack: ${r.error.stack}`)),e.join(" | ")});t.appendFileSync(this.currentLogFile,e.join("\n")+"\n","utf8"),this.logBuffer=[]}getErrorReports(r){let e=Array.from(this.errorReports.values());if(r&&(void 0!==r.resolved&&(e=e.filter(e=>e.resolved===r.resolved)),r.since)){const s=new Date(r.since);e=e.filter(r=>new Date(r.timestamp)>=s)}return e}async resolveErrorReport(r,e){const s=this.errorReports.get(r);if(s){s.resolved=!0,s.notes=e;const i=o.join(this.errorsDir,`${r}.json`);t.existsSync(i)&&await t.promises.writeFile(i,JSON.stringify({...s,error:{name:s.error.name,message:s.error.message,stack:s.error.stack}},null,2),"utf8")}}async reportError(r,e){const s={id:crypto.randomUUID(),timestamp:(new Date).toISOString(),error:r,context:e||{},resolved:!1};this.errorReports.set(s.id,s);const i=o.join(this.errorsDir,`${s.id}.json`);return await t.promises.writeFile(i,JSON.stringify({...s,error:{name:r.name,message:r.message,stack:r.stack}},null,2),"utf8"),this.emit("error-reported",s),s.id}getRecentLogs(r=100){return this.logBuffer.slice(-r)}getStatistics(){return{totalLogs:this.logBuffer.length,errorReports:this.errorReports.size,unresolvedErrors:Array.from(this.errorReports.values()).filter(r=>!r.resolved).length}}shutdown(){this.flushInterval&&(clearInterval(this.flushInterval),this.flushInterval=null),this.flushLogs()}}let a=null;function c(r){return a||(a=new n(r)),a}}};
//# sourceMappingURL=src_main_ipc_errorMonitoringHandlers_ts.main.js.map