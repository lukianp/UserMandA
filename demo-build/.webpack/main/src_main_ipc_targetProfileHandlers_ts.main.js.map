{"version":3,"file":"src_main_ipc_targetProfileHandlers_ts.main.js","mappings":"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","sources":["webpack://enterprise-discovery-suite/./src/main/ipc/targetProfileHandlers.ts","webpack://enterprise-discovery-suite/./src/main/services/targetProfileService.ts"],"sourcesContent":["/**\n * IPC Handlers for Target Profile Management\n *\n * Provides renderer process access to target profile functionality\n */\nimport { ipcMain } from 'electron';\nimport * as targetProfileService from '../services/targetProfileService';\n/**\n * Register all target profile IPC handlers\n * Matches existing channel names in preload.ts\n */\nexport function registerTargetProfileHandlers() {\n    // Load target profiles\n    ipcMain.handle('profile:loadTargetProfiles', async (event) => {\n        console.log('[IPC] profile:loadTargetProfiles');\n        return await targetProfileService.loadTargetProfiles();\n    });\n    // Create target profile\n    ipcMain.handle('profile:createTarget', async (event, profileData) => {\n        console.log('[IPC] profile:createTarget', profileData.name);\n        return await targetProfileService.createTargetProfile(profileData);\n    });\n    // Update target profile\n    ipcMain.handle('profile:updateTarget', async (event, id, updates) => {\n        console.log('[IPC] profile:updateTarget', id);\n        return await targetProfileService.updateTargetProfile(id, updates);\n    });\n    // Delete target profile\n    ipcMain.handle('profile:deleteTarget', async (event, id) => {\n        console.log('[IPC] profile:deleteTarget', id);\n        return await targetProfileService.deleteTargetProfile(id);\n    });\n    // Set active target profile\n    ipcMain.handle('profile:setActiveTarget', async (event, id) => {\n        console.log('[IPC] profile:setActiveTarget', id);\n        return await targetProfileService.setActiveTargetProfile(id);\n    });\n    // Decrypt target credential\n    ipcMain.handle('profile:decryptTargetCredential', async (event, companyName) => {\n        console.log('[IPC] profile:decryptTargetCredential', companyName);\n        return await targetProfileService.decryptTargetCredential(companyName);\n    });\n    console.log('[IPC] Target profile handlers registered');\n}\nexport default registerTargetProfileHandlers;\n","/**\n * Target Profile Service (Main Process)\n *\n * Manages target profiles for migration destinations (Azure, Google, AWS, etc.).\n * Handles profile persistence, credential encryption, and profile operations.\n *\n * Pattern from GUI/Services/TargetProfileService.cs\n */\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { spawn } from 'child_process';\nimport { app } from 'electron';\n/**\n * Get the path to the target profiles storage file\n */\nfunction getTargetProfilesPath() {\n    const userDataPath = app.getPath('userData');\n    const profilesDir = path.join(userDataPath, 'profiles');\n    // Ensure directory exists\n    if (!fs.existsSync(profilesDir)) {\n        fs.mkdirSync(profilesDir, { recursive: true });\n    }\n    return path.join(profilesDir, 'target-profiles.json');\n}\n/**\n * Load all target profiles from disk\n * Pattern from GUI/Services/TargetProfileService.cs:GetProfilesAsync\n */\nexport async function loadTargetProfiles() {\n    try {\n        const profilesPath = getTargetProfilesPath();\n        if (!fs.existsSync(profilesPath)) {\n            console.log('[TargetProfileService] No target profiles file found, returning empty array');\n            return [];\n        }\n        const content = await fs.promises.readFile(profilesPath, 'utf8');\n        const profiles = JSON.parse(content);\n        console.log(`[TargetProfileService] Loaded ${profiles.length} target profiles`);\n        return profiles;\n    }\n    catch (error) {\n        console.error('[TargetProfileService] Failed to load target profiles:', error);\n        return [];\n    }\n}\n/**\n * Save all target profiles to disk\n * Pattern from GUI/Services/TargetProfileService.cs:SaveProfilesAsync\n */\nasync function saveTargetProfiles(profiles) {\n    try {\n        const profilesPath = getTargetProfilesPath();\n        const content = JSON.stringify(profiles, null, 2);\n        await fs.promises.writeFile(profilesPath, content, 'utf8');\n        console.log(`[TargetProfileService] Saved ${profiles.length} target profiles`);\n    }\n    catch (error) {\n        console.error('[TargetProfileService] Failed to save target profiles:', error);\n        throw error;\n    }\n}\n/**\n * Create a new target profile\n * Pattern from GUI/Services/TargetProfileService.cs:CreateProfileAsync\n */\nexport async function createTargetProfile(profileData) {\n    try {\n        const profiles = await loadTargetProfiles();\n        // Check for duplicate names\n        const duplicate = profiles.find((p) => p.name === profileData.name);\n        if (duplicate) {\n            return {\n                success: false,\n                error: `A target profile with the name \"${profileData.name}\" already exists`\n            };\n        }\n        // Create new profile\n        const newProfile = {\n            ...profileData,\n            id: profileData.id || crypto.randomUUID(),\n            createdAt: new Date().toISOString(),\n            created: new Date().toISOString(),\n            lastModified: new Date().toISOString(),\n            isActive: false,\n            isConnected: false\n        };\n        // Encrypt client secret if provided (Azure profiles)\n        if (newProfile.clientSecret && newProfile.companyName) {\n            const encrypted = await encryptCredential(newProfile.companyName, newProfile.clientSecret);\n            if (encrypted) {\n                // Store encrypted reference instead of plaintext\n                newProfile.clientSecret = `[encrypted:${newProfile.companyName}]`;\n            }\n        }\n        profiles.push(newProfile);\n        await saveTargetProfiles(profiles);\n        console.log(`[TargetProfileService] Created target profile: ${newProfile.name}`);\n        return {\n            success: true,\n            profile: newProfile\n        };\n    }\n    catch (error) {\n        console.error('[TargetProfileService] Failed to create target profile:', error);\n        return {\n            success: false,\n            error: error.message || 'Failed to create target profile'\n        };\n    }\n}\n/**\n * Update an existing target profile\n * Pattern from GUI/Services/TargetProfileService.cs:UpdateProfileAsync\n */\nexport async function updateTargetProfile(id, updates) {\n    try {\n        const profiles = await loadTargetProfiles();\n        const index = profiles.findIndex((p) => p.id === id);\n        if (index === -1) {\n            return {\n                success: false,\n                error: `Target profile with ID \"${id}\" not found`\n            };\n        }\n        // Encrypt client secret if being updated\n        if (updates.clientSecret && profiles[index].companyName) {\n            const encrypted = await encryptCredential(profiles[index].companyName, updates.clientSecret);\n            if (encrypted) {\n                updates.clientSecret = `[encrypted:${profiles[index].companyName}]`;\n            }\n        }\n        // Update profile\n        const updatedProfile = {\n            ...profiles[index],\n            ...updates,\n            lastModified: new Date().toISOString()\n        };\n        profiles[index] = updatedProfile;\n        await saveTargetProfiles(profiles);\n        console.log(`[TargetProfileService] Updated target profile: ${id}`);\n        return {\n            success: true,\n            profile: updatedProfile\n        };\n    }\n    catch (error) {\n        console.error('[TargetProfileService] Failed to update target profile:', error);\n        return {\n            success: false,\n            error: error.message || 'Failed to update target profile'\n        };\n    }\n}\n/**\n * Delete a target profile\n * Pattern from GUI/Services/TargetProfileService.cs:DeleteProfileAsync\n */\nexport async function deleteTargetProfile(id) {\n    try {\n        const profiles = await loadTargetProfiles();\n        const index = profiles.findIndex((p) => p.id === id);\n        if (index === -1) {\n            return {\n                success: false,\n                error: `Target profile with ID \"${id}\" not found`\n            };\n        }\n        const deletedProfile = profiles[index];\n        profiles.splice(index, 1);\n        await saveTargetProfiles(profiles);\n        console.log(`[TargetProfileService] Deleted target profile: ${id}`);\n        return {\n            success: true,\n            profile: deletedProfile\n        };\n    }\n    catch (error) {\n        console.error('[TargetProfileService] Failed to delete target profile:', error);\n        return {\n            success: false,\n            error: error.message || 'Failed to delete target profile'\n        };\n    }\n}\n/**\n * Set active target profile\n * Pattern from GUI/Services/TargetProfileService.cs:SetCurrentProfileAsync\n */\nexport async function setActiveTargetProfile(id) {\n    try {\n        const profiles = await loadTargetProfiles();\n        // Deactivate all profiles\n        profiles.forEach((p) => {\n            p.isActive = false;\n        });\n        // Activate selected profile\n        const profile = profiles.find((p) => p.id === id);\n        if (!profile) {\n            return {\n                success: false,\n                error: `Target profile with ID \"${id}\" not found`\n            };\n        }\n        profile.isActive = true;\n        await saveTargetProfiles(profiles);\n        console.log(`[TargetProfileService] Set active target profile: ${profile.name}`);\n        return {\n            success: true,\n            profile\n        };\n    }\n    catch (error) {\n        console.error('[TargetProfileService] Failed to set active target profile:', error);\n        return {\n            success: false,\n            error: error.message || 'Failed to set active target profile'\n        };\n    }\n}\n/**\n * Encrypt credential using Windows DPAPI\n * Pattern from GUI/Models/TargetProfile.cs:EncryptCredentialAsync\n */\nasync function encryptCredential(companyName, plaintext) {\n    try {\n        const credentialsDir = path.join('C:', 'DiscoveryData', companyName, 'Credentials');\n        // Ensure directory exists\n        if (!fs.existsSync(credentialsDir)) {\n            fs.mkdirSync(credentialsDir, { recursive: true });\n        }\n        const credentialPath = path.join(credentialsDir, 'target-credential.enc');\n        // Escape single quotes in plaintext\n        const escapedPlaintext = plaintext.replace(/'/g, \"''\");\n        const script = `\r\n      try {\r\n        $plaintext = '${escapedPlaintext}'\r\n        $ss = ConvertTo-SecureString -String $plaintext -AsPlainText -Force\r\n        $encrypted = ConvertFrom-SecureString -SecureString $ss\r\n        Set-Content -Path '${credentialPath.replace(/'/g, \"''\")}' -Value $encrypted\r\n        Write-Output \"SUCCESS\"\r\n      } catch {\r\n        Write-Error $_.Exception.Message\r\n        exit 1\r\n      }\r\n    `;\n        return new Promise((resolve) => {\n            const child = spawn('powershell.exe', [\n                '-NoProfile',\n                '-ExecutionPolicy',\n                'Bypass',\n                '-Command',\n                script\n            ]);\n            let stdout = '';\n            let stderr = '';\n            child.stdout?.on('data', (data) => {\n                stdout += data.toString();\n            });\n            child.stderr?.on('data', (data) => {\n                stderr += data.toString();\n            });\n            child.on('close', (code) => {\n                if (code === 0 && stdout.trim() === 'SUCCESS') {\n                    resolve(credentialPath);\n                }\n                else {\n                    console.error(`[TargetProfileService] Encryption failed:`, stderr);\n                    resolve(null);\n                }\n            });\n            child.on('error', (error) => {\n                console.error(`[TargetProfileService] PowerShell execution failed:`, error);\n                resolve(null);\n            });\n        });\n    }\n    catch (error) {\n        console.error(`[TargetProfileService] Encryption error:`, error);\n        return null;\n    }\n}\n/**\n * Decrypt credential using Windows DPAPI\n * Pattern from GUI/Models/TargetProfile.cs:DecryptCredentialAsync\n */\nexport async function decryptTargetCredential(companyName) {\n    try {\n        const credentialPath = path.join('C:', 'DiscoveryData', companyName, 'Credentials', 'target-credential.enc');\n        if (!fs.existsSync(credentialPath)) {\n            console.error(`[TargetProfileService] Credential file not found: ${credentialPath}`);\n            return null;\n        }\n        const escapedPath = credentialPath.replace(/'/g, \"''\");\n        const script = `\r\n      try {\r\n        $encrypted = Get-Content -Path '${escapedPath}' -Raw\r\n        $ss = ConvertTo-SecureString -String $encrypted\r\n        $bstr = [Runtime.InteropServices.Marshal]::SecureStringToBSTR($ss)\r\n        $plaintext = [Runtime.InteropServices.Marshal]::PtrToStringUni($bstr)\r\n        [Runtime.InteropServices.Marshal]::ZeroFreeBSTR($bstr)\r\n        Write-Output $plaintext\r\n      } catch {\r\n        Write-Error $_.Exception.Message\r\n        exit 1\r\n      }\r\n    `;\n        return new Promise((resolve) => {\n            const child = spawn('powershell.exe', [\n                '-NoProfile',\n                '-ExecutionPolicy',\n                'Bypass',\n                '-Command',\n                script\n            ]);\n            let stdout = '';\n            let stderr = '';\n            child.stdout?.on('data', (data) => {\n                stdout += data.toString();\n            });\n            child.stderr?.on('data', (data) => {\n                stderr += data.toString();\n            });\n            child.on('close', (code) => {\n                if (code === 0 && stdout.trim()) {\n                    resolve(stdout.trim());\n                }\n                else {\n                    console.error(`[TargetProfileService] Decryption failed:`, stderr);\n                    resolve(null);\n                }\n            });\n            child.on('error', (error) => {\n                console.error(`[TargetProfileService] PowerShell execution failed:`, error);\n                resolve(null);\n            });\n        });\n    }\n    catch (error) {\n        console.error(`[TargetProfileService] Decryption error:`, error);\n        return null;\n    }\n}\nexport default {\n    loadTargetProfiles,\n    createTargetProfile,\n    updateTargetProfile,\n    deleteTargetProfile,\n    setActiveTargetProfile,\n    decryptTargetCredential\n};\n"],"names":["registerTargetProfileHandlers","ipcMain","handle","async","event","console","log","profileData","name","id","updates","companyName","getTargetProfilesPath","userDataPath","app","getPath","profilesDir","recursive","loadTargetProfiles","profilesPath","content","readFile","profiles","JSON","parse","length","error","saveTargetProfiles","stringify","writeFile","createTargetProfile","find","p","success","newProfile","crypto","randomUUID","createdAt","Date","toISOString","created","lastModified","isActive","isConnected","clientSecret","encryptCredential","push","profile","message","updateTargetProfile","index","findIndex","updatedProfile","deleteTargetProfile","deletedProfile","splice","setActiveTargetProfile","forEach","plaintext","credentialsDir","credentialPath","script","replace","Promise","resolve","child","spawn","stdout","stderr","on","data","toString","code","trim","decryptTargetCredential"],"sourceRoot":""}