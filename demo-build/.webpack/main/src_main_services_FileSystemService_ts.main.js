"use strict";exports.id="src_main_services_FileSystemService_ts",exports.ids=["src_main_services_FileSystemService_ts"],exports.modules={"./src/main/services/FileSystemService.ts":(e,t,a)=>{a.d(t,{FileSystemService:()=>o});var i=a("fs/promises"),r=a("path"),s=a("electron"),n=a("chokidar"),c=a("glob");class o{watchers=new Map;constructor(){this.registerIPCHandlers()}registerIPCHandlers(){s.ipcMain.handle("fs:getCSVPath",(e,t,a)=>this.getCSVPath(t,a)),s.ipcMain.handle("fs:getRawDataPath",(e,t)=>this.getRawDataPath(t)),s.ipcMain.handle("fs:readFile",(e,t)=>this.readFile(t)),s.ipcMain.handle("fs:listCSVFiles",(e,t)=>this.listCSVFiles(t)),s.ipcMain.handle("fs:watchDirectory",(e,t,a,i)=>this.watchDirectory(t,a,i)),s.ipcMain.handle("fs:unwatchDirectory",(e,t)=>this.unwatchDirectory(t))}getDataRootPath(){return"win32"===process.platform?"C:\\DiscoveryData":r.join(a("os").homedir(),"DiscoveryData")}getCSVPath(e,t){return r.join(this.getDataRootPath(),e,"Raw",t)}getRawDataPath(e){return r.join(this.getDataRootPath(),e,"Raw")}async readFile(e){try{return await i.readFile(e,"utf-8")}catch(t){throw new Error(`Failed to read file ${e}: ${t instanceof Error?t.message:String(t)}`)}}async listCSVFiles(e){const t=this.getRawDataPath(e);try{return(await(0,c.glob)(r.join(t,"*.csv"))).map(e=>r.basename(e))}catch(t){return console.warn(`Failed to list CSV files for ${e}:`,t),[]}}watchDirectory(e,t,a){try{const i=(0,n.watch)(r.join(e,t),{ignoreInitial:!0,persistent:!0});return i.on("add",()=>{this.broadcastFileChange(a,"add")}),i.on("change",()=>{this.broadcastFileChange(a,"change")}),i.on("unlink",()=>{this.broadcastFileChange(a,"unlink")}),this.watchers.set(a,i),!0}catch(t){return console.error(`Failed to watch directory ${e}:`,t),!1}}unwatchDirectory(e){const t=this.watchers.get(e);return!!t&&(t.close(),this.watchers.delete(e),!0)}broadcastFileChange(e,t){a("electron").BrowserWindow.getAllWindows().forEach(a=>{a.webContents.send("fs:fileChanged",{watchId:e,event:t})})}}}};
//# sourceMappingURL=src_main_services_FileSystemService_ts.main.js.map