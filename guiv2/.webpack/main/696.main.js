"use strict";exports.id=696,exports.ids=[696],exports.modules={696:(e,r,s)=>{s.d(r,{initializeLogging:()=>L,registerLoggingHandlers:()=>y});var t,o=s(482),i=s(896),n=s(928);!function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.FATAL="FATAL"}(t||(t={}));class c{config;currentLogFile=null;logBuffer=[];isInitialized=!1;constructor(){const e=o.app?.getPath("userData")||process.cwd();this.config={enableFileLogging:!0,enableConsoleLogging:!0,logDirectory:n.join(e,"logs"),maxLogFiles:10,maxLogFileSize:10485760,minLogLevel:t.DEBUG}}async initialize(e){this.isInitialized||(e&&(this.config={...this.config,...e}),this.config.enableFileLogging&&(await this.ensureLogDirectory(),await this.rotateLogFiles(),this.currentLogFile=this.getLogFilePath()),this.isInitialized=!0,this.info("LoggingService","Logging service initialized",{config:this.config}))}debug(e,r,s){this.log(t.DEBUG,e,r,s)}info(e,r,s){this.log(t.INFO,e,r,s)}warn(e,r,s){this.log(t.WARN,e,r,s)}error(e,r,s,o){this.log(t.ERROR,e,r,{...o,error:s?.message},s)}fatal(e,r,s,o){this.log(t.FATAL,e,r,{...o,error:s?.message},s)}log(e,r,s,t,o){if(!this.shouldLog(e))return;const i={timestamp:(new Date).toISOString(),level:e,component:r,message:s,context:t,stack:o?.stack,error:o};this.config.enableConsoleLogging&&this.logToConsole(i),this.config.enableFileLogging&&this.logToFile(i),this.logBuffer.push(i),this.logBuffer.length>1e3&&this.logBuffer.shift()}logToConsole(e){const r=`${`[${new Date(e.timestamp).toLocaleTimeString()}] [${e.level}] [${e.component}]`} ${e.message}`;switch(e.level){case t.DEBUG:console.debug(r,e.context||"");break;case t.INFO:console.info(r,e.context||"");break;case t.WARN:console.warn(r,e.context||"");break;case t.ERROR:case t.FATAL:console.error(r,e.context||"",e.stack||"")}}async logToFile(e){if(this.currentLogFile)try{const r=this.formatLogEntry(e);await this.shouldRotateLogFile()&&(await this.rotateLogFiles(),this.currentLogFile=this.getLogFilePath()),await i.promises.appendFile(this.currentLogFile,r+"\n","utf8")}catch(e){console.error("Failed to write to log file:",e)}}formatLogEntry(e){const r=[e.timestamp,e.level,e.component,e.message];return e.context&&Object.keys(e.context).length>0&&r.push(JSON.stringify(e.context)),e.stack&&r.push(e.stack.replace(/\n/g,"\\n")),r.join(" | ")}shouldLog(e){const r=[t.DEBUG,t.INFO,t.WARN,t.ERROR,t.FATAL],s=r.indexOf(this.config.minLogLevel);return r.indexOf(e)>=s}async ensureLogDirectory(){try{i.existsSync(this.config.logDirectory)||await i.promises.mkdir(this.config.logDirectory,{recursive:!0})}catch(e){console.error("Failed to create log directory:",e)}}getLogFilePath(){const e=(new Date).toISOString().split("T")[0];return n.join(this.config.logDirectory,`app-${e}.log`)}async shouldRotateLogFile(){if(!this.currentLogFile||!i.existsSync(this.currentLogFile))return!1;try{return(await i.promises.stat(this.currentLogFile)).size>=this.config.maxLogFileSize}catch(e){return!1}}async rotateLogFiles(){try{const e=(await i.promises.readdir(this.config.logDirectory)).filter(e=>e.startsWith("app-")&&e.endsWith(".log")).map(e=>({name:e,path:n.join(this.config.logDirectory,e),mtime:i.statSync(n.join(this.config.logDirectory,e)).mtime})).sort((e,r)=>r.mtime.getTime()-e.mtime.getTime());if(e.length>=this.config.maxLogFiles){const r=e.slice(this.config.maxLogFiles-1);for(const e of r)await i.promises.unlink(e.path)}}catch(e){console.error("Failed to rotate log files:",e)}}getRecentLogs(e=100){return this.logBuffer.slice(-e)}getLogsByLevel(e,r=100){return this.logBuffer.filter(r=>r.level===e).slice(-r)}getLogsByComponent(e,r=100){return this.logBuffer.filter(r=>r.component===e).slice(-r)}clearBuffer(){this.logBuffer=[]}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}}let a=null;function g(){return a||(a=new c),a}var l,u;!function(e){e.VALIDATION="VALIDATION",e.AUTHENTICATION="AUTHENTICATION",e.AUTHORIZATION="AUTHORIZATION",e.NETWORK="NETWORK",e.FILE_SYSTEM="FILE_SYSTEM",e.POWERSHELL="POWERSHELL",e.DATABASE="DATABASE",e.CONFIGURATION="CONFIGURATION",e.UNKNOWN="UNKNOWN"}(l||(l={})),function(e){e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.CRITICAL="CRITICAL"}(u||(u={}));class h extends Error{code;category;severity;component;context;userMessage;suggestions;constructor(e,r,s,t,o,i,n,c){super(r),this.name="ApplicationError",this.code=e,this.category=s,this.severity=t,this.component=o,this.context=n,this.userMessage=i,this.suggestions=c,Error.captureStackTrace(this,this.constructor)}}class f{loggingService=g();handleError(e,r,s={}){const{logError:t=!0,notifyUser:o=!1,throwError:i=!1}=s,n=this.normalizeError(e,r);if(t&&this.logError(n),o&&this.notifyUser(n),i)throw new h(n.code,n.message,n.category,n.severity,n.component,n.userMessage,n.context,n.suggestions);return n}normalizeError(e,r){if(e instanceof h)return{code:e.code,message:e.message,category:e.category,severity:e.severity,component:e.component,context:e.context,originalError:e,stack:e.stack,timestamp:(new Date).toISOString(),userMessage:e.userMessage,suggestions:e.suggestions};if(e instanceof Error){const s=this.categorizeError(e),t=this.determineSeverity(e,s);return{code:"UNKNOWN_ERROR",message:e.message,category:s,severity:t,component:r,originalError:e,stack:e.stack,timestamp:(new Date).toISOString(),userMessage:this.getUserFriendlyMessage(e,s),suggestions:this.getSuggestions(e,s)}}return{code:"UNKNOWN_ERROR",message:String(e),category:l.UNKNOWN,severity:u.MEDIUM,component:r,stack:void 0,timestamp:(new Date).toISOString(),userMessage:"An unexpected error occurred. Please try again.",suggestions:["Try refreshing the page","Contact support if the issue persists"]}}categorizeError(e){const r=e.message.toLowerCase();return r.includes("validation")||r.includes("invalid")?l.VALIDATION:r.includes("auth")||r.includes("unauthorized")?l.AUTHENTICATION:r.includes("permission")||r.includes("forbidden")?l.AUTHORIZATION:r.includes("network")||r.includes("fetch")||r.includes("timeout")?l.NETWORK:r.includes("file")||r.includes("path")||r.includes("enoent")?l.FILE_SYSTEM:r.includes("powershell")||r.includes("script")?l.POWERSHELL:r.includes("database")||r.includes("sql")?l.DATABASE:r.includes("config")?l.CONFIGURATION:l.UNKNOWN}determineSeverity(e,r){if(e.message.toLowerCase().includes("fatal"))return u.CRITICAL;switch(r){case l.AUTHENTICATION:case l.AUTHORIZATION:case l.DATABASE:return u.HIGH;case l.NETWORK:case l.FILE_SYSTEM:case l.POWERSHELL:return u.MEDIUM;case l.VALIDATION:case l.CONFIGURATION:return u.LOW;default:return u.MEDIUM}}getUserFriendlyMessage(e,r){switch(r){case l.VALIDATION:return"The provided information is invalid. Please check your inputs and try again.";case l.AUTHENTICATION:return"Authentication failed. Please check your credentials and try again.";case l.AUTHORIZATION:return"You do not have permission to perform this action.";case l.NETWORK:return"Network error occurred. Please check your connection and try again.";case l.FILE_SYSTEM:return"File system error occurred. Please check file permissions and paths.";case l.POWERSHELL:return"PowerShell execution failed. Please check the script and try again.";case l.DATABASE:return"Database error occurred. Please try again or contact support.";case l.CONFIGURATION:return"Configuration error. Please check your settings.";default:return e.message||"An unexpected error occurred. Please try again."}}getSuggestions(e,r){const s=[];switch(r){case l.VALIDATION:s.push("Verify all required fields are filled"),s.push("Check that values are in the correct format");break;case l.AUTHENTICATION:s.push("Verify your username and password"),s.push("Check if your account is active"),s.push("Try logging out and logging in again");break;case l.AUTHORIZATION:s.push("Contact your administrator for access"),s.push("Verify you have the necessary permissions");break;case l.NETWORK:s.push("Check your internet connection"),s.push("Verify the server is accessible"),s.push("Try again in a few moments");break;case l.FILE_SYSTEM:s.push("Verify the file or directory exists"),s.push("Check file permissions"),s.push("Ensure the path is correct");break;case l.POWERSHELL:s.push("Check the PowerShell script for errors"),s.push("Verify required modules are installed"),s.push("Check the execution logs for details");break;case l.DATABASE:s.push("Verify database connection settings"),s.push("Check if the database is accessible"),s.push("Contact support if the issue persists");break;case l.CONFIGURATION:s.push("Review your configuration settings"),s.push("Reset to default configuration if needed"),s.push("Consult documentation for correct settings");break;default:s.push("Try the operation again"),s.push("Refresh the page"),s.push("Contact support if the issue persists")}return s}logError(e){const r=this.getLogLevel(e.severity);this.loggingService.log(r,e.component,e.message,{code:e.code,category:e.category,severity:e.severity,context:e.context,userMessage:e.userMessage,suggestions:e.suggestions},e.originalError)}getLogLevel(e){switch(e){case u.LOW:return t.WARN;case u.MEDIUM:return t.ERROR;case u.HIGH:case u.CRITICAL:return t.FATAL;default:return t.ERROR}}notifyUser(e){console.warn("Error notification:",e.userMessage)}createError(e,r,s,t,o,i,n,c){return new h(e,r,s,t,o,i,n,c)}}let d=null;function p(){return d||(d=new f),d}const m=g();p();function y(){o.ipcMain.handle("log:message",async(e,r)=>{try{const{level:e,component:s,message:o,context:i}=r;switch(e){case t.DEBUG:m.debug(s,o,i);break;case t.INFO:m.info(s,o,i);break;case t.WARN:m.warn(s,o,i);break;case t.ERROR:m.error(s,o,void 0,i);break;case t.FATAL:m.fatal(s,o,void 0,i)}return{success:!0}}catch(e){return console.error("log:message error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),o.ipcMain.handle("log:error",async(e,r)=>{try{const{component:e,message:s,stack:t,context:o}=r,i=new Error(s);return t&&(i.stack=t),m.error(e,s,i,o),{success:!0}}catch(e){return console.error("log:error error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),o.ipcMain.handle("log:getRecent",async(e,r=100)=>{try{return{success:!0,logs:m.getRecentLogs(r)}}catch(e){return console.error("log:getRecent error:",e),{success:!1,error:e instanceof Error?e.message:String(e),logs:[]}}}),o.ipcMain.handle("log:getByLevel",async(e,r)=>{try{const{level:e,count:s=100}=r;return{success:!0,logs:m.getLogsByLevel(e,s)}}catch(e){return console.error("log:getByLevel error:",e),{success:!1,error:e instanceof Error?e.message:String(e),logs:[]}}}),o.ipcMain.handle("log:getByComponent",async(e,r)=>{try{const{component:e,count:s=100}=r;return{success:!0,logs:m.getLogsByComponent(e,s)}}catch(e){return console.error("log:getByComponent error:",e),{success:!1,error:e instanceof Error?e.message:String(e),logs:[]}}}),o.ipcMain.handle("log:clear",async()=>{try{return m.clearBuffer(),{success:!0}}catch(e){return console.error("log:clear error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),o.ipcMain.handle("log:updateConfig",async(e,r)=>{try{return m.updateConfig(r),{success:!0}}catch(e){return console.error("log:updateConfig error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),o.ipcMain.handle("log:getConfig",async()=>{try{return{success:!0,config:m.getConfig()}}catch(e){return console.error("log:getConfig error:",e),{success:!1,error:e instanceof Error?e.message:String(e),config:null}}}),console.log("Logging IPC handlers registered")}async function L(){await m.initialize(),console.log("Logging service initialized")}}};