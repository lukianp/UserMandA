(()=>{var e,t,r,s={17:(e,t,r)=>{var s=r(18),n=r(23);(t=e.exports=r(486)).init=function(e){e.inspectOpts={};for(var r=Object.keys(t.inspectOpts),s=0;s<r.length;s++)e.inspectOpts[r[s]]=t.inspectOpts[r[s]]},t.log=function(){return o.write(n.format.apply(n,arguments)+"\n")},t.formatArgs=function(e){var r=this.namespace,s=this.useColors;if(s){var n=this.color,i="  [3"+n+";1m"+r+" [0m";e[0]=i+e[0].split("\n").join("\n"+i),e.push("[3"+n+"m+"+t.humanize(this.diff)+"[0m")}else e[0]=(new Date).toUTCString()+" "+r+" "+e[0]},t.save=function(e){null==e?delete process.env.DEBUG:process.env.DEBUG=e},t.load=a,t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):s.isatty(i)},t.colors=[6,2,3,4,5,1],t.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var r=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(e,t){return t.toUpperCase()}),s=process.env[t];return s=!!/^(yes|on|true|enabled)$/i.test(s)||!/^(no|off|false|disabled)$/i.test(s)&&("null"===s?null:Number(s)),e[r]=s,e},{});var i=parseInt(process.env.DEBUG_FD,10)||2;1!==i&&2!==i&&n.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var o=1===i?process.stdout:2===i?process.stderr:function(e){var t;switch(process.binding("tty_wrap").guessHandleType(e)){case"TTY":(t=new s.WriteStream(e))._type="tty",t._handle&&t._handle.unref&&t._handle.unref();break;case"FILE":(t=new(r(896).SyncWriteStream)(e,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":(t=new(r(278).Socket)({fd:e,readable:!1,writable:!0})).readable=!1,t.read=null,t._type="pipe",t._handle&&t._handle.unref&&t._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return t.fd=e,t._isStdio=!0,t}(i);function a(){return process.env.DEBUG}t.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts).split("\n").map(function(e){return e.trim()}).join(" ")},t.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts)},t.enable(a())},18:e=>{"use strict";e.exports=require("tty")},23:e=>{"use strict";e.exports=require("util")},109:(e,t,r)=>{var s=r(928),n=r(317).spawn,i=r(329)("electron-squirrel-startup"),o=r(482).app,a=function(e,t){var r=s.resolve(s.dirname(process.execPath),"..","Update.exe");i("Spawning `%s` with args `%s`",r,e),n(r,e,{detached:!0}).on("close",t)};e.exports=function(){if("win32"===process.platform){var e=process.argv[1];i("processing squirrel command `%s`",e);var t=s.basename(process.execPath);if("--squirrel-install"===e||"--squirrel-updated"===e)return a(["--createShortcut="+t],o.quit),!0;if("--squirrel-uninstall"===e)return a(["--removeShortcut="+t],o.quit),!0;if("--squirrel-obsolete"===e)return o.quit(),!0}return!1}()},203:e=>{"use strict";e.exports=require("stream")},225:(e,t,r)=>{"use strict";var s,n,i;r.d(t,{i8:()=>o,mockComputerDetailService:()=>l,mockGroupDetailService:()=>d}),function(e){e.Security="Security",e.Distribution="Distribution",e.MailEnabled="MailEnabled",e.Office365="Office365",e.Dynamic="Dynamic"}(s||(s={})),function(e){e.Universal="Universal",e.Global="Global",e.DomainLocal="DomainLocal",e.None="None"}(n||(n={})),function(e){e.Static="Static",e.Dynamic="Dynamic",e.RuleBased="RuleBased"}(i||(i={}));class o{static instance;cache=new Map;static getInstance(){return o.instance||(o.instance=new o),o.instance}async getUserDetailAsync(e){if(this.cache.has(e))return console.log(`[MockLogicEngine] Returning cached user detail for ${e}`),this.cache.get(e);console.log(`[MockLogicEngine] Generating mock user detail for ${e}`);const t=this.generateMockUserDetail(e);return this.cache.set(e,t),setTimeout(()=>this.cache.delete(e),9e5),t}clearUserDetailCache(e){this.cache.delete(e),console.log(`[MockLogicEngine] Cleared cache for ${e}`)}clearAllCache(){this.cache.clear(),console.log("[MockLogicEngine] Cleared all cache")}isLoaded(){return!0}generateMockUserDetail(e){const t=this.generateMockUser(e),r=this.generateMockGroups(5),s=this.generateMockDevices(3),n=this.generateMockApplications(12),i=this.generateMockDrives(2),o=this.generateMockFileAccess(8),a=this.generateMockGpos(4,"link"),c=this.generateMockGpos(2,"filter"),l=this.generateMockMailbox(t.userPrincipalName),d=this.generateMockAzureRoles(3),u=this.generateMockSqlDatabases(2),p=this.generateMockRisks(4),h=this.generateMockMigrationHints(5),g=r.map(e=>e.name),m=r.filter((e,t)=>t<1).map(e=>e.name),f=t.managerDisplayName||"manager@company.com",y=m,v={totalGroups:r.length,totalDevices:s.length,totalApplications:n.length,totalFileAccess:o.length,totalGpos:a.length+c.length,totalAzureRoles:d.length,totalSqlDatabases:u.length,totalRisks:p.length,highRiskCount:p.filter(e=>"High"===e.severity).length,criticalRiskCount:p.filter(e=>"Critical"===e.severity).length};return{user:t,groups:r,devices:s,apps:n,drives:i,fileAccess:o,gpoLinks:a,gpoFilters:c,mailbox:l,azureRoles:d,sqlDatabases:u,risks:p,migrationHints:h,memberOfGroups:g,managedGroups:m,managerUpn:f,ownedGroups:y,stats:v}}generateMockUser(e){const t=e.includes("@")?e:`${e}@company.com`,r=`User ${e.split("@")[0]}`;return{id:e,name:r,displayName:r,userPrincipalName:t,mail:t,email:t,department:"IT Department",jobTitle:"Senior Engineer",accountEnabled:!0,samAccountName:e.split("@")[0],companyName:"Contoso Corporation",managerDisplayName:"Manager Smith",createdDateTime:new Date("2020-01-15"),userSource:"ActiveDirectory",firstName:"John",lastName:"Doe",country:"United States",company:"Contoso Corporation",givenName:"John",surname:"Doe",city:"New York",mobilePhone:"+1-555-0123",lastSignInDateTime:new Date("2024-10-03"),groupMembershipCount:"5",assignedLicenses:"Office 365 E3, Project Plan 3",enabled:!0,title:"Senior Engineer",isPrivileged:!1,passwordExpiryDate:new Date("2025-01-15"),lastLogonDate:new Date("2024-10-03"),createdDate:new Date("2020-01-15"),canEdit:!0,canResetPassword:!0,canToggleAccount:!0,status:"Enabled",officeLocation:"Building A",manager:"Manager Smith",groups:"IT Admins, Developers",objectType:"User",isSelected:!1,domain:"contoso.com",createdAt:new Date("2020-01-15")}}generateMockGroups(e){const t=[s.Security,s.Distribution,s.Office365],r=[n.Universal,n.Global,n.DomainLocal];return Array.from({length:e},(e,s)=>({id:`group-${s}`,objectId:`obj-group-${s}`,name:`Group ${s+1}`,displayName:`Group ${s+1}`,description:`Mock group ${s+1} for testing`,email:`group${s}@company.com`,groupType:t[s%t.length],scope:r[s%r.length],membershipType:i.Static,memberCount:Math.floor(50*Math.random())+5,owners:[`owner-${s}@company.com`],createdDate:new Date(2020,s%12,s%28+1).toISOString(),lastModified:new Date(2024,9,s%28+1).toISOString(),source:"ActiveDirectory",distinguishedName:`CN=Group ${s+1},OU=Groups,DC=contoso,DC=com`,managedBy:0===s?"CN=User Test,OU=Users,DC=contoso,DC=com":void 0,isSecurityEnabled:s%2==0,isMailEnabled:s%3==0}))}generateMockDevices(e){const t=["Windows 11 Pro","Windows 10 Enterprise","Windows Server 2022"],r=["Dell","HP","Lenovo"];return Array.from({length:e},(e,s)=>({id:`device-${s}`,name:`DESKTOP-${1e3+s}`,dns:`desktop-${1e3+s}.contoso.com`,os:t[s%t.length],ou:"OU=Workstations,DC=contoso,DC=com",primaryUserSid:"S-1-5-21-123456789-123456789-123456789-1001",lastSeen:new Date(2024,9,3-s),ipAddress:`192.168.1.${100+s}`,manufacturer:r[s%r.length],model:"OptiPlex "+(7e3+10*s),serialNumber:`SN${1e4+s}`,domain:"contoso.com",isEnabled:!0}))}generateMockApplications(e){return[{name:"Microsoft Office 365",publisher:"Microsoft",version:"16.0.12345"},{name:"Google Chrome",publisher:"Google LLC",version:"120.0.6099"},{name:"Adobe Acrobat Reader",publisher:"Adobe Inc.",version:"2024.001"},{name:"Slack",publisher:"Slack Technologies",version:"4.35.121"},{name:"Visual Studio Code",publisher:"Microsoft",version:"1.84.2"},{name:"Zoom",publisher:"Zoom Video Communications",version:"5.16.5"},{name:"7-Zip",publisher:"7-Zip",version:"23.01"},{name:"VLC Media Player",publisher:"VideoLAN",version:"3.0.20"},{name:"Microsoft Teams",publisher:"Microsoft",version:"1.6.00.36174"},{name:"Notepad++",publisher:"Notepad++ Team",version:"8.6.0"},{name:"Postman",publisher:"Postman Inc.",version:"10.19.0"},{name:"Docker Desktop",publisher:"Docker Inc.",version:"4.25.2"}].slice(0,e).map((e,t)=>({name:e.name,version:e.version,publisher:e.publisher,type:"Application",userCount:Math.floor(10*Math.random())+1,groupCount:Math.floor(3*Math.random()),deviceCount:Math.floor(5*Math.random())+1,lastSeen:new Date(2024,9,4-t%30),id:`app-${t}`,installDate:new Date(2023,t%12,t%28+1),installCount:Math.floor(20*Math.random())+5,status:"Installed",category:t%3==0?"Productivity":t%3==1?"Development":"Communication"}))}generateMockDrives(e){const t=["Z:","Y:","X:","W:"],r=["\\\\fileserver\\users","\\\\fileserver\\shared","\\\\fileserver\\projects","\\\\fileserver\\department"];return Array.from({length:Math.min(e,t.length)},(e,s)=>({driveLetter:t[s],uncPath:r[s],userSid:"S-1-5-21-123456789-123456789-123456789-1001",persistent:!0,label:`Network Drive ${s+1}`,connected:!0}))}generateMockFileAccess(e){const t=["\\\\fileserver\\users\\johndoe","\\\\fileserver\\shared\\documents","\\\\fileserver\\projects\\project-alpha","C:\\Shared\\TeamFiles","\\\\fileserver\\department\\IT","\\\\fileserver\\archives\\2024","C:\\Users\\Public\\Documents","\\\\fileserver\\software\\installers"],r=["FullControl","Modify","ReadAndExecute","Read","Write"];return Array.from({length:Math.min(e,t.length)},(e,s)=>({path:t[s],rights:r[s%r.length],inherited:s%3!=0,isShare:t[s].startsWith("\\\\"),isNtfs:!t[s].startsWith("\\\\"),identitySid:"S-1-5-21-123456789-123456789-123456789-1001",accessType:"Allow",appliesTo:"This folder, subfolders and files"}))}generateMockGpos(e,t){const r="link"===t?["Default Domain Policy","IT Security Policy","Password Policy","Desktop Settings"]:["User Configuration Filter","Security Settings Filter"];return Array.from({length:Math.min(e,r.length)},(e,s)=>({name:r[s],guid:`{${crypto.randomUUID()}}`,enabled:!0,wmiFilter:"filter"===t?'SELECT * FROM Win32_OperatingSystem WHERE Version LIKE "10.%"':void 0,linkedOu:"OU=Users,DC=contoso,DC=com",gpoStatus:"Enabled",description:`Mock GPO ${t} ${s+1}`,createdDate:new Date(2020,s%12,1),modifiedDate:new Date(2024,9,1)}))}generateMockMailbox(e){return e?{mailboxGuid:crypto.randomUUID(),userPrincipalName:e,sizeMb:4567.89,type:"UserMailbox",itemCount:12345,database:"EXCH-DB01",serverName:"EXCH-SERVER01",quotaGB:50,prohibitSendQuotaGB:49,issueWarningQuotaGB:45,lastLogonTime:new Date("2024-10-03T14:30:00Z")}:null}generateMockAzureRoles(e){return[{name:"User",scope:"Directory"},{name:"Application Developer",scope:"Directory"},{name:"Reader",scope:"/subscriptions/12345678-1234-1234-1234-123456789012"}].slice(0,e).map((e,t)=>({roleName:e.name,scope:e.scope,principalObjectId:`obj-${crypto.randomUUID()}`,principalType:"User",assignmentId:crypto.randomUUID(),roleDefinitionId:crypto.randomUUID(),createdOn:new Date(2023,t%12,t%28+1),isInherited:!1}))}generateMockSqlDatabases(e){return[{server:"SQL-SERVER01",instance:"PROD",database:"CRM_Database",role:"db_datareader"},{server:"SQL-SERVER02",instance:"DEV",database:"Analytics_DB",role:"db_owner"}].slice(0,e).map((e,t)=>({server:e.server,instance:e.instance,database:e.database,role:e.role,loginType:"Windows",hasAccess:!0,permissions:["SELECT","INSERT","UPDATE"],appHints:"SSMS, Power BI",lastAccessed:new Date(2024,9,4-t)}))}generateMockRisks(e){return[{type:"StaleAccount",severity:"Medium",description:"User has not logged in for 90+ days",recommendation:"Review account activity and consider disabling if no longer needed",category:"Security"},{type:"OverprivilegedUser",severity:"High",description:"User has excessive permissions across multiple systems",recommendation:"Review and reduce permissions following principle of least privilege",category:"Security"},{type:"MissingMFA",severity:"High",description:"Multi-factor authentication is not enabled for this account",recommendation:"Enable MFA to enhance account security",category:"Security"},{type:"ExpiredPassword",severity:"Low",description:"Password is set to never expire",recommendation:"Implement password expiration policy",category:"Compliance"}].slice(0,e).map((e,t)=>({...e,affectedEntity:`user-${t}`,detectedAt:new Date(2024,9,1),remediation:e.recommendation,cvssScore:"High"===e.severity?7.5:"Medium"===e.severity?5:2}))}generateMockMigrationHints(e){return[{category:"Device",priority:"High",message:"User has 3 devices that need to be migrated. Coordinate device handoff.",actionRequired:!0,impact:"High",complexity:"Medium",estimatedEffort:"4 hours",dependencies:["Device inventory","User coordination"]},{category:"Application",priority:"Medium",message:"2 applications (Adobe Acrobat, Visual Studio) require license transfer",actionRequired:!0,impact:"Medium",complexity:"Low",estimatedEffort:"1 hour",dependencies:["License management"]},{category:"Group",priority:"High",message:"User is member of 5 groups - map to target directory groups",actionRequired:!0,impact:"High",complexity:"Medium",estimatedEffort:"2 hours",dependencies:["Group mapping","Access validation"]},{category:"Mailbox",priority:"High",message:"Mailbox size is 4.5GB - plan for migration window",actionRequired:!0,impact:"High",complexity:"Medium",estimatedEffort:"6 hours",dependencies:["Bandwidth availability","User notification"]},{category:"FileAccess",priority:"Medium",message:"User has 8 file share permissions - verify access in target environment",actionRequired:!1,impact:"Medium",complexity:"Low",estimatedEffort:"1 hour",dependencies:["File share mapping"]}].slice(0,e)}}class a{static instance;cache=new Map;static getInstance(){return a.instance||(a.instance=new a),a.instance}async getComputerDetailAsync(e){if(this.cache.has(e))return console.log(`[MockComputerDetail] Returning cached computer detail for ${e}`),this.cache.get(e);console.log(`[MockComputerDetail] Generating mock computer detail for ${e}`);const t=this.generateMockComputerDetail(e);return this.cache.set(e,t),setTimeout(()=>this.cache.delete(e),9e5),t}clearComputerDetailCache(e){this.cache.delete(e),console.log(`[MockComputerDetail] Cleared cache for ${e}`)}generateMockComputerDetail(e){const t=this.generateMockComputer(e),r=this.generateMockComputerUsers(3),s=this.generateMockSoftware(45),n=this.generateMockHardwareSpec(),i=this.generateMockSecurityStatus(),o=this.generateMockNetworkInfo(),a=this.generateMockComputerGroups(5),c=this.generateMockComputerApps(12),l=this.generateMockComputerRisks(4),d=this.generateMockComputerMigrationHints(5);return{computer:t,overview:{userCount:r.length,softwareCount:s.length,groupCount:a.length,networkAdapterCount:o.adapters.length,lastBootTime:new Date(Date.now()-2592e5),uptime:"3 days, 12 hours, 45 minutes",installDate:new Date(2023,0,15)},users:r,software:s,hardware:n,security:i,network:o,groups:a,apps:c,risks:l,migrationHints:d,primaryUser:r[0]?.userPrincipalName||null,assignedUsers:r.map(e=>e.userPrincipalName),memberOfGroups:a.map(e=>e.name),stats:{totalUsers:r.length,totalSoftware:s.length,totalGroups:a.length,totalRisks:l.length,highRiskCount:l.filter(e=>"High"===e.severity).length,criticalRiskCount:l.filter(e=>"Critical"===e.severity).length,diskUsagePercentage:Math.floor(100*(1-n.freeDiskGB/n.totalDiskGB)),complianceScore:85}}}generateMockComputer(e){const t=["Windows 11 Pro","Windows 10 Enterprise","Windows Server 2022","Windows Server 2019"],r=t[e.charCodeAt(0)%t.length];return{id:e,name:`WKS-${e.padStart(6,"0")}`,dns:`wks-${e}.contoso.com`,domain:"contoso.com",ou:"OU=Workstations,OU=Computers,DC=contoso,DC=com",os:r,osVersion:r.includes("11")?"10.0.22631":r.includes("10")?"10.0.19045":"10.0.20348",status:e.charCodeAt(0)%3==0?"Online":e.charCodeAt(0)%3==1?"Offline":"Unknown",lastSeen:new Date(Date.now()-7*Math.random()*24*60*60*1e3),ipAddress:`192.168.${Math.floor(255*Math.random())}.${Math.floor(255*Math.random())}`,macAddress:`00:15:5D:${Math.floor(256*Math.random()).toString(16).toUpperCase().padStart(2,"0")}:${Math.floor(256*Math.random()).toString(16).toUpperCase().padStart(2,"0")}:${Math.floor(256*Math.random()).toString(16).toUpperCase().padStart(2,"0")}`,manufacturer:["Dell","HP","Lenovo"][e.charCodeAt(0)%3],model:["OptiPlex 7090","EliteDesk 800","ThinkCentre M90"][e.charCodeAt(0)%3],serialNumber:`SN${Math.random().toString(36).substring(2,12).toUpperCase()}`,isEnabled:!0,createdDate:new Date(2023,0,15),modifiedDate:new Date,description:"Corporate workstation"}}generateMockComputerUsers(e){return Array.from({length:e},(e,t)=>({userSid:`S-1-5-21-123456789-123456789-123456789-${1e3+t}`,userPrincipalName:`user${t}@contoso.com`,displayName:`User ${t}`,assignmentType:0===t?"Primary":1===t?"Secondary":"LastLogon",lastLogon:new Date(Date.now()-24*t*60*60*1e3),profilePath:`C:\\Users\\user${t}`,isPrimaryUser:0===t}))}generateMockSoftware(e){const t=[{name:"Microsoft Office 365",publisher:"Microsoft",category:"Productivity"},{name:"Google Chrome",publisher:"Google LLC",category:"Browser"},{name:"Adobe Acrobat Reader",publisher:"Adobe Inc.",category:"Productivity"},{name:"Zoom",publisher:"Zoom Video Communications",category:"Communication"},{name:"Microsoft Teams",publisher:"Microsoft",category:"Communication"},{name:"Visual Studio Code",publisher:"Microsoft",category:"Development"},{name:"Slack",publisher:"Slack Technologies",category:"Communication"},{name:"Notepad++",publisher:"Notepad++ Team",category:"Development"},{name:"7-Zip",publisher:"7-Zip",category:"Utility"},{name:"VLC Media Player",publisher:"VideoLAN",category:"Media"}];return Array.from({length:Math.min(e,50)},(e,r)=>{const s=t[r%t.length];return{name:s.name,version:`${Math.floor(10*Math.random())+1}.${Math.floor(100*Math.random())}.${Math.floor(1e3*Math.random())}`,publisher:s.publisher,installDate:new Date(2023,Math.floor(12*Math.random()),Math.floor(28*Math.random())+1),installPath:`C:\\Program Files\\${s.name.replace(/\s+/g,"")}`,category:s.category,size:Math.floor(500*Math.random())+10,licenseKey:null,licenseType:"Commercial"}})}generateMockHardwareSpec(){return{processor:"Intel Core i7-11700 @ 2.50GHz",processorCores:8,processorSpeed:"2.50 GHz",ramGB:16,totalDiskGB:512,freeDiskGB:168,diskType:"SSD",graphicsCard:"Intel UHD Graphics 750",biosVersion:"A12",biosDate:new Date(2023,5,15),systemType:"64-bit",virtualMachine:!1,hypervisor:null}}generateMockSecurityStatus(){return{antivirusInstalled:!0,antivirusProduct:"Windows Defender",antivirusUpToDate:!0,antivirusLastUpdate:new Date(Date.now()-1728e5),firewallEnabled:!0,firewallProfile:"Domain",encryptionEnabled:!0,encryptionType:"BitLocker",tpmEnabled:!0,secureBoot:!0,lastPatchDate:new Date(Date.now()-6048e5),patchLevel:"Fully Patched",complianceStatus:"Compliant",complianceIssues:[],vulnerabilityCount:2,criticalVulnerabilityCount:0}}generateMockNetworkInfo(){return{ipAddress:`192.168.1.${Math.floor(255*Math.random())}`,macAddress:`00:15:5D:${Math.floor(256*Math.random()).toString(16).toUpperCase().padStart(2,"0")}:${Math.floor(256*Math.random()).toString(16).toUpperCase().padStart(2,"0")}:${Math.floor(256*Math.random()).toString(16).toUpperCase().padStart(2,"0")}`,subnet:"255.255.255.0",gateway:"192.168.1.1",dnsServers:["192.168.1.10","192.168.1.11"],dhcpEnabled:!0,dhcpServer:"192.168.1.1",vlan:null,connectionType:"Wired",wifiSSID:null,networkSpeed:"1 Gbps",adapters:[{name:"Ethernet",type:"Ethernet",macAddress:"00:15:5D:AB:CD:EF",status:"Connected",speed:"1 Gbps",ipAddresses:["192.168.1.100"]},{name:"Wi-Fi",type:"WiFi",macAddress:"00:15:5D:12:34:56",status:"Disconnected",speed:null,ipAddresses:[]}]}}generateMockComputerGroups(e){const t=["Domain Computers","Workstations","Finance-Computers","IT-Admin-Computers","VPN Users"];return Array.from({length:Math.min(e,t.length)},(e,r)=>({id:`group-${r}`,objectId:`obj-group-${r}`,name:t[r],displayName:t[r],description:`Computer group ${r}`,email:null,groupType:s.Security,scope:n.Global,membershipType:i.Static,memberCount:Math.floor(100*Math.random())+10,owners:["admin@contoso.com"],createdDate:new Date(2020,r%12,1).toISOString(),lastModified:(new Date).toISOString(),source:"ActiveDirectory",distinguishedName:`CN=${t[r]},OU=Groups,DC=contoso,DC=com`,managedBy:void 0,isSecurityEnabled:!0,isMailEnabled:!1}))}generateMockComputerApps(e){return[{name:"Microsoft Office 365",publisher:"Microsoft",version:"16.0.12345"},{name:"Google Chrome",publisher:"Google LLC",version:"120.0.6099"},{name:"Adobe Acrobat Reader",publisher:"Adobe Inc.",version:"2024.001"},{name:"Slack",publisher:"Slack Technologies",version:"4.35.121"},{name:"Visual Studio Code",publisher:"Microsoft",version:"1.84.2"},{name:"Zoom",publisher:"Zoom Video Communications",version:"5.16.5"},{name:"7-Zip",publisher:"7-Zip",version:"23.01"},{name:"VLC Media Player",publisher:"VideoLAN",version:"3.0.20"},{name:"Microsoft Teams",publisher:"Microsoft",version:"1.6.00.36174"},{name:"Notepad++",publisher:"Notepad++ Team",version:"8.6.0"},{name:"Postman",publisher:"Postman Inc.",version:"10.19.0"},{name:"Docker Desktop",publisher:"Docker Inc.",version:"4.25.2"}].slice(0,e).map((e,t)=>({name:e.name,version:e.version,publisher:e.publisher,type:"Application",userCount:Math.floor(10*Math.random())+1,groupCount:Math.floor(3*Math.random()),deviceCount:Math.floor(5*Math.random())+1,lastSeen:new Date(2024,9,4-t%30),id:`app-${t}`,installDate:new Date(2023,t%12,t%28+1),installCount:Math.floor(20*Math.random())+5,status:"Installed",category:t%3==0?"Productivity":t%3==1?"Development":"Communication"}))}generateMockComputerRisks(e){return[{type:"OutdatedOS",severity:"High",description:"Operating system version is outdated and should be upgraded",recommendation:"Schedule OS upgrade to latest version",category:"Security"},{type:"MissingPatches",severity:"Medium",description:"3 critical security patches are missing",recommendation:"Apply missing patches during next maintenance window",category:"Security"},{type:"LowDiskSpace",severity:"Low",description:"Free disk space is below 20% threshold",recommendation:"Clean up temporary files or expand disk capacity",category:"Performance"},{type:"NoBackup",severity:"High",description:"Computer has not been backed up in 30+ days",recommendation:"Enable automated backup schedule",category:"Configuration"}].slice(0,e).map((e,t)=>({...e,affectedComponent:`computer-${t}`,detectedAt:new Date(2024,9,1),remediation:e.recommendation}))}generateMockComputerMigrationHints(e){return[{category:"Hardware",priority:"Medium",message:"Computer meets minimum requirements for target environment",actionRequired:!1,impact:"Low",complexity:"Low",estimatedEffort:"30 minutes",dependencies:["Hardware inventory"]},{category:"Software",priority:"High",message:"45 applications installed - verify compatibility with target OS",actionRequired:!0,impact:"High",complexity:"High",estimatedEffort:"8 hours",dependencies:["Application compatibility testing"]},{category:"User",priority:"High",message:"3 users assigned - coordinate migration schedule",actionRequired:!0,impact:"High",complexity:"Medium",estimatedEffort:"2 hours",dependencies:["User coordination","Calendar scheduling"]},{category:"Network",priority:"Low",message:"Network configuration is standard - minimal changes required",actionRequired:!1,impact:"Low",complexity:"Low",estimatedEffort:"15 minutes",dependencies:[]},{category:"Security",priority:"Medium",message:"BitLocker enabled - ensure recovery keys are backed up",actionRequired:!0,impact:"Medium",complexity:"Low",estimatedEffort:"30 minutes",dependencies:["Recovery key backup"]}].slice(0,e)}}class c{static instance;cache=new Map;static getInstance(){return c.instance||(c.instance=new c),c.instance}async getGroupDetailAsync(e){if(this.cache.has(e))return console.log(`[MockGroupDetail] Returning cached group detail for ${e}`),this.cache.get(e);console.log(`[MockGroupDetail] Generating mock group detail for ${e}`);const t=this.generateMockGroupDetail(e);return this.cache.set(e,t),setTimeout(()=>this.cache.delete(e),9e5),t}clearGroupDetailCache(e){this.cache.delete(e),console.log(`[MockGroupDetail] Cleared cache for ${e}`)}generateMockGroupDetail(e){const t=this.generateMockGroup(e),r=this.generateMockGroupMembers(25),s=this.generateMockGroupOwners(2),n=this.generateMockGroupPermissions(12),i=this.generateMockGroupApplications(8),o=this.generateMockNestedGroups(5),a=this.generateMockGroupPolicies(3),c=this.generateMockGroupRisks(3),l=this.generateMockGroupMigrationHints(5),d=this.generateMockSyncStatus();return{group:t,overview:{memberCount:r.length,ownerCount:s.length,permissionCount:n.length,applicationCount:i.length,nestedGroupCount:o.length,createdDate:new Date(2022,0,1),modifiedDate:new Date,description:"Security group for department access",notes:null,isHybrid:!0,isDynamic:!1,dynamicMembershipRule:null},members:r,owners:s,permissions:n,applications:i,nestedGroups:o,policies:a,risks:c,migrationHints:l,syncStatus:d,directMembers:r.filter(e=>"Direct"===e.memberType).map(e=>e.userPrincipalName),allMembers:r.map(e=>e.userPrincipalName),primaryOwner:s.find(e=>"Primary"===e.ownershipType)?.userPrincipalName||null,allOwners:s.map(e=>e.userPrincipalName||e.displayName),parentGroups:o.filter(e=>"Parent"===e.relationshipType).map(e=>e.groupName),childGroups:o.filter(e=>"Child"===e.relationshipType).map(e=>e.groupName),stats:{totalMembers:r.length,totalOwners:s.length,totalPermissions:n.length,totalApplications:i.length,totalNestedGroups:o.length,totalRisks:c.length,highRiskCount:c.filter(e=>"High"===e.severity).length,criticalRiskCount:c.filter(e=>"Critical"===e.severity).length,activeMembers:r.filter(e=>e.accountEnabled).length,staleMembers:r.filter(e=>!e.accountEnabled).length,securityScore:82}}}generateMockGroup(e){return{id:e,objectId:`obj-${e}`,name:`Group-${e}`,displayName:`Department Group ${e}`,description:"Mock group for testing",email:`group-${e}@contoso.com`,groupType:s.Security,scope:n.Universal,membershipType:i.Static,memberCount:25,owners:["admin@contoso.com"],createdDate:new Date(2022,0,1).toISOString(),lastModified:(new Date).toISOString(),source:"ActiveDirectory",distinguishedName:`CN=Group-${e},OU=Groups,DC=contoso,DC=com`,managedBy:"CN=Admin,OU=Users,DC=contoso,DC=com",isSecurityEnabled:!0,isMailEnabled:!1}}generateMockGroupMembers(e){return Array.from({length:e},(e,t)=>({id:`member-${t}`,userPrincipalName:`user${t}@contoso.com`,displayName:`User ${t}`,email:`user${t}@contoso.com`,memberType:t<20?"Direct":t<23?"Nested":"Dynamic",addedDate:new Date(2023,t%12,t%28+1),department:["IT","Finance","HR","Sales"][t%4],jobTitle:["Engineer","Manager","Analyst","Director"][t%4],accountEnabled:t<23,membershipSource:t<20?"Manual":"Inherited",isDirectMember:t<20}))}generateMockGroupOwners(e){return Array.from({length:e},(e,t)=>({id:`owner-${t}`,displayName:`Owner ${t}`,type:"User",userPrincipalName:`owner${t}@contoso.com`,email:`owner${t}@contoso.com`,ownershipType:0===t?"Primary":"Secondary",assignedDate:new Date(2022,0,1),isPrimaryOwner:0===t}))}generateMockGroupPermissions(e){const t=["SharePoint Site","Exchange Mailbox","Azure Subscription","File Share"],r=["Full Control","Contribute","Read","Owner"];return Array.from({length:e},(e,s)=>({resourceType:t[s%t.length],resourceName:`Resource-${s}`,permissionLevel:r[s%r.length],accessLevel:r[s%r.length],permissionType:s%2==0?"Direct":"Inherited",scope:s%3==0?"Global":"Limited",isInherited:s%2!=0,inherited:s%2!=0,grantedDate:new Date(2023,s%12,s%28+1),assignedDate:new Date(2023,s%12,s%28+1),assignedBy:"admin@contoso.com",source:["Azure","ActiveDirectory","Exchange","SharePoint"][s%4]}))}generateMockGroupApplications(e){const t=["Microsoft 365","Salesforce","Azure DevOps","GitHub","Jira","Confluence","Slack","Zoom"],r=["Admin","User","Contributor","Reader"];return Array.from({length:e},(e,s)=>({applicationId:`app-${s}`,applicationName:t[s%t.length],accessLevel:r[s%r.length],roleName:r[s%r.length],accessType:s%2==0?"Direct":"Inherited",roles:[r[s%r.length]],grantedDate:new Date(2023,s%12,s%28+1),grantedBy:"admin@contoso.com",source:["Azure","ActiveDirectory"][s%2],isConditionalAccess:s%3==0,isConditional:s%3==0,conditions:s%3==0?["MFA Required","Compliant Device"]:[]}))}generateMockNestedGroups(e){return Array.from({length:e},(e,t)=>({groupId:`nested-group-${t}`,groupName:`Nested Group ${t}`,relationshipType:t<3?"Child":"Parent",relationship:t<3?"Child":"Parent",groupType:"Security",scope:"Global",memberCount:Math.floor(50*Math.random())+5,nestingLevel:t%2==0?1:2,addedDate:new Date(2023,t%12,t%28+1),isCircular:4===t}))}generateMockGroupPolicies(e){return Array.from({length:e},(e,t)=>({policyName:`Group Policy ${t}`,policyGuid:crypto.randomUUID(),policyType:["User","Computer","Both"][t%3],enabled:!0,linkedOu:"OU=Groups,DC=contoso,DC=com",order:t+1,enforced:0===t,appliesTo:"All Users"}))}generateMockGroupRisks(e){return[{type:"StaleMembership",severity:"Medium",description:"2 members have inactive accounts",recommendation:"Review and remove inactive members",category:"Security"},{type:"OverprivilegedGroup",severity:"High",description:"Group has excessive permissions across multiple resources",recommendation:"Review and reduce permissions following principle of least privilege",category:"Security"},{type:"CircularNesting",severity:"High",description:"Circular group nesting detected",recommendation:"Resolve circular dependencies in group membership",category:"Configuration"}].slice(0,e).map((e,t)=>({...e,affectedMembers:[`member-${t}`],affectedResources:[`resource-${t}`],detectedAt:new Date(2024,9,1),remediation:e.recommendation}))}generateMockGroupMigrationHints(e){return[{category:"Membership",priority:"High",message:"Group has 25 members - verify all should be migrated",actionRequired:!0,impact:"High",complexity:"Medium",estimatedEffort:"3 hours",dependencies:["Member verification","Access validation"]},{category:"Permissions",priority:"High",message:"12 permissions assigned - map to target environment",actionRequired:!0,impact:"High",complexity:"High",estimatedEffort:"4 hours",dependencies:["Permission mapping","Resource availability"]},{category:"NestedGroups",priority:"Medium",message:"5 nested group relationships - verify hierarchy in target",actionRequired:!0,impact:"Medium",complexity:"Medium",estimatedEffort:"2 hours",dependencies:["Group hierarchy mapping"]},{category:"Applications",priority:"High",message:"8 application access assignments - verify in target environment",actionRequired:!0,impact:"High",complexity:"Medium",estimatedEffort:"3 hours",dependencies:["Application availability","Role mapping"]},{category:"Sync",priority:"Low",message:"Group is hybrid synced - ensure sync is configured in target",actionRequired:!1,impact:"Low",complexity:"Low",estimatedEffort:"1 hour",dependencies:["Hybrid sync configuration"]}].slice(0,e)}generateMockSyncStatus(){return{isSynced:!0,lastSyncTime:new Date(Date.now()-72e5),syncSource:"ActiveDirectory",syncErrors:[],deltaChanges:0,syncEnabled:!0}}}o.getInstance();const l=a.getInstance(),d=c.getInstance()},231:e=>{"use strict";e.exports=require("chokidar")},278:e=>{"use strict";e.exports=require("net")},317:e=>{"use strict";e.exports=require("child_process")},329:(e,t,r)=>{"undefined"!=typeof process&&"renderer"===process.type?e.exports=r(809):e.exports=r(17)},410:e=>{"use strict";e.exports=require("glob")},434:e=>{"use strict";e.exports=require("events")},482:e=>{"use strict";e.exports=require("electron")},486:(e,t,r)=>{var s;function n(e){function r(){if(r.enabled){var e=r,n=+new Date,i=n-(s||n);e.diff=i,e.prev=s,e.curr=n,s=n;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(r,s){if("%%"===r)return r;c++;var n=t.formatters[s];if("function"==typeof n){var i=o[c];r=n.call(e,i),o.splice(c,1),c--}return r}),t.formatArgs.call(e,o),(r.log||t.log||console.log.bind(console)).apply(e,o)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var r,s=0;for(r in e)s=(s<<5)-s+e.charCodeAt(r),s|=0;return t.colors[Math.abs(s)%t.colors.length]}(e),"function"==typeof t.init&&t.init(r),r}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length,n=0;n<s;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var r,s;for(r=0,s=t.skips.length;r<s;r++)if(t.skips[r].test(e))return!1;for(r=0,s=t.names.length;r<s;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(969),t.names=[],t.skips=[],t.formatters={}},566:(e,t,r)=>{"use strict";r.d(t,{CredentialService:()=>a});var s=r(896),n=r(928),i=r.n(n),o=r(482);class a{credentialsPath;store={credentials:[]};initialized=!1;constructor(){const e=o.app.getPath("userData");this.credentialsPath=i().join(e,"credentials.enc")}async initialize(){if(!this.initialized){if(!o.safeStorage.isEncryptionAvailable())return console.warn("Encryption not available - credentials will not be stored"),void(this.initialized=!0);try{const e=await s.promises.readFile(this.credentialsPath),t=o.safeStorage.decryptString(e);this.store=JSON.parse(t)}catch(e){"ENOENT"!==e.code&&console.error("Error loading credentials:",e),this.store={credentials:[]}}this.initialized=!0}}async storeCredential(e,t,r,s,n,i,a){if(await this.ensureInitialized(),!o.safeStorage.isEncryptionAvailable())throw new Error("Encryption not available - cannot store credentials");const c=o.safeStorage.encryptString(r).toString("base64");this.store.credentials=this.store.credentials.filter(t=>t.profileId!==e),this.store.credentials.push({profileId:e,username:t,encryptedPassword:c,domain:n,connectionType:s,createdAt:(new Date).toISOString(),tenantId:i,clientId:a}),await this.save()}async getCredential(e){await this.ensureInitialized();const t=this.getCredentialsFromEnv();if(t)return console.log(`[CredentialService] Using ENV variables for profile: ${e}`),t;const r=this.store.credentials.find(t=>t.profileId===e);if(r){if(!o.safeStorage.isEncryptionAvailable())throw new Error("Encryption not available - cannot decrypt credentials");try{const t=Buffer.from(r.encryptedPassword,"base64"),s=o.safeStorage.decryptString(t);return r.lastUsed=(new Date).toISOString(),await this.save(),console.log(`[CredentialService] Using safeStorage credentials for profile: ${e}`),{username:r.username,password:s,domain:r.domain,connectionType:r.connectionType,tenantId:r.tenantId,clientId:r.clientId,clientSecret:s}}catch(e){throw console.error("Error decrypting credential:",e),new Error("Failed to decrypt credential")}}const s=await this.loadLegacyCredentials(e);return s?(console.log(`[CredentialService] Found legacy credentials for profile: ${e}`),console.warn("[CredentialService] âš ï¸ Legacy credentials are UNENCRYPTED - migrating to safeStorage"),await this.migrateLegacyCredentials(e,s),{username:s.ClientId,password:s.ClientSecret,connectionType:"AzureAD",tenantId:s.TenantId,clientId:s.ClientId,clientSecret:s.ClientSecret}):(console.log(`[CredentialService] No credentials found for profile: ${e}`),null)}getCredentialsFromEnv(){const e=process.env.AZURE_TENANT_ID,t=process.env.AZURE_CLIENT_ID,r=process.env.AZURE_CLIENT_SECRET;return e&&t&&r?{username:t,password:r,tenantId:e,clientId:t,clientSecret:r,connectionType:"AzureAD"}:null}async loadLegacyCredentials(e){try{const t=i().join("C:","DiscoveryData",e,"Credentials","discoverycredentials.config");console.log(`[CredentialService] Checking legacy credentials at: ${t}`);let r=await s.promises.readFile(t,"utf-8");65279===r.charCodeAt(0)&&(r=r.slice(1));const n=JSON.parse(r);return n.TenantId&&n.ClientId&&n.ClientSecret?n:(console.warn("[CredentialService] Legacy credentials missing required fields"),null)}catch(e){return"ENOENT"!==e.code&&console.error("[CredentialService] Error loading legacy credentials:",e),null}}async migrateLegacyCredentials(e,t){try{console.log(`[CredentialService] Migrating legacy credentials for profile: ${e}`),await this.storeCredential(e,t.ClientId,t.ClientSecret,"AzureAD",t.Domain,t.TenantId,t.ClientId),console.log(`[CredentialService] âœ… Successfully migrated credentials for profile: ${e}`)}catch(e){console.error("[CredentialService] Failed to migrate credentials:",e)}}async deleteCredential(e){await this.ensureInitialized(),this.store.credentials=this.store.credentials.filter(t=>t.profileId!==e),await this.save()}async hasCredential(e){if(await this.ensureInitialized(),this.getCredentialsFromEnv())return!0;if(this.store.credentials.some(t=>t.profileId===e))return!0;return null!==await this.loadLegacyCredentials(e)}async listProfiles(){return await this.ensureInitialized(),this.store.credentials.map(e=>({profileId:e.profileId,username:e.username,connectionType:e.connectionType,createdAt:e.createdAt,lastUsed:e.lastUsed}))}async clearAll(){this.store={credentials:[]},await this.save()}async save(){if(o.safeStorage.isEncryptionAvailable())try{await s.promises.mkdir(i().dirname(this.credentialsPath),{recursive:!0});const e=JSON.stringify(this.store),t=o.safeStorage.encryptString(e);await s.promises.writeFile(this.credentialsPath,t)}catch(e){throw console.error("Error saving credentials:",e),new Error(`Failed to save credentials: ${e}`)}}async ensureInitialized(){this.initialized||await this.initialize()}}},580:(e,t,r)=>{"use strict";function s(e,t){if(void 0===e)throw new Error("lowdb: missing adapter");if(void 0===t)throw new Error("lowdb: missing default data")}r.d(t,{t:()=>n});class n{adapter;data;constructor(e,t){s(e,t),this.adapter=e,this.data=t}async read(){const e=await this.adapter.read();e&&(this.data=e)}async write(){this.data&&await this.adapter.write(this.data)}async update(e){e(this.data),await this.write()}}},809:(e,t,r)=>{function s(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=r(486)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return;var s="color: "+this.color;e.splice(1,0,s,"color: inherit");var n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))}),e.splice(i,0,s)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=s,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(s())},819:function(e,t,r){var s;s=function e(){"use strict";var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},s=!t.document&&!!t.postMessage,n=t.IS_PAPA_WORKER||!1,i={},o=0,a={parse:function(r,s){var n=(s=s||{}).dynamicTyping||!1;if(I(n)&&(s.dynamicTypingFunction=n,n={}),s.dynamicTyping=n,s.transform=!!I(s.transform)&&s.transform,s.worker&&a.WORKERS_SUPPORTED){var c=function(){if(!a.WORKERS_SUPPORTED)return!1;var r=function(){var r=t.URL||t.webkitURL||null,s=e.toString();return a.BLOB_URL||(a.BLOB_URL=r.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",s,")();"],{type:"text/javascript"})))}(),s=new t.Worker(r);return s.onmessage=v,s.id=o++,i[s.id]=s,s}();return c.userStep=s.step,c.userChunk=s.chunk,c.userComplete=s.complete,c.userError=s.error,s.step=I(s.step),s.chunk=I(s.chunk),s.complete=I(s.complete),s.error=I(s.error),delete s.worker,void c.postMessage({input:r,config:s,workerId:c.id})}var l,m=null;return r===a.NODE_STREAM_INPUT&&"undefined"==typeof PAPA_BROWSER_CONTEXT?(m=new g(s)).getStream():("string"==typeof r?(r=65279===(l=r).charCodeAt(0)?l.slice(1):l,m=s.download?new d(s):new p(s)):!0===r.readable&&I(r.read)&&I(r.on)?m=new h(s):(t.File&&r instanceof File||r instanceof Object)&&(m=new u(s)),m.stream(r))},unparse:function(e,t){var r=!1,s=!0,n=",",i="\r\n",o='"',c=o+o,l=!1,d=null,u=!1;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter(function(e){return-1!==t.delimiter.indexOf(e)}).length||(n=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(r=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(l=t.skipEmptyLines),"string"==typeof t.newline&&(i=t.newline),"string"==typeof t.quoteChar&&(o=t.quoteChar),"boolean"==typeof t.header&&(s=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");d=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+o),t.escapeFormulae instanceof RegExp?u=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(u=/^[=+\-@\t\r].*$/)}}();var p=new RegExp(f(o),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return h(null,e,l);if("object"==typeof e[0])return h(d||Object.keys(e[0]),e,l)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||d),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),h(e.fields||[],e.data||[],l);throw new Error("Unable to serialize unrecognized input");function h(e,t,r){var o="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var a=Array.isArray(e)&&e.length>0,c=!Array.isArray(t[0]);if(a&&s){for(var l=0;l<e.length;l++)l>0&&(o+=n),o+=g(e[l],l);t.length>0&&(o+=i)}for(var d=0;d<t.length;d++){var u=a?e.length:t[d].length,p=!1,h=a?0===Object.keys(t[d]).length:0===t[d].length;if(r&&!a&&(p="greedy"===r?""===t[d].join("").trim():1===t[d].length&&0===t[d][0].length),"greedy"===r&&a){for(var m=[],f=0;f<u;f++){var y=c?e[f]:f;m.push(t[d][y])}p=""===m.join("").trim()}if(!p){for(var v=0;v<u;v++){v>0&&!h&&(o+=n);var w=a&&c?e[v]:v;o+=g(t[d][w],v)}d<t.length-1&&(!r||u>0&&!h)&&(o+=i)}}return o}function g(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var s=!1;u&&"string"==typeof e&&u.test(e)&&(e="'"+e,s=!0);var i=e.toString().replace(p,c);return s=s||!0===r||"function"==typeof r&&r(e,t)||Array.isArray(r)&&r[t]||function(e,t){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>-1)return!0;return!1}(i,a.BAD_DELIMITERS)||i.indexOf(n)>-1||" "===i.charAt(0)||" "===i.charAt(i.length-1),s?o+i+o:i}}};if(a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!s&&!!t.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=y,a.ParserHandle=m,a.NetworkStreamer=d,a.FileStreamer=u,a.StringStreamer=p,a.ReadableStreamStreamer=h,"undefined"==typeof PAPA_BROWSER_CONTEXT&&(a.DuplexStreamStreamer=g),t.jQuery){var c=t.jQuery;c.fn.parse=function(e){var r=e.config||{},s=[];return this.each(function(e){if("INPUT"!==c(this).prop("tagName").toUpperCase()||"file"!==c(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var n=0;n<this.files.length;n++)s.push({file:this.files[n],inputElem:this,instanceConfig:c.extend({},r)})}),n(),this;function n(){if(0!==s.length){var t,r,n,o,l=s[0];if(I(e.before)){var d=e.before(l.file,l.inputElem);if("object"==typeof d){if("abort"===d.action)return t="AbortError",r=l.file,n=l.inputElem,o=d.reason,void(I(e.error)&&e.error({name:t},r,n,o));if("skip"===d.action)return void i();"object"==typeof d.config&&(l.instanceConfig=c.extend(l.instanceConfig,d.config))}else if("skip"===d)return void i()}var u=l.instanceConfig.complete;l.instanceConfig.complete=function(e){I(u)&&u(e,l.file,l.inputElem),i()},a.parse(l.file,l.instanceConfig)}else I(e.complete)&&e.complete()}function i(){s.splice(0,1),n()}}}function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=C(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new m(t),this._handle.streamer=this,this._config=t}.call(this,e),this.parseChunk=function(e,r){const s=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&s>0){let t=this._config.newline;if(!t){const r=this._config.quoteChar||'"';t=this._handle.guessLineEndings(e,r)}const r=e.split(t);e=[...r.slice(s)].join(t)}if(this.isFirstChunk&&I(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);void 0!==i&&(e=i)}this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+e;this._partialLine="";var c=this._handle.parse(o,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var l=c.meta.cursor;this._finished||(this._partialLine=o.substring(l-this._baseIndex),this._baseIndex=l),c&&c.data&&(this._rowCount+=c.data.length);var d=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(n)t.postMessage({results:c,workerId:a.WORKER_ID,finished:d});else if(I(this._config.chunk)&&!r){if(this._config.chunk(c,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);c=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(c.data),this._completeResults.errors=this._completeResults.errors.concat(c.errors),this._completeResults.meta=c.meta),this._completed||!d||!I(this._config.complete)||c&&c.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),d||c&&c.meta.paused||this._nextChunk(),c}this._halted=!0},this._sendError=function(e){I(this._config.error)?this._config.error(e):n&&this._config.error&&t.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function d(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),l.call(this,e),this._nextChunk=s?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),s||(t.onload=D(this._chunkLoaded,this),t.onerror=D(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!s),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var r in e)t.setRequestHeader(r,e[r])}if(this._config.chunkSize){var n=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+n)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}s&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||t.status>=400?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var r=t.statusText||e;this._sendError(new Error(r))}}function u(e){var t,r;(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),l.call(this,e);var s="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,s?((t=new FileReader).onload=D(this._chunkLoaded,this),t.onerror=D(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var n=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,n)}var i=t.readAsText(e,this._config.encoding);s||this._chunkLoaded({target:{result:i}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function p(e){var t;e=e||{},l.call(this,e),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,r=this._config.chunkSize;return r?(e=t.substring(0,r),t=t.substring(r)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function h(e){e=e||{},l.call(this,e);var t=[],r=!0,s=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){s&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=D(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=D(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=D(function(){this._streamCleanUp(),s=!0,this._streamData("")},this),this._streamCleanUp=D(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function g(e){var t=r(203).Duplex,s=C(e),n=!0,i=!1,o=[],a=null;this._onCsvData=function(e){var t=e.data;a.push(t)||this._handle.paused()||this._handle.pause()},this._onCsvComplete=function(){a.push(null)},s.step=D(this._onCsvData,this),s.complete=D(this._onCsvComplete,this),l.call(this,s),this._nextChunk=function(){i&&1===o.length&&(this._finished=!0),o.length?o.shift()():n=!0},this._addToParseQueue=function(e,t){o.push(D(function(){if(this.parseChunk("string"==typeof e?e:e.toString(s.encoding)),I(t))return t()},this)),n&&(n=!1,this._nextChunk())},this._onRead=function(){this._handle.paused()&&this._handle.resume()},this._onWrite=function(e,t,r){this._addToParseQueue(e,r)},this._onWriteComplete=function(){i=!0,this._addToParseQueue("")},this.getStream=function(){return a},(a=new t({readableObjectMode:!0,decodeStrings:!1,read:D(this._onRead,this),write:D(this._onWrite,this)})).once("finish",D(this._onWriteComplete,this))}function m(e){var t,r,s,n=Math.pow(2,53),i=-n,o=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,c=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,l=this,d=0,u=0,p=!1,h=!1,g=[],m={data:[],errors:[],meta:{}};if(I(e.step)){var v=e.step;e.step=function(t){if(m=t,D())S();else{if(S(),0===m.data.length)return;d+=t.data.length,e.preview&&d>e.preview?r.abort():(m.data=m.data[0],v(m,l))}}}function w(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function S(){return m&&s&&(E("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),s=!1),e.skipEmptyLines&&(m.data=m.data.filter(function(e){return!w(e)})),D()&&function(){if(m)if(Array.isArray(m.data[0])){for(var t=0;D()&&t<m.data.length;t++)m.data[t].forEach(r);m.data.splice(0,1)}else m.data.forEach(r);function r(t,r){I(e.transformHeader)&&(t=e.transformHeader(t,r)),g.push(t)}}(),function(){if(!m||!e.header&&!e.dynamicTyping&&!e.transform)return m;function t(t,r){var s,n=e.header?{}:[];for(s=0;s<t.length;s++){var i=s,o=t[s];e.header&&(i=s>=g.length?"__parsed_extra":g[s]),e.transform&&(o=e.transform(o,i)),o=b(i,o),"__parsed_extra"===i?(n[i]=n[i]||[],n[i].push(o)):n[i]=o}return e.header&&(s>g.length?E("FieldMismatch","TooManyFields","Too many fields: expected "+g.length+" fields but parsed "+s,u+r):s<g.length&&E("FieldMismatch","TooFewFields","Too few fields: expected "+g.length+" fields but parsed "+s,u+r)),n}var r=1;return!m.data.length||Array.isArray(m.data[0])?(m.data=m.data.map(t),r=m.data.length):m.data=t(m.data,0),e.header&&m.meta&&(m.meta.fields=g),u+=r,m}()}function D(){return e.header&&0===g.length}function b(t,r){return function(t){return e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)}(t)?"true"===r||"TRUE"===r||"false"!==r&&"FALSE"!==r&&(function(e){if(o.test(e)){var t=parseFloat(e);if(t>i&&t<n)return!0}return!1}(r)?parseFloat(r):c.test(r)?new Date(r):""===r?null:r):r}function E(e,t,r,s){var n={type:e,code:t,message:r};void 0!==s&&(n.row=s),m.errors.push(n)}this.parse=function(n,i,o){var c=e.quoteChar||'"';if(e.newline||(e.newline=this.guessLineEndings(n,c)),s=!1,e.delimiter)I(e.delimiter)&&(e.delimiter=e.delimiter(n),m.meta.delimiter=e.delimiter);else{var l=function(t,r,s,n,i){var o,c,l,d;i=i||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var u=0;u<i.length;u++){var p=i[u],h=0,g=0,m=0;l=void 0;for(var f=new y({comments:n,delimiter:p,newline:r,preview:10}).parse(t),v=0;v<f.data.length;v++)if(s&&w(f.data[v]))m++;else{var S=f.data[v].length;g+=S,void 0!==l?S>0&&(h+=Math.abs(S-l),l=S):l=S}f.data.length>0&&(g/=f.data.length-m),(void 0===c||h<=c)&&(void 0===d||g>d)&&g>1.99&&(c=h,o=p,d=g)}return e.delimiter=o,{successful:!!o,bestDelimiter:o}}(n,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);l.successful?e.delimiter=l.bestDelimiter:(s=!0,e.delimiter=a.DefaultDelimiter),m.meta.delimiter=e.delimiter}var d=C(e);return e.preview&&e.header&&d.preview++,t=n,r=new y(d),m=r.parse(t,i,o),S(),p?{meta:{paused:!0}}:m||{meta:{paused:!1}}},this.paused=function(){return p},this.pause=function(){p=!0,r.abort(),t=I(e.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){l.streamer._halted?(p=!1,l.streamer.parseChunk(t,!0)):setTimeout(l.resume,3)},this.aborted=function(){return h},this.abort=function(){h=!0,r.abort(),m.meta.aborted=!0,I(e.complete)&&e.complete(m),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576);var r=new RegExp(f(t)+"([^]*?)"+f(t),"gm"),s=(e=e.replace(r,"")).split("\r"),n=e.split("\n"),i=n.length>1&&n[0].length<s[0].length;if(1===s.length||i)return"\n";for(var o=0,a=0;a<s.length;a++)"\n"===s[a][0]&&o++;return o>=s.length/2?"\r\n":"\r"}}function f(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function y(e){var t,r=(e=e||{}).delimiter,s=e.newline,n=e.comments,i=e.step,o=e.preview,c=e.fastMode,l=null,d=!1,u=t=void 0===e.quoteChar||null===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(u=e.escapeChar),("string"!=typeof r||a.BAD_DELIMITERS.indexOf(r)>-1)&&(r=","),n===r)throw new Error("Comment character same as delimiter");!0===n?n="#":("string"!=typeof n||a.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),"\n"!==s&&"\r"!==s&&"\r\n"!==s&&(s="\n");var p=0,h=!1;this.parse=function(a,g,m){if("string"!=typeof a)throw new Error("Input must be a string");var y=a.length,v=r.length,w=s.length,S=n.length,C=I(i);p=0;var D=[],b=[],E=[],M=0;if(!a)return _();if(c||!1!==c&&-1===a.indexOf(t)){for(var P=a.split(s),A=0;A<P.length;A++){if(E=P[A],p+=E.length,A!==P.length-1)p+=s.length;else if(m)return _();if(!n||E.substring(0,S)!==n){if(C){if(D=[],U(E.split(r)),B(),h)return _()}else U(E.split(r));if(o&&A>=o)return D=D.slice(0,o),_(!0)}}return _()}for(var $=a.indexOf(r,p),x=a.indexOf(s,p),T=new RegExp(f(u)+f(t),"g"),k=a.indexOf(t,p);;)if(a[p]!==t)if(n&&0===E.length&&a.substring(p,p+S)===n){if(-1===x)return _();p=x+w,x=a.indexOf(s,p),$=a.indexOf(r,p)}else if(-1!==$&&($<x||-1===x))E.push(a.substring(p,$)),p=$+v,$=a.indexOf(r,p);else{if(-1===x)break;if(E.push(a.substring(p,x)),L(x+w),C&&(B(),h))return _();if(o&&D.length>=o)return _(!0)}else for(k=p,p++;;){if(-1===(k=a.indexOf(t,k+1)))return m||b.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:D.length,index:p}),R();if(k===y-1)return R(a.substring(p,k).replace(T,t));if(t!==u||a[k+1]!==u){if(t===u||0===k||a[k-1]!==u){-1!==$&&$<k+1&&($=a.indexOf(r,k+1)),-1!==x&&x<k+1&&(x=a.indexOf(s,k+1));var N=F(-1===x?$:Math.min($,x));if(a.substr(k+1+N,v)===r){E.push(a.substring(p,k).replace(T,t)),p=k+1+N+v,a[k+1+N+v]!==t&&(k=a.indexOf(t,p)),$=a.indexOf(r,p),x=a.indexOf(s,p);break}var O=F(x);if(a.substring(k+1+O,k+1+O+w)===s){if(E.push(a.substring(p,k).replace(T,t)),L(k+1+O+w),$=a.indexOf(r,p),k=a.indexOf(t,p),C&&(B(),h))return _();if(o&&D.length>=o)return _(!0);break}b.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:D.length,index:p}),k++}}else k++}return R();function U(e){D.push(e),M=p}function F(e){var t=0;if(-1!==e){var r=a.substring(k+1,e);r&&""===r.trim()&&(t=r.length)}return t}function R(e){return m||(void 0===e&&(e=a.substring(p)),E.push(e),p=y,U(E),C&&B()),_()}function L(e){p=e,U(E),E=[],x=a.indexOf(s,p)}function _(t){if(e.header&&!g&&D.length&&!d){const t=D[0],r=Object.create(null),s=new Set(t);let n=!1;for(let i=0;i<t.length;i++){let o=t[i];if(I(e.transformHeader)&&(o=e.transformHeader(o,i)),r[o]){let e,a=r[o];do{e=`${o}_${a}`,a++}while(s.has(e));s.add(e),t[i]=e,r[o]++,n=!0,null===l&&(l={}),l[e]=o}else r[o]=1,t[i]=o;s.add(o)}n&&console.warn("Duplicate headers found and renamed."),d=!0}return{data:D,errors:b,meta:{delimiter:r,linebreak:s,aborted:h,truncated:!!t,cursor:M+(g||0),renamedHeaders:l}}}function B(){i(_()),D=[],b=[]}},this.abort=function(){h=!0},this.getCharIndex=function(){return p}}function v(e){var t=e.data,r=i[t.workerId],s=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var n={abort:function(){s=!0,w(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:S,resume:S};if(I(r.userStep)){for(var o=0;o<t.results.data.length&&(r.userStep({data:t.results.data[o],errors:t.results.errors,meta:t.results.meta},n),!s);o++);delete t.results}else I(r.userChunk)&&(r.userChunk(t.results,n,t.file),delete t.results)}t.finished&&!s&&w(t.workerId,t.results)}function w(e,t){var r=i[e];I(r.userComplete)&&r.userComplete(t),r.terminate(),delete i[e]}function S(){throw new Error("Not implemented.")}function C(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=C(e[r]);return t}function D(e,t){return function(){e.apply(t,arguments)}}function I(e){return"function"==typeof e}return n&&(t.onmessage=function(e){var r=e.data;if(void 0===a.WORKER_ID&&r&&(a.WORKER_ID=r.workerId),"string"==typeof r.input)t.postMessage({workerId:a.WORKER_ID,results:a.parse(r.input,r.config),finished:!0});else if(t.File&&r.input instanceof File||r.input instanceof Object){var s=a.parse(r.input,r.config);s&&t.postMessage({workerId:a.WORKER_ID,results:s,finished:!0})}}),d.prototype=Object.create(l.prototype),d.prototype.constructor=d,u.prototype=Object.create(l.prototype),u.prototype.constructor=u,p.prototype=Object.create(p.prototype),p.prototype.constructor=p,h.prototype=Object.create(l.prototype),h.prototype.constructor=h,"undefined"==typeof PAPA_BROWSER_CONTEXT&&(g.prototype=Object.create(l.prototype),g.prototype.constructor=g),a},"function"==typeof define&&define.amd?define([],s):e.exports=s()},857:e=>{"use strict";e.exports=require("os")},896:e=>{"use strict";e.exports=require("fs")},912:(e,t,r)=>{"use strict";r.d(t,{Pv:()=>l});require("fs");const s=require("fs/promises"),n=require("path"),i=require("url");class o{#e;#t;#r=!1;#s=null;#n=null;#i=null;#o=null;#a(e){return this.#o=e,this.#i||=new Promise((e,t)=>{this.#n=[e,t]}),new Promise((e,t)=>{this.#i?.then(e).catch(t)})}async#c(e){this.#r=!0;try{await(0,s.writeFile)(this.#t,e,"utf-8"),await async function(e,t,r){for(let s=0;s<t;s++)try{return await e()}catch(e){if(!(s<t-1))throw e;await new Promise(e=>setTimeout(e,r))}}(async()=>{await(0,s.rename)(this.#t,this.#e)},10,100),this.#s?.[0]()}catch(e){throw e instanceof Error&&this.#s?.[1](e),e}finally{if(this.#r=!1,this.#s=this.#n,this.#n=this.#i=null,null!==this.#o){const e=this.#o;this.#o=null,await this.write(e)}}}constructor(e){this.#e=e,this.#t=function(e){const t=e instanceof URL?(0,i.fileURLToPath)(e):e.toString();return(0,n.join)((0,n.dirname)(t),`.${(0,n.basename)(t)}.tmp`)}(e)}async write(e){return this.#r?this.#a(e):this.#c(e)}}class a{#e;#l;constructor(e){this.#e=e,this.#l=new o(e)}async read(){let e;try{e=await(0,s.readFile)(this.#e,"utf-8")}catch(e){if("ENOENT"===e.code)return null;throw e}return e}write(e){return this.#l.write(e)}}class c{#d;#u;#p;constructor(e,{parse:t,stringify:r}){this.#d=new a(e),this.#u=t,this.#p=r}async read(){const e=await this.#d.read();return null===e?null:this.#u(e)}write(e){return this.#d.write(this.#p(e))}}class l extends c{constructor(e){super(e,{parse:JSON.parse,stringify:e=>JSON.stringify(e,null,2)})}}},928:e=>{"use strict";e.exports=require("path")},943:e=>{"use strict";e.exports=require("fs/promises")},969:e=>{var t=1e3,r=60*t,s=60*r,n=24*s,i=365.25*n;function o(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,a){a=a||{};var c,l=typeof e;if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var o=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!o)return;var a=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*i;case"days":case"day":case"d":return a*n;case"hours":case"hour":case"hrs":case"hr":case"h":return a*s;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===l&&!1===isNaN(e))return a.long?o(c=e,n,"day")||o(c,s,"hour")||o(c,r,"minute")||o(c,t,"second")||c+" ms":function(e){if(e>=n)return Math.round(e/n)+"d";if(e>=s)return Math.round(e/s)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},982:e=>{"use strict";e.exports=require("crypto")}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return s[e].call(r.exports,r,r.exports,i),r.exports}i.m=s,void 0!==i&&(i.ab=__dirname+"/native_modules/"),i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"==typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"==typeof r.then)return r}var n=Object.create(null);i.r(n);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&s&&r;("object"==typeof a||"function"==typeof a)&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>o[e]=()=>r[e]);return o.default=()=>r,i.d(n,o),n},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce((t,r)=>(i.f[r](e,t),t),[])),i.u=e=>e+".main.js",i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r={792:1},i.f.require=(e,t)=>{if(!r[e]){var s=require("./"+i.u(e));r[e]||(e=>{var t=e.modules,s=e.ids,n=e.runtime;for(var o in t)i.o(t,o)&&(i.m[o]=t[o]);n&&n(i);for(var a=0;a<s.length;a++)r[s[a]]=1})(s)}},(()=>{"use strict";var e=i(482),t=i(928),r=i(943),s=i(982),n=i(317),o=i(434),a=i(566);class c extends Error{constructor(e){super(e),this.name="PowerShellError"}}class l extends c{script;constructor(e,t){super(e),this.script=t,this.name="PowerShellSyntaxError"}}class d extends c{exitCode;stderr;constructor(e,t,r){super(e),this.exitCode=t,this.stderr=r,this.name="PowerShellRuntimeError"}}class u extends c{scriptPath;constructor(e,t){super(`Script execution timed out after ${e}ms: ${t}`),this.scriptPath=t,this.name="PowerShellTimeoutError"}}class p extends o.EventEmitter{config;sessionPool;requestQueue;activeExecutions;moduleCache;scriptLibrary;cleanupInterval;initialized;queuePaused;credentialService;constructor(e={},r){super(),this.config={maxPoolSize:e.maxPoolSize||10,minPoolSize:e.minPoolSize||2,sessionTimeout:e.sessionTimeout||3e5,queueSize:e.queueSize||100,enableModuleCaching:!1!==e.enableModuleCaching,defaultTimeout:e.defaultTimeout||6e4,scriptsBaseDir:e.scriptsBaseDir||t.join(process.cwd(),"..")},this.sessionPool=new Map,this.requestQueue=[],this.activeExecutions=new Map,this.moduleCache=new Map,this.scriptLibrary=new Map,this.cleanupInterval=null,this.initialized=!1,this.queuePaused=!1,this.credentialService=r||new a.CredentialService,this.processQueue=this.processQueue.bind(this),this.cleanupIdleSessions=this.cleanupIdleSessions.bind(this)}async initialize(){if(this.initialized)return void console.warn("PowerShellExecutionService already initialized");console.log(`Initializing PowerShell Execution Service (min: ${this.config.minPoolSize}, max: ${this.config.maxPoolSize})`);const e=[];for(let t=0;t<this.config.minPoolSize;t++)e.push(this.createSession());await Promise.all(e),this.cleanupInterval=setInterval(this.cleanupIdleSessions,6e4),this.initialized=!0,console.log(`PowerShell Execution Service initialized with ${this.sessionPool.size} sessions`)}async createSession(){const e=s.randomUUID(),t=`runspace_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r={id:e,process:null,status:"idle",lastUsed:Date.now(),runspaceId:t,executionCount:0};this.sessionPool.set(e,r),console.log(`Created PowerShell session: ${e}`)}async getAvailableSession(){for(const e of this.sessionPool.values())if("idle"===e.status)return e.status="busy",e.lastUsed=Date.now(),e;if(this.sessionPool.size<this.config.maxPoolSize){await this.createSession();for(const e of this.sessionPool.values())if("idle"===e.status)return e.status="busy",e.lastUsed=Date.now(),e}return null}releaseSession(e){const t=this.sessionPool.get(e);t&&(t.status="idle",t.lastUsed=Date.now(),t.executionCount++,this.processQueue())}cleanupIdleSessions(){const e=Date.now(),t=[];for(const[r,s]of this.sessionPool.entries())"idle"===s.status&&this.sessionPool.size>this.config.minPoolSize&&e-s.lastUsed>this.config.sessionTimeout&&t.push(r);for(const e of t){const t=this.sessionPool.get(e);t?.process&&t.process.kill(),this.sessionPool.delete(e),console.log(`Terminated idle session: ${e}`)}}async processQueue(){if(!this.queuePaused)for(;this.requestQueue.length>0;){const e=await this.getAvailableSession();if(!e)break;const t=this.requestQueue.shift();t?this.executeScriptWithSession(e,t.scriptPath,t.args,t.options).then(t.resolve).catch(t.reject):this.releaseSession(e.id)}}resolveScriptPath(e){if(t.isAbsolute(e))return e;const r=[t.join(this.config.scriptsBaseDir,"Scripts"),t.join(this.config.scriptsBaseDir,"Modules"),t.join(this.config.scriptsBaseDir,"Core")];for(const s of r){return t.join(s,e)}return t.join(this.config.scriptsBaseDir,e)}async executeScriptWithSession(e,t,r,o={}){const a=o.cancellationToken||s.randomUUID(),c=this.resolveScriptPath(t),p=o.timeout||this.config.defaultTimeout,h=Date.now();return new Promise((t,s)=>{try{const g=["-NoProfile","-ExecutionPolicy","Bypass","-File",c,...r],m="win32"===process.platform?"powershell.exe":"pwsh";let f;if(o.showWindow&&"win32"===process.platform){console.log(`[PowerShellService.executeScriptWithSession] Spawning VISIBLE PowerShell window for: ${c}`);const e=["/c","start",'""',m,"-NoProfile","-ExecutionPolicy","Bypass","-NoExit","-File",`"${c}"`,...r.map(e=>`"${e}"`)];f=(0,n.spawn)("cmd.exe",e,{cwd:o.workingDirectory||this.config.scriptsBaseDir,env:{...process.env,...o.environmentVariables,PSModulePath:process.env.PSModulePath||""},shell:!0,windowsHide:!1})}else f=(0,n.spawn)(m,g,{cwd:o.workingDirectory||this.config.scriptsBaseDir,env:{...process.env,...o.environmentVariables,PSModulePath:process.env.PSModulePath||""}});this.activeExecutions.set(a,f);let y="",v="";const w=[],S=[],C=[],D=[];let I=setTimeout(()=>{f.kill("SIGTERM");const t=new u(p,c);this.activeExecutions.delete(a),this.releaseSession(e.id),s(t)},p);f.stdout?.on("data",e=>{const t=e.toString();y+=t,this.parseAndEmitStreams(t,a,o.streamOutput||!1)}),f.stderr?.on("data",e=>{const t=e.toString();v+=t,this.parseStderrStreams(t,a,o.streamOutput||!1,w,S,C,D)}),f.on("close",r=>{I&&(clearTimeout(I),I=null),this.activeExecutions.delete(a),this.releaseSession(e.id);const s=Date.now()-h;if(0!==r){if(v.includes("ParserError")||v.includes("Unexpected token")){const e={success:!1,error:new l(`Script contains syntax errors:\n${v}`,c).message,duration:s,warnings:w,stdout:y,stderr:v,exitCode:r||-1};return void t(e)}const e={success:!1,error:new d(`Script failed with exit code ${r}`,r||-1,v).message,duration:s,warnings:w,stdout:y,stderr:v,exitCode:r||-1};return void t(e)}try{const e="<<<JSON_RESULT_START>>>",n="<<<JSON_RESULT_END>>>";let o=y.trim();const a=y.indexOf(e),c=y.indexOf(n);-1!==a&&-1!==c&&(o=y.substring(a+e.length,c).trim());const l=i(896),d="C:\\discoverydata\\powershell_debug_output.txt";try{const e=["========== POWERSHELL DEBUG OUTPUT ==========",`Timestamp: ${(new Date).toISOString()}`,`stdout length: ${y.length}`,`stderr length: ${v.length}`,`jsonContent length: ${o.length}`,"","========== FULL STDOUT ==========",y,"","========== STDERR ==========",v,"","========== EXTRACTED JSON CONTENT ==========",o,"","=========================================="].join("\n");l.writeFileSync(d,e,"utf8"),console.log(`[PowerShellService] Full output written to: ${d}`)}catch(e){console.error("[PowerShellService] Failed to write debug log:",e)}console.log("[PowerShellService] ========== STDOUT DEBUG =========="),console.log("[PowerShellService] stdout length:",y.length),console.log("[PowerShellService] Last 2000 chars of stdout:\n",y.substring(Math.max(0,y.length-2e3))),console.log("[PowerShellService] stderr length:",v.length),v.length>0&&console.log("[PowerShellService] stderr:\n",v),console.log("[PowerShellService] jsonContent length:",o.length),console.log("[PowerShellService] jsonContent:",o),console.log("[PowerShellService] ====================================");const u=o?JSON.parse(o):{};t({success:!0,data:u,duration:s,warnings:w,stdout:y,stderr:v,exitCode:r||0})}catch(e){const n={success:!1,error:`Failed to parse JSON output: ${e.message}\n\nOutput:\n${y}`,duration:s,warnings:w,stdout:y,stderr:v,exitCode:r||0};t(n)}}),f.on("error",r=>{I&&clearTimeout(I),this.activeExecutions.delete(a),this.releaseSession(e.id);const s={success:!1,error:`Process error: ${r.message}`,duration:Date.now()-h,warnings:w,stderr:r.message};t(s)})}catch(r){this.releaseSession(e.id);const s={success:!1,error:`Execution error: ${r.message}`,duration:Date.now()-h,warnings:[]};t(s)}})}parseAndEmitStreams(e,t,r){if(!r)return;const s={executionId:t,data:e,type:"output",timestamp:new Date};this.emit("output",s),this.emit("stream:output",s)}parseStderrStreams(e,t,r,s,n,i,o){const a=e.split("\n");for(const e of a)if(e.trim())if(e.startsWith("WARNING: ")){const n=e.replace("WARNING: ","");if(s.push(n),r){const e={executionId:t,data:n,type:"warning",timestamp:new Date};this.emit("output",e),this.emit("stream:warning",e)}}else if(e.startsWith("VERBOSE: ")){const s=e.replace("VERBOSE: ","");if(n.push(s),r){const e={executionId:t,data:s,type:"verbose",timestamp:new Date};this.emit("output",e),this.emit("stream:verbose",e)}}else if(e.startsWith("DEBUG: ")){const s=e.replace("DEBUG: ","");if(i.push(s),r){const e={executionId:t,data:s,type:"debug",timestamp:new Date};this.emit("output",e),this.emit("stream:debug",e)}}else if(e.startsWith("INFORMATION: ")||e.startsWith("INFO: ")){const s=e.replace(/^(INFORMATION|INFO): /,"");if(o.push(s),r){console.log(`[PowerShellService] ðŸ”” Emitting INFORMATION stream event: ${s.substring(0,100)}...`);const e={executionId:t,data:s,type:"information",timestamp:new Date};this.emit("output",e),this.emit("stream:information",e)}else console.log(`[PowerShellService] âš ï¸ streamOutput is FALSE, not emitting: ${s.substring(0,100)}...`)}else if(e.includes("ERROR:")||e.includes("Exception")){if(r){const r={executionId:t,data:e,type:"error",timestamp:new Date};this.emit("output",r),this.emit("stream:error",r)}}else{const s=e;if(o.push(s),r){const e={executionId:t,data:s,type:"information",timestamp:new Date};this.emit("output",e),this.emit("stream:information",e)}}}async discoverModules(){try{const e=t.join(process.env.TEMP||"/tmp",`discover_modules_${s.randomUUID()}.ps1`);await r.writeFile(e,"\n      Get-Module -ListAvailable | Select-Object Name, Version, Path, Description, Author, CompanyName, Guid, @{\n        Name='ExportedCommands';\n        Expression={ ($_.ExportedCommands.Keys | Sort-Object) -join ',' }\n      } | ConvertTo-Json -Depth 3\n    ","utf-8");const n=await this.executeScript(e,[],{timeout:3e4});if(await r.unlink(e).catch(()=>{}),!n.success||!n.data)return console.warn("Module discovery failed:",n.error),[];return(Array.isArray(n.data)?n.data:[n.data]).map(e=>({name:e.Name,version:e.Version?.ToString()||e.Version||"Unknown",path:e.Path,description:e.Description,author:e.Author,companyName:e.CompanyName,guid:e.Guid,exportedCommands:e.ExportedCommands?e.ExportedCommands.split(",").filter(Boolean):[]}))}catch(e){return console.error("Error discovering modules:",e),[]}}async executeParallel(e){if(!this.initialized)throw new Error("PowerShellExecutionService not initialized. Call initialize() first.");const t=this.config.maxPoolSize,r=new Array(e.length);for(let s=0;s<e.length;s+=t){const n=e.slice(s,s+t).map(async(e,t)=>{const r=await this.executeScript(e.scriptPath,e.args,e.options);return{index:s+t,result:r}}),i=await Promise.all(n);for(const{index:e,result:t}of i)r[e]=t}return r}async executeWithRetry(e,t=[],r={},s=3,n=1e3){let i=null,o=0;for(;o<=s;){try{const n=await this.executeScript(e,t,r);if(n.success)return o>0&&console.log(`Script succeeded on attempt ${o+1}/${s+1}`),n;if(!this.isTransientError(n.error||"")||o===s)return n;i=new Error(n.error)}catch(e){if(i=e,!this.isTransientError(e.message)||o===s)throw e}const a=n*Math.pow(2,o);console.log(`Script failed, retrying in ${a}ms (attempt ${o+1}/${s+1})...`),await new Promise(e=>setTimeout(e,a)),o++}throw i||new Error("Script execution failed after retries")}isTransientError(e){return[/timeout/i,/connection/i,/network/i,/temporarily unavailable/i,/too many requests/i,/service unavailable/i,/ECONNRESET/i,/ETIMEDOUT/i,/throttl/i].some(t=>t.test(e))}async executeScript(e,t=[],r={}){if(!this.initialized)throw new Error("PowerShellExecutionService not initialized. Call initialize() first.");const n=await this.getAvailableSession();return n?this.executeScriptWithSession(n,e,t,r):this.requestQueue.length>=this.config.queueSize?{success:!1,error:"Request queue is full. Too many concurrent executions.",duration:0,warnings:[]}:new Promise((n,i)=>{const o={id:s.randomUUID(),scriptPath:e,args:t,options:r,resolve:n,reject:i,timestamp:Date.now()};this.requestQueue.push(o),console.log(`Queued request ${o.id}, queue size: ${this.requestQueue.length}`)})}async executeModule(e,n,i={},o={}){try{console.log(`[PowerShellService.executeModule] showWindow: ${o.showWindow}, function: ${n}`);const a=JSON.stringify(i),c=t.join(process.env.TEMP||"/tmp",`ps_result_${s.randomUUID()}.json`),l=o.showWindow?`\n        # Discovery Module Execution Window\n        $Host.UI.RawUI.WindowTitle = "Discovery Module: ${n}"\n\n        Write-Host '========================================' -ForegroundColor Cyan\n        Write-Host 'Discovery Module - PowerShell Execution' -ForegroundColor Cyan\n        Write-Host '========================================' -ForegroundColor Cyan\n        Write-Host ''\n        Write-Host "Module: ${e}" -ForegroundColor Yellow\n        Write-Host "Function: ${n}" -ForegroundColor Yellow\n        Write-Host ''\n        Write-Host '========================================' -ForegroundColor Cyan\n        Write-Host ''\n\n        # Enable ONLY Information stream for clean, summary-level output\n        # Suppress verbose/debug to avoid HTTP request spam from Graph SDK\n        $InformationPreference = 'Continue'\n        $VerbosePreference = 'SilentlyContinue'  # Suppress verbose HTTP logs\n        $DebugPreference = 'SilentlyContinue'    # Suppress debug HTTP logs\n        $WarningPreference = 'Continue'          # Keep warnings visible\n\n        Import-Module '${e}' -Force -ErrorAction Stop\n\n        # Convert JSON to hashtable recursively\n        function ConvertTo-HashtableRecursive {\n            param([Parameter(ValueFromPipeline)] $InputObject)\n\n            if ($null -eq $InputObject) {\n                return $null\n            }\n\n            if ($InputObject -is [System.Collections.IEnumerable] -and $InputObject -isnot [string]) {\n                $collection = @()\n                foreach ($item in $InputObject) {\n                    $collection += ConvertTo-HashtableRecursive $item\n                }\n                return $collection\n            }\n\n            if ($InputObject -is [PSCustomObject]) {\n                $hash = @{}\n                $InputObject.PSObject.Properties | ForEach-Object {\n                    $hash[$_.Name] = ConvertTo-HashtableRecursive $_.Value\n                }\n                return $hash\n            }\n\n            return $InputObject\n        }\n\n        $paramsObj = '${a.replace(/'/g,"''")}' | ConvertFrom-Json\n        $params = ConvertTo-HashtableRecursive $paramsObj\n\n        Write-Host 'Starting discovery execution...' -ForegroundColor Green\n        Write-Host ''\n\n        # Execute function - all Write-Information, Write-Verbose output will be visible\n        try {\n            $result = ${n} @params\n\n            Write-Host ''\n            Write-Host '========================================' -ForegroundColor Green\n            Write-Host 'Discovery Complete!' -ForegroundColor Green\n            Write-Host '========================================' -ForegroundColor Green\n\n            # Write result to temp file for Node.js to read\n            $resultFile = '${c.replace(/\\/g,"\\\\")}'\n            Write-Host "Writing result to: $resultFile" -ForegroundColor Cyan\n\n            if ($null -eq $result) {\n              @{Success=$true} | ConvertTo-Json -Depth 20 | Out-File -FilePath $resultFile -Encoding UTF8\n            } else {\n              $result | ConvertTo-Json -Depth 20 | Out-File -FilePath $resultFile -Encoding UTF8\n            }\n\n            Write-Host 'Result written successfully!' -ForegroundColor Green\n\n            # Also output to stdout for compatibility (though it won't be captured)\n            Write-Output "<<<JSON_RESULT_START>>>"\n            if ($null -eq $result) {\n              @{Success=$true} | ConvertTo-Json -Compress\n            } else {\n              $result | ConvertTo-Json -Depth 20 -Compress\n            }\n            Write-Output "<<<JSON_RESULT_END>>>"\n\n            Write-Host ''\n            Write-Host 'Press any key to close this window...' -ForegroundColor Yellow\n            $null = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyDown')\n        } catch {\n            Write-Host ''\n            Write-Host '========================================' -ForegroundColor Red\n            Write-Host 'Discovery Failed!' -ForegroundColor Red\n            Write-Host "Error: $_" -ForegroundColor Red\n            Write-Host '========================================' -ForegroundColor Red\n\n            # Write error to result file\n            $resultFile = '${c.replace(/\\/g,"\\\\")}'\n            @{\n              Success = $false\n              Error = $_.Exception.Message\n              StackTrace = $_.ScriptStackTrace\n            } | ConvertTo-Json -Depth 5 | Out-File -FilePath $resultFile -Encoding UTF8\n\n            Write-Host ''\n            Write-Host 'Press any key to close this window...' -ForegroundColor Yellow\n            $null = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyDown')\n            throw\n        }\n      `:`\n        # Hidden execution mode with clean summary output\n        $InformationPreference = 'Continue'\n        $VerbosePreference = 'SilentlyContinue'  # Suppress verbose HTTP logs\n        $DebugPreference = 'SilentlyContinue'    # Suppress debug HTTP logs\n        $WarningPreference = 'Continue'          # Keep warnings visible\n\n        Import-Module '${e}' -Force -ErrorAction Stop\n\n        # Convert JSON to hashtable recursively (PowerShell 5.1 compatible)\n        function ConvertTo-HashtableRecursive {\n            param([Parameter(ValueFromPipeline)] $InputObject)\n\n            if ($null -eq $InputObject) {\n                return $null\n            }\n\n            if ($InputObject -is [System.Collections.IEnumerable] -and $InputObject -isnot [string]) {\n                $collection = @()\n                foreach ($item in $InputObject) {\n                    $collection += ConvertTo-HashtableRecursive $item\n                }\n                return $collection\n            }\n\n            if ($InputObject -is [PSCustomObject]) {\n                $hash = @{}\n                $InputObject.PSObject.Properties | ForEach-Object {\n                    $hash[$_.Name] = ConvertTo-HashtableRecursive $_.Value\n                }\n                return $hash\n            }\n\n            return $InputObject\n        }\n\n        $paramsObj = '${a.replace(/'/g,"''")}' | ConvertFrom-Json\n        $params = ConvertTo-HashtableRecursive $paramsObj\n\n        # Execute function and capture result\n        # Note: All output streams (including Information) are already configured above\n        $result = & { ${n} @params }\n\n        # Output JSON result marker and data\n        Write-Output "<<<JSON_RESULT_START>>>"\n        if ($null -eq $result) {\n          @{} | ConvertTo-Json -Compress\n        } else {\n          $result | ConvertTo-Json -Depth 20 -Compress\n        }\n        Write-Output "<<<JSON_RESULT_END>>>"\n      `,d=t.join(process.env.TEMP||"/tmp",`ps_module_${s.randomUUID()}.ps1`);await r.writeFile(d,l,"utf-8");const u=await this.executeScript(d,[],o);if(!o.showWindow)return await r.unlink(d).catch(()=>{}),u;console.log(`[PowerShellService.executeModule] Reading result from file: ${c}`);try{await new Promise(e=>setTimeout(e,500));if(await r.access(c).then(()=>!0).catch(()=>!1)){let e=await r.readFile(c,"utf-8");console.log(`[PowerShellService.executeModule] Read ${e.length} bytes from result file`),65279===e.charCodeAt(0)&&(e=e.substring(1),console.log("[PowerShellService.executeModule] Stripped BOM from file content"));const t=JSON.parse(e);return await r.unlink(d).catch(()=>{}),await r.unlink(c).catch(()=>{}),{success:!1!==t.Success,data:t,duration:u.duration,warnings:u.warnings||[],stdout:u.stdout,stderr:u.stderr,exitCode:u.exitCode}}return console.warn(`[PowerShellService.executeModule] Result file not found: ${c}`),await r.unlink(d).catch(()=>{}),u}catch(e){return console.error(`[PowerShellService.executeModule] Error reading result file: ${e.message}`),await r.unlink(d).catch(()=>{}),await r.unlink(c).catch(()=>{}),u}}catch(e){return{success:!1,error:`Module execution error: ${e.message}`,duration:0,warnings:[]}}}async executeDiscoveryModule(e,r,s={},n={}){try{console.log(`[PowerShellService] Loading credentials for company: ${r}`);const i=await this.credentialService.getCredential(r);if(!i)return{success:!1,error:`No credentials found for company "${r}". Please configure credentials first.`,duration:0,warnings:[]};console.log("[PowerShellService] Credentials loaded:",{tenantId:i.tenantId||"MISSING",clientId:i.clientId||"MISSING",hasClientSecret:!!i.clientSecret,connectionType:i.connectionType});let o;["Azure","Exchange","SharePoint","OneDrive","Teams"].includes(e)?(o={CompanyName:r,TenantId:i.tenantId,ClientId:i.clientId,ClientSecret:i.clientSecret,OutputPath:`C:\\DiscoveryData\\${r}\\Raw`,AdditionalParams:s},console.log(`[PowerShellService] Azure credentials added for ${e} module`)):(o={CompanyName:r,OutputPath:`C:\\DiscoveryData\\${r}\\Raw`,...s},console.log(`[PowerShellService] Skipping Azure credentials for local ${e} module`)),console.log(`[PowerShellService] Executing ${e} discovery for ${r}`),console.log(`[PowerShellService] Output path: ${o.OutputPath}`),console.log("[PowerShellService] AdditionalParams:",JSON.stringify(s,null,2));const a=t.join(this.config.scriptsBaseDir,"Modules","Discovery",`${e}Discovery.psm1`),c=`Invoke-${e}Discovery`,l=await this.executeModule(a,c,o,{...n,timeout:n.timeout||18e5});return l.success?console.log(`[PowerShellService] âœ… ${e} discovery completed successfully`):(console.error(`[PowerShellService] âŒ ${e} discovery failed:`,l.error),l.stderr&&console.error(`[PowerShellService] PowerShell Error Output:\n${l.stderr}`),l.stdout&&console.log(`[PowerShellService] PowerShell Standard Output:\n${l.stdout}`)),l}catch(e){return console.error("[PowerShellService] Discovery module execution error:",e),{success:!1,error:`Discovery module execution error: ${e.message}`,duration:0,warnings:[]}}}cancelExecution(e){const t=this.activeExecutions.get(e);return!!t&&(console.log(`Cancelling execution: ${e}`),t.kill("SIGTERM"),this.activeExecutions.delete(e),this.emit("execution:cancelled",{executionId:e}),!0)}getStatistics(){const e=Array.from(this.sessionPool.values()).filter(e=>"idle"===e.status).length,t=Array.from(this.sessionPool.values()).filter(e=>"busy"===e.status).length;return{poolSize:this.sessionPool.size,idleSessions:e,busySessions:t,activeExecutions:this.activeExecutions.size,queuedRequests:this.requestQueue.length,queuePaused:this.queuePaused,cacheSize:this.moduleCache.size,scriptLibrarySize:this.scriptLibrary.size,totalExecutions:Array.from(this.sessionPool.values()).reduce((e,t)=>e+t.executionCount,0)}}async pauseQueue(){this.queuePaused=!0,console.log("PowerShell execution queue paused"),this.emit("queue:paused")}async resumeQueue(){this.queuePaused=!1,console.log("PowerShell execution queue resumed"),this.emit("queue:resumed"),await this.processQueue()}async clearQueue(){const e=this.requestQueue.length;for(const e of this.requestQueue)e.reject(new Error("Request cancelled - queue cleared"));return this.requestQueue=[],console.log(`Cleared ${e} requests from queue`),this.emit("queue:cleared",{count:e}),e}getQueueStatus(){return{paused:this.queuePaused,length:this.requestQueue.length,oldestRequest:this.requestQueue[0]?.timestamp||null,requests:this.requestQueue.map(e=>({id:e.id,scriptPath:e.scriptPath,timestamp:e.timestamp,waitTime:Date.now()-e.timestamp}))}}async queueScript(e){return this.executeScript(e.scriptPath,e.args,e.options)}async getScriptLibrary(e){const t=Array.from(this.scriptLibrary.values());return e?t.filter(t=>t.category===e):t}async saveScript(e){const t=new Date,r={...e,id:s.randomUUID(),createdAt:t,updatedAt:t,executionCount:0};return this.scriptLibrary.set(r.id,r),console.log(`Saved script to library: ${r.name} (${r.id})`),this.emit("script:saved",r),r}async updateScript(e,t){const r=this.scriptLibrary.get(e);if(!r)return console.warn(`Script not found in library: ${e}`),null;const s={...r,...t,updatedAt:new Date};return this.scriptLibrary.set(e,s),console.log(`Updated script in library: ${s.name} (${e})`),this.emit("script:updated",s),s}async deleteScript(e){const t=this.scriptLibrary.get(e);return t?(this.scriptLibrary.delete(e),console.log(`Deleted script from library: ${t.name} (${e})`),this.emit("script:deleted",{id:e,name:t.name}),!0):(console.warn(`Script not found in library: ${e}`),!1)}async getScript(e){return this.scriptLibrary.get(e)||null}async searchScripts(e){const t=e.toLowerCase();return Array.from(this.scriptLibrary.values()).filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t)))}async executeFromLibrary(e,s={},n={}){const i=this.scriptLibrary.get(e);if(!i)return{success:!1,error:`Script not found in library: ${e}`,duration:0,warnings:[]};try{const o=t.join(process.env.TEMP||"/tmp",`library_${e}_${Date.now()}.ps1`);await r.writeFile(o,i.content,"utf-8");const a=Object.entries(s).flatMap(([e,t])=>[`-${e}`,"string"==typeof t?t:JSON.stringify(t)]),c=await this.executeScript(o,a,n);return await r.unlink(o).catch(()=>{}),c.success&&(i.executionCount++,this.scriptLibrary.set(e,i)),c}catch(e){return{success:!1,error:`Library script execution error: ${e.message}`,duration:0,warnings:[]}}}async getInstalledModules(){return this.discoverModules()}async importModule(e){const n=`Import-Module '${e}' -Force -PassThru | ConvertTo-Json`,i=t.join(process.env.TEMP||"/tmp",`import_${s.randomUUID()}.ps1`);try{await r.writeFile(i,n,"utf-8");const e=await this.executeScript(i,[],{timeout:1e4});return await r.unlink(i).catch(()=>{}),e}catch(e){return{success:!1,error:`Module import error: ${e.message}`,duration:0,warnings:[]}}}async removeModule(e){const n=`Remove-Module '${e}' -Force -ErrorAction SilentlyContinue`,i=t.join(process.env.TEMP||"/tmp",`remove_${s.randomUUID()}.ps1`);try{await r.writeFile(i,n,"utf-8");const e=await this.executeScript(i,[],{timeout:5e3});return await r.unlink(i).catch(()=>{}),e}catch(e){return{success:!1,error:`Module removal error: ${e.message}`,duration:0,warnings:[]}}}async shutdown(){console.log("Shutting down PowerShell Execution Service..."),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null);for(const[e,t]of this.activeExecutions.entries())console.log(`Killing active execution: ${e}`),t.kill("SIGTERM");this.activeExecutions.clear();for(const[e,t]of this.sessionPool.entries())t.process&&(console.log(`Terminating session: ${e}`),t.process.kill("SIGTERM"));this.sessionPool.clear(),this.moduleCache.clear(),this.requestQueue=[],this.initialized=!1,console.log("PowerShell Execution Service shutdown complete")}}const h=class{modules;categories;psService;registryPath;loaded;constructor(e,r){this.modules=new Map,this.categories=new Map,this.psService=e,this.registryPath=r||t.join(process.cwd(),"module-registry.json"),this.loaded=!1}async loadRegistry(e){const t=e||this.registryPath;try{const e=await r.readFile(t,"utf-8"),s=JSON.parse(e);if(s.modules&&Array.isArray(s.modules)){for(const e of s.modules)await this.registerModule(e);console.log(`Loaded ${this.modules.size} modules from registry`),this.loaded=!0}else console.warn("Invalid registry format, expected { modules: [...] }")}catch(e){if("ENOENT"!==e.code)throw console.error(`Failed to load module registry: ${e.message}`),e;console.log(`No module registry found at ${t}, starting with empty registry`),this.loaded=!0}}async saveRegistry(e){const t=e||this.registryPath,s=Array.from(this.modules.values()),n={version:"1.0.0",lastUpdated:(new Date).toISOString(),modules:s};try{await r.writeFile(t,JSON.stringify(n,null,2),"utf-8"),console.log(`Saved ${s.length} modules to registry`)}catch(e){throw console.error(`Failed to save module registry: ${e.message}`),e}}async registerModule(e){if(!e.id||!e.displayName||!e.scriptPath)throw new Error("Module must have id, displayName, and scriptPath");this.modules.has(e.id)&&console.warn(`Module ${e.id} already registered, overwriting`);const t={...e,enabled:!1!==e.enabled,priority:e.priority||100,timeout:e.timeout||6e4,requiredPermissions:e.requiredPermissions||[],parameters:e.parameters||[],version:e.version||"1.0.0",tags:e.tags||[]};this.modules.set(e.id,t),this.categories.has(e.category)||this.categories.set(e.category,[]);const r=this.categories.get(e.category),s=r.findIndex(t=>t.id===e.id);s>=0&&r.splice(s,1),r.push(t),r.sort((e,t)=>t.priority-e.priority),console.log(`Registered module: ${e.id} (${e.category})`)}async unregisterModule(e){const t=this.modules.get(e);if(!t)return!1;this.modules.delete(e);const r=this.categories.get(t.category);if(r){const t=r.findIndex(t=>t.id===e);t>=0&&r.splice(t,1)}return console.log(`Unregistered module: ${e}`),!0}getModule(e){return this.modules.get(e)}getAllModules(){return Array.from(this.modules.values())}getModulesByCategory(e){return this.categories.get(e)||[]}getCategories(){return Array.from(this.categories.entries()).map(([e,t])=>({category:e,count:t.length}))}validateModuleParameters(e,t){const r=this.modules.get(e);if(!r)return{valid:!1,errors:[{parameter:"_module",message:`Module ${e} not found`}]};const s=[];for(const e of r.parameters){const r=t[e.name];if(e.required&&null==r){s.push({parameter:e.name,message:`Parameter '${e.name}' is required`});continue}if(null==r)continue;const n=Array.isArray(r)?"array":typeof r;if(e.type===n||"object"===e.type){if(e.validation){const{validation:t}=e;"number"===e.type&&(void 0!==t.min&&r<t.min&&s.push({parameter:e.name,message:`Parameter '${e.name}' must be >= ${t.min}`,value:r}),void 0!==t.max&&r>t.max&&s.push({parameter:e.name,message:`Parameter '${e.name}' must be <= ${t.max}`,value:r})),"string"===e.type&&(void 0!==t.minLength&&r.length<t.minLength&&s.push({parameter:e.name,message:`Parameter '${e.name}' must have at least ${t.minLength} characters`,value:r}),void 0!==t.maxLength&&r.length>t.maxLength&&s.push({parameter:e.name,message:`Parameter '${e.name}' must have at most ${t.maxLength} characters`,value:r}),t.pattern&&!new RegExp(t.pattern).test(r)&&s.push({parameter:e.name,message:`Parameter '${e.name}' does not match required pattern`,value:r})),"array"===e.type&&(void 0!==t.minLength&&r.length<t.minLength&&s.push({parameter:e.name,message:`Parameter '${e.name}' must have at least ${t.minLength} items`,value:r}),void 0!==t.maxLength&&r.length>t.maxLength&&s.push({parameter:e.name,message:`Parameter '${e.name}' must have at most ${t.maxLength} items`,value:r})),t.enum&&!t.enum.includes(r)&&s.push({parameter:e.name,message:`Parameter '${e.name}' must be one of: ${t.enum.join(", ")}`,value:r})}}else s.push({parameter:e.name,message:`Parameter '${e.name}' must be of type ${e.type}, got ${n}`,value:r})}return{valid:0===s.length,errors:s}}applyDefaults(e,t){const r={...t};for(const t of e.parameters)void 0===r[t.name]&&void 0!==t.default&&(r[t.name]=t.default);return r}async executeModule(e,t={},r){const s=this.modules.get(e);if(!s)return{success:!1,error:`Module ${e} not found in registry`,duration:0,warnings:[]};if(!s.enabled)return{success:!1,error:`Module ${e} is disabled`,duration:0,warnings:[]};const n=this.applyDefaults(s,t),i=this.validateModuleParameters(e,n);if(!i.valid){return{success:!1,error:`Parameter validation failed:\n${i.errors.map(e=>`  - ${e.parameter}: ${e.message}`).join("\n")}`,duration:0,warnings:[]}}const o={timeout:s.timeout,...r},a=[];for(const[e,t]of Object.entries(n))a.push(`-${e}`),"object"==typeof t?a.push(JSON.stringify(t)):a.push(String(t));return console.log(`Executing module ${e} with args:`,a),this.psService.executeScript(s.scriptPath,a,o)}searchModules(e){const t=e.toLowerCase(),r=[];for(const e of this.modules.values())(e.id.toLowerCase().includes(t)||e.displayName.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.tags&&e.tags.some(e=>e.toLowerCase().includes(t)))&&r.push(e);return r.sort((e,t)=>t.priority-e.priority),r}getModulesByTags(e){const t=[],r=e.map(e=>e.toLowerCase());for(const e of this.modules.values())e.tags&&e.tags.some(e=>r.includes(e.toLowerCase()))&&t.push(e);return t.sort((e,t)=>t.priority-e.priority),t}getStatistics(){const e=this.modules.size,t=Array.from(this.modules.values()).filter(e=>e.enabled).length;return{totalModules:e,enabledModules:t,disabledModules:e-t,categories:this.getCategories(),loaded:this.loaded}}};class g extends o.EventEmitter{psService;activeDetections=new Map;constructor(e){super(),this.psService=e}async detectEnvironment(e={}){const t=this.generateDetectionId(),r=new Date;this.activeDetections.set(t,!0),this.emit("detection:started",{detectionId:t,startTime:r});const s={id:t,startTime:r,status:"detecting",detectedEnvironment:"unknown",detectedServices:[],recommendations:[],totalServicesFound:0,confidence:0,errors:[],warnings:[]};try{const r=await Promise.allSettled([!1!==e.detectAzure?this.detectAzureEnvironment(e,t):null,!1!==e.detectOnPremises?this.detectOnPremisesEnvironment(e,t):null,!0===e.detectAWS?this.detectAWSEnvironment(e,t):null,!0===e.detectGCP?this.detectGCPEnvironment(e,t):null]),n=[],i=[];return r.forEach((e,t)=>{if("fulfilled"===e.status&&e.value)n.push(...e.value.services),i.push(...e.value.errors);else if("rejected"===e.status){const r=["azure","on-premises","aws","gcp"][t];i.push({timestamp:new Date,serviceType:r,message:e.reason?.message||"Detection failed"})}}),s.detectedServices=n,s.errors=i,s.totalServicesFound=n.filter(e=>e.detected).length,s.detectedEnvironment=this.determineEnvironmentType(n),s.confidence=this.calculateConfidence(n,i),s.recommendations=this.generateRecommendations(n,s.detectedEnvironment),s.status="completed",s.endTime=new Date,this.emit("detection:completed",s),s}catch(e){return s.status="failed",s.endTime=new Date,s.errors.push({timestamp:new Date,serviceType:"system",message:e.message}),this.emit("detection:failed",s),s}finally{this.activeDetections.delete(t)}}async detectAzureEnvironment(e,r){const s=[],n=[];this.emitProgress(r,"Detecting Azure environment...",10);try{const e=await this.psService.executeScript(t.join("..","Modules","Discovery","AzureDiscovery.psm1"),["-FunctionName","Test-AzureADConnection"],{timeout:3e4,streamOutput:!1}),n=e.data;e.success&&n?.Connected&&s.push({id:"azure-ad",name:"Azure Active Directory",type:"Identity",provider:"azure",detected:!0,version:n.Version,endpoint:n.TenantId,authentication:"OAuth2",features:["SSO","MFA","Conditional Access","PIM"],status:"available",capabilities:[{name:"User Management",available:!0},{name:"Group Management",available:!0},{name:"Application Registration",available:!0},{name:"Conditional Access",available:n.HasPremium,requiresLicense:!0,licenseType:"Azure AD Premium"}]}),this.emitProgress(r,"Detecting Microsoft 365 services...",30);const i=await this.psService.executeScript(t.join("..","Modules","Discovery","ExchangeDiscovery.psm1"),["-FunctionName","Test-ExchangeOnlineConnection"],{timeout:3e4,streamOutput:!1}),o=i.data;i.success&&o?.Connected&&s.push({id:"exchange-online",name:"Exchange Online",type:"Email",provider:"microsoft365",detected:!0,version:o.Version,endpoint:o.Endpoint,authentication:"Modern Auth",features:["Mailboxes","Distribution Groups","Shared Mailboxes","Mail Flow Rules"],status:"available",capabilities:[{name:"Mailbox Management",available:!0},{name:"Advanced Threat Protection",available:o.HasATP,requiresLicense:!0,licenseType:"Exchange Online Plan 2"}]}),this.emitProgress(r,"Detecting SharePoint Online...",50);const a=await this.psService.executeScript(t.join("..","Modules","Discovery","SharePointDiscovery.psm1"),["-FunctionName","Test-SharePointOnlineConnection"],{timeout:3e4,streamOutput:!1}),c=a.data;a.success&&c?.Connected&&s.push({id:"sharepoint-online",name:"SharePoint Online",type:"Collaboration",provider:"microsoft365",detected:!0,version:c.Version,endpoint:c.AdminUrl,authentication:"OAuth2",features:["Sites","Libraries","Lists","Content Types"],status:"available",capabilities:[{name:"Site Collection Management",available:!0},{name:"Advanced DLP",available:c.HasAdvancedDLP,requiresLicense:!0,licenseType:"Microsoft 365 E5"}]});const l=await this.psService.executeScript(t.join("..","Modules","Discovery","TeamsDiscovery.psm1"),["-FunctionName","Test-TeamsConnection"],{timeout:3e4,streamOutput:!1}),d=l.data;l.success&&d?.Connected&&s.push({id:"microsoft-teams",name:"Microsoft Teams",type:"Communication",provider:"microsoft365",detected:!0,version:d.Version,authentication:"OAuth2",features:["Teams","Channels","Calls","Meetings"],status:"available",capabilities:[{name:"Team Management",available:!0},{name:"Phone System",available:d.HasPhoneSystem,requiresLicense:!0,licenseType:"Teams Phone"}]}),this.emitProgress(r,"Azure detection complete",70)}catch(e){n.push({timestamp:new Date,serviceType:"azure",message:`Azure detection error: ${e.message}`})}return{services:s,errors:n}}async detectOnPremisesEnvironment(e,r){const s=[],n=[];this.emitProgress(r,"Detecting on-premises environment...",15);try{const e=await this.psService.executeScript(t.join("..","Modules","Discovery","ActiveDirectoryDiscovery.psm1"),["-FunctionName","Test-ActiveDirectoryConnection"],{timeout:3e4,streamOutput:!1}),n=e.data;e.success&&n?.Connected&&s.push({id:"active-directory",name:"Active Directory",type:"Identity",provider:"on-premises",detected:!0,version:n.ForestFunctionalLevel,endpoint:n.DomainController,authentication:"Kerberos/NTLM",features:["Users","Groups","OUs","GPOs","Trusts"],status:"available",capabilities:[{name:"User Management",available:!0},{name:"Group Policy Management",available:!0},{name:"Fine-Grained Password Policies",available:n.SupportsFGPP}]}),this.emitProgress(r,"Detecting Exchange Server...",35);const i=await this.psService.executeScript(t.join("..","Modules","Discovery","ExchangeDiscovery.psm1"),["-FunctionName","Test-ExchangeServerConnection"],{timeout:3e4,streamOutput:!1}),o=i.data;i.success&&o?.Connected&&s.push({id:"exchange-server",name:"Exchange Server",type:"Email",provider:"on-premises",detected:!0,version:o.Version,endpoint:o.Server,authentication:"NTLM/Kerberos",features:["Mailboxes","DAGs","Public Folders","Transport Rules"],status:"available",capabilities:[{name:"Mailbox Management",available:!0},{name:"Database Availability Groups",available:o.HasDAG}]}),this.emitProgress(r,"Detecting SharePoint Server...",55);const a=await this.psService.executeScript(t.join("..","Modules","Discovery","SharePointDiscovery.psm1"),["-FunctionName","Test-SharePointServerConnection"],{timeout:3e4,streamOutput:!1}),c=a.data;a.success&&c?.Connected&&s.push({id:"sharepoint-server",name:"SharePoint Server",type:"Collaboration",provider:"on-premises",detected:!0,version:c.Version,endpoint:c.WebApplication,authentication:"Windows/SAML",features:["Sites","Service Applications","Search","Workflows"],status:"available",capabilities:[{name:"Site Collection Management",available:!0},{name:"Hybrid Configuration",available:c.IsHybrid}]}),this.emitProgress(r,"On-premises detection complete",75)}catch(e){n.push({timestamp:new Date,serviceType:"on-premises",message:`On-premises detection error: ${e.message}`})}return{services:s,errors:n}}async detectAWSEnvironment(e,r){const s=[],n=[];this.emitProgress(r,"Detecting AWS environment...",20);try{const n=await this.psService.executeScript(t.join("..","Modules","Discovery","AWSDiscovery.psm1"),["-FunctionName","Test-AWSConnection","-AccessKey",e.credentials?.awsAccessKey||"","-SecretKey",e.credentials?.awsSecretKey||""],{timeout:3e4,streamOutput:!1}),i=n.data;n.success&&i?.Connected&&s.push({id:"aws-iam",name:"AWS IAM",type:"Identity",provider:"aws",detected:!0,version:i.Version,endpoint:i.Region,authentication:"AWS Signature",features:["Users","Roles","Policies","Federation"],status:"available",capabilities:[{name:"User Management",available:!0},{name:"Role-Based Access",available:!0},{name:"SSO Integration",available:i.HasSSO}]}),this.emitProgress(r,"AWS detection complete",80)}catch(e){n.push({timestamp:new Date,serviceType:"aws",message:`AWS detection error: ${e.message}`})}return{services:s,errors:n}}async detectGCPEnvironment(e,r){const s=[],n=[];this.emitProgress(r,"Detecting GCP environment...",25);try{const n=await this.psService.executeScript(t.join("..","Modules","Discovery","GCPDiscovery.psm1"),["-FunctionName","Test-GCPConnection","-ProjectId",e.credentials?.gcpProjectId||"","-ServiceAccountKey",e.credentials?.gcpServiceAccountKey||""],{timeout:3e4,streamOutput:!1}),i=n.data;n.success&&i?.Connected&&s.push({id:"gcp-iam",name:"GCP IAM",type:"Identity",provider:"gcp",detected:!0,version:i.Version,endpoint:i.ProjectId,authentication:"OAuth 2.0",features:["Service Accounts","Roles","Policies","Federation"],status:"available",capabilities:[{name:"Service Account Management",available:!0},{name:"Custom Role Creation",available:!0}]}),this.emitProgress(r,"GCP detection complete",85)}catch(e){n.push({timestamp:new Date,serviceType:"gcp",message:`GCP detection error: ${e.message}`})}return{services:s,errors:n}}determineEnvironmentType(e){const t=e.some(e=>"azure"===e.provider&&e.detected),r=e.some(e=>"on-premises"===e.provider&&e.detected),s=e.some(e=>"aws"===e.provider&&e.detected),n=e.some(e=>"gcp"===e.provider&&e.detected);return t&&r?"hybrid":t?"azure":r?"on-premises":s?"aws":n?"gcp":"unknown"}calculateConfidence(e,t){const r=e.length+t.length;if(0===r)return 0;const s=e.filter(e=>e.detected).length;return Math.round(s/r*100)}generateRecommendations(e,t){const r=[];if("hybrid"===t){const t=e.some(e=>"azure-ad"===e.id&&e.detected),s=e.some(e=>"active-directory"===e.id&&e.detected);t&&s&&r.push({id:"hybrid-identity-sync",category:"configuration",priority:"high",title:"Configure Azure AD Connect for Identity Synchronization",description:"Detected both Azure AD and on-premises Active Directory. Implement Azure AD Connect for seamless identity sync.",impact:"Enables single sign-on and unified identity management across cloud and on-premises resources.",effort:"medium",steps:["Install Azure AD Connect on a domain-joined server","Configure synchronization settings","Enable password hash synchronization or federation","Validate user synchronization"],relatedServices:["azure-ad","active-directory"]})}"on-premises"===t&&r.push({id:"cloud-migration-assessment",category:"migration",priority:"critical",title:"Assess Cloud Migration Readiness",description:"On-premises environment detected. Evaluate workloads for cloud migration opportunities.",impact:"Modernize infrastructure, reduce costs, and improve scalability.",effort:"high",steps:["Inventory all applications and dependencies","Assess cloud compatibility","Develop migration roadmap","Pilot migration for non-critical workloads"],relatedServices:e.filter(e=>"on-premises"===e.provider).map(e=>e.id)});e.some(e=>e.capabilities.some(e=>e.requiresLicense&&!e.available))&&r.push({id:"license-optimization",category:"optimization",priority:"medium",title:"Optimize License Assignments",description:"Some detected services have capabilities requiring additional licenses.",impact:"Unlock advanced features and improve security posture.",effort:"low",steps:["Review current license inventory","Identify required licenses for advanced features","Optimize license assignments based on user needs","Monitor license usage"],relatedServices:e.filter(e=>e.capabilities.some(e=>e.requiresLicense)).map(e=>e.id)});return e.some(e=>"azure-ad"===e.id&&e.capabilities.some(e=>"Conditional Access"===e.name&&e.available))&&r.push({id:"conditional-access-policies",category:"security",priority:"high",title:"Implement Conditional Access Policies",description:"Azure AD Premium detected with Conditional Access capability. Enhance security with policy-based access control.",impact:"Improve security posture by enforcing MFA, device compliance, and location-based access.",effort:"medium",steps:["Define access policies for different user groups","Configure MFA requirements","Set up device compliance policies","Test policies with pilot group before rollout"],relatedServices:["azure-ad"]}),r}async validateCredentials(e,r){try{let s;switch(e){case"azure":s=await this.psService.executeScript(t.join("..","Modules","Discovery","AzureDiscovery.psm1"),["-FunctionName","Test-AzureCredentials","-TenantId",r.tenantId||"","-ClientId",r.clientId||"","-ClientSecret",r.clientSecret||""],{timeout:3e4,streamOutput:!1});break;case"on-premises":s=await this.psService.executeScript(t.join("..","Modules","Discovery","ActiveDirectoryDiscovery.psm1"),["-FunctionName","Test-ADCredentials","-Domain",r.domain||"","-Username",r.username||"","-Password",r.password||""],{timeout:3e4,streamOutput:!1});break;case"aws":s=await this.psService.executeScript(t.join("..","Modules","Discovery","AWSDiscovery.psm1"),["-FunctionName","Test-AWSCredentials","-AccessKey",r.accessKey||"","-SecretKey",r.secretKey||""],{timeout:3e4,streamOutput:!1});break;case"gcp":s=await this.psService.executeScript(t.join("..","Modules","Discovery","GCPDiscovery.psm1"),["-FunctionName","Test-GCPCredentials","-ProjectId",r.projectId||"","-ServiceAccountKey",r.serviceAccountKey||""],{timeout:3e4,streamOutput:!1});break;default:return{valid:!1,message:`Unsupported provider: ${e}`}}const n=s.data;return s.success&&n?.Valid?{valid:!0,message:"Credentials validated successfully",details:n}:{valid:!1,message:n?.Message||s.error||"Credential validation failed"}}catch(e){return{valid:!1,message:`Validation error: ${e.message}`}}}async cancelDetection(e){return!!this.activeDetections.has(e)&&(this.activeDetections.delete(e),this.emit("detection:cancelled",{detectionId:e}),!0)}getStatistics(){return{activeDetections:this.activeDetections.size,totalDetectionsRun:0}}generateDetectionId(){return`detection_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}emitProgress(e,t,r){this.emit("detection:progress",{detectionId:e,message:t,percentage:r,timestamp:new Date})}}var m,f,y=i(225),v=i(819),w=i(410);!function(e){e.User="User",e.Group="Group",e.Device="Device",e.App="App",e.Share="Share",e.Path="Path",e.Gpo="Gpo",e.Mailbox="Mailbox",e.Role="Role",e.Db="Db",e.Threat="Threat",e.DataAsset="DataAsset",e.LineageFlow="LineageFlow",e.ExternalIdentity="ExternalIdentity"}(m||(m={})),function(e){e.MemberOf="MemberOf",e.PrimaryUser="PrimaryUser",e.HasApp="HasApp",e.AclOn="AclOn",e.MapsTo="MapsTo",e.LinkedByGpo="LinkedByGpo",e.HasMailbox="HasMailbox",e.AssignedRole="AssignedRole",e.OwnsDb="OwnsDb",e.DependsOn="DependsOn",e.Threatens="Threatens",e.HasGovernanceIssue="HasGovernanceIssue",e.DataFlowTo="DataFlowTo",e.ExternalMapping="ExternalMapping",e.Correlates="Correlates",e.Violates="Violates"}(f||(f={}));class S extends o.EventEmitter{static instance;dataRoot;fuzzyConfig;memoryCache=new Map;isLoading=!1;lastLoadTime;fileLoadTimes=new Map;usersBySid=new Map;usersByUpn=new Map;groupsBySid=new Map;membersByGroupSid=new Map;groupsByUserSid=new Map;devicesByName=new Map;devicesByPrimaryUserSid=new Map;appsById=new Map;appsByDevice=new Map;aclByIdentitySid=new Map;drivesByUserSid=new Map;gposByGuid=new Map;gposBySidFilter=new Map;gposByOu=new Map;mailboxByUpn=new Map;rolesByPrincipalId=new Map;sqlDbsByKey=new Map;fileSharesByPath=new Map;threatsByThreatId=new Map;threatsByAsset=new Map;threatsByCategory=new Map;threatsBySeverity=new Map;governanceByAssetId=new Map;governanceByOwner=new Map;governanceByCompliance=new Map;lineageByLineageId=new Map;lineageBySourceAsset=new Map;lineageByTargetAsset=new Map;externalIdentitiesById=new Map;externalIdentitiesByUpn=new Map;externalIdentitiesByProvider=new Map;externalIdentitiesByMappingStatus=new Map;servicePrincipalsById=new Map;directoryRolesById=new Map;sharePointSitesById=new Map;teamsById=new Map;tenantsById=new Map;applicationSecretsById=new Map;nodes=new Map;edges=[];entityRelationships=new Map;entityMetadata=new Map;appliedInferenceRules=[];lastLoadStats;constructor(e){super(),this.dataRoot=e||"C:\\discoverydata\\ljpops\\Raw",this.fuzzyConfig={LevenshteinThreshold:.8,JaroWinklerThreshold:.85,SoundexEnabled:!1,MetaphoneEnabled:!1,BigramAnalysisEnabled:!1}}static getInstance(e){return S.instance||(S.instance=new S(e)),S.instance}getIsLoading(){return this.isLoading}getLastLoadTime(){return this.lastLoadTime}async loadAllAsync(e,s=!1){if(this.isLoading)return console.warn("Load already in progress, skipping duplicate request"),!1;try{this.isLoading=!0;const n=new Date;this.appliedInferenceRules=[];const i=e||this.dataRoot;console.log(`Starting LogicEngine data load from ${i}${s?" (force reload)":""}`),this.emit("progress",{stage:"init",message:"Initializing data load",percentage:0});try{await r.access(i)}catch{const e=new Error(`Data directory not found: ${i}`);return console.error(`Data directory not found: ${i}`),this.emit("error",{Error:e,Message:e.message}),!1}const o=(await r.readdir(i)).filter(e=>e.toLowerCase().endsWith(".csv")).map(e=>t.join(i,e));if(s)console.log("[LogicEngine] Force reload requested, bypassing cache");else{if(!await this.checkForFileChanges(o)&&this.lastLoadTime)return console.log("No CSV changes detected. Using cached data"),this.emit("progress",{stage:"cached",message:"Using cached data",percentage:100}),!0}await this.clearDataStores(),this.emit("progress",{stage:"loading",message:"Loading CSV files",percentage:10});const a=[this.loadUsersStreamingAsync(i),this.loadGroupsStreamingAsync(i),this.loadDevicesStreamingAsync(i),this.loadApplicationsStreamingAsync(i),this.loadGposStreamingAsync(i),this.loadAclsStreamingAsync(i),this.loadMappedDrivesStreamingAsync(i),this.loadMailboxesStreamingAsync(i),this.loadAzureRolesStreamingAsync(i),this.loadSqlDatabasesStreamingAsync(i),this.loadThreatDetectionStreamingAsync(i),this.loadDataGovernanceStreamingAsync(i),this.loadDataLineageStreamingAsync(i),this.loadExternalIdentitiesStreamingAsync(i)];await Promise.all(a),this.emit("progress",{stage:"indexing",message:"Building indices",percentage:60}),await this.buildIndicesAsync(),this.emit("progress",{stage:"inference",message:"Applying inference rules",percentage:80}),await this.applyInferenceRulesAsync();const c=(new Date).getTime()-n.getTime();this.lastLoadStats={UserCount:this.usersBySid.size,GroupCount:this.groupsBySid.size,DeviceCount:this.devicesByName.size,AppCount:this.appsById.size,GpoCount:this.gposByGuid.size,AclEntryCount:Array.from(this.aclByIdentitySid.values()).reduce((e,t)=>e+t.length,0),MappedDriveCount:Array.from(this.drivesByUserSid.values()).reduce((e,t)=>e+t.length,0),MailboxCount:this.mailboxByUpn.size,AzureRoleCount:Array.from(this.rolesByPrincipalId.values()).reduce((e,t)=>e+t.length,0),SqlDbCount:this.sqlDbsByKey.size,ThreatCount:this.threatsByThreatId.size,GovernanceAssetCount:this.governanceByAssetId.size,LineageFlowCount:this.lineageByLineageId.size,ExternalIdentityCount:this.externalIdentitiesById.size,InferenceRulesApplied:this.appliedInferenceRules.length,FuzzyMatchesFound:this.getFuzzyMatchCount(),LoadDuration:c,LoadTimestamp:n};for(const e of o){const t=await r.stat(e);this.fileLoadTimes.set(e,t.mtime)}return this.lastLoadTime=new Date,console.log(`LogicEngine data load completed successfully in ${c}ms`),this.emit("progress",{stage:"complete",message:"Data load complete",percentage:100}),this.emit("loaded",{Statistics:this.lastLoadStats,AppliedInferenceRules:this.appliedInferenceRules}),!0}catch(e){return console.error("Failed to load LogicEngine data:",e),this.emit("error",{Error:e instanceof Error?e:new Error(String(e)),Message:e.message||String(e)}),!1}finally{this.isLoading=!1}}async buildUserDetailProjection(e){const t=this.usersBySid.get(e)||this.usersByUpn.get(e);if(!t)return console.warn(`User not found: ${e}`),null;const r=this.getGroupsForUser(t.Sid),s=this.getDevicesForUser(t.Sid),n=this.getAppsForUser(t.Sid,s),i=this.drivesByUserSid.get(t.Sid)||[],o=this.getSharesForUser(t.Sid),a=this.getGpoLinksForUser(t),c=this.getGpoFiltersForUser(t.Sid),l=this.mailboxByUpn.get(t.UPN)||this.mailboxByUpn.get(t.Mail||""),d=this.rolesByPrincipalId.get(t.AzureObjectId||"")||[],u=this.getSqlDatabasesForUser(t.Sid),p=this.calculateRisksForUser(t),h=this.generateMigrationHintsForUser(t),g=this.getThreatsForAsset(t.Sid),m=this.getGovernanceForAsset(t.Sid),f=this.getLineageForAsset(t.Sid),y=this.getExternalIdentitiesForUser(t.Sid);return{User:t,Groups:r,Devices:s,Apps:n,Drives:i,Shares:o,GpoLinks:a,GpoFilters:c,Mailbox:l,AzureRoles:d,SqlDatabases:u,Risks:p,MigrationHints:h,MemberOfGroups:r.map(e=>e.Name||e.Dn||"").filter(e=>e),ManagedGroups:r.filter(e=>e.ManagedBy===t.Dn).map(e=>e.Name||e.Dn||""),ManagerUpn:t.Manager||"",OwnedGroups:r.filter(e=>e.ManagedBy===t.Dn).map(e=>e.Name||e.Dn||""),Threats:g,GovernanceIssues:m?[m]:[],DataLineage:f,ExternalIdentities:y}}async checkForFileChanges(e){for(const t of e){const e=this.fileLoadTimes.get(t);if(!e)return!0;if((await r.stat(t)).mtime>e)return!0}return!1}async clearDataStores(){this.usersBySid.clear(),this.usersByUpn.clear(),this.groupsBySid.clear(),this.membersByGroupSid.clear(),this.groupsByUserSid.clear(),this.devicesByName.clear(),this.devicesByPrimaryUserSid.clear(),this.appsById.clear(),this.appsByDevice.clear(),this.aclByIdentitySid.clear(),this.drivesByUserSid.clear(),this.gposByGuid.clear(),this.gposBySidFilter.clear(),this.gposByOu.clear(),this.mailboxByUpn.clear(),this.rolesByPrincipalId.clear(),this.sqlDbsByKey.clear(),this.threatsByThreatId.clear(),this.threatsByAsset.clear(),this.threatsByCategory.clear(),this.threatsBySeverity.clear(),this.governanceByAssetId.clear(),this.governanceByOwner.clear(),this.governanceByCompliance.clear(),this.lineageByLineageId.clear(),this.lineageBySourceAsset.clear(),this.lineageByTargetAsset.clear(),this.externalIdentitiesById.clear(),this.externalIdentitiesByUpn.clear(),this.externalIdentitiesByProvider.clear(),this.externalIdentitiesByMappingStatus.clear(),this.servicePrincipalsById.clear(),this.directoryRolesById.clear(),this.sharePointSitesById.clear(),this.teamsById.clear(),this.tenantsById.clear(),this.applicationSecretsById.clear(),this.nodes.clear(),this.edges=[],this.entityRelationships.clear(),this.entityMetadata.clear(),this.memoryCache.clear()}async loadUsersStreamingAsync(e){console.log(`[LogicEngine] Loading users from: ${e}`);const s=[t.join(e,"*Users*.csv").replace(/\\/g,"/"),t.join(e,"AzureUsers.csv").replace(/\\/g,"/"),t.join(e,"ActiveDirectoryUsers.csv").replace(/\\/g,"/")],n=[];for(const e of s)try{const t=await(0,w.glob)(e,{nocase:!0});console.log(`[LogicEngine] Pattern "${e}" matched ${t.length} files:`,t),n.push(...t)}catch(t){console.debug(`[LogicEngine] No files matched pattern: ${e}`)}const i=[...new Set(n)];console.log(`[LogicEngine] Loading ${i.length} unique user files:`,i);for(const e of i)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseUserFromCsv(e);t&&(this.usersBySid.set(t.Sid,t),t.UPN&&this.usersByUpn.set(t.UPN,t))})}}),console.log(`Loaded ${this.usersBySid.size} users from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseUserFromCsv(e){try{const t=e.UPN||e.UserPrincipalName||e.Mail||"",r=e.Sam||e.SamAccountName||e.SAMAccountName||e.OnPremisesSamAccountName||"",s=e.Sid||e.SID||e.ObjectSid||e.Id||t||r;if(!s)return null;const n=e.Groups?e.Groups.split(";").filter(e=>e):e.GroupMemberships?e.GroupMemberships.split(";").filter(e=>e):[];return{UPN:t,Sam:r,Sid:s,Mail:e.Mail||e.EmailAddress,DisplayName:e.DisplayName||e.Name||r,Enabled:"true"===e.Enabled||"True"===e.Enabled||"1"===e.Enabled||"True"===e.AccountEnabled||"true"===e.AccountEnabled,OU:e.OU||e.OrganizationalUnit,ManagerSid:e.ManagerSid||e.ManagerId||e.Manager,Dept:e.Department||e.Dept,AzureObjectId:e.AzureObjectId||e.ObjectId||e.Id,Groups:n,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e._DiscoveryModule||e.DiscoveryModule||"UserDiscovery",SessionId:e._SessionId||e.SessionId||this.generateSessionId(),Manager:e.Manager,Dn:e.DN||e.DistinguishedName||s}}catch(e){return console.warn("Failed to parse user from CSV:",e),null}}async loadGroupsStreamingAsync(e){console.log(`[LogicEngine] Loading groups from: ${e}`);const s=[t.join(e,"*Groups*.csv").replace(/\\/g,"/"),t.join(e,"AzureGroups.csv").replace(/\\/g,"/"),t.join(e,"ActiveDirectoryGroups.csv").replace(/\\/g,"/")],n=[];for(const e of s)try{const t=await(0,w.glob)(e,{nocase:!0});console.log(`[LogicEngine] Pattern "${e}" matched ${t.length} files:`,t),n.push(...t)}catch(t){console.debug(`[LogicEngine] No files matched pattern: ${e}`)}const i=[...new Set(n)];console.log(`[LogicEngine] Loading ${i.length} unique group files:`,i);for(const e of i)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseGroupFromCsv(e);t&&this.groupsBySid.set(t.Sid,t)})}}),console.log(`Loaded ${this.groupsBySid.size} groups from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseGroupFromCsv(e){try{const t=e.Sid||e.SID||e.ObjectSid||e.Id||e.PrimarySmtpAddress||e.Alias,r=e.Name||e.GroupName||e.CN||e.DisplayName||e.Alias||"";if(!t||!r)return null;const s=e.Members?e.Members.split(";").filter(e=>e):e.SampleMembers?e.SampleMembers.split(";").filter(e=>e):[],n=e.NestedGroups?e.NestedGroups.split(";").filter(e=>e):[];return{Sid:t,Name:r,Type:e.Type||e.GroupType||"Security",Members:s,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e._DiscoveryModule||e.DiscoveryModule||"GroupDiscovery",SessionId:e._SessionId||e.SessionId||this.generateSessionId(),NestedGroups:n,Dn:e.DN||e.DistinguishedName||t,ManagedBy:e.ManagedBy||e.Manager}}catch(e){return console.warn("Failed to parse group from CSV:",e),null}}async loadDevicesStreamingAsync(e){console.log(`[LogicEngine] Loading devices/infrastructure from: ${e}`);const s=[t.join(e,"*Computer*.csv").replace(/\\/g,"/"),t.join(e,"*VM*.csv").replace(/\\/g,"/"),t.join(e,"*Server*.csv").replace(/\\/g,"/"),t.join(e,"*Infrastructure*.csv").replace(/\\/g,"/"),t.join(e,"NetworkInfrastructure*.csv").replace(/\\/g,"/"),t.join(e,"Infrastructure.csv").replace(/\\/g,"/")],n=[];for(const e of s)try{const t=await(0,w.glob)(e,{nocase:!0});console.log(`[LogicEngine] Pattern "${e}" matched ${t.length} files:`,t),n.push(...t)}catch(t){console.debug(`[LogicEngine] No files matched pattern: ${e}`)}const i=[...new Set(n)];console.log(`[LogicEngine] Loading ${i.length} unique device/infrastructure files:`,i);for(const e of i)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseDeviceFromCsv(e);t&&this.devicesByName.set(t.Name,t)})}}),console.log(`Loaded ${this.devicesByName.size} devices from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseDeviceFromCsv(e){try{const t=e.Name||e.ComputerName||e.DNSHostName||"";if(!t)return null;const r=e.InstalledApps?e.InstalledApps.split(";").filter(e=>e):e.InstalledSoftware?e.InstalledSoftware.split(";").filter(e=>e):[];return{Name:t,DNS:e.DNS||e.DNSHostName||e.FQDN,OU:e.OU||e.OrganizationalUnit,OS:e.OS||e.OperatingSystem||e.OSVersion,PrimaryUserSid:e.PrimaryUserSid||e.PrimaryUser||e.LastLoggedOnUser,InstalledApps:r,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"ComputerDiscovery",SessionId:e.SessionId||this.generateSessionId()}}catch(e){return console.warn("Failed to parse device from CSV:",e),null}}async loadApplicationsStreamingAsync(e){const s=[t.join(e,"Applications.csv"),t.join(e,"Software.csv"),t.join(e,"InstalledSoftware.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseApplicationFromCsv(e);t&&this.appsById.set(t.Id,t)})}}),console.log(`Loaded ${this.appsById.size} applications from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseApplicationFromCsv(e){try{const t=e.Id||e.AppId||e.Name||"",r=e.Name||e.ApplicationName||e.DisplayName||"";if(!t||!r)return null;const s=e.Executables?e.Executables.split(";").filter(e=>e):[],n=e.Publishers?e.Publishers.split(";").filter(e=>e):[];return{Id:t,Name:r,Source:e.Source||e.InstallSource,InstallCounts:parseInt(e.InstallCounts||e.InstallCount||"0"),Executables:s,Publishers:n,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"ApplicationDiscovery",SessionId:e.SessionId||this.generateSessionId()}}catch(e){return console.warn("Failed to parse application from CSV:",e),null}}async loadGposStreamingAsync(e){const s=[t.join(e,"GroupPolicies.csv"),t.join(e,"GPOs.csv"),t.join(e,"GroupPolicyObjects.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseGpoFromCsv(e);t&&this.gposByGuid.set(t.Guid,t)})}}),console.log(`Loaded ${this.gposByGuid.size} GPOs from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseGpoFromCsv(e){try{const t=e.Guid||e.GUID||e.Id||"",r=e.Name||e.DisplayName||"";if(!t||!r)return null;const s=e.Links?e.Links.split(";").filter(e=>e):[];return{Guid:t,Name:r,Links:s,SecurityFilter:e.SecurityFilter?e.SecurityFilter.split(";").filter(e=>e):[],WmiFilter:e.WmiFilter||e.WMIFilter,Enabled:"true"===e.Enabled||"True"===e.Enabled||"1"===e.Enabled,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"GPODiscovery",SessionId:e.SessionId||this.generateSessionId()}}catch(e){return console.warn("Failed to parse GPO from CSV:",e),null}}async loadAclsStreamingAsync(e){const s=[t.join(e,"ACLs.csv"),t.join(e,"FilePermissions.csv"),t.join(e,"SharePermissions.csv"),t.join(e,"NTFSPermissions.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseAclFromCsv(e);if(t){const e=this.aclByIdentitySid.get(t.IdentitySid)||[];e.push(t),this.aclByIdentitySid.set(t.IdentitySid,e)}})}}),console.log(`Loaded ACL entries from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseAclFromCsv(e){try{const t=e.Path||e.FilePath||e.SharePath||"",r=e.IdentitySid||e.Identity||e.UserSid||"";return t&&r?{Path:t,IdentitySid:r,Rights:e.Rights||e.Permissions||e.AccessRights||"",Inherited:"true"===e.Inherited||"True"===e.Inherited||"1"===e.Inherited,IsShare:"true"===e.IsShare||"Share"===e.Type,IsNTFS:"true"===e.IsNTFS||"NTFS"===e.Type,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"ACLDiscovery",SessionId:e.SessionId||this.generateSessionId()}:null}catch(e){return console.warn("Failed to parse ACL from CSV:",e),null}}async loadMappedDrivesStreamingAsync(e){const s=[t.join(e,"MappedDrives.csv"),t.join(e,"NetworkDrives.csv"),t.join(e,"UserDrives.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseMappedDriveFromCsv(e);if(t){const e=this.drivesByUserSid.get(t.UserSid)||[];e.push(t),this.drivesByUserSid.set(t.UserSid,e)}})}}),console.log(`Loaded mapped drives from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseMappedDriveFromCsv(e){try{const t=e.UserSid||e.UserSID||e.User||"",r=e.Letter||e.DriveLetter||"",s=e.UNC||e.UNCPath||e.NetworkPath||"";return t&&r&&s?{UserSid:t,Letter:r,UNC:s,Label:e.Label||e.DriveLabel,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"DriveDiscovery",SessionId:e.SessionId||this.generateSessionId()}:null}catch(e){return console.warn("Failed to parse mapped drive from CSV:",e),null}}async loadMailboxesStreamingAsync(e){const s=[t.join(e,"Mailboxes.csv"),t.join(e,"ExchangeMailboxes.csv"),t.join(e,"UserMailboxes.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseMailboxFromCsv(e);t&&(this.mailboxByUpn.set(t.UPN,t),t.UserPrincipalName&&t.UserPrincipalName!==t.UPN&&this.mailboxByUpn.set(t.UserPrincipalName,t))})}}),console.log(`Loaded ${this.mailboxByUpn.size} mailboxes from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseMailboxFromCsv(e){try{const t=e.UPN||e.UserPrincipalName||e.Email||"";if(!t)return null;const r=e.Permissions?e.Permissions.split(";").filter(e=>e):[];return{UPN:t,MailboxGuid:e.MailboxGuid||e.MailboxGUID||e.Guid,SizeMB:parseFloat(e.SizeMB||e.MailboxSize||"0"),Type:e.Type||e.MailboxType||"UserMailbox",DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"MailboxDiscovery",SessionId:e.SessionId||this.generateSessionId(),Permissions:r,UserPrincipalName:e.UserPrincipalName,EffectiveUPN:e.UserPrincipalName||t}}catch(e){return console.warn("Failed to parse mailbox from CSV:",e),null}}async loadAzureRolesStreamingAsync(e){const s=[t.join(e,"AzureRoles.csv"),t.join(e,"AzureRoleAssignments.csv"),t.join(e,"RoleAssignments.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseAzureRoleFromCsv(e);if(t){const e=this.rolesByPrincipalId.get(t.PrincipalObjectId)||[];e.push(t),this.rolesByPrincipalId.set(t.PrincipalObjectId,e)}})}}),console.log(`Loaded Azure roles from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseAzureRoleFromCsv(e){try{const t=e.PrincipalObjectId||e.PrincipalId||e.ObjectId||"",r=e.RoleName||e.Role||"";return t&&r?{PrincipalObjectId:t,RoleName:r,Scope:e.Scope||e.RoleScope||"/",DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"AzureRoleDiscovery",SessionId:e.SessionId||this.generateSessionId()}:null}catch(e){return console.warn("Failed to parse Azure role from CSV:",e),null}}async loadSqlDatabasesStreamingAsync(e){const s=[t.join(e,"SqlDatabases.csv"),t.join(e,"Databases.csv"),t.join(e,"SQLServers.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseSqlDbFromCsv(e);if(t){const e=`${t.Server}_${t.Database}`;this.sqlDbsByKey.set(e,t)}})}}),console.log(`Loaded ${this.sqlDbsByKey.size} SQL databases from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseSqlDbFromCsv(e){try{const t=e.Server||e.ServerName||"",r=e.Database||e.DatabaseName||e.DB||"";if(!t||!r)return null;const s=e.Owners?e.Owners.split(";").filter(e=>e):[],n=e.AppHints?e.AppHints.split(";").filter(e=>e):[];return{Server:t,Instance:e.Instance||e.InstanceName,Database:r,Owners:s,AppHints:n,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"SqlDiscovery",SessionId:e.SessionId||this.generateSessionId(),Name:r}}catch(e){return console.warn("Failed to parse SQL database from CSV:",e),null}}async loadThreatDetectionStreamingAsync(e){const s=[t.join(e,"ThreatDetection.csv"),t.join(e,"Threats.csv"),t.join(e,"SecurityThreats.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseThreatFromCsv(e);t&&this.threatsByThreatId.set(t.ThreatId,t)})}}),console.log(`Loaded ${this.threatsByThreatId.size} threats from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseThreatFromCsv(e){try{const t=e.ThreatId||e.Id||this.generateSessionId(),r=e.ThreatName||e.Name||"";if(!r)return null;const s=e.AffectedAssets?e.AffectedAssets.split(";").filter(e=>e):[],n=e.IndicatorsOfCompromise?e.IndicatorsOfCompromise.split(";").filter(e=>e):[];let i={};if(e.ThreatDetails)try{i=JSON.parse(e.ThreatDetails)}catch{i={raw:e.ThreatDetails}}return{ThreatId:t,ThreatName:r,Category:e.Category||"Unknown",Severity:e.Severity||"Medium",Confidence:parseFloat(e.Confidence||"0.5"),MitreAttackId:e.MitreAttackId,MitreTactic:e.MitreTactic,MitreTechnique:e.MitreTechnique,AffectedAssets:s,IndicatorsOfCompromise:n,ThreatDetails:i,DetectionTimestamp:new Date(e.DetectionTimestamp||Date.now()),DetectionSource:e.DetectionSource||"Unknown",SessionId:e.SessionId||this.generateSessionId(),DiscoveryModule:e.DiscoveryModule||"ThreatDetectionEngine",ThreatScore:parseFloat(e.ThreatScore||"50")}}catch(e){return console.warn("Failed to parse threat from CSV:",e),null}}async loadDataGovernanceStreamingAsync(e){const s=[t.join(e,"DataGovernance.csv"),t.join(e,"GovernanceAssets.csv"),t.join(e,"Compliance.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseGovernanceFromCsv(e);t&&this.governanceByAssetId.set(t.AssetId,t)})}}),console.log(`Loaded ${this.governanceByAssetId.size} governance records from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseGovernanceFromCsv(e){try{const t=e.AssetId||e.Id||this.generateSessionId(),r=e.AssetName||e.Name||"";if(!r)return null;const s=e.RetentionPolicies?e.RetentionPolicies.split(";").filter(e=>e):[],n=e.ComplianceFrameworks?e.ComplianceFrameworks.split(";").filter(e=>e):[],i=e.ViolationsFound?e.ViolationsFound.split(";").filter(e=>e):[];let o={};if(e.Metadata)try{o=JSON.parse(e.Metadata)}catch{e.Metadata.split(";").forEach(e=>{const[t,r]=e.split("=");t&&r&&(o[t]=r)})}return{AssetId:t,AssetName:r,AssetType:e.AssetType||"Unknown",Classification:e.Classification||"Unclassified",Owner:e.Owner||"Unknown",Custodian:e.Custodian||"Unknown",RetentionPolicies:s,ComplianceFrameworks:n,Metadata:o,HasPersonalData:"true"===e.HasPersonalData||"1"===e.HasPersonalData,HasSensitiveData:"true"===e.HasSensitiveData||"1"===e.HasSensitiveData,LastAuditDate:new Date(e.LastAuditDate||Date.now()),ComplianceStatus:e.ComplianceStatus||"Unknown",ViolationsFound:i,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"DataGovernanceMetadataManagement",SessionId:e.SessionId||this.generateSessionId(),ComplianceScore:parseFloat(e.ComplianceScore||"0"),RiskLevel:e.RiskLevel,GovernanceRisk:parseFloat(e.GovernanceRisk||"0")}}catch(e){return console.warn("Failed to parse governance from CSV:",e),null}}async loadDataLineageStreamingAsync(e){const s=[t.join(e,"DataLineage.csv"),t.join(e,"DataFlows.csv"),t.join(e,"LineageMapping.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseLineageFromCsv(e);t&&this.lineageByLineageId.set(t.LineageId,t)})}}),console.log(`Loaded ${this.lineageByLineageId.size} lineage records from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseLineageFromCsv(e){try{const t=e.LineageId||e.Id||this.generateSessionId(),r=e.SourceAssetId||e.Source||"",s=e.TargetAssetId||e.Target||"";if(!r||!s)return null;const n=e.TransformationSteps?e.TransformationSteps.split(";").filter(e=>e):[],i=e.Dependencies?e.Dependencies.split(";").filter(e=>e):[],o=e.Issues?e.Issues.split(";").filter(e=>e):[];let a={};if(e.FlowMetadata)try{a=JSON.parse(e.FlowMetadata)}catch{e.FlowMetadata.split(";").forEach(e=>{const[t,r]=e.split("=");t&&r&&(a[t]=r)})}return{LineageId:t,SourceAssetId:r,SourceAssetName:e.SourceAssetName||r,SourceAssetType:e.SourceAssetType||"Unknown",TargetAssetId:s,TargetAssetName:e.TargetAssetName||s,TargetAssetType:e.TargetAssetType||"Unknown",TransformationType:e.TransformationType||"Unknown",TransformationSteps:n,DataFlow:e.DataFlow||"Unknown",FlowMetadata:a,Dependencies:i,IsOrphaned:"true"===e.IsOrphaned||"1"===e.IsOrphaned,HasBrokenLinks:"true"===e.HasBrokenLinks||"1"===e.HasBrokenLinks,LastValidated:new Date(e.LastValidated||Date.now()),DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"DataLineageDependencyEngine",SessionId:e.SessionId||this.generateSessionId(),Issues:o,LineageRisk:parseFloat(e.LineageRisk||"0")}}catch(e){return console.warn("Failed to parse lineage from CSV:",e),null}}async loadExternalIdentitiesStreamingAsync(e){const s=[t.join(e,"ExternalIdentities.csv"),t.join(e,"FederatedIdentities.csv"),t.join(e,"B2BUsers.csv")];for(const e of s)try{await r.access(e);const s=await r.readFile(e,"utf-8");v.parse(s,{header:!0,skipEmptyLines:!0,complete:e=>{e.data.forEach(e=>{const t=this.parseExternalIdentityFromCsv(e);t&&(this.externalIdentitiesById.set(t.ExternalIdentityId,t),t.ExternalUserEmail&&this.externalIdentitiesByUpn.set(t.ExternalUserEmail,t))})}}),console.log(`Loaded ${this.externalIdentitiesById.size} external identities from ${t.basename(e)}`)}catch(t){console.debug(`File not found (expected): ${e}`)}}parseExternalIdentityFromCsv(e){try{const t=e.ExternalIdentityId||e.Id||this.generateSessionId(),r=e.ExternalProvider||e.Provider||"Unknown",s=e.ExternalUserId||e.UserId||"";if(!s)return null;const n=e.AssignedRoles?e.AssignedRoles.split(";").filter(e=>e):[],i=e.Permissions?e.Permissions.split(";").filter(e=>e):[],o=e.SyncErrors?e.SyncErrors.split(";").filter(e=>e):[];return{ExternalIdentityId:t,ExternalProvider:r,ExternalUserId:s,ExternalUserEmail:e.ExternalUserEmail||e.Email,ExternalDisplayName:e.ExternalDisplayName||e.DisplayName,InternalUserSid:e.InternalUserSid||e.MappedUserSid,MappingStatus:e.MappingStatus||"Unmapped",MappingConfidence:parseFloat(e.MappingConfidence||"0"),AssignedRoles:n,Permissions:i,LastSynchronized:new Date(e.LastSynchronized||Date.now()),SyncErrors:o,DiscoveryTimestamp:new Date(e.DiscoveryTimestamp||Date.now()),DiscoveryModule:e.DiscoveryModule||"ExternalIdentityMapping",SessionId:e.SessionId||this.generateSessionId(),IdentityRisk:parseFloat(e.IdentityRisk||"0")}}catch(e){return console.warn("Failed to parse external identity from CSV:",e),null}}applyAclGroupUserInference(){console.log("Applying ACLâ†’Groupâ†’User inference rules");let e=0;Array.from(this.aclByIdentitySid.entries()).forEach(([t,r])=>{const s=this.groupsBySid.get(t);if(s){(this.membersByGroupSid.get(t)||[]).forEach(t=>{const s=this.aclByIdentitySid.get(t)||[];r.forEach(e=>{const r={...e,IdentitySid:t};s.push(r)}),this.aclByIdentitySid.set(t,s),e++}),s.NestedGroups&&s.NestedGroups.forEach(t=>{(this.membersByGroupSid.get(t)||[]).forEach(t=>{const s=this.aclByIdentitySid.get(t)||[];r.forEach(e=>{const r={...e,IdentitySid:t,Inherited:!0};s.push(r)}),this.aclByIdentitySid.set(t,s),e++})})}}),this.appliedInferenceRules.push(`ACLâ†’Groupâ†’User expansion: ${e} derived permissions`),console.log(`Expanded ${e} ACL entries through group memberships`)}applyPrimaryDeviceInference(){console.log("Applying primary device inference rules");let e=0;this.devicesByName.forEach(t=>{if(t.PrimaryUserSid){const r=this.devicesByPrimaryUserSid.get(t.PrimaryUserSid)||[];r.includes(t)||(r.push(t),this.devicesByPrimaryUserSid.set(t.PrimaryUserSid,r),e++);const s=`User_${t.PrimaryUserSid}`,n=`Device_${t.Name}`;this.edges.push({SourceId:s,TargetId:n,Type:f.PrimaryUser})}}),this.appliedInferenceRules.push(`Primary device inference: ${e} assignments`),console.log(`Assigned ${e} primary device relationships`)}applyGpoSecurityFilterInference(){console.log("Applying GPO security filter inference rules");let e=0;this.gposByGuid.forEach(t=>{t.SecurityFilter.forEach(r=>{if(this.groupsBySid.get(r)){(this.membersByGroupSid.get(r)||[]).forEach(r=>{const s=this.gposBySidFilter.get(r)||[];s.includes(t)||(s.push(t),this.gposBySidFilter.set(r,s),e++)})}else{const s=this.gposBySidFilter.get(r)||[];s.includes(t)||(s.push(t),this.gposBySidFilter.set(r,s),e++)}}),t.Links.forEach(e=>{const r=this.gposByOu.get(e)||[];r.includes(t)||(r.push(t),this.gposByOu.set(e,r))})}),this.appliedInferenceRules.push(`GPO security filter inference: ${e} user-GPO links`),console.log(`Created ${e} user-GPO relationships through security filters`)}applyApplicationUsageInference(){console.log("Applying application usage inference rules");let e=0;this.devicesByName.forEach(t=>{t.InstalledApps.forEach(r=>{let s=this.appsById.get(r);if(s||(s=this.fuzzyMatchApplication(r,Array.from(this.appsById.keys()))),s){const r=`Device_${t.Name}`,n=`App_${s.Id}`;if(this.edges.push({SourceId:r,TargetId:n,Type:f.HasApp}),t.PrimaryUserSid){const r=`User_${t.PrimaryUserSid}`;this.edges.push({SourceId:r,TargetId:n,Type:f.HasApp,Properties:{via:t.Name}}),e++}}})}),this.appliedInferenceRules.push(`Application usage inference: ${e} user-app links`),console.log(`Created ${e} user-application relationships`)}applyAzureRoleInference(){console.log("Applying Azure role inference rules");let e=0,t=0;this.usersBySid.forEach(r=>{if(r.AzureObjectId){const s=this.rolesByPrincipalId.get(r.AzureObjectId);s&&s.length>0&&(e+=s.length,t++,s.forEach(e=>{const t=`User_${r.Sid}`,s=`Role_${e.RoleName}_${e.Scope}`;this.nodes.has(s)||this.nodes.set(s,{Id:s,Type:m.Role,Properties:{name:e.RoleName,scope:e.Scope}}),this.edges.push({SourceId:t,TargetId:s,Type:f.AssignedRole})}))}}),this.appliedInferenceRules.push(`Azure role inference: ${e} roles linked to ${t} users`),console.log(`Linked ${e} Azure roles to ${t} users`)}applySqlOwnershipInference(){console.log("Applying SQL database ownership inference rules");let e=0;this.sqlDbsByKey.forEach(t=>{t.Owners.forEach(r=>{const s=this.usersBySid.get(r);if(s){const r=`Db_${t.Server}_${t.Database}`,n=`User_${s.Sid}`;this.nodes.has(r)||this.nodes.set(r,{Id:r,Type:m.Db,Properties:{server:t.Server,database:t.Database,instance:t.Instance}}),this.edges.push({SourceId:n,TargetId:r,Type:f.OwnsDb}),e++}const n=this.groupsBySid.get(r);if(n){(this.membersByGroupSid.get(r)||[]).forEach(r=>{const s=`Db_${t.Server}_${t.Database}`,i=`User_${r}`;this.edges.push({SourceId:i,TargetId:s,Type:f.OwnsDb,Properties:{viaGroup:n.Name}}),e++})}})}),this.appliedInferenceRules.push(`SQL ownership inference: ${e} ownership relationships`),console.log(`Created ${e} database ownership relationships`)}applyThreatAssetCorrelationInference(){console.log("Applying threat-asset correlation inference rules");let e=0;this.threatsByThreatId.forEach(t=>{t.AffectedAssets.forEach(r=>{const s=this.threatsByAsset.get(r)||[];s.includes(t)||(s.push(t),this.threatsByAsset.set(r,s));const n=this.usersBySid.get(r)||this.usersByUpn.get(r);if(n){const r=`User_${n.Sid}`,s=`Threat_${t.ThreatId}`;this.nodes.has(s)||this.nodes.set(s,{Id:s,Type:m.Threat,Properties:{name:t.ThreatName,severity:t.Severity,category:t.Category}}),this.edges.push({SourceId:s,TargetId:r,Type:f.Threatens}),e++}const i=this.devicesByName.get(r);if(i){const r=`Device_${i.Name}`,s=`Threat_${t.ThreatId}`;this.edges.push({SourceId:s,TargetId:r,Type:f.Threatens}),e++}});const r=this.threatsByCategory.get(t.Category)||[];r.includes(t)||(r.push(t),this.threatsByCategory.set(t.Category,r));const s=this.threatsBySeverity.get(t.Severity)||[];s.includes(t)||(s.push(t),this.threatsBySeverity.set(t.Severity,s))}),this.appliedInferenceRules.push(`Threat-asset correlation: ${e} correlations`),console.log(`Created ${e} threat-asset correlations`)}applyGovernanceRiskInference(){console.log("Applying governance risk inference rules");let e=0;this.governanceByAssetId.forEach(t=>{if(t.Owner){const r=this.usersBySid.get(t.Owner)||this.usersByUpn.get(t.Owner);if(r){const s=this.governanceByOwner.get(r.Sid)||[];s.includes(t)||(s.push(t),this.governanceByOwner.set(r.Sid,s),e++);const n=`User_${r.Sid}`,i=`DataAsset_${t.AssetId}`;this.nodes.has(i)||this.nodes.set(i,{Id:i,Type:m.DataAsset,Properties:{name:t.AssetName,type:t.AssetType,classification:t.Classification}}),this.edges.push({SourceId:n,TargetId:i,Type:f.HasGovernanceIssue})}}const r=this.governanceByCompliance.get(t.ComplianceStatus)||[];r.includes(t)||(r.push(t),this.governanceByCompliance.set(t.ComplianceStatus,r))}),this.appliedInferenceRules.push(`Governance risk inference: ${e} owner-asset links`),console.log(`Created ${e} governance-owner relationships`)}applyLineageIntegrityInference(){console.log("Applying data lineage integrity inference rules");let e=0,t=0,r=0;this.lineageByLineageId.forEach(s=>{const n=`DataAsset_${s.SourceAssetId}`,i=`DataAsset_${s.TargetAssetId}`,o=`LineageFlow_${s.LineageId}`;this.nodes.has(n)||this.nodes.set(n,{Id:n,Type:m.DataAsset,Properties:{name:s.SourceAssetName,type:s.SourceAssetType}}),this.nodes.has(i)||this.nodes.set(i,{Id:i,Type:m.DataAsset,Properties:{name:s.TargetAssetName,type:s.TargetAssetType}}),this.nodes.has(o)||this.nodes.set(o,{Id:o,Type:m.LineageFlow,Properties:{transformationType:s.TransformationType,dataFlow:s.DataFlow}}),this.edges.push({SourceId:n,TargetId:o,Type:f.DataFlowTo}),this.edges.push({SourceId:o,TargetId:i,Type:f.DataFlowTo}),e+=2;const a=this.lineageBySourceAsset.get(s.SourceAssetId)||[];a.includes(s)||(a.push(s),this.lineageBySourceAsset.set(s.SourceAssetId,a));const c=this.lineageByTargetAsset.get(s.TargetAssetId)||[];c.includes(s)||(c.push(s),this.lineageByTargetAsset.set(s.TargetAssetId,c)),s.IsOrphaned&&t++,s.HasBrokenLinks&&r++}),this.appliedInferenceRules.push(`Lineage integrity: ${e} flows, ${t} orphaned, ${r} broken`),console.log(`Created ${e} lineage relationships, found ${t} orphaned flows and ${r} broken links`)}applyExternalIdentityMappingInference(){console.log("Applying external identity mapping inference rules");let e=0,t=0;this.externalIdentitiesById.forEach(r=>{let s;if(r.ExternalUserEmail&&(s=this.usersByUpn.get(r.ExternalUserEmail)),!s&&r.ExternalDisplayName&&(s=this.fuzzyMatchUser(r.ExternalDisplayName,"DisplayName")),s){r.InternalUserSid=s.Sid,r.MappingStatus="Mapped",e++;const t=`User_${s.Sid}`,n=`ExternalIdentity_${r.ExternalIdentityId}`;this.nodes.has(n)||this.nodes.set(n,{Id:n,Type:m.ExternalIdentity,Properties:{provider:r.ExternalProvider,userId:r.ExternalUserId,email:r.ExternalUserEmail}}),this.edges.push({SourceId:t,TargetId:n,Type:f.ExternalMapping})}else r.MappingStatus="Unmapped";const n=this.externalIdentitiesByProvider.get(r.ExternalProvider)||[];n.includes(r)||(n.push(r),this.externalIdentitiesByProvider.set(r.ExternalProvider,n));const i=this.externalIdentitiesByMappingStatus.get(r.MappingStatus)||[];i.includes(r)||(i.push(r),this.externalIdentitiesByMappingStatus.set(r.MappingStatus,i)),"Unmapped"===r.MappingStatus&&t++}),this.appliedInferenceRules.push(`External identity mapping: ${e} mapped, ${t} conflicts`),console.log(`Mapped ${e} external identities, found ${t} conflicts`)}fuzzyMatchApplication(e,t){let r,s=0;return t.forEach(t=>{const n=this.appsById.get(t);if(n){const t=this.calculateLevenshteinSimilarity(e,n.Name);t>=.8&&t>s&&(s=t,r=n)}}),r&&this.appliedInferenceRules.push(`Fuzzy app match: '${e}' -> '${r.Name}' (similarity: ${(100*s).toFixed(1)}%)`),r}fuzzyMatchUser(e,t="DisplayName"){let r,s=0;return this.usersBySid.forEach(n=>{const i="UPN"===t?n.UPN:"Mail"===t?n.Mail:n.DisplayName;if(i){const t=this.calculateLevenshteinSimilarity(e,i);t>=.8&&t>s&&(s=t,r=n)}}),r&&this.appliedInferenceRules.push(`Fuzzy user match: '${e}' -> '${r.DisplayName}' (similarity: ${(100*s).toFixed(1)}%)`),r}calculateLevenshteinSimilarity(e,t){if(!e||!t)return e||t?0:1;const r=e.length,s=t.length,n=[];for(let e=0;e<=r;e++)n[e]=[e];for(let e=0;e<=s;e++)n[0][e]=e;for(let i=1;i<=r;i++)for(let r=1;r<=s;r++){const s=e[i-1]===t[r-1]?0:1;n[i][r]=Math.min(n[i-1][r]+1,n[i][r-1]+1,n[i-1][r-1]+s)}const i=n[r][s],o=Math.max(r,s);return 0===o?1:1-i/o}async buildIndicesAsync(){this.groupsBySid.forEach((e,t)=>{e.Members.forEach(e=>{const r=this.membersByGroupSid.get(t)||[];r.push(e),this.membersByGroupSid.set(t,r);const s=this.groupsByUserSid.get(e)||[];s.push(t),this.groupsByUserSid.set(e,s)})}),this.devicesByName.forEach(e=>{if(e.PrimaryUserSid){const t=this.devicesByPrimaryUserSid.get(e.PrimaryUserSid)||[];t.push(e),this.devicesByPrimaryUserSid.set(e.PrimaryUserSid,t)}}),console.log("Indices built successfully")}async applyInferenceRulesAsync(){console.log("Applying inference rules..."),this.applyAclGroupUserInference(),this.applyPrimaryDeviceInference(),this.applyGpoSecurityFilterInference(),this.applyApplicationUsageInference(),this.applyAzureRoleInference(),this.applySqlOwnershipInference(),this.applyThreatAssetCorrelationInference(),this.applyGovernanceRiskInference(),this.applyLineageIntegrityInference(),this.applyExternalIdentityMappingInference(),this.appliedInferenceRules.push("Fuzzy matching enabled for identity resolution"),this.appliedInferenceRules.push("File share loader implemented with ACL correlation"),console.log(`Applied ${this.appliedInferenceRules.length} inference rules`)}getGroupsForUser(e){return(this.groupsByUserSid.get(e)||[]).map(e=>this.groupsBySid.get(e)).filter(e=>e)}getDevicesForUser(e){return this.devicesByPrimaryUserSid.get(e)||[]}getAppsForUser(e,t){const r=new Set;return t.forEach(e=>{e.InstalledApps.forEach(e=>{const t=this.appsById.get(e);t&&r.add(t)})}),Array.from(r)}getSharesForUser(e){return this.aclByIdentitySid.get(e)||[]}getGpoLinksForUser(e){const t=[];if(e.OU){const r=this.gposByOu.get(e.OU)||[];t.push(...r)}return t}getGpoFiltersForUser(e){return this.gposBySidFilter.get(e)||[]}getSqlDatabasesForUser(e){const t=[];return this.sqlDbsByKey.forEach(r=>{r.Owners.includes(e)&&t.push(r)}),t}calculateRisksForUser(e){const t=[],r=[];return e.AzureObjectId||r.push("No Azure AD mapping"),this.mailboxByUpn.has(e.UPN)||r.push("No mailbox found"),r.length>0&&t.push({EntityId:e.Sid,EntityType:"User",MissingMappings:r,OrphanedAcls:[],UnresolvableSidRefs:[],Severity:r.length>1?"High":"Medium",Type:"User",Description:`Risk assessment for User ${e.DisplayName||e.Sam}`,Recommendation:r.length>1?"Requires immediate attention before migration":"Should be reviewed and resolved during migration planning"}),t}generateMigrationHintsForUser(e){const t=[];return e.Manager&&t.push({EntityId:e.Sid,EntityType:"User",HintType:"ManagerMapping",Description:"User has a manager that needs to be mapped in target",RequiredActions:{"Map Manager":`Ensure manager ${e.Manager} is migrated first`,"Update Hierarchy":"Update reporting structure after migration"}}),t}getThreatsForAsset(e){return this.threatsByAsset.get(e)||[]}getGovernanceForAsset(e){return this.governanceByAssetId.get(e)}getLineageForAsset(e){return[...this.lineageBySourceAsset.get(e)||[],...this.lineageByTargetAsset.get(e)||[]]}getExternalIdentitiesForUser(e){const t=[];return this.externalIdentitiesById.forEach(r=>{r.InternalUserSid===e&&t.push(r)}),t}getFuzzyMatchCount(){return this.appliedInferenceRules.filter(e=>e.toLowerCase().includes("fuzzy")||e.toLowerCase().includes("similarity")||e.toLowerCase().includes("match")).length}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getUserCount(){return this.usersBySid.size}getGroupCount(){return this.groupsBySid.size}getDeviceCount(){return this.devicesByName.size}getInfrastructureCount(){return this.sqlDbsByKey.size+this.fileSharesByPath.size}getApplicationCount(){return this.appsById.size}getDiscoveredUserCount(e=7){const t=new Date(Date.now()-24*e*60*60*1e3);let r=0;return this.usersBySid.forEach(e=>{e.DiscoveryTimestamp&&new Date(e.DiscoveryTimestamp)>t&&r++}),r}getDiscoveredGroupCount(e=7){const t=new Date(Date.now()-24*e*60*60*1e3);let r=0;return this.groupsBySid.forEach(e=>{e.DiscoveryTimestamp&&new Date(e.DiscoveryTimestamp)>t&&r++}),r}getDiscoveredDeviceCount(e=7){const t=new Date(Date.now()-24*e*60*60*1e3);let r=0;return this.devicesByName.forEach(e=>{e.DiscoveryTimestamp&&new Date(e.DiscoveryTimestamp)>t&&r++}),r}getLastDiscoveryRun(){let e;return this.usersBySid.forEach(t=>{if(t.DiscoveryTimestamp){const r=new Date(t.DiscoveryTimestamp);(!e||r>e)&&(e=r)}}),e?.toISOString()}getAllUsers(){return Array.from(this.usersBySid.values())}getAllGroups(){return Array.from(this.groupsBySid.values())}getAllDevices(){return Array.from(this.devicesByName.values())}getAllApplications(){return Array.from(this.appsById.values())}getAllMailboxes(){return Array.from(this.mailboxByUpn.values())}async analyzeMigrationComplexity(e){const t=this.usersBySid.get(e)||this.usersByUpn.get(e);if(!t)return console.warn(`User not found for complexity analysis: ${e}`),{score:0,level:"Low",factors:["User not found in discovery data"]};let r=0;const s=[],n=this.getGroupsForUser(t.Sid),i=this.getDevicesForUser(t.Sid),o=this.mailboxByUpn.get(t.UPN)||this.mailboxByUpn.get(t.Mail||""),a=this.rolesByPrincipalId.get(t.AzureObjectId||"")||[],c=this.drivesByUserSid.get(t.Sid)||[],l=this.aclByIdentitySid.get(t.Sid)||[];n.length>20?(r+=10,s.push(`High group membership count (${n.length} groups)`)):n.length>10?(r+=5,s.push(`Moderate group membership count (${n.length} groups)`)):n.length>5&&(r+=2,s.push(`Several group memberships (${n.length} groups)`));const d=n.filter(e=>e.Name?.toLowerCase().includes("admin")||e.Name?.toLowerCase().includes("domain")||e.Type?.toLowerCase().includes("privileged"));d.length>0&&(r+=15,s.push(`Administrative permissions detected (${d.length} admin groups)`)),a.length>5?(r+=10,s.push(`Multiple Azure role assignments (${a.length} roles)`)):a.length>0&&(r+=5,s.push(`Azure role assignments (${a.length} roles)`));const u=!!o,p=i.length>0,h=c.length>0;u&&p&&(r+=4,s.push("Multiple Microsoft 365 services (Mailbox + Devices)")),h&&(r+=2,s.push(`Mapped network drives (${c.length} drives)`)),p&&i.length>1&&(r+=2,s.push(`Multiple devices (${i.length} devices)`)),l.length>10?(r+=7,s.push(`Extensive file share permissions (${l.length} ACL entries)`)):l.length>0&&(r+=3,s.push(`File share permissions (${l.length} ACL entries)`));const g=n.filter(e=>("Team"===e.Type||e.Name?.toLowerCase().includes("team"))&&e.ManagedBy===t.Dn);if(g.length>0&&(r+=5,s.push(`Teams owner (${g.length} teams)`)),t.Manager){const e=Array.from(this.usersBySid.values()).filter(e=>e.Manager===t.Dn||e.ManagerSid===t.Sid);e.length>0&&(r+=5,s.push(`Manager with direct reports (${e.length} reports)`))}let m;return m=r<=15?"Low":r<=35?"Medium":"High",0===s.length&&s.push("Minimal dependencies - straightforward migration"),console.log(`Complexity analysis for ${t.DisplayName||t.Sam}: Score=${r}, Level=${m}, Factors=${s.length}`),{score:r,level:m,factors:s}}async batchAnalyzeMigrationComplexity(e){const t=new Map;for(const r of e){const e=await this.analyzeMigrationComplexity(r);t.set(r,e)}return t}getComplexityStatistics(){return{total:this.usersBySid.size,low:0,medium:0,high:0,analyzed:0}}}class C{projectCache=new Map;getProjectPath(e){return t.join("C:","discoverydata",e,"Project.json")}async loadProjectConfig(e){if(this.projectCache.has(e))return this.projectCache.get(e);const t=this.getProjectPath(e);try{const s=await r.readFile(t,"utf-8"),n=JSON.parse(s);return this.projectCache.set(e,n),n}catch(t){return console.log(`Creating default project for ${e}`),this.createDefaultProject(e)}}async saveProjectConfig(e,s){const n=this.getProjectPath(e);await r.mkdir(t.dirname(n),{recursive:!0}),s.updatedAt=(new Date).toISOString(),await r.writeFile(n,JSON.stringify(s,null,2),"utf-8"),this.projectCache.set(e,s)}createDefaultProject(e){const t=new Date,r=new Date(t.getTime()+7776e6);return{id:`project-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`${e} Migration Project`,description:"M&A migration project",createdAt:t.toISOString(),updatedAt:t.toISOString(),sourceProfile:{name:e,type:"ActiveDirectory",lastValidated:t.toISOString()},targetProfile:{name:"Target Environment",type:"AzureAD"},startDate:t.toISOString(),targetCutover:r.toISOString(),estimatedDuration:90,status:"Planning",currentPhase:"Discovery",waves:[],settings:{autoRefreshInterval:30,enableNotifications:!0,retentionDays:90,logLevel:"info"}}}async updateProjectStatus(e,t){const r=await this.loadProjectConfig(e);r.status=t,await this.saveProjectConfig(e,r)}async updateProjectPhase(e,t){const r=await this.loadProjectConfig(e);r.currentPhase=t,await this.saveProjectConfig(e,r)}async addMigrationWave(e,t){const r=await this.loadProjectConfig(e);r.waves.push(t),await this.saveProjectConfig(e,r)}async updateWaveStatus(e,t,r){const s=await this.loadProjectConfig(e),n=s.waves.find(e=>e.id===t);n&&(n.status=r,"Complete"===r&&(n.completedAt=(new Date).toISOString()),await this.saveProjectConfig(e,s))}invalidateCache(e){e?this.projectCache.delete(e):this.projectCache.clear()}}class D{logicEngine;projectService;statsCache=new Map;cacheTimeout=1e4;constructor(e,t){this.logicEngine=e,this.projectService=t}async getStats(e){const r=this.statsCache.get(e);if(r&&Date.now()-r.timestamp<this.cacheTimeout)return r.data;const s=t.join("C:","discoverydata",e,"Raw");try{await this.logicEngine.loadAllAsync(s)}catch(e){console.warn("Logic Engine load warning:",e)}const n={totalUsers:this.logicEngine.getUserCount(),totalGroups:this.logicEngine.getGroupCount(),totalComputers:this.logicEngine.getDeviceCount(),totalInfrastructure:this.logicEngine.getInfrastructureCount(),discoveredUsers:this.logicEngine.getDiscoveredUserCount(),discoveredGroups:this.logicEngine.getDiscoveredGroupCount(),discoveredComputers:this.logicEngine.getDiscoveredDeviceCount(),discoveredApplications:this.logicEngine.getApplicationCount(),migratedUsers:await this.getMigratedUserCount(e),migratedGroups:await this.getMigratedGroupCount(e),pendingMigrationUsers:await this.getPendingMigrationUserCount(e),pendingMigrationGroups:await this.getPendingMigrationGroupCount(e),lastDiscoveryRun:this.logicEngine.getLastDiscoveryRun(),lastMigrationRun:await this.getLastMigrationRun(e),lastDataRefresh:(new Date).toISOString(),dataSource:"LogicEngine"};return this.statsCache.set(e,{data:n,timestamp:Date.now()}),n}async getProjectTimeline(e){const t=await this.projectService.loadProjectConfig(e),r=new Date,s=new Date(t.targetCutover),n=new Date(t.startDate),i=(t.waves??[]).filter(e=>"Scheduled"===e.status&&new Date(e.scheduledDate)>r).sort((e,t)=>new Date(e.scheduledDate).getTime()-new Date(t.scheduledDate).getTime()),o=i.length>0?new Date(i[0].scheduledDate):new Date(r.getTime()+6048e5),a=this.calculateDaysDifference(r,s),c=this.calculateDaysDifference(r,o),l=this.calculateDaysDifference(n,r),d=t.waves??[],u=d.filter(e=>"Complete"===e.status).length,p=d.findIndex(e=>"InProgress"===e.status),h=this.calculatePhaseProgress(t.currentPhase,l,t.estimatedDuration),g=p>=0?this.calculateWaveProgress(d[p]):0,m=d.length>0?Math.round(u/d.length*100):0;return{projectId:t.id,projectName:t.name,projectDescription:t.description,projectStartDate:t.startDate,targetCutover:t.targetCutover,nextWave:o.toISOString(),daysToCutover:a,daysToNextWave:c,daysElapsed:l,currentPhase:t.currentPhase,phaseProgress:h,totalWaves:d.length,completedWaves:u,activeWave:p>=0?p+1:void 0,waveProgress:g,overallProgress:m,estimatedCompletionDate:this.calculateEstimatedCompletion(t,l)}}async getSystemHealth(){const e=Date.now(),t=await this.checkLogicEngineStatus(),r=await this.checkPowerShellStatus(),s=await this.checkFileSystemStatus(),n={status:"online",lastCheck:(new Date).toISOString(),responseTimeMs:0},i=process.memoryUsage(),o=Date.now()-e;return{logicEngineStatus:t,powerShellStatus:r,fileSystemStatus:s,networkStatus:n,dataFreshnessMinutes:await this.getDataFreshness(),avgResponseTimeMs:o,memoryUsageMB:Math.round(i.heapUsed/1024/1024),cpuUsagePercent:0,lastErrorCount:0,activeAlerts:[]}}async getRecentActivity(e,s=10){const n=t.join("C:","discoverydata",e,"Logs","activity.log");try{const e=(await r.readFile(n,"utf-8")).split("\n").filter(e=>e.trim());return e.slice(2*-s).reverse().map((e,t)=>{const r=e.match(/\[(.*?)\]\s*\[(.*?)\]\s*(.*)/);if(!r)return null;const[,s,n,i]=r;return{id:`activity-${Date.now()}-${t}`,type:this.mapActivityType(n),title:this.extractActivityTitle(i),description:i,timestamp:new Date(s).toISOString(),status:"info",actionUrl:this.getActivityActionUrl(n)}}).filter(e=>null!==e).slice(0,s)}catch(e){return[{id:"default-1",type:"system",title:"System Ready",description:"Dashboard service initialized successfully",timestamp:(new Date).toISOString(),status:"success"}]}}async acknowledgeAlert(e){console.log(`Alert acknowledged: ${e}`)}async getMigratedUserCount(e){return((await this.projectService.loadProjectConfig(e)).waves??[]).filter(e=>"Complete"===e.status).reduce((e,t)=>e+t.userCount,0)}async getMigratedGroupCount(e){return((await this.projectService.loadProjectConfig(e)).waves??[]).filter(e=>"Complete"===e.status).reduce((e,t)=>e+t.groupCount,0)}async getPendingMigrationUserCount(e){return((await this.projectService.loadProjectConfig(e)).waves??[]).filter(e=>"Scheduled"===e.status||"InProgress"===e.status).reduce((e,t)=>e+t.userCount,0)}async getPendingMigrationGroupCount(e){return((await this.projectService.loadProjectConfig(e)).waves??[]).filter(e=>"Scheduled"===e.status||"InProgress"===e.status).reduce((e,t)=>e+t.groupCount,0)}async getLastMigrationRun(e){const t=((await this.projectService.loadProjectConfig(e)).waves??[]).filter(e=>"Complete"===e.status&&e.completedAt).sort((e,t)=>new Date(t.completedAt).getTime()-new Date(e.completedAt).getTime());return t.length>0?t[0].completedAt:void 0}async checkLogicEngineStatus(){try{const e=Date.now(),t=this.logicEngine.getUserCount(),r=Date.now()-e;return{status:t>=0?"online":"degraded",lastCheck:(new Date).toISOString(),responseTimeMs:r}}catch(e){return{status:"offline",lastCheck:(new Date).toISOString(),errorMessage:e instanceof Error?e.message:"Unknown error"}}}async checkPowerShellStatus(){return{status:"online",lastCheck:(new Date).toISOString(),responseTimeMs:50}}async checkFileSystemStatus(){try{return await r.access(t.join("C:","discoverydata")),{status:"online",lastCheck:(new Date).toISOString()}}catch{return{status:"offline",lastCheck:(new Date).toISOString(),errorMessage:"Data directory not accessible"}}}async getDataFreshness(){const e=this.logicEngine.getLastDiscoveryRun();if(!e)return 0;const t=new Date(e),r=(new Date).getTime()-t.getTime();return Math.floor(r/6e4)}calculateDaysDifference(e,t){const r=t.getTime()-e.getTime();return Math.ceil(r/864e5)}calculatePhaseProgress(e,t,r){return{Discovery:20,Planning:20,Migration:40,Validation:15,Cutover:5,Complete:100}[e]||0}calculateWaveProgress(e){return"Complete"===e.status?100:"InProgress"===e.status?50:0}calculateEstimatedCompletion(e,t){const r=7*(e.waves??[]).filter(e=>"Complete"!==e.status).length;return new Date(Date.now()+24*r*60*60*1e3).toISOString()}mapActivityType(e){return{DISCOVERY:"discovery",MIGRATION:"migration",VALIDATION:"validation",CONFIG:"configuration",CONFIGURATION:"configuration",ERROR:"error",SYSTEM:"system"}[e.toUpperCase()]||"system"}extractActivityTitle(e){const t=e.split(".")[0];return t.length>50?t.substring(0,47)+"...":t}getActivityActionUrl(e){return{DISCOVERY:"/discovery",MIGRATION:"/migration",VALIDATION:"/validation",CONFIG:"/settings",CONFIGURATION:"/settings"}[e.toUpperCase()]}invalidateCache(e){e?this.statsCache.delete(e):this.statsCache.clear()}}var I=i(580),b=i(912);class E{db;isInitialized=!1;profilesPath;dataRootPath;constructor(){this.profilesPath=t.join(e.app.getPath("appData"),"MandADiscoverySuite","profiles.json"),this.dataRootPath=process.env.MANDA_DISCOVERY_PATH||("win32"===process.platform?t.join("C:","DiscoveryData"):t.join(e.app.getPath("userData"),"DiscoveryData"))}async initialize(){if(this.isInitialized)return;await r.mkdir(t.dirname(this.profilesPath),{recursive:!0});const e=new b.Pv(this.profilesPath);this.db=new I.t(e,{profiles:[],version:1}),await this.db.read(),this.ensureData(),this.db.data=this.db.data||{profiles:[],version:1},this.db.data?.profiles?.length||await this.autoDiscoverProfiles(),this.isInitialized=!0,this.registerIPCHandlers()}registerIPCHandlers(){e.ipcMain.handle("profile:getAll",()=>this.getProfiles()),e.ipcMain.handle("profile:getCurrent",()=>this.getCurrentProfile()),e.ipcMain.handle("profile:setCurrent",(e,t)=>this.setCurrentProfile(t)),e.ipcMain.handle("profile:create",(e,t)=>this.createProfile(t)),e.ipcMain.handle("profile:update",(e,t)=>this.updateProfile(t)),e.ipcMain.handle("profile:delete",(e,t)=>this.deleteProfile(t)),e.ipcMain.handle("profile:import",(e,t)=>this.importProfile(t)),e.ipcMain.handle("profile:export",(e,t,r)=>this.exportProfile(t,r)),e.ipcMain.handle("profile:getStats",(e,t)=>this.getProfileStatistics(t)),e.ipcMain.handle("profile:validate",(e,t)=>this.validateProfile(t)),e.ipcMain.handle("profile:getConnectionConfig",(e,t)=>this.getConnectionConfig(t)),e.ipcMain.handle("profile:setConnectionConfig",(e,t,r)=>this.setConnectionConfig(t,r))}ensureData(){this.db.data||(this.db.data={profiles:[],version:1}),this.db.data.profiles||(this.db.data.profiles=[]),this.db.data.version||(this.db.data.version=1)}async getProfiles(){return await this.db.read(),this.ensureData(),[...this.db.data?.profiles??[]].sort((e,t)=>e.companyName.localeCompare(t.companyName))}async getCurrentProfile(){return(await this.getProfiles()).find(e=>e.isActive)||null}async setCurrentProfile(e){await this.db.read(),this.ensureData();const t=this.db.data.profiles,r=t.find(t=>t.id===e||t.companyName===e);return!!r&&(t.forEach(e=>e.isActive=!1),r.isActive=!0,r.lastModified=(new Date).toISOString(),await this.db.write(),this.broadcastProfileChange(),!0)}async createProfile(e){await this.db.read(),this.ensureData();if(this.db.data.profiles.find(t=>t.companyName.toLowerCase()===e.companyName.toLowerCase()))throw new Error(`Profile with company name "${e.companyName}" already exists`);const t={...e,id:this.generateId(),created:(new Date).toISOString(),lastModified:(new Date).toISOString(),isActive:0===this.db.data.profiles.length};return await this.createProfileDirectories(t.companyName),this.db.data.profiles.push(t),await this.db.write(),t.isActive&&this.broadcastProfileChange(),t}async updateProfile(e){await this.db.read(),this.ensureData();const t=this.db.data.profiles.findIndex(t=>t.id===e.id);if(-1===t)throw new Error(`Profile with ID "${e.id}" not found`);const r=this.db.data.profiles[t],s=r.companyName;if(this.db.data.profiles.find(t=>t.id!==e.id&&t.companyName.toLowerCase()===e.companyName.toLowerCase()))throw new Error(`Profile with company name "${e.companyName}" already exists`);return this.db.data.profiles[t]={...e,created:r.created,lastModified:(new Date).toISOString()},s!==e.companyName&&await this.renameProfileDirectory(s,e.companyName),await this.db.write(),e.isActive&&this.broadcastProfileChange(),this.db.data.profiles[t]}async deleteProfile(e){await this.db.read(),this.ensureData();const t=this.db.data.profiles.findIndex(t=>t.id===e);if(-1===t)return!1;const r=this.db.data.profiles[t],s=r.isActive;return this.db.data.profiles.splice(t,1),await this.deleteProfileDirectory(r.companyName),s&&this.db.data.profiles.length>0&&(this.db.data.profiles[0].isActive=!0),await this.db.write(),s&&this.broadcastProfileChange(),!0}async importProfile(e){const t=await r.readFile(e,"utf-8"),s=JSON.parse(t);if(!s.companyName)throw new Error("Invalid profile file: missing company name");let n=s.companyName,i=1;for(await this.db.read(),this.ensureData();this.db.data.profiles.some(e=>e.companyName.toLowerCase()===n.toLowerCase());)n=`${s.companyName} (${i})`,i++;const o={companyName:n,description:s.description||"",domainController:s.domainController||"",tenantId:s.tenantId||"",isActive:!1,configuration:s.configuration||{}};return this.createProfile(o)}async exportProfile(e,t){const s=(await this.getProfiles()).find(t=>t.id===e);if(!s)throw new Error(`Profile with ID "${e}" not found`);const n=JSON.stringify(s,null,2);await r.writeFile(t,n,"utf-8")}async getProfileStatistics(e){const t=(await this.getProfiles()).find(t=>t.id===e);if(!t)return null;const r=this.getCompanyDataPath(t.companyName);return{profileId:t.id,companyName:t.companyName,created:t.created,lastModified:t.lastModified,lastDiscoveryRun:await this.getLastDiscoveryRun(r),totalDiscoveryRuns:await this.getTotalDiscoveryRuns(r),dataSizeBytes:await this.getDirectorySize(r)}}validateProfile(e){const t={isValid:!0,errors:[],warnings:[],recommendations:[]};return e.companyName?.trim()||(t.errors.push("Company name is required"),t.isValid=!1),e.companyName&&e.companyName.length>100&&(t.errors.push("Company name cannot exceed 100 characters"),t.isValid=!1),e.domainController?.trim()||t.warnings.push("Domain controller is not specified"),e.tenantId?.trim()||t.warnings.push("Tenant ID is not specified"),e.tenantId&&!this.isValidGuid(e.tenantId)&&t.warnings.push("Tenant ID should be a valid GUID"),t.recommendations.push("Consider adding a detailed description for better identification"),t}getCompanyDataPath(e){return t.join(this.dataRootPath,e)}async getConnectionConfig(e){const s=(await this.getProfiles()).find(t=>t.id===e);if(!s)return null;const n=t.join(this.getCompanyDataPath(s.companyName),"connection.json");try{const e=await r.readFile(n,"utf-8");return JSON.parse(e)}catch{return null}}async setConnectionConfig(e,s){const n=(await this.getProfiles()).find(t=>t.id===e);if(!n)throw new Error(`Profile with ID "${e}" not found`);const i=t.join(this.getCompanyDataPath(n.companyName),"connection.json"),o=JSON.stringify(s,null,2);await r.writeFile(i,o,"utf-8")}async autoDiscoverProfiles(){const e=[];try{const s=await r.readdir(this.dataRootPath);for(const n of s){const s=n;if("profiles"===s.toLowerCase())continue;const i=t.join(this.dataRootPath,n);if(!(await r.stat(i)).isDirectory())continue;const o=t.join(i,"Raw");await this.hasCSVFiles(o)&&e.push(this.createDefaultProfile(s,0===e.length))}const n=t.join(this.dataRootPath,"Profiles"),i=await(0,w.glob)(t.join(n,"*"));for(const r of i){const s=t.basename(r);if(!e.some(e=>e.companyName.toLowerCase()===s.toLowerCase())){const n=t.join(r,"Raw");await this.hasCSVFiles(n)&&e.push(this.createDefaultProfile(s,0===e.length))}}}catch(e){console.warn("Auto-discovery failed:",e)}e.length||e.push(this.createDefaultProfile("Sample Corporation",!0)),this.db.data.profiles=e,await this.db.write()}createDefaultProfile(e,t){return{id:this.generateId(),companyName:e,description:`Auto-discovered profile for ${e}`,domainController:`dc.${e.toLowerCase().replace(/\s+/g,"")}.com`,tenantId:this.generateId(),isActive:t,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),configuration:{}}}async hasCSVFiles(e){try{const r=t.join(e,"*.csv").split(t.sep).join("/");console.log("[ProfileService] hasCSVFiles checking:",r);const s=await(0,w.glob)(r);return console.log("[ProfileService]   Found:",s.length,"files"),s.length>0}catch(e){return console.log("[ProfileService] hasCSVFiles error:",e),!1}}async createProfileDirectories(e){const s=this.getCompanyDataPath(e),n=["Raw","Output","Reports","Logs"];for(const e of n)await r.mkdir(t.join(s,e),{recursive:!0})}async renameProfileDirectory(e,t){const s=this.getCompanyDataPath(e),n=this.getCompanyDataPath(t);try{await r.rename(s,n)}catch(r){console.warn(`Failed to rename profile directory from ${e} to ${t}:`,r)}}async deleteProfileDirectory(e){const t=this.getCompanyDataPath(e);try{await r.rm(t,{recursive:!0,force:!0})}catch(t){console.warn(`Failed to delete profile directory ${e}:`,t)}}async getLastDiscoveryRun(e){try{const s=await(0,w.glob)(t.join(e,"**","*.csv"));if(!s.length)return null;const n=await Promise.all(s.map(async e=>(await r.stat(e)).mtime));return Math.max(...n.map(e=>e.getTime())).toString()}catch{return null}}async getTotalDiscoveryRuns(e){try{const s=await(0,w.glob)(t.join(e,"**","*.csv"));if(!s.length)return 0;const n=new Set;for(const e of s){const t=await r.stat(e);n.add(t.mtime.toDateString())}return n.size}catch{return 0}}async getDirectorySize(e){try{const s=await(0,w.glob)(t.join(e,"**","*"),{nodir:!0});let n=0;for(const e of s){n+=(await r.stat(e)).size}return n}catch{return 0}}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}isValidGuid(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}broadcastProfileChange(){i(482).BrowserWindow.getAllWindows().forEach(e=>{e.webContents.send("profile:changed")})}}let M,P,A,$,x,T,k,N,O=null;function U(){return O}function F(){return null!==O&&!O.isDestroyed()}const R=t.join(process.cwd(),"config","app-config.json");let L={};async function _(){try{await r.mkdir(t.dirname(R),{recursive:!0}),await r.writeFile(R,JSON.stringify(L,null,2),"utf-8")}catch(e){throw console.error(`Failed to save config: ${e instanceof Error?e.message:String(e)}`),e}}function B(e){const r=t.normalize(e);return t.resolve(r)}async function j(n){console.error("[IPC] ================================================"),console.error("[IPC] registerIpcHandlers called with window:",!!n),console.error("[IPC] ================================================"),n?(!function(e){console.error("[WINDOW_MANAGER] ðŸ”§ Setting window:",!!e),O=e,console.error("[WINDOW_MANAGER] âœ… Window stored, valid:",!!O)}(n),console.error("[IPC] âœ… Window stored, verified:",F())):console.error("[IPC] âš ï¸ CRITICAL WARNING: No window provided to registerIpcHandlers!"),await async function(){console.log("Initializing IPC services...");const e=process.cwd(),s=e.endsWith("guiv2")?t.join(e,".."):"C:\\enterprisediscovery";console.log(`[IPC] PowerShell scripts base directory: ${s}`),M=new p({maxPoolSize:10,minPoolSize:2,sessionTimeout:3e5,queueSize:100,enableModuleCaching:!0,defaultTimeout:6e4,scriptsBaseDir:s}),await M.initialize();const n=t.join(process.cwd(),"config","module-registry.json");P=new h(M,n);try{await P.loadRegistry()}catch(e){console.warn(`Could not load module registry: ${e instanceof Error?e.message:String(e)}`)}A=new g(M),console.log("Environment Detection Service initialized"),$=y.i8.getInstance(),console.log("Mock Logic Engine Service initialized");const o=t.join("C:","discoverydata","ljpops","Raw");x=S.getInstance(o),console.log("Logic Engine Service initialized"),T=new C,console.log("Project Service initialized"),k=new D(x,T),console.log("Dashboard Service initialized"),N=new E,await N.initialize();const{FileSystemService:a}=await i.e(940).then(i.bind(i,940));new a,console.log("Profile Service initialized"),console.log("FileSystem Service initialized");const c=await N.getCurrentProfile();if(c){console.log(`[ProfileService] Active profile found: ${c.companyName}`);const e=N.getCompanyDataPath(c.companyName),r=t.join(e,"Raw");console.log(`[ProfileService] Loading data from: ${r}`),x=S.getInstance(r),x.loadAllAsync(r).then(e=>{e?console.log(`[LogicEngine] Successfully loaded data for profile: ${c.companyName}`):console.warn(`[LogicEngine] Failed to load data for profile: ${c.companyName}`)}).catch(e=>{console.error(`[LogicEngine] Error loading data: ${e}`)})}else console.warn("[ProfileService] No active profile found - Logic Engine will use default hardcoded path");try{const e=await r.readFile(R,"utf-8");L=JSON.parse(e),console.log("Loaded application configuration")}catch(e){e instanceof Error&&"code"in e&&"ENOENT"===e.code?(console.log("No configuration file found, starting with defaults"),L={},await r.mkdir(t.dirname(R),{recursive:!0})):console.error(`Failed to load config: ${e instanceof Error?e.message:String(e)}`)}console.log("IPC services initialized successfully")}(),console.error("[IPC] After initializeServices, window still exists:",F()),F()&&(M.on("stream:output",e=>{const t=U();t?.webContents.send("powershell:stream:output",e)}),M.on("stream:error",e=>{const t=U();t?.webContents.send("powershell:stream:error",e)}),M.on("stream:warning",e=>{const t=U();t?.webContents.send("powershell:stream:warning",e)}),M.on("stream:verbose",e=>{const t=U();t?.webContents.send("powershell:stream:verbose",e)}),M.on("stream:debug",e=>{const t=U();t?.webContents.send("powershell:stream:debug",e)}),M.on("stream:information",e=>{const t=U();t?.webContents.send("powershell:stream:information",e)}),M.on("output",e=>{const t=U();t?.webContents.send("powershell:output",e)}),M.on("execution:cancelled",e=>{const t=U();t?.webContents.send("powershell:execution:cancelled",e)}),console.log("PowerShell stream event forwarding configured"),A.on("detection:started",e=>{const t=U();t?.webContents.send("environment:detection:started",e)}),A.on("detection:progress",e=>{const t=U();t?.webContents.send("environment:detection:progress",e)}),A.on("detection:completed",e=>{const t=U();t?.webContents.send("environment:detection:completed",e)}),A.on("detection:failed",e=>{const t=U();t?.webContents.send("environment:detection:failed",e)}),A.on("detection:cancelled",e=>{const t=U();t?.webContents.send("environment:detection:cancelled",e)}),console.log("Environment Detection event forwarding configured")),e.ipcMain.handle("powershell:executeScript",async(e,t)=>{try{return console.log(`IPC: executeScript - ${t.scriptPath}`),await M.executeScript(t.scriptPath,t.args||[],t.options)}catch(e){return console.error(`executeScript error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e),duration:0,warnings:[]}}}),e.ipcMain.handle("powershell:executeModule",async(e,t)=>{try{return console.log(`IPC: executeModule - ${t.modulePath} :: ${t.functionName}`),await M.executeModule(t.modulePath,t.functionName,t.parameters||{},t.options)}catch(e){return console.error(`executeModule error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e),duration:0,warnings:[]}}}),e.ipcMain.handle("powershell:executeDiscoveryModule",async(e,t)=>{try{return console.log(`[IPC] executeDiscoveryModule - ${t.moduleName} for ${t.companyName}`),await M.executeDiscoveryModule(t.moduleName,t.companyName,t.additionalParams||{},t.options)}catch(e){return console.error(`executeDiscoveryModule error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e),duration:0,warnings:[]}}}),e.ipcMain.handle("powershell:cancel",async(e,t)=>{try{return console.log(`IPC: cancelExecution - ${t}`),M.cancelExecution(t)}catch(e){return console.error(`cancelExecution error: ${e instanceof Error?e.message:String(e)}`),!1}}),e.ipcMain.handle("powershell:getStatistics",async()=>{try{return M.getStatistics()}catch(e){return console.error(`getStatistics error: ${e instanceof Error?e.message:String(e)}`),null}}),e.ipcMain.handle("powershell:discoverModules",async()=>{try{return console.log("IPC: discoverModules"),await M.discoverModules()}catch(e){return console.error(`discoverModules error: ${e instanceof Error?e.message:String(e)}`),[]}}),e.ipcMain.handle("powershell:executeParallel",async(e,t)=>{try{return console.log(`IPC: executeParallel - ${t.length} scripts`),await M.executeParallel(t)}catch(e){return console.error(`executeParallel error: ${e instanceof Error?e.message:String(e)}`),t.map(()=>({success:!1,error:e instanceof Error?e.message:String(e),duration:0,warnings:[]}))}}),e.ipcMain.handle("powershell:executeWithRetry",async(e,t,r,s)=>{try{return console.log(`IPC: executeWithRetry - ${t.scriptPath} (retries: ${r})`),await M.executeWithRetry(t.scriptPath,t.args||[],t.options,r,s)}catch(e){return console.error(`executeWithRetry error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e),duration:0,warnings:[]}}}),e.ipcMain.handle("modules:getByCategory",async(e,t)=>{try{return P.getModulesByCategory(t)}catch(e){return console.error(`getModulesByCategory error: ${e instanceof Error?e.message:String(e)}`),[]}}),e.ipcMain.handle("modules:getAll",async()=>{try{return P.getAllModules()}catch(e){return console.error(`getAllModules error: ${e instanceof Error?e.message:String(e)}`),[]}}),e.ipcMain.handle("modules:getById",async(e,t)=>{try{return P.getModule(t)}catch(e){return console.error(`getModule error: ${e instanceof Error?e.message:String(e)}`),null}}),e.ipcMain.handle("modules:search",async(e,t)=>{try{return P.searchModules(t)}catch(e){return console.error(`searchModules error: ${e instanceof Error?e.message:String(e)}`),[]}}),e.ipcMain.handle("modules:execute",async(e,t,r,s)=>{try{return console.log(`IPC: executeModule - ${t}`),await P.executeModule(t,r,s)}catch(e){return console.error(`executeModule error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e),duration:0,warnings:[]}}}),e.ipcMain.handle("modules:getStatistics",async()=>{try{return P.getStatistics()}catch(e){return console.error(`getModuleStatistics error: ${e instanceof Error?e.message:String(e)}`),null}}),e.ipcMain.handle("file:read",async(e,t,s="utf-8")=>{try{const e=B(t);return console.log(`IPC: readFile - ${e}`),await r.readFile(e,s)}catch(e){throw console.error(`readFile error: ${e instanceof Error?e.message:String(e)}`),new Error(`Failed to read file: ${e instanceof Error?e.message:String(e)}`)}}),e.ipcMain.handle("file:write",async(e,s,n,i="utf-8")=>{try{const e=B(s);console.log(`IPC: writeFile - ${e}`),await r.mkdir(t.dirname(e),{recursive:!0}),await r.writeFile(e,n,i)}catch(e){throw console.error(`writeFile error: ${e instanceof Error?e.message:String(e)}`),new Error(`Failed to write file: ${e instanceof Error?e.message:String(e)}`)}}),e.ipcMain.handle("file:exists",async(e,t)=>{try{const e=B(t);return await r.access(e),!0}catch{return!1}}),e.ipcMain.handle("file:delete",async(e,t)=>{try{const e=B(t);console.log(`IPC: deleteFile - ${e}`),await r.unlink(e)}catch(e){throw console.error(`deleteFile error: ${e instanceof Error?e.message:String(e)}`),new Error(`Failed to delete file: ${e instanceof Error?e.message:String(e)}`)}}),e.ipcMain.handle("file:list",async(e,s,n)=>{try{const e=B(s);console.log(`IPC: listFiles - ${e}`);let i=await r.readdir(e);if(n){const e=new RegExp(n.replace(/\*/g,".*").replace(/\?/g,"."));i=i.filter(t=>e.test(t))}return i.map(r=>t.join(e,r))}catch(e){throw console.error(`listFiles error: ${e instanceof Error?e.message:String(e)}`),new Error(`Failed to list files: ${e instanceof Error?e.message:String(e)}`)}}),e.ipcMain.handle("file:stat",async(e,t)=>{try{const e=B(t),s=await r.stat(e);return{size:s.size,isFile:s.isFile(),isDirectory:s.isDirectory(),created:s.birthtime,modified:s.mtime}}catch(e){throw console.error(`statFile error: ${e instanceof Error?e.message:String(e)}`),new Error(`Failed to stat file: ${e instanceof Error?e.message:String(e)}`)}}),e.ipcMain.handle("fs:writeFile",async(e,s)=>{try{const{path:e,content:n,encoding:i="utf8"}=s,o=B(e);return console.log(`IPC: fs:writeFile - ${o}`),await r.mkdir(t.dirname(o),{recursive:!0}),await r.writeFile(o,n,i),{success:!0}}catch(e){return console.error(`fs:writeFile error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("fs:exists",async(e,t)=>{try{const{path:e}=t,s=B(e);return await r.access(s),{success:!0,exists:!0}}catch{return{success:!0,exists:!1}}}),e.ipcMain.handle("fs:mkdir",async(e,t)=>{try{const{path:e,recursive:s=!1}=t,n=B(e);return console.log(`IPC: fs:mkdir - ${n}`),await r.mkdir(n,{recursive:s}),{success:!0}}catch(e){return console.error(`fs:mkdir error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("fs:rmdir",async(e,t)=>{try{const{path:e,recursive:s=!1}=t,n=B(e);return console.log(`IPC: fs:rmdir - ${n}`),await r.rm(n,{recursive:s}),{success:!0}}catch(e){return console.error(`fs:rmdir error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("fs:unlink",async(e,t)=>{try{const{path:e}=t,s=B(e);return console.log(`IPC: fs:unlink - ${s}`),await r.unlink(s),{success:!0}}catch(e){return console.error(`fs:unlink error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("fs:readdir",async(e,t)=>{try{const{path:e,options:s}=t,n=B(e);console.log(`IPC: fs:readdir - ${n}`);return{success:!0,data:await r.readdir(n,s)}}catch(e){return console.error(`fs:readdir error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("fs:stat",async(e,t)=>{try{const{path:e}=t,s=B(e),n=await r.stat(s);return{success:!0,data:{size:n.size,isFile:n.isFile(),isDirectory:n.isDirectory(),isSymbolicLink:n.isSymbolicLink(),created:n.birthtime,modified:n.mtime,accessed:n.atime}}}catch(e){return console.error(`fs:stat error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("config:get",async(e,t)=>L[t]),e.ipcMain.handle("config:set",async(e,t,r)=>{L[t]=r,await _()}),e.ipcMain.handle("config:getAll",async()=>({...L})),e.ipcMain.handle("config:delete",async(e,t)=>{delete L[t],await _()}),e.ipcMain.handle("config:reset",async()=>{L={},await _()}),e.ipcMain.handle("profile:loadSourceProfiles",async()=>{try{const e=await N.getProfiles();return console.log(`Loaded ${e.length} source profiles`),e}catch(e){return console.error(`loadSourceProfiles error: ${e instanceof Error?e.message:String(e)}`),[]}}),e.ipcMain.handle("profile:getActiveSource",async()=>{try{return await N.getCurrentProfile()}catch(e){return console.error(`getActiveSource error: ${e instanceof Error?e.message:String(e)}`),null}}),e.ipcMain.handle("profile:getActiveTarget",async()=>{try{return await N.getCurrentProfile()}catch(e){return console.error(`getActiveTarget error: ${e instanceof Error?e.message:String(e)}`),null}}),e.ipcMain.handle("profile:testConnection",async(e,s)=>{try{console.log(`[IPC profile:testConnection] Testing connection for profile: ${s}`);const{CredentialService:e}=await Promise.resolve().then(i.bind(i,566)),n=new e;await n.initialize();if(!await n.hasCredential(s))return console.log(`[IPC profile:testConnection] No credential files found for profile: ${s}`),console.log("[IPC profile:testConnection] Checked locations:"),console.log("  - ENV variables: AZURE_TENANT_ID, AZURE_CLIENT_ID, AZURE_CLIENT_SECRET"),console.log(`  - safeStorage: ${n.credentialsPath}`),console.log(`  - Legacy file: C:\\DiscoveryData\\${s}\\Credentials\\discoverycredentials.config`),{success:!1,error:`No credentials configured for profile '${s}'. Please create a credential file first using the Azure setup script.`};const o=await n.getCredential(s);if(!o)return console.log(`[IPC profile:testConnection] Credentials exist but could not be loaded for profile: ${s}`),{success:!1,error:"Credentials exist but could not be loaded. Please check the credential file format."};const a=!!o.tenantId,c=!(!o.clientId&&!o.username),l=!(!o.clientSecret&&!o.password);if(!a||!c||!l){const e=[];return a||e.push("TenantId"),c||e.push("ClientId"),l||e.push("ClientSecret"),console.log(`[IPC profile:testConnection] Missing required fields: ${e.join(", ")}`),{success:!1,error:`Missing required Azure credentials: ${e.join(", ")}`}}console.log("[IPC profile:testConnection] Credentials found, testing with Azure API...");const d=`\n        $tenantId = "${o.tenantId}"\n        $clientId = "${o.clientId||o.username}"\n        $clientSecret = "${o.clientSecret||o.password}"\n\n        try {\n          $body = @{\n            grant_type    = "client_credentials"\n            scope         = "https://graph.microsoft.com/.default"\n            client_id     = $clientId\n            client_secret = $clientSecret\n          }\n\n          $response = Invoke-RestMethod \`\n            -Method Post \`\n            -Uri "https://login.microsoftonline.com/$tenantId/oauth2/v2.0/token" \`\n            -Body $body \`\n            -ErrorAction Stop\n\n          if ($response.access_token) {\n            Write-Output "SUCCESS: Token acquired"\n          } else {\n            Write-Error "No access token in response"\n            exit 1\n          }\n        } catch {\n          Write-Error $_.Exception.Message\n          exit 1\n        }\n      `,u=await Promise.resolve().then(i.t.bind(i,857,23)),p=t.join(u.tmpdir(),`test-azure-creds-${Date.now()}.ps1`);try{await r.writeFile(p,d,"utf-8");const e=await M.executeScript(p,[],{timeout:3e4});try{await r.unlink(p)}catch(e){console.warn("[IPC profile:testConnection] Failed to delete temp script file:",e)}if(!(0===e.exitCode&&e.stdout?.includes("SUCCESS"))){const t=e.stderr||e.error||"Failed to authenticate with Azure";return console.log(`[IPC profile:testConnection] âŒ Azure authentication failed: ${t}`),{success:!1,error:`Azure authentication failed: ${t}`}}return console.log("[IPC profile:testConnection] âœ… Successfully validated credentials with Azure API"),{success:!0,message:"Successfully authenticated with Azure",data:{connectionType:o.connectionType,tenantId:o.tenantId,clientId:o.clientId||o.username,hasSecret:!0}}}catch(e){try{await r.unlink(p)}catch(e){}throw e}}catch(e){return console.error(`[IPC profile:testConnection] Error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("profile:createSource",async(e,t)=>{try{const e=await N.createProfile(t);return console.log(`Created source profile: ${e.id}`),{success:!0,profile:e}}catch(e){return console.error(`createSource error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("profile:updateSource",async(e,t,r)=>{try{const e=await N.updateProfile({id:t,...r});return console.log(`Updated source profile: ${t}`),{success:!0,profile:e}}catch(e){return console.error(`updateSource error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("profile:deleteSource",async(e,t)=>{try{const e=await N.deleteProfile(t);return console.log(`Deleted source profile: ${t}`),{success:e}}catch(e){return console.error(`deleteSource error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("profile:setActiveSource",async(e,r)=>{try{const e=await N.setCurrentProfile(r);console.log(`Set active source profile: ${r}`);const s=N.getCompanyDataPath(r),n=t.join(s,"Raw");return console.log(`Updating Logic Engine data path to: ${n}`),x=S.getInstance(n),{success:e,dataPath:n}}catch(e){return console.error(`setActiveSource error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("profile:refresh",async()=>{try{await N.refreshProfiles();const e=N.getSourceProfiles();return console.log(`Refreshed profiles: ${e.length} source profiles found`),{success:!0,profiles:e}}catch(e){return console.error(`refresh profiles error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("profile:getDataPath",async(e,t)=>{try{return{success:!0,dataPath:N.getProfileDataPath(t)}}catch(e){return console.error(`getDataPath error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("credentials:load",async(e,t)=>{const{profileId:r}=t;try{console.log(`IPC: credentials:load - ${r}`);const{CredentialService:e}=await Promise.resolve().then(i.bind(i,566)),t=new e;await t.initialize();const s=await t.getCredential(r);return s?{ok:!0,credentials:{tenantId:s.tenantId,clientId:s.clientId,hasSecret:!(!s.clientSecret&&!s.password),connectionType:s.connectionType,username:s.username}}:{ok:!1,error:"No credentials found for profile"}}catch(e){return console.error(`credentials:load error: ${e instanceof Error?e.message:String(e)}`),{ok:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("credentials:save",async(e,t)=>{const{profileId:r,username:s,password:n,connectionType:o,domain:a}=t;try{console.log(`IPC: credentials:save - ${r}`);const{CredentialService:e}=await Promise.resolve().then(i.bind(i,566)),t=new e;return await t.initialize(),await t.storeCredential(r,s,n,o,a),{ok:!0}}catch(e){return console.error(`credentials:save error: ${e instanceof Error?e.message:String(e)}`),{ok:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("credentials:delete",async(e,t)=>{const{profileId:r}=t;try{console.log(`IPC: credentials:delete - ${r}`);const{CredentialService:e}=await Promise.resolve().then(i.bind(i,566)),t=new e;return await t.initialize(),await t.deleteCredential(r),{ok:!0}}catch(e){return console.error(`credentials:delete error: ${e instanceof Error?e.message:String(e)}`),{ok:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("credentials:exists",async(e,t)=>{const{profileId:r}=t;try{const{CredentialService:e}=await Promise.resolve().then(i.bind(i,566)),t=new e;await t.initialize();return{ok:!0,exists:await t.hasCredential(r)}}catch(e){return console.error(`credentials:exists error: ${e instanceof Error?e.message:String(e)}`),{ok:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("system:getAppVersion",async()=>process.env.npm_package_version||"1.0.0"),e.ipcMain.handle("system:getDataPath",async()=>process.cwd()),e.ipcMain.handle("system:openExternal",async(t,r)=>{try{await e.shell.openExternal(r)}catch(e){throw console.error(`openExternal error: ${e instanceof Error?e.message:String(e)}`),new Error(`Failed to open external: ${e instanceof Error?e.message:String(e)}`)}}),e.ipcMain.handle("system:showOpenDialog",async(t,r)=>{try{const t=await e.dialog.showOpenDialog(r);return t.canceled?null:t.filePaths}catch(e){return console.error(`showOpenDialog error: ${e instanceof Error?e.message:String(e)}`),null}}),e.ipcMain.handle("system:showSaveDialog",async(t,r)=>{try{const t=await e.dialog.showSaveDialog(r);return t.canceled?null:t.filePath}catch(e){return console.error(`showSaveDialog error: ${e instanceof Error?e.message:String(e)}`),null}}),e.ipcMain.handle("window:minimize",async()=>{try{const e=U();return e?(e.minimize(),{success:!0}):{success:!1,error:"Main window not available"}}catch(e){return console.error(`window:minimize error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("window:maximize",async()=>{try{const e=U();return e?(e.isMaximized()?e.unmaximize():e.maximize(),{success:!0}):{success:!1,error:"Main window not available"}}catch(e){return console.error(`window:maximize error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("window:close",async()=>{try{const e=U();return e?(e.close(),{success:!0}):{success:!1,error:"Main window not available"}}catch(e){return console.error(`window:close error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("window:restore",async()=>{try{const e=U();return e?(e.restore(),{success:!0}):{success:!1,error:"Main window not available"}}catch(e){return console.error(`window:restore error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("window:isMaximized",async()=>{try{const e=U();return e?{success:!0,isMaximized:e.isMaximized()}:{success:!1,error:"Main window not available"}}catch(e){return console.error(`window:isMaximized error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("environment:detect",async(e,t)=>{try{return console.log("IPC: detectEnvironment"),await A.detectEnvironment(t)}catch(e){return console.error(`detectEnvironment error: ${e instanceof Error?e.message:String(e)}`),{id:"error",startTime:new Date,endTime:new Date,status:"failed",detectedEnvironment:"unknown",detectedServices:[],recommendations:[],totalServicesFound:0,confidence:0,errors:[{timestamp:new Date,serviceType:"system",message:e instanceof Error?e.message:String(e)}],warnings:[]}}}),e.ipcMain.handle("environment:validateCredentials",async(e,t,r)=>{try{return console.log(`IPC: validateCredentials - ${t}`),await A.validateCredentials(t,r)}catch(e){return console.error(`validateCredentials error: ${e instanceof Error?e.message:String(e)}`),{valid:!1,message:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("environment:cancel",async(e,t)=>{try{return console.log(`IPC: cancelDetection - ${t}`),await A.cancelDetection(t)}catch(e){return console.error(`cancelDetection error: ${e instanceof Error?e.message:String(e)}`),!1}}),e.ipcMain.handle("environment:getStatistics",async()=>{try{return A.getStatistics()}catch(e){return console.error(`getEnvironmentStatistics error: ${e instanceof Error?e.message:String(e)}`),{activeDetections:0,totalDetectionsRun:0}}}),e.ipcMain.handle("filewatcher:start",async(e,t)=>{try{console.log(`IPC: filewatcher:start for profile "${t}"`);const{getFileWatcherService:e}=await i.e(49).then(i.bind(i,49)),r=e(),s=U();return s&&r.setMainWindow(s),await r.watchProfile(t),{success:!0,profileId:t}}catch(e){throw console.error(`filewatcher:start error: ${e instanceof Error?e.message:String(e)}`),new Error(`Failed to start file watcher: ${e instanceof Error?e.message:String(e)}`)}}),e.ipcMain.handle("filewatcher:stop",async(e,t)=>{try{console.log(`IPC: filewatcher:stop for profile "${t}"`);const{getFileWatcherService:e}=await i.e(49).then(i.bind(i,49)),r=e();return await r.stopWatching(t),{success:!0,profileId:t}}catch(e){throw console.error(`filewatcher:stop error: ${e instanceof Error?e.message:String(e)}`),new Error(`Failed to stop file watcher: ${e instanceof Error?e.message:String(e)}`)}}),e.ipcMain.handle("filewatcher:stopAll",async()=>{try{console.log("IPC: filewatcher:stopAll");const{getFileWatcherService:e}=await i.e(49).then(i.bind(i,49)),t=e();return await t.stopAll(),{success:!0}}catch(e){throw console.error(`filewatcher:stopAll error: ${e instanceof Error?e.message:String(e)}`),new Error(`Failed to stop all file watchers: ${e instanceof Error?e.message:String(e)}`)}}),e.ipcMain.handle("filewatcher:getWatchedFiles",async()=>{try{const{getFileWatcherService:e}=await i.e(49).then(i.bind(i,49));return e().getWatchedFiles()}catch(e){return console.error(`filewatcher:getWatchedFiles error: ${e instanceof Error?e.message:String(e)}`),[]}}),e.ipcMain.handle("filewatcher:getStatistics",async()=>{try{const{getFileWatcherService:e}=await i.e(49).then(i.bind(i,49));return e().getStatistics()}catch(e){return console.error(`filewatcher:getStatistics error: ${e instanceof Error?e.message:String(e)}`),{activeWatchers:0,watchedDirectories:[],totalEvents:0,eventsByType:{added:0,changed:0,deleted:0}}}}),e.ipcMain.handle("logic-engine:load-all",async(e,t)=>{const{profilePath:r}=t;try{console.log(`IPC: logic-engine:load-all - ${r||"default"}`);const e=e=>{const t=U();t&&t.webContents.send("logic-engine:progress",e)},t=e=>{const t=U();t&&t.webContents.send("logic-engine:loaded",e)},s=e=>{const t=U();t&&t.webContents.send("logic-engine:error",e)};x.on("progress",e),x.on("loaded",t),x.on("error",s);const n=await x.loadAllAsync(r);return x.removeListener("progress",e),x.removeListener("loaded",t),x.removeListener("error",s),{success:n,statistics:n?x.lastLoadStats:null}}catch(e){return console.error("logic-engine:load-all error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logic-engine:get-user-detail",async(e,t)=>{const{userId:r}=t;try{if(console.log(`IPC: logic-engine:get-user-detail - ${r}`),!r||"string"!=typeof r)throw new Error("Invalid userId parameter");const e=await x.buildUserDetailProjection(r);return e?{success:!0,data:e}:{success:!1,error:`User not found: ${r}`}}catch(e){return console.error("logic-engine:get-user-detail error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logic-engine:get-statistics",async()=>{try{return{success:!0,data:{statistics:x.lastLoadStats,lastLoadTime:x.getLastLoadTime(),isLoading:x.getIsLoading()}}}catch(e){return console.error("logic-engine:get-statistics error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logic-engine:invalidate-cache",async()=>{try{return x.fileLoadTimes.clear(),{success:!0}}catch(e){return console.error("logic-engine:invalidate-cache error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("dashboard:getStats",async(e,t)=>{try{console.log("[IPC dashboard:getStats] Received profileName:",t,"type:",typeof t);return{success:!0,data:await k.getStats(t)}}catch(e){return console.error("dashboard:getStats error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("dashboard:getProjectTimeline",async(e,t)=>{try{console.log("[IPC dashboard:getProjectTimeline] Received profileName:",t,"type:",typeof t);return{success:!0,data:await k.getProjectTimeline(t)}}catch(e){return console.error("dashboard:getProjectTimeline error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("dashboard:getSystemHealth",async()=>{try{return{success:!0,data:await k.getSystemHealth()}}catch(e){return console.error("dashboard:getSystemHealth error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("dashboard:getRecentActivity",async(e,t,r=10)=>{try{return{success:!0,data:await k.getRecentActivity(t,r)}}catch(e){return console.error("dashboard:getRecentActivity error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("dashboard:acknowledgeAlert",async(e,t)=>{try{return await k.acknowledgeAlert(t),{success:!0}}catch(e){return console.error("dashboard:acknowledgeAlert error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logicEngine:analyzeMigrationComplexity",async(e,t)=>{try{if(console.log(`Analyzing migration complexity for user: ${t}`),!t||"string"!=typeof t)throw new Error("Invalid userId parameter");return{success:!0,data:await x.analyzeMigrationComplexity(t)}}catch(e){return console.error("logicEngine:analyzeMigrationComplexity error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logicEngine:batchAnalyzeMigrationComplexity",async(e,t)=>{try{if(console.log(`Batch analyzing migration complexity for ${t.length} users`),!Array.isArray(t)||0===t.length)throw new Error("Invalid userIds parameter");const e=await x.batchAnalyzeMigrationComplexity(t),r={};return e.forEach((e,t)=>{r[t]=e}),{success:!0,data:r}}catch(e){return console.error("logicEngine:batchAnalyzeMigrationComplexity error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logicEngine:getComplexityStatistics",async()=>{try{return{success:!0,data:x.getComplexityStatistics()}}catch(e){return console.error("logicEngine:getComplexityStatistics error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logicEngine:forceReload",async(e,t)=>{try{console.log("[LogicEngine] Force reloading data from CSV files...");return await x.loadAllAsync(t,!0)?(console.log("[LogicEngine] Force reload completed successfully"),{success:!0}):{success:!1,error:"Failed to reload data"}}catch(e){return console.error("logicEngine:forceReload error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logicEngine:getAllUsers",async()=>{try{const e=x.getAllUsers();return console.log(`[LogicEngine] Retrieved ${e.length} users`),{success:!0,data:e}}catch(e){return console.error("logicEngine:getAllUsers error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logicEngine:getAllGroups",async()=>{try{const e=x.getAllGroups();return console.log(`[LogicEngine] Retrieved ${e.length} groups`),{success:!0,data:e}}catch(e){return console.error("logicEngine:getAllGroups error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logicEngine:getAllDevices",async()=>{try{const e=x.getAllDevices();return console.log(`[LogicEngine] Retrieved ${e.length} devices`),{success:!0,data:e}}catch(e){return console.error("logicEngine:getAllDevices error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logicEngine:getAllApplications",async()=>{try{const e=x.getAllApplications();return console.log(`[LogicEngine] Retrieved ${e.length} applications`),{success:!0,data:e}}catch(e){return console.error("logicEngine:getAllApplications error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("logicEngine:getAllMailboxes",async()=>{try{return{success:!0,data:x.getAllMailboxes()}}catch(e){return console.error("logicEngine:getAllMailboxes error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("project:getConfiguration",async(e,t)=>{try{return{success:!0,data:await T.loadProjectConfig(t)}}catch(e){return console.error("project:getConfiguration error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("project:saveConfiguration",async(e,t,r)=>{try{return await T.saveProjectConfig(t,r),{success:!0}}catch(e){return console.error("project:saveConfiguration error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("project:updateStatus",async(e,t,r)=>{try{return await T.updateProjectStatus(t,r),{success:!0}}catch(e){return console.error("project:updateStatus error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("project:addWave",async(e,t,r)=>{try{return await T.addMigrationWave(t,r),{success:!0}}catch(e){return console.error("project:addWave error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("project:updateWaveStatus",async(e,t,r,s)=>{try{return await T.updateWaveStatus(t,r,s),{success:!0}}catch(e){return console.error("project:updateWaveStatus error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("get-user-detail",async(e,t)=>{const{userId:r}=t;try{if(console.log(`IPC: get-user-detail - ${r}`),!r||"string"!=typeof r)throw new Error("Invalid userId parameter");const e=await $.getUserDetailAsync(r);return e?{success:!0,data:e}:{success:!1,error:`User not found: ${r}`,data:null}}catch(e){return console.error("get-user-detail error:",e),{success:!1,error:(e instanceof Error?e.message:String(e))||"Failed to retrieve user details",data:null}}}),e.ipcMain.handle("clear-user-detail-cache",async(e,t)=>{const{userId:r}=t;try{return console.log(`IPC: clear-user-detail-cache - ${r}`),$.clearUserDetailCache(r),{success:!0}}catch(e){return console.error("clear-user-detail-cache error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("export-user-snapshot",async(e,s)=>{const{userDetail:n,format:i,fileName:o}=s;try{console.log(`IPC: export-user-snapshot - ${o} (${i})`);const e=t.join(process.env.USERPROFILE||process.env.HOME||"","Downloads"),s=t.join(e,t.basename(o));if("json"===i)await r.writeFile(s,JSON.stringify(n,null,2),"utf-8");else{const e=function(e){const t=[];return t.push("Section,Key,Value"),t.push(`User,Display Name,"${z(e.user.displayName)}"`),t.push(`User,UPN,"${z(e.user.userPrincipalName)}"`),t.push(`User,Email,"${z(e.user.mail)}"`),t.push(`User,Department,"${z(e.user.department)}"`),t.push(`User,Job Title,"${z(e.user.jobTitle)}"`),e.groups.forEach((e,r)=>{t.push(`Groups,Group ${r+1},"${z(e.name)}"`)}),e.devices.forEach((e,r)=>{t.push(`Devices,Device ${r+1},"${z(e.name)}"`)}),e.apps.forEach((e,r)=>{t.push(`Apps,App ${r+1},"${z(e.name)}"`)}),e.azureRoles.forEach((e,r)=>{t.push(`Azure Roles,Role ${r+1},"${z(e.roleName)}"`)}),e.risks.forEach((e,r)=>{t.push(`Risks,Risk ${r+1},"${e.severity}: ${z(e.description)}"`)}),t.join("\n")}(n);await r.writeFile(s,e,"utf-8")}return{success:!0,filePath:s}}catch(e){return console.error("export-user-snapshot error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("get-computer-detail",async(e,t)=>{const{computerId:r}=t;try{if(console.log(`IPC: get-computer-detail - ${r}`),!r||"string"!=typeof r)throw new Error("Invalid computerId parameter");const{mockComputerDetailService:e}=await Promise.resolve().then(i.bind(i,225)),t=await e.getComputerDetailAsync(r);return t?{success:!0,data:t}:{success:!1,error:`Computer not found: ${r}`,data:null}}catch(e){return console.error("get-computer-detail error:",e),{success:!1,error:(e instanceof Error?e.message:String(e))||"Failed to retrieve computer details",data:null}}}),e.ipcMain.handle("clear-computer-detail-cache",async(e,t)=>{const{computerId:r}=t;try{console.log(`IPC: clear-computer-detail-cache - ${r}`);const{mockComputerDetailService:e}=await Promise.resolve().then(i.bind(i,225));return e.clearComputerDetailCache(r),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("export-computer-snapshot",async(e,s)=>{try{const{computerDetail:e,format:n,fileName:i}=s,o=t.join(process.env.USERPROFILE||process.env.HOME||"","Downloads"),a=t.join(o,t.basename(i));if("json"===n)await r.writeFile(a,JSON.stringify(e,null,2),"utf-8");else if("csv"===n){const t=function(e){const t=[];return t.push("Section,Key,Value"),t.push(`Computer,Name,"${z(e.computer.name)}"`),t.push(`Computer,DNS,"${z(e.computer.dns)}"`),t.push(`Computer,Domain,"${z(e.computer.domain)}"`),t.push(`Computer,OS,"${z(e.computer.os)}"`),t.push(`Computer,Status,"${z(e.computer.status)}"`),e.users.forEach((e,r)=>{t.push(`Users,User ${r+1},"${z(e.displayName)}"`)}),e.software.forEach((e,r)=>{t.push(`Software,App ${r+1},"${z(e.name)}"`)}),e.groups.forEach((e,r)=>{t.push(`Groups,Group ${r+1},"${z(e.name)}"`)}),e.risks.forEach((e,r)=>{t.push(`Risks,Risk ${r+1},"${e.severity}: ${z(e.description)}"`)}),t.join("\n")}(e);await r.writeFile(a,t,"utf-8")}return console.log(`Exported computer snapshot: ${a}`),{success:!0,path:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("remote-connect",async(e,t)=>{try{const{computerId:e,connectionType:r}=t;return console.log(`IPC: remote-connect - ${e} (${r})`),{success:!0,message:`${r} connection initiated to ${e}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("get-group-detail",async(e,t)=>{const{groupId:r}=t;try{if(console.log(`IPC: get-group-detail - ${r}`),!r||"string"!=typeof r)throw new Error("Invalid groupId parameter");const{mockGroupDetailService:e}=await Promise.resolve().then(i.bind(i,225)),t=await e.getGroupDetailAsync(r);return t?{success:!0,data:t}:{success:!1,error:`Group not found: ${r}`,data:null}}catch(e){return console.error("get-group-detail error:",e),{success:!1,error:(e instanceof Error?e.message:String(e))||"Failed to retrieve group details",data:null}}}),e.ipcMain.handle("clear-group-detail-cache",async(e,t)=>{const{groupId:r}=t;try{console.log(`IPC: clear-group-detail-cache - ${r}`);const{mockGroupDetailService:e}=await Promise.resolve().then(i.bind(i,225));return e.clearGroupDetailCache(r),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("export-group-snapshot",async(e,s)=>{try{const{groupDetail:e,format:n,fileName:i}=s,o=t.join(process.env.USERPROFILE||process.env.HOME||"","Downloads"),a=t.join(o,t.basename(i));if("json"===n)await r.writeFile(a,JSON.stringify(e,null,2),"utf-8");else if("csv"===n){const t=function(e){const t=[];return t.push("Section,Key,Value"),t.push(`Group,Name,"${z(e.group.name)}"`),t.push(`Group,Display Name,"${z(e.group.displayName)}"`),t.push(`Group,Type,"${z(e.group.groupType)}"`),t.push(`Group,Scope,"${z(e.group.scope)}"`),t.push(`Group,Email,"${z(e.group.email)}"`),e.members.forEach((e,r)=>{t.push(`Members,Member ${r+1},"${z(e.displayName)} (${e.userPrincipalName})"`)}),e.owners.forEach((e,r)=>{t.push(`Owners,Owner ${r+1},"${z(e.displayName)}"`)}),e.permissions.forEach((e,r)=>{t.push(`Permissions,Permission ${r+1},"${z(e.resourceName)} - ${e.accessLevel}"`)}),e.applications.forEach((e,r)=>{t.push(`Applications,App ${r+1},"${z(e.applicationName)} - ${e.roleName}"`)}),e.risks.forEach((e,r)=>{t.push(`Risks,Risk ${r+1},"${e.severity}: ${z(e.description)}"`)}),t.join("\n")}(e);await r.writeFile(a,t,"utf-8")}return console.log(`Exported group snapshot: ${a}`),{success:!0,path:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("add-group-members",async(e,t)=>{try{const{groupId:e,memberIds:r}=t;return console.log(`IPC: add-group-members - ${e} (${r.length} members)`),{success:!0,message:`Added ${r.length} members to group ${e}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("update-group",async(e,t)=>{try{const{groupId:e,updates:r}=t;return console.log(`IPC: update-group - ${e}`,r),{success:!0,message:`Updated group ${e}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}),console.log("[IPC] Registering discovery:execute handler..."),e.ipcMain.handle("discovery:execute",async(e,t)=>{console.log("[IPC] ========== discovery:execute RECEIVED PARAMS =========="),console.log("[IPC] args:",JSON.stringify(t,null,2));const r=t.moduleName,n=t.configuration||t.parameters||{},i=t.executionId,o=t.executionOptions||{},a=t.companyName;console.log("[IPC] Extracted parameters:",JSON.stringify(n,null,2)),console.log("[IPC] Extracted executionOptions:",JSON.stringify(o,null,2)),console.log("[IPC] ==============================================="),console.log("[IPC] discovery:execute HANDLER CALLED!"),console.log(`[IPC] Module: ${r}`),console.log(`[IPC] ExecutionId: ${i||"auto-generating..."}`),console.log(`[IPC] mainWindow exists: ${F()}`),console.log("[IPC] ===============================================");try{const e=i||s.randomUUID();console.log(`IPC: discovery:execute - ${r} (executionId: ${e})`);const t={id:e,moduleName:r,parameters:n,startTime:Date.now()},c=[],l=t=>{console.error("[IPC Handler] ðŸŽ¯ Received stream:output event:",t.data?.substring(0,100));const s=U();console.error(`[IPC Handler] ðŸ” Window exists: ${!!s}, hasWindow: ${F()}`),s&&!s.isDestroyed()?(console.error(`[IPC Handler] ðŸ“¤ Forwarding output to renderer (execId: ${e})`),s.webContents.send("discovery:output",{executionId:e,timestamp:(new Date).toISOString(),level:"output",message:t.data,source:r})):console.error("[IPC Handler] âš ï¸ Window not available, cannot forward output event")},d=t=>{console.error("[IPC Handler] ðŸŽ¯ Received stream:error event:",t.data?.substring(0,100));const s=U();s&&!s.isDestroyed()?(console.error(`[IPC Handler] ðŸ“¤ Forwarding error to renderer (execId: ${e})`),s.webContents.send("discovery:output",{executionId:e,timestamp:(new Date).toISOString(),level:"error",message:t.data,source:r})):console.error("[IPC Handler] âš ï¸ Window not available, cannot forward error event")},u=t=>{console.error("[IPC Handler] ðŸŽ¯ Received stream:warning event:",t.data?.substring(0,100));const s=U();s&&!s.isDestroyed()?(console.error(`[IPC Handler] ðŸ“¤ Forwarding warning to renderer (execId: ${e})`),s.webContents.send("discovery:output",{executionId:e,timestamp:(new Date).toISOString(),level:"warning",message:t.data,source:r})):console.error("[IPC Handler] âš ï¸ Window not available, cannot forward warning event")},p=t=>{console.error("[IPC Handler] ðŸŽ¯ Received stream:verbose event:",t.data?.substring(0,100));const s=U();s&&!s.isDestroyed()?(console.error(`[IPC Handler] ðŸ“¤ Forwarding verbose to renderer (execId: ${e})`),s.webContents.send("discovery:output",{executionId:e,timestamp:(new Date).toISOString(),level:"verbose",message:t.data,source:r})):console.error("[IPC Handler] âš ï¸ Window not available, cannot forward verbose event")},h=t=>{console.error("[IPC Handler] ðŸŽ¯ Received stream:debug event:",t.data?.substring(0,100));const s=U();s&&!s.isDestroyed()?(console.error(`[IPC Handler] ðŸ“¤ Forwarding debug to renderer (execId: ${e})`),s.webContents.send("discovery:output",{executionId:e,timestamp:(new Date).toISOString(),level:"debug",message:t.data,source:r})):console.error("[IPC Handler] âš ï¸ Window not available, cannot forward debug event")},g=t=>{console.error("[IPC Handler] ðŸŽ¯ Received stream:information event:",t.data?.substring(0,100));const s=U();s&&!s.isDestroyed()?(console.error(`[IPC Handler] ðŸ“¤ Forwarding information to renderer (execId: ${e})`),s.webContents.send("discovery:output",{executionId:e,timestamp:(new Date).toISOString(),level:"information",message:t.data,source:r})):console.error("[IPC Handler] âš ï¸ Window not available, cannot forward information event")};console.log(`[IPC Handler] ðŸ”Œ Registering stream listeners for execId: ${e}`),M.on("stream:output",l),M.on("stream:error",d),M.on("stream:warning",u),M.on("stream:verbose",p),M.on("stream:debug",h),M.on("stream:information",g),console.log(`[IPC Handler] âœ… All stream listeners registered for execId: ${e}`),c.push(()=>M.off("stream:output",l)),c.push(()=>M.off("stream:error",d)),c.push(()=>M.off("stream:warning",u)),c.push(()=>M.off("stream:verbose",p)),c.push(()=>M.off("stream:debug",h)),c.push(()=>M.off("stream:information",g));const m=await N.getCurrentProfile();if(!m)throw new Error("No active profile selected. Please select a company profile first.");console.log(`[IPC:discovery:execute] Starting ${r} discovery`),console.log(`[IPC:discovery:execute] Company: ${m.companyName}`),console.log(`[IPC:discovery:execute] Execution ID: ${e}`),console.log("[IPC:discovery:execute] Parameters:",JSON.stringify(n,null,2));const f=a||m.companyName;console.log(`[IPC:discovery:execute] Using company name: ${f}`);const y=await M.executeDiscoveryModule(r,f,n,{cancellationToken:e,streamOutput:!0,timeout:o.timeout||3e5,showWindow:void 0!==o.showWindow&&o.showWindow});console.log(`[IPC Handler] ðŸ§¹ Cleaning up stream listeners for execId: ${e}`),c.forEach(e=>e()),console.log(`[IPC Handler] âœ… All stream listeners cleaned up for execId: ${e}`),console.log(`[IPC:discovery:execute] âœ… ${r} completed successfully`),console.log(`[IPC:discovery:execute] Duration: ${Date.now()-t.startTime}ms`),console.log("[IPC:discovery:execute] Result:",y.success?"SUCCESS":"FAILED");const v=U();if(v&&!v.isDestroyed()){console.error("[IPC Handler] ðŸ“¤ Sending discovery:complete event");const r=y.data,s={...y,totalItems:r?.RecordCount||0,recordCount:r?.RecordCount||0};console.error(`[IPC Handler] ðŸ“Š Discovery results: RecordCount=${r?.RecordCount}, Success=${r?.Success}`),v.webContents.send("discovery:complete",{executionId:e,result:s,duration:Date.now()-t.startTime})}else console.error("[IPC Handler] âš ï¸ Window not available for completion event");return{success:!0,executionId:e,result:y}}catch(e){console.error("[IPC:discovery:execute] âŒ Error:",e);const t=U();return t&&!t.isDestroyed()&&i?(console.error("[IPC Handler] ðŸ“¤ Sending discovery:error event"),t.webContents.send("discovery:error",{executionId:i||"unknown",error:e instanceof Error?e.message:String(e)})):console.error("[IPC Handler] âš ï¸ Window not available for error event"),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("discovery:cancel",async(e,t)=>{const{executionId:r}=t;try{console.log(`IPC: discovery:cancel - ${r}`);const e=await M.cancelExecution(r),t=U();return e&&t&&t.webContents.send("discovery:cancelled",{executionId:r}),{success:e}}catch(e){return console.error("discovery:cancel error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("discovery:get-status",async(e,t)=>{const{executionId:r}=t;try{return console.log(`IPC: discovery:get-status - ${r}`),{success:!0,status:{state:"running",progress:0,message:"Execution in progress"}}}catch(e){return console.error("discovery:get-status error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("discovery:clear-logs",async(e,t)=>{const{executionId:r}=t;try{console.log(`IPC: discovery:clear-logs - ${r}`);const e=U();return e&&e.webContents.send("discovery:logs-cleared",{executionId:r}),{success:!0}}catch(e){return console.error("discovery:clear-logs error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("discovery:get-modules",async()=>{try{console.log("IPC: discovery:get-modules");const e=P.getAllModules();return{success:!0,modules:e.filter(e=>"discovery"===e.category)}}catch(e){return console.error("discovery:get-modules error:",e),{success:!1,error:e instanceof Error?e.message:String(e),modules:[]}}}),e.ipcMain.handle("discovery:get-module-info",async(e,t)=>{const{moduleName:r}=t;try{console.log(`IPC: discovery:get-module-info - ${r}`);const e=P.getModule(r);return e?{success:!0,info:e}:{success:!1,error:`Module not found: ${r}`,info:null}}catch(e){return console.error("discovery:get-module-info error:",e),{success:!1,error:e instanceof Error?e.message:String(e),info:null}}}),e.ipcMain.handle("backup:create",async(e,t)=>{try{const{config:e}=t;console.log("IPC: backup:create",e);const r=`backup-${Date.now()}`;return{success:!0,operationId:r,filePath:`backup-${r}.zip`}}catch(e){return console.error("backup:create error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("backup:cancel",async(e,t)=>{try{const{operationId:e}=t;return console.log("IPC: backup:cancel",e),{success:!0}}catch(e){return console.error("backup:cancel error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("backup:list",async()=>{try{return console.log("IPC: backup:list"),{success:!0,backups:[]}}catch(e){return console.error("backup:list error:",e),{success:!1,error:e instanceof Error?e.message:String(e),backups:[]}}}),e.ipcMain.handle("backup:delete",async(e,t)=>{try{const{operationId:e}=t;return console.log("IPC: backup:delete",e),{success:!0}}catch(e){return console.error("backup:delete error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("backup:validate",async(e,t)=>{try{const{filePath:e}=t;return console.log("IPC: backup:validate",e),{success:!0,isValid:!0,errors:[],warnings:[]}}catch(e){return console.error("backup:validate error:",e),{success:!1,isValid:!1,errors:[e instanceof Error?e.message:String(e)],warnings:[]}}}),e.ipcMain.handle("restore:create",async(e,t)=>{try{const{backupFilePath:e,config:r}=t;console.log("IPC: restore:create",e,r);return{success:!0,operationId:`restore-${Date.now()}`}}catch(e){return console.error("restore:create error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("restore:cancel",async(e,t)=>{try{const{operationId:e}=t;return console.log("IPC: restore:cancel",e),{success:!0}}catch(e){return console.error("restore:cancel error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("migration:plan",async(e,t)=>{try{const{provider:e,profileId:r,args:s}=t;console.log("IPC: migration:plan",e,r);return{runId:`migration-${Date.now()}`}}catch(e){throw console.error("migration:plan error:",e),new Error(e instanceof Error?e.message:String(e))}}),e.ipcMain.handle("migration:execute",async(e,t)=>{try{const{provider:e,profileId:r,runId:s,args:n}=t;console.log("IPC: migration:execute",e,r,s);return{runId:s||`migration-${Date.now()}`}}catch(e){throw console.error("migration:execute error:",e),new Error(e instanceof Error?e.message:String(e))}}),e.ipcMain.handle("migration:cancel",async(e,t)=>{try{const{runId:e}=t;return console.log("IPC: migration:cancel",e),{success:!0}}catch(e){return console.error("migration:cancel error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("migration:pause",async(e,t)=>{try{const{runId:e}=t;return console.log("IPC: migration:pause",e),{success:!0}}catch(e){return console.error("migration:pause error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}),e.ipcMain.handle("migration:resume",async(e,t)=>{try{const{runId:e}=t;return console.log("IPC: migration:resume",e),{success:!0}}catch(e){return console.error("migration:resume error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}});const{registerMigrationHandlers:o}=await i.e(64).then(i.bind(i,64));o();const{registerAppRegistrationHandlers:a}=await i.e(337).then(i.bind(i,337));a();const{registerTargetProfileHandlers:c}=await i.e(750).then(i.bind(i,750));c();const{registerConnectionTestHandlers:l}=await i.e(224).then(i.bind(i,224));l(U()||void 0);const{registerMigrationPlanningHandlers:d}=await i.e(245).then(i.bind(i,245));d();const{registerModuleDiscoveryHandlers:u}=await i.e(542).then(i.bind(i,542));u();const{registerDataExportImportHandlers:m}=await i.e(680).then(i.bind(i,680));m();const{registerErrorMonitoringHandlers:f}=await i.e(336).then(i.bind(i,336));f(U()||void 0);const{registerLoggingHandlers:v,initializeLogging:w}=await i.e(696).then(i.bind(i,696));await w(),v();const{registerAdvancedIpcHandlers:I}=await i.e(711).then(i.bind(i,711));I(),e.ipcMain.handle("triggerWebhook",async(e,t)=>{try{const{webhookId:e,event:r,data:s={}}=t,{webhookService:n}=await i.e(816).then(i.bind(i,816));return n.getWebhook(e)?(await n.trigger(r,s),{success:!0}):{success:!1,error:"Webhook not found"}}catch(e){return console.error(`triggerWebhook error: ${e instanceof Error?e.message:String(e)}`),{success:!1,error:e instanceof Error?e.message:String(e)}}}),console.log("All IPC handlers registered successfully")}function z(e){return e?e.replace(/"/g,'""'):""}e.ipcMain.handle("get-discovery-files",async()=>{try{console.log("[IPC] get-discovery-files: Scanning for CSV files...");const e=[t.join(process.cwd(),"DiscoveryData"),t.join("C:","DiscoveryData"),t.join(process.cwd(),"Modules","Discovery")],s=[],n=async e=>{try{if(!await r.stat(e).catch(()=>null))return;const i=await r.readdir(e);for(const o of i){const i=t.join(e,o),a=await r.stat(i).catch(()=>null);if(a)if(a.isDirectory())await n(i);else if(o.endsWith(".csv")){let e="generic";o.includes("Users")?e="users":o.includes("Groups")?e="groups":o.includes("Applications")?e="applications":o.includes("Infrastructure")?e="infrastructure":o.includes("Exchange")?e="exchange":o.includes("FileSystem")&&(e="filesystem"),s.push({path:i,type:e})}}}catch(t){console.warn("[IPC] get-discovery-files: Error scanning directory:",e,t)}};for(const t of e)await n(t);return console.log("[IPC] get-discovery-files: Found",s.length,"CSV files"),s}catch(e){return console.error("[IPC] get-discovery-files: Error:",e),[]}}),e.ipcMain.handle("read-discovery-file",async(e,t)=>{try{console.log("[IPC] read-discovery-file:",t);return await r.readFile(t,"utf8")}catch(e){throw console.error("[IPC] read-discovery-file: Error reading file:",t,e),e}});const G="file://"+t.resolve(__dirname,"../renderer/main_window/index.html"),H=t.resolve(__dirname,"../preload/index.js");i(109)&&e.app.quit();const W=async()=>{console.log("[MAIN] ========================================"),console.log("[MAIN] Webpack Entry Points:"),console.log("[MAIN] MAIN_WINDOW_WEBPACK_ENTRY:",G),console.log("[MAIN] MAIN_WINDOW_PRELOAD_WEBPACK_ENTRY:",H),console.log("[MAIN] ========================================");const t=new e.BrowserWindow({height:900,width:1400,minHeight:700,minWidth:1200,webPreferences:{preload:H,contextIsolation:!0,nodeIntegration:!1,sandbox:!1},backgroundColor:"#1a1a1a",show:!0});t.once("ready-to-show",()=>{t.show()}),t.webContents.session.webRequest.onHeadersReceived((e,t)=>{t({responseHeaders:{...e.responseHeaders,"Content-Security-Policy":["default-src 'self'; img-src 'self' data: blob:; font-src 'self' data: blob:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' ws: wss:;"]}})}),t.webContents.session.setPreloads([]),t.webContents.session.setSpellCheckerLanguages([]),t.webContents.session.setSpellCheckerEnabled(!1),t.webContents.setWindowOpenHandler(()=>({action:"deny"})),t.webContents.on("will-navigate",(e,t)=>{const r=new URL(t);"file://"!==r.origin&&"http://localhost:3000"!==r.origin&&e.preventDefault()}),t.loadURL(G);return console.log("[MAIN] Opening DevTools (debug mode enabled)"),t.webContents.openDevTools(),t};e.app.on("ready",async()=>{const e=await W();await j(e)}),e.app.on("window-all-closed",()=>{"darwin"!==process.platform&&e.app.quit()}),e.app.on("before-quit",async t=>{t.preventDefault(),await async function(){console.log("Shutting down IPC services..."),M&&await M.shutdown(),await _(),console.log("IPC services shutdown complete")}(),e.app.exit(0)}),e.app.on("activate",()=>{0===e.BrowserWindow.getAllWindows().length&&W()})})()})();