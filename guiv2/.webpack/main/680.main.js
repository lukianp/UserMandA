"use strict";exports.id=680,exports.ids=[680],exports.modules={680:(e,r,t)=>{t.d(r,{registerDataExportImportHandlers:()=>i});var s=t(482),o=t(896),a=t(928);class n{async exportToCSV(e,r,t){try{if(console.log(`[DataExport] Exporting ${e.length} records to CSV: ${r}`),0===e.length)return{success:!1,error:"No data to export"};const s=t?.filterFields||Object.keys(e[0]),n=[];!1!==t?.includeHeaders&&n.push(s.map(e=>this.escapeCSV(e)).join(","));for(const r of e){const e=s.map(e=>{const t=this.getNestedValue(r,e);return this.escapeCSV(this.formatValue(t))});n.push(e.join(","))}return await o.promises.mkdir(a.dirname(r),{recursive:!0}),await o.promises.writeFile(r,n.join("\n"),"utf8"),console.log(`[DataExport] Successfully exported to CSV: ${r}`),{success:!0,filePath:r,recordCount:e.length}}catch(e){return console.error("[DataExport] CSV export failed:",e),{success:!1,error:e.message}}}async exportToJSON(e,r,t){try{console.log(`[DataExport] Exporting ${e.length} records to JSON: ${r}`);let s=e;t?.filterFields&&t.filterFields.length>0&&(s=e.map(e=>{const r={};return t.filterFields.forEach(t=>{r[t]=this.getNestedValue(e,t)}),r}));const n={data:s,recordCount:e.length};return t?.includeMetadata&&(n.metadata={exportDate:(new Date).toISOString(),version:"2.0.0",source:"M&A Discovery Suite"}),await o.promises.mkdir(a.dirname(r),{recursive:!0}),await o.promises.writeFile(r,JSON.stringify(n,null,2),"utf8"),console.log(`[DataExport] Successfully exported to JSON: ${r}`),{success:!0,filePath:r,recordCount:e.length}}catch(e){return console.error("[DataExport] JSON export failed:",e),{success:!1,error:e.message}}}async importFromCSV(e){try{console.log(`[DataImport] Importing from CSV: ${e}`);const r=(await o.promises.readFile(e,"utf8")).split("\n").filter(e=>e.trim());if(0===r.length)return{success:!1,errors:["File is empty"],warnings:[]};const t=this.parseCSVLine(r[0]),s=[],a=[],n=[];for(let e=1;e<r.length;e++)try{const o=this.parseCSVLine(r[e]);if(o.length!==t.length){n.push(`Row ${e+1}: Column count mismatch (expected ${t.length}, got ${o.length})`);continue}const a={};t.forEach((e,r)=>{a[e]=o[r]}),s.push(a)}catch(r){a.push(`Row ${e+1}: ${r.message}`)}return console.log(`[DataImport] Successfully imported ${s.length} records from CSV`),{success:!0,recordCount:s.length,errors:a,warnings:n}}catch(e){return console.error("[DataImport] CSV import failed:",e),{success:!1,errors:[e.message],warnings:[]}}}async importFromJSON(e){try{console.log(`[DataImport] Importing from JSON: ${e}`);const r=await o.promises.readFile(e,"utf8"),t=JSON.parse(r);let s;if(Array.isArray(t))s=t;else{if(!t.data||!Array.isArray(t.data))return{success:!1,errors:['Invalid JSON structure: expected array or object with "data" property'],warnings:[]};s=t.data}return console.log(`[DataImport] Successfully imported ${s.length} records from JSON`),{success:!0,recordCount:s.length,errors:[],warnings:[]}}catch(e){return console.error("[DataImport] JSON import failed:",e),{success:!1,errors:[e.message],warnings:[]}}}escapeCSV(e){return e?e.includes(",")||e.includes('"')||e.includes("\n")?`"${e.replace(/"/g,'""')}"`:e:""}parseCSVLine(e){const r=[];let t="",s=!1;for(let o=0;o<e.length;o++){const a=e[o];'"'===a?s&&'"'===e[o+1]?(t+='"',o++):s=!s:","!==a||s?t+=a:(r.push(t),t="")}return r.push(t),r}getNestedValue(e,r){const t=r.split(".");let s=e;for(const e of t){if(null==s)return null;s=s[e]}return s}formatValue(e){return null==e?"":"object"==typeof e?JSON.stringify(e):String(e)}}let c=null;function i(){const e=(c||(c=new n),c);s.ipcMain.handle("data-export:export",async(r,t)=>{try{const{data:r,filePath:s,options:o}=t;let a;switch(s.endsWith(".json")?"JSON":s.endsWith(".xlsx")?"XLSX":"CSV"){case"JSON":a=await e.exportToJSON(r,s,o);break;case"XLSX":a=await e.exportToExcel(r,s,o);break;default:a=await e.exportToCSV(r,s,o)}return a}catch(e){return{success:!1,error:e.message}}}),s.ipcMain.handle("data-import:import",async(r,t)=>{try{const{filePath:r,format:s}=t;let o;switch(s){case"JSON":o=await e.importFromJSON(r);break;case"XLSX":o=await e.importFromExcel(r);break;default:o=await e.importFromCSV(r)}return o}catch(e){return{success:!1,errors:[e.message],warnings:[]}}})}}};