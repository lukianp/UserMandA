"use strict";exports.id=542,exports.ids=[542],exports.modules={542:(e,s,r)=>{r.d(s,{registerModuleDiscoveryHandlers:()=>l});var t=r(928),o=r.n(t),c=r(482),a=r(896);class i{modulesCache=new Map;lastScanTime=null;async discoverModules(e){console.log(`[ModuleDiscovery] Scanning scripts directory: ${e}`);const s=[];try{return a.existsSync(e)?(await this.scanDirectory(e,s),s.forEach(e=>{this.modulesCache.set(e.id,e)}),this.lastScanTime=new Date,console.log(`[ModuleDiscovery] Discovered ${s.length} modules`),s):(console.warn(`[ModuleDiscovery] Scripts directory not found: ${e}`),[])}catch(e){return console.error("[ModuleDiscovery] Discovery failed:",e),[]}}async scanDirectory(e,s,r){try{const o=await a.promises.readdir(e,{withFileTypes:!0});for(const c of o){const o=t.join(e,c.name);if(c.isDirectory())await this.scanDirectory(o,s,c.name);else if(c.isFile()&&(c.name.endsWith(".ps1")||c.name.endsWith(".psm1"))){const e=await this.parseModule(o,r||"General");e&&s.push(e)}}}catch(s){console.error(`[ModuleDiscovery] Failed to scan directory ${e}:`,s)}}async parseModule(e,s){try{const r=await a.promises.readFile(e,"utf8"),o=this.extractMetadata(r),c=await this.extractParameters(e,r),i=t.basename(e,t.extname(e));return{id:`${s.toLowerCase()}-${i.toLowerCase()}`,name:o.name||i,path:e,category:s,description:o.description||"",parameters:c,dependencies:o.dependencies||[],version:o.version,author:o.author}}catch(s){return console.error(`[ModuleDiscovery] Failed to parse module ${e}:`,s),null}}extractMetadata(e){const s={},r=e.match(/\.SYNOPSIS\s+(.*?)(?=\.|$)/is);r&&(s.description=r[1].trim());const t=e.match(/\.DESCRIPTION\s+(.*?)(?=\.|$)/is);t&&(s.description=t[1].trim());const o=e.match(/\.VERSION\s+(\S+)/i);o&&(s.version=o[1].trim());const c=e.match(/\.AUTHOR\s+(.*?)(?=\n|$)/i);c&&(s.author=c[1].trim());const a=e.matchAll(/#Requires\s+-Modules\s+([^\n]+)/gi);s.dependencies=[];for(const e of a){const r=e[1].split(",").map(e=>e.trim());s.dependencies.push(...r)}return s}async extractParameters(e,s){const r=[],t=s.match(/param\s*\(([\s\S]*?)\)/i);if(!t)return r;const o=t[1].matchAll(/\[Parameter[^\]]*\]\s*\[(\w+)\]\s*\$(\w+)\s*=?\s*([^,\n]*)/gi);for(const e of o){const s=e[1],t=e[2],o=e[3]?.trim();r.push({name:t,type:s,required:/Mandatory\s*=\s*\$true/i.test(e[0]),defaultValue:o||void 0,description:void 0})}return r}getModule(e){return this.modulesCache.get(e)||null}getAllModules(){return Array.from(this.modulesCache.values())}getModulesByCategory(e){return Array.from(this.modulesCache.values()).filter(s=>s.category.toLowerCase()===e.toLowerCase())}searchModules(e){const s=e.toLowerCase();return Array.from(this.modulesCache.values()).filter(e=>e.name.toLowerCase().includes(s)||e.description.toLowerCase().includes(s))}getStatistics(){return{totalModules:this.modulesCache.size,lastScanTime:this.lastScanTime,categories:Array.from(new Set(Array.from(this.modulesCache.values()).map(e=>e.category)))}}clearCache(){this.modulesCache.clear(),this.lastScanTime=null}}let n=null;function u(){return n||(n=new i),n}function l(){c.ipcMain.handle("module-discovery:discover",async e=>{try{const e=u(),s=process.env.SCRIPTS_ROOT||o().join(__dirname,"../../Scripts");return{success:!0,modules:await e.discoverModules(s)}}catch(e){return{success:!1,error:e.message,modules:[]}}}),c.ipcMain.handle("module-discovery:get-by-id",async(e,s)=>{try{const e=u().getModuleById(s);return e?{success:!0,module:e}:{success:!1,error:"Module not found"}}catch(e){return{success:!1,error:e.message}}}),c.ipcMain.handle("module-discovery:search",async(e,s)=>{try{const e=u();return{success:!0,modules:e.searchModules(s)}}catch(e){return{success:!1,error:e.message,modules:[]}}}),c.ipcMain.handle("module-discovery:get-by-category",async(e,s)=>{try{const e=u();return{success:!0,modules:e.getModulesByCategory(s)}}catch(e){return{success:!1,error:e.message,modules:[]}}}),c.ipcMain.handle("module-discovery:get-categories",async e=>{try{const e=u();return{success:!0,categories:e.getCategories()}}catch(e){return{success:!1,error:e.message,categories:[]}}})}}};