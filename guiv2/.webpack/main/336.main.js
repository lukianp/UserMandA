"use strict";exports.id=336,exports.ids=[336],exports.modules={336:(r,e,t)=>{t.d(e,{registerErrorMonitoringHandlers:()=>c});var s=t(482),o=t(896),i=t(928),n=t(434);class a extends n.EventEmitter{logsDir;errorsDir;currentLogFile;logBuffer=[];flushInterval=null;errorReports=new Map;constructor(r="C:\\DiscoveryData"){super(),this.logsDir=i.join(r,"Logs"),this.errorsDir=i.join(r,"Errors"),this.currentLogFile=this.getLogFilePath(),this.ensureDirectoriesExist(),this.startFlushInterval()}ensureDirectoriesExist(){o.existsSync(this.logsDir)||o.mkdirSync(this.logsDir,{recursive:!0}),o.existsSync(this.errorsDir)||o.mkdirSync(this.errorsDir,{recursive:!0})}getLogFilePath(){const r=(new Date).toISOString().split("T")[0];return i.join(this.logsDir,`app-${r}.log`)}startFlushInterval(){this.flushInterval=setInterval(()=>{this.flushLogs()},5e3)}log(r,e,t,s){const o={timestamp:(new Date).toISOString(),level:r,category:e,message:t,context:s};this.logBuffer.push(o),this.emit("log",o);const i=`[${o.timestamp}] [${r.toUpperCase()}] [${e}] ${t}`;switch(r){case"debug":console.debug(i,s||"");break;case"info":console.log(i,s||"");break;case"warn":console.warn(i,s||"");break;case"error":case"fatal":console.error(i,s||"")}"error"!==r&&"fatal"!==r||this.flushLogs()}debug(r,e,t){this.log("debug",r,e,t)}info(r,e,t){this.log("info",r,e,t)}warn(r,e,t){this.log("warn",r,e,t)}error(r,e,t,s){const o={timestamp:(new Date).toISOString(),level:"error",category:r,message:e,context:s,error:t?{name:t.name,message:t.message,stack:t.stack}:void 0};this.logBuffer.push(o),this.emit("log",o),this.emit("error",o),console.error(`[${o.timestamp}] [ERROR] [${r}] ${e}`,t||"",s||""),t&&this.createErrorReport(t,s||{}),this.flushLogs()}fatal(r,e,t,s){const o={timestamp:(new Date).toISOString(),level:"fatal",category:r,message:e,context:s,error:t?{name:t.name,message:t.message,stack:t.stack}:void 0};this.logBuffer.push(o),this.emit("log",o),this.emit("fatal",o),console.error(`[${o.timestamp}] [FATAL] [${r}] ${e}`,t||"",s||""),t&&this.createErrorReport(t,s||{}),this.flushLogs()}createErrorReport(r,e){const t={id:crypto.randomUUID(),timestamp:(new Date).toISOString(),error:r,context:e,resolved:!1};this.errorReports.set(t.id,t);const s=i.join(this.errorsDir,`${t.id}.json`);o.promises.writeFile(s,JSON.stringify({...t,error:{name:r.name,message:r.message,stack:r.stack}},null,2),"utf8")}flushLogs(){if(0===this.logBuffer.length)return;const r=this.getLogFilePath();r!==this.currentLogFile&&(this.currentLogFile=r);const e=this.logBuffer.map(r=>{const e=[r.timestamp,r.level.toUpperCase().padEnd(5),r.category.padEnd(20),r.message];return r.context&&e.push(JSON.stringify(r.context)),r.error&&(e.push(`\n  Error: ${r.error.name}: ${r.error.message}`),r.error.stack&&e.push(`\n  Stack: ${r.error.stack}`)),e.join(" | ")});o.appendFileSync(this.currentLogFile,e.join("\n")+"\n","utf8"),this.logBuffer=[]}getErrorReports(r){let e=Array.from(this.errorReports.values());if(r&&(void 0!==r.resolved&&(e=e.filter(e=>e.resolved===r.resolved)),r.since)){const t=new Date(r.since);e=e.filter(r=>new Date(r.timestamp)>=t)}return e}async resolveErrorReport(r,e){const t=this.errorReports.get(r);if(t){t.resolved=!0,t.notes=e;const s=i.join(this.errorsDir,`${r}.json`);o.existsSync(s)&&await o.promises.writeFile(s,JSON.stringify({...t,error:{name:t.error.name,message:t.error.message,stack:t.error.stack}},null,2),"utf8")}}async reportError(r,e){const t={id:crypto.randomUUID(),timestamp:(new Date).toISOString(),error:r,context:e||{},resolved:!1};this.errorReports.set(t.id,t);const s=i.join(this.errorsDir,`${t.id}.json`);return await o.promises.writeFile(s,JSON.stringify({...t,error:{name:r.name,message:r.message,stack:r.stack}},null,2),"utf8"),this.emit("error-reported",t),t.id}getRecentLogs(r=100){return this.logBuffer.slice(-r)}getStatistics(){return{totalLogs:this.logBuffer.length,errorReports:this.errorReports.size,unresolvedErrors:Array.from(this.errorReports.values()).filter(r=>!r.resolved).length}}shutdown(){this.flushInterval&&(clearInterval(this.flushInterval),this.flushInterval=null),this.flushLogs()}}let l=null;function c(r){const e=(l||(l=new a(t)),l);var t;r&&(e.on("log",e=>{r.webContents.send("error-monitoring:log",e)}),e.on("error-reported",e=>{r.webContents.send("error-monitoring:error-reported",e)})),s.ipcMain.handle("error-monitoring:get-reports",async(r,t)=>{try{return{success:!0,reports:e.getErrorReports(t)}}catch(r){return{success:!1,error:r.message,reports:[]}}}),s.ipcMain.handle("error-monitoring:resolve",async(r,t)=>{try{return await e.resolveErrorReport(t.reportId,t.notes),{success:!0}}catch(r){return{success:!1,error:r.message}}}),s.ipcMain.handle("error-monitoring:log",async(r,t)=>{try{return e.log(t.level,t.category,t.message,t.context),{success:!0}}catch(r){return{success:!1,error:r.message}}}),s.ipcMain.handle("error-monitoring:report-error",async(r,t)=>{try{return{success:!0,reportId:await e.reportError(t.error,t.context)}}catch(r){return{success:!1,error:r.message}}}),s.ipcMain.handle("error-monitoring:get-logs",async(r,t)=>{try{let r=e.getRecentLogs(t?.limit||100);return t?.level&&(r=r.filter(r=>r.level===t.level)),t?.category&&(r=r.filter(r=>r.category===t.category)),{success:!0,logs:r}}catch(r){return{success:!1,error:r.message,logs:[]}}}),s.ipcMain.handle("error-monitoring:subscribe",async(r,e)=>({success:!0}))}}};