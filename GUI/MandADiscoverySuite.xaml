<Window x:Class="MandADiscoverySuite.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:behaviors="clr-namespace:MandADiscoverySuite.Behaviors"
        xmlns:converters="clr-namespace:MandADiscoverySuite.Converters"
        xmlns:controls="clr-namespace:MandADiscoverySuite.Controls"
        xmlns:collections="clr-namespace:MandADiscoverySuite.Collections"
        xmlns:helpers="clr-namespace:MandADiscoverySuite.Helpers"
        xmlns:views="clr-namespace:MandADiscoverySuite.Views"
        mc:Ignorable="d"
        Title="M&amp;A Discovery Suite - SUPER AGGRESSIVE BUILD FIX 2025" Height="1000" Width="1600"
        WindowStartupLocation="CenterScreen" WindowState="Maximized"
        Background="#FF0F1419" KeyDown="MainWindow_KeyDown"
        Closing="Window_Closing"
        behaviors:KeyboardNavigationBehavior.EnableEnhancedNavigation="False"
        behaviors:ResponsiveLayoutBehavior.EnableResponsiveLayout="False"
        AutomationProperties.Name="M&amp;A Discovery Suite Main Window"
        AutomationProperties.HelpText="Main application window for M&amp;A Discovery Suite with navigation tabs and data views">
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- Widget Templates -->
                <ResourceDictionary Source="Themes/DashboardWidgets.xaml"/>
                
                <!-- Accessibility Styles -->
                <ResourceDictionary Source="Styles/AccessibilityStyles.xaml"/>
                
                <!-- Temporarily disabled for debugging stack overflow -->
                <!-- <ResourceDictionary Source="Themes/ThemeStyles.xaml"/> -->
                <!-- <ResourceDictionary Source="Themes/SpacingSystem.xaml"/> -->
                <!-- <ResourceDictionary Source="Themes/CustomTooltips.xaml"/> -->
                <!-- <ResourceDictionary Source="Controls/ChartControls.xaml"/> -->
            </ResourceDictionary.MergedDictionaries>
            
        <!-- Lightweight Control Templates for Large Lists -->
        <DataTemplate x:Key="LightweightDiscoveryModuleTemplate">
            <Border Background="#FF2D3748" CornerRadius="4" Padding="12,8" Margin="2">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="{Binding Icon}" FontSize="16" Margin="0,0,12,0"/>
                    <TextBlock Grid.Column="1" Text="{Binding DisplayName}" 
                               Foreground="#FFE2E8F0" FontSize="13" FontWeight="Medium" 
                               VerticalAlignment="Center"/>
                    <Ellipse Grid.Column="2" Width="6" Height="6" Fill="{Binding StatusColor}"/>
                </Grid>
            </Border>
        </DataTemplate>
        
        <DataTemplate x:Key="LightweightUserListTemplate">
            <Border Background="Transparent" Padding="8,4" Margin="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="60"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="{Binding DisplayName}" 
                               Foreground="#FFE2E8F0" FontSize="12" VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1" Text="{Binding Department}" 
                               Foreground="#FFA0AEC0" FontSize="11" VerticalAlignment="Center"/>
                    <Ellipse Grid.Column="2" Width="4" Height="4" Fill="Green" 
                             Visibility="{Binding AccountEnabled, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </Grid>
            </Border>
        </DataTemplate>
        
        <!-- Column Header Gripper Style (moved to top to fix forward reference) -->
        <Style x:Key="ColumnHeaderGripperStyle" TargetType="Thumb">
            <Setter Property="Width" Value="8"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Cursor" Value="SizeWE"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border Background="{TemplateBinding Background}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:RiskLevelToBrushConverter x:Key="RiskLevelToBrushConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        
        <!-- Modern Gradient Brushes -->
        <LinearGradientBrush x:Key="PrimaryGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF1e3c72" Offset="0"/>
            <GradientStop Color="#FF2a5298" Offset="1"/>
        </LinearGradientBrush>
        
        <LinearGradientBrush x:Key="AccentGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF667eea" Offset="0"/>
            <GradientStop Color="#FF764ba2" Offset="1"/>
        </LinearGradientBrush>
        
        <LinearGradientBrush x:Key="SuccessGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF11998e" Offset="0"/>
            <GradientStop Color="#FF38ef7d" Offset="1"/>
        </LinearGradientBrush>
        
        <LinearGradientBrush x:Key="DangerGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FFff5f6d" Offset="0"/>
            <GradientStop Color="#FFffc371" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- âœ¨ AWESOME GLASSMORPHISM EFFECTS âœ¨ -->
        <LinearGradientBrush x:Key="GlassmorphismBrush" StartPoint="0,0" EndPoint="1,1" Opacity="0.15">
            <GradientStop Color="#FFFFFFFF" Offset="0"/>
            <GradientStop Color="#FF000000" Offset="0.5"/>
            <GradientStop Color="#FFFFFFFF" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- ðŸŒˆ NEON GLOW GRADIENTS ðŸŒˆ -->
        <LinearGradientBrush x:Key="NeonCyanGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF00FFFF" Offset="0"/>
            <GradientStop Color="#FF0080FF" Offset="1"/>
        </LinearGradientBrush>
        
        <LinearGradientBrush x:Key="NeonPinkGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FFFF1493" Offset="0"/>
            <GradientStop Color="#FFFF69B4" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- Input Validation Styles -->
        <Style x:Key="ValidTextBoxStyle" TargetType="TextBox">
            <Setter Property="BorderBrush" Value="#FF48BB78"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="#FF2D3748"/>
            <Setter Property="Foreground" Value="#FFE2E8F0"/>
        </Style>
        
        <Style x:Key="InvalidTextBoxStyle" TargetType="TextBox">
            <Setter Property="BorderBrush" Value="#FFE53E3E"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="#FF3C1F1F"/>
            <Setter Property="Foreground" Value="#FFFED7D7"/>
        </Style>
        
        <Style x:Key="ValidationTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Margin" Value="0,4,0,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>
        
        <Style x:Key="ValidationErrorTextStyle" TargetType="TextBlock" BasedOn="{StaticResource ValidationTextStyle}">
            <Setter Property="Foreground" Value="#FFE53E3E"/>
        </Style>
        
        <Style x:Key="ValidationSuccessTextStyle" TargetType="TextBlock" BasedOn="{StaticResource ValidationTextStyle}">
            <Setter Property="Foreground" Value="#FF48BB78"/>
        </Style>
        
        <LinearGradientBrush x:Key="HolographicGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF8A2387" Offset="0"/>
            <GradientStop Color="#FFE94057" Offset="0.5"/>
            <GradientStop Color="#FFF27121" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- âœ¨ ENHANCED MODERN CARD STYLE WITH GLASSMORPHISM âœ¨ -->
        <Style x:Key="ModernCardStyle" TargetType="Border">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1" Opacity="0.8">
                        <GradientStop Color="#FF1C2433" Offset="0"/>
                        <GradientStop Color="#FF2D3748" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1" Opacity="0.3">
                        <GradientStop Color="#FFFFFFFF" Offset="0"/>
                        <GradientStop Color="#FF4299E1" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#FF00FFFF" Direction="270" ShadowDepth="6" BlurRadius="20" Opacity="0.2"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource NeonCyanGradient}"/>
                    <Setter Property="Background">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1" Opacity="0.9">
                                <GradientStop Color="#FF2A3441" Offset="0"/>
                                <GradientStop Color="#FF3C4D62" Offset="1"/>
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#FF00FFFF" Direction="270" ShadowDepth="8" BlurRadius="25" Opacity="0.4"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Section Border Style -->
        <Style x:Key="SectionBorderStyle" TargetType="Border">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1" Opacity="0.9">
                        <GradientStop Color="#FF1C2433" Offset="0"/>
                        <GradientStop Color="#FF2D3748" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#FF374151" Offset="0"/>
                        <GradientStop Color="#FF4B5563" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Direction="270" ShadowDepth="2" BlurRadius="10" Opacity="0.3"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Modern TextBox Style -->
        <Style x:Key="ModernTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#FF2D3748"/>
            <Setter Property="Foreground" Value="#FFE2E8F0"/>
            <Setter Property="BorderBrush" Value="#FF4A5568"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost" Padding="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#FF667EEA"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#FF667EEA"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Modern Button Style -->
        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryGradient}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="MainButtonBorder" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect ShadowDepth="2" Direction="270" BlurRadius="5" Opacity="0.3" Color="Black"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="MainButtonBorder" Property="Background" Value="{StaticResource AccentGradient}"/>
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX" To="1.05" Duration="0:0:0.15"/>
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY" To="1.05" Duration="0:0:0.15"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX" To="1" Duration="0:0:0.15"/>
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY" To="1" Duration="0:0:0.15"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="MainButtonBorder" Property="Background" Value="#FF4A5568"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Sidebar Navigation Button Style -->
        <Style x:Key="NavButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#FFE2E8F0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Height" Value="56"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="24,0"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="0,12,12,0"
                                Margin="0,2,8,2"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF2D3748"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Metric Card Style -->
        <Style x:Key="MetricCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#FF1A202C"/>
            <Setter Property="BorderBrush" Value="#FF2D3748"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#FF000000" Direction="270" ShadowDepth="2" BlurRadius="8" Opacity="0.2"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="#FF4A5568"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#FF000000" Direction="270" ShadowDepth="4" BlurRadius="12" Opacity="0.3"/>
                        </Setter.Value>
                    </Setter>
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX" To="1.02" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY" To="1.02" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX" To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY" To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- ComboBox Modern Style -->
        <Style x:Key="ModernComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#FF2D3748"/>
            <Setter Property="Foreground" Value="#FFE2E8F0"/>
            <Setter Property="BorderBrush" Value="#FF4A5568"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton Name="ToggleButton" 
                                        Background="{TemplateBinding Background}" 
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        Focusable="false"
                                        IsChecked="{Binding Path=IsDropDownOpen,Mode=TwoWay,RelativeSource={RelativeSource TemplatedParent}}"
                                        ClickMode="Press">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition Width="20"/>
                                    </Grid.ColumnDefinitions>
                                    <ContentPresenter Grid.Column="0" Name="ContentSite" 
                                                    IsHitTestVisible="False" 
                                                    Content="{TemplateBinding SelectionBoxItem}"
                                                    ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                    ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                    Margin="3,3,23,3"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left" 
                                                    TextBlock.Foreground="#FFE2E8F0"/>
                                    <Path Grid.Column="1" x:Name="Arrow" 
                                        Fill="#FFE2E8F0" 
                                        HorizontalAlignment="Center" 
                                        VerticalAlignment="Center" 
                                        Data="M 0 0 L 4 4 L 8 0 Z"/>
                                </Grid>
                            </ToggleButton>
                            <ContentPresenter Name="ContentPresenter" 
                                            Content="{TemplateBinding SelectionBoxItem}"
                                            ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                            ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                            Margin="3,3,23,3"
                                            IsHitTestVisible="False"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left"
                                            TextBlock.Foreground="#FFE2E8F0"/>
                            <TextBox x:Name="PART_EditableTextBox"
                                   Style="{x:Null}" 
                                   Template="{DynamicResource ComboBoxTextBox}" 
                                   HorizontalAlignment="Left" 
                                   VerticalAlignment="Center" 
                                   Margin="3,3,23,3"
                                   Focusable="True" 
                                   Background="#FF2D3748"
                                   Foreground="#FFE2E8F0"
                                   Visibility="Hidden"
                                   IsReadOnly="{TemplateBinding IsReadOnly}"/>
                            <Popup Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True" 
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid Name="DropDown"
                                      SnapsToDevicePixels="True"                
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                            Background="#FF2D3748" 
                                            BorderThickness="1"
                                            BorderBrush="#FF4A5568"/>
                                    <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" 
                                                   TextBlock.Foreground="#FFE2E8F0"/>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Resources>
                <Style TargetType="ComboBoxItem">
                    <Setter Property="Background" Value="#FF2D3748"/>
                    <Setter Property="Foreground" Value="#FFE2E8F0"/>
                    <Setter Property="Padding" Value="8,4"/>
                    <Style.Triggers>
                        <Trigger Property="IsHighlighted" Value="True">
                            <Setter Property="Background" Value="#FF4A5568"/>
                            <Setter Property="Foreground" Value="#FFFFFFFF"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Style.Resources>
        </Style>

        <!-- Data Grid Modern Style -->
        <Style x:Key="ModernDataGridStyle" TargetType="DataGrid">
            <Setter Property="Background" Value="#FF1A202C"/>
            <Setter Property="Foreground" Value="#FFE2E8F0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#FF2D3748"/>
            <Setter Property="RowBackground" Value="#FF1A202C"/>
            <Setter Property="AlternatingRowBackground" Value="#FF2D3748"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="CanUserResizeColumns" Value="True"/>
            <Setter Property="CanUserSortColumns" Value="True"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="ColumnHeaderStyle">
                <Setter.Value>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#FF2D3748"/>
                        <Setter Property="Foreground" Value="#FFE2E8F0"/>
                        <Setter Property="BorderBrush" Value="#FF4A5568"/>
                        <Setter Property="BorderThickness" Value="0,0,1,0"/>
                        <Setter Property="Padding" Value="12,8,24,8"/>
                        <Setter Property="FontWeight" Value="Medium"/>
                        <Setter Property="FontSize" Value="12"/>
                        <Setter Property="HorizontalContentAlignment" Value="Left"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="DataGridColumnHeader">
                                    <Grid>
                                        <Border Background="{TemplateBinding Background}"
                                               BorderBrush="{TemplateBinding BorderBrush}"
                                               BorderThickness="{TemplateBinding BorderThickness}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <ContentPresenter Grid.Column="0"
                                                                 Content="{TemplateBinding Content}"
                                                                 ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                 Margin="12,8,4,8"
                                                                 HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                 VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                                
                                                <!-- Sort Direction Indicator -->
                                                <Path x:Name="SortArrow" 
                                                     Grid.Column="1"
                                                     Width="10" Height="6"
                                                     Margin="4,0,8,0"
                                                     Fill="#FF667EEA"
                                                     Visibility="Collapsed"
                                                     HorizontalAlignment="Center"
                                                     VerticalAlignment="Center"
                                                     Data="M0,0 L3,3 L6,0 Z"/>
                                            </Grid>
                                        </Border>
                                        <Thumb x:Name="PART_LeftHeaderGripper" HorizontalAlignment="Left" Style="{StaticResource ColumnHeaderGripperStyle}"/>
                                        <Thumb x:Name="PART_RightHeaderGripper" HorizontalAlignment="Right" Style="{StaticResource ColumnHeaderGripperStyle}"/>
                                    </Grid>
                                    
                                    <ControlTemplate.Triggers>
                                        <!-- Ascending Sort -->
                                        <Trigger Property="SortDirection" Value="Ascending">
                                            <Setter TargetName="SortArrow" Property="Visibility" Value="Visible"/>
                                            <Setter TargetName="SortArrow" Property="Data" Value="M0,6 L5,0 L10,6 Z"/>
                                            <Setter TargetName="SortArrow" Property="Fill" Value="#FF48BB78"/>
                                        </Trigger>
                                        
                                        <!-- Descending Sort -->
                                        <Trigger Property="SortDirection" Value="Descending">
                                            <Setter TargetName="SortArrow" Property="Visibility" Value="Visible"/>
                                            <Setter TargetName="SortArrow" Property="Data" Value="M0,0 L5,6 L10,0 Z"/>
                                            <Setter TargetName="SortArrow" Property="Fill" Value="#FFED8936"/>
                                        </Trigger>
                                        
                                        <!-- Hover Effect -->
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#FF374151"/>
                                            <Setter Property="Foreground" Value="#FFFFFFFF"/>
                                        </Trigger>
                                        
                                        <!-- Pressed Effect -->
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="#FF4A5568"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Column Header Gripper Style moved to top of resources section -->
        
        <!-- Header Text Style -->
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFF7FAFC"/>
            <Setter Property="FontSize" Value="32"/>
            <Setter Property="FontWeight" Value="Light"/>
            <Setter Property="Margin" Value="0,0,0,24"/>
        </Style>
        
        <!-- Section Header Style -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFE2E8F0"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>
        
        <!-- Page Header Style -->
        <Style x:Key="PageHeaderStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFF7FAFC"/>
            <Setter Property="FontSize" Value="28"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>
        
        <!-- Progress Ring Style -->
        <Style x:Key="ProgressRingStyle" TargetType="ProgressBar">
            <Setter Property="Background" Value="#FF2D3748"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryGradient}"/>
            <Setter Property="Height" Value="4"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- Tab View Templates for TDI -->
        <DataTemplate x:Key="TabViewTemplate">
            <ContentControl>
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Style.Triggers>
                            <!-- Dashboard Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Dashboard">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <Grid Margin="16">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="*"/>
                                                </Grid.RowDefinitions>

                                                <!-- Dashboard Header with Controls -->
                                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                        <TextBlock Text="ðŸ“Š" FontSize="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="Dashboard" Foreground="#FFE2E8F0" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                        <Border Background="#FF374151" CornerRadius="4" Padding="4,2" Margin="12,0,0,0" 
                                                                Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisibilityConverter}}">
                                                            <TextBlock Text="EDIT MODE" Foreground="#FFFBBF24" FontSize="10" FontWeight="Bold"/>
                                                        </Border>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                        <Button Content="ðŸ”„" Padding="8,4" Margin="0,0,8,0" 
                                                                Command="{Binding RefreshAllWidgetsCommand}" 
                                                                Style="{StaticResource ModernButtonStyle}"/>
                                                        <Button Content="âœï¸" Padding="8,4" Margin="0,0,8,0" 
                                                                Command="{Binding ToggleEditModeCommand}" 
                                                                Style="{StaticResource ModernButtonStyle}"/>
                                                        <Button Content="ðŸ’¾" Padding="8,4" Margin="0,0,8,0" 
                                                                Command="{Binding SaveLayoutCommand}" 
                                                                Style="{StaticResource ModernButtonStyle}"
                                                                Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                                        <Button Content="ðŸ”„" Padding="8,4" 
                                                                Command="{Binding ResetLayoutCommand}" 
                                                                Style="{StaticResource ModernButtonStyle}"
                                                                Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                                    </StackPanel>
                                                </Grid>

                                                <!-- Widget Grid Container -->
                                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="300"/>
                                                            <ColumnDefinition Width="300"/>
                                                        </Grid.ColumnDefinitions>

                                                        <!-- Widget ItemsControl with Grid positioning -->
                                                        <ItemsControl ItemsSource="{Binding Widgets}" Grid.RowSpan="4" Grid.ColumnSpan="4">
                                                            <ItemsControl.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                    <Grid/>
                                                                </ItemsPanelTemplate>
                                                            </ItemsControl.ItemsPanel>
                                                            <ItemsControl.ItemContainerStyle>
                                                                <Style TargetType="ContentPresenter">
                                                                    <Setter Property="Grid.Row" Value="{Binding Row}"/>
                                                                    <Setter Property="Grid.Column" Value="{Binding Column}"/>
                                                                    <Setter Property="Grid.RowSpan" Value="{Binding RowSpan}"/>
                                                                    <Setter Property="Grid.ColumnSpan" Value="{Binding ColumnSpan}"/>
                                                                    <Setter Property="Margin" Value="8"/>
                                                                    <Setter Property="Visibility" Value="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                                                </Style>
                                                            </ItemsControl.ItemContainerStyle>
                                                        </ItemsControl>
                                                    </Grid>
                                                </ScrollViewer>

                                                <!-- Loading Overlay -->
                                                <Border Grid.RowSpan="2" Background="#80000000" CornerRadius="8"
                                                        Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                                        <ProgressBar IsIndeterminate="True" Width="200" Height="4" 
                                                                     Background="Transparent" Foreground="#FF667eea"/>
                                                        <TextBlock Text="Loading Dashboard..." Foreground="#FFE2E8F0" FontSize="14" 
                                                                   HorizontalAlignment="Center" Margin="0,16,0,0"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Error Message -->
                                                <Border Grid.RowSpan="2" Background="#80000000" CornerRadius="8" Padding="32"
                                                        Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}">
                                                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                                        <TextBlock Text="âŒ" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                                                        <TextBlock Text="{Binding ErrorMessage}" Foreground="#FFF56565" FontSize="14" 
                                                                   HorizontalAlignment="Center" TextWrapping="Wrap" MaxWidth="400"/>
                                                    </StackPanel>
                                                </Border>
                                            </Grid>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Users Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Users">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:UsersViewNew DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Computers Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Computers">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:ComputersView DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Infrastructure Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Infrastructure">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:InfrastructureViewNew DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Security Groups Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Security Groups">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:SecurityGroupsView DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Groups Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Groups">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:GroupsViewNew DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Discovery Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Discovery">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:DashboardView/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Applications Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Applications">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:ApplicationsViewNew DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- FileServers Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="FileServers">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:FileServersViewNew DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Databases Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Databases">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:DatabasesViewNew DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- GroupPolicies Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="GroupPolicies">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:GroupPoliciesViewNew DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Snapshot Comparison Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Snapshot Comparison">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:SnapshotComparisonView/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <!-- Management Template -->
                            <DataTrigger Binding="{Binding TabTitle}" Value="Management">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:ManagementView/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
            </ContentControl>
        </DataTemplate>
        
        </ResourceDictionary>
    </Window.Resources>
    
    <Window.InputBindings>
        <!-- Navigation Shortcuts -->
        <KeyBinding Key="F1" Command="{Binding ShowDashboardViewCommand}"/>
        <KeyBinding Key="F2" Command="{Binding ShowDiscoveryViewCommand}"/>
        <KeyBinding Key="F3" Command="{Binding ShowUsersViewCommand}"/>
        <KeyBinding Key="F4" Command="{Binding ShowComputersViewCommand}"/>
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}"/>
        
        <!-- Action Shortcuts -->
        <KeyBinding Key="F6" Command="{Binding StartDiscoveryCommand}"/>
        <KeyBinding Key="F9" Command="{Binding ShowSettingsViewCommand}"/>
        <KeyBinding Key="F10" Command="{Binding ShowReportsViewCommand}"/>
        
        <!-- Standard Shortcuts -->
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding SearchCommand}"/>
        <KeyBinding Key="R" Modifiers="Ctrl" Command="{Binding RefreshCommand}"/>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding NewProfileCommand}"/>
        <KeyBinding Key="P" Modifiers="Ctrl+Shift" Command="{Binding ShowCommandPaletteCommand}"/>
        
        <!-- Theme Toggle -->
        <KeyBinding Key="T" Modifiers="Ctrl+Alt" Command="{Binding ToggleThemeCommand}"/>
        <!-- Theme Selection Dialog -->
        <KeyBinding Key="T" Modifiers="Ctrl+Shift" Command="{Binding ShowThemeSelectionCommand}"/>
        <!-- Log Viewer -->
        <KeyBinding Key="L" Modifiers="Ctrl+Shift" Command="{Binding ShowLogViewerCommand}"/>
        
        <!-- Close/Exit -->
        <KeyBinding Key="F4" Modifiers="Alt" Command="{Binding ExitCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CancelCommand}"/>
    </Window.InputBindings>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Enhanced Sidebar -->
        <Border Grid.Column="0" Background="#FF1A202C" BorderBrush="#FF2D3748" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Enhanced Logo/Title -->
                <Border Grid.Row="0" Padding="24,32,24,24">
                    <StackPanel>
                        <TextBlock Text="M&amp;A Discovery" Foreground="#FFF7FAFC" FontSize="24" FontWeight="Bold"/>
                        <TextBlock Text="Suite" Foreground="#FF4299E1" FontSize="24" FontWeight="Light"/>
                        <TextBlock Text="Enterprise Edition" Foreground="#FFA0AEC0" FontSize="11" FontWeight="Medium" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Target Company Selector -->
                <Border Grid.Row="2" Padding="24,0,24,24">
                    <StackPanel>
                        <TextBlock Text="Target Company Profile" Foreground="#FFA0AEC0" FontSize="12" FontWeight="Medium" Margin="0,0,0,8"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <ComboBox Grid.Column="0"
                                      Style="{StaticResource ModernComboBoxStyle}"
                                      Height="40"
                                      FontSize="14"
                                      Margin="0,0,8,0"
                                      ItemsSource="{Binding TargetCompanyProfiles}"
                                      SelectedItem="{Binding SelectedTargetCompany}"
                                      DisplayMemberPath="CompanyName"/>

                            <Button Grid.Column="1"
                                    Command="{Binding SwitchTargetProfileCommand}"
                                    Background="{StaticResource SuccessGradient}"
                                    BorderThickness="0"
                                    Width="40" Height="40"
                                    Margin="0,0,4,0"
                                    ToolTip="Set Selected Target Company">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8" x:Name="TargetSwitchBorder">
                                            <TextBlock Text="âœ“" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>

                            <Button Grid.Column="2"
                                    Command="{Binding RunTargetAppRegistrationCommand}"
                                    Background="{StaticResource AccentGradient}"
                                    BorderThickness="0"
                                    Width="40" Height="40"
                                    ToolTip="Run App Registration for Target Company">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8" x:Name="TargetAppRegBorder">
                                            <TextBlock Text="A" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>

                            <Button Grid.Column="5"
                                    Command="{Binding ImportTargetAppRegistrationCommand}"
                                    Background="{StaticResource SuccessGradient}"
                                    BorderThickness="0"
                                    Width="40" Height="40"
                                    Margin="4,0,0,0"
                                    ToolTip="Import Target App Registration credentials">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8" x:Name="TargetAppImportBorder">
                                            <TextBlock Text="I" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>

                            <Button Grid.Column="6"
                                    Command="{Binding ShowTargetProfilesCommand}"
                                    Background="{StaticResource SecondaryGradient}"
                                    BorderThickness="0"
                                    Width="40" Height="40"
                                    Margin="4,0,0,0"
                                    ToolTip="Manage Target Profiles">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8" x:Name="TargetProfilesBorder">
                                            <TextBlock Text="P" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>

                            <!-- Active Target Profile Picker -->
                            <StackPanel Grid.Column="3" Margin="8,0,8,0">
                                <TextBlock Text="Active Target Profile" Foreground="#FFA0AEC0" FontSize="12" FontWeight="Medium" Margin="0,0,0,4"/>
                                <ComboBox ItemsSource="{Binding TargetProfiles}"
                                          SelectedItem="{Binding SelectedTargetProfile}"
                                          DisplayMemberPath="Name"
                                          Width="260"
                                          Style="{StaticResource ModernComboBoxStyle}"
                                          ToolTip="Active Target Profile used for Graph authentication" />
                            </StackPanel>

                            <Button Grid.Column="4"
                                    Command="{Binding SetActiveTargetProfileCommand}"
                                    Background="{StaticResource SuccessGradient}"
                                    BorderThickness="0"
                                    Width="40" Height="40"
                                    ToolTip="Set Active Target Profile">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8" x:Name="SetActiveProfileBorder">
                                            <TextBlock Text="âœ“" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>

                        <!-- Target Domain Preview -->
                        <TextBlock Margin="0,8,0,0" Foreground="#FFA0AEC0" FontSize="11">
                            <Run Text="Destination Domain: "/>
                            <Run Text="{Binding SelectedTargetCompany.CompanyName}"/>
                        </TextBlock>
                    </StackPanel>
                </Border>
                
                <!-- Company Selector with Status -->
                <Border Grid.Row="1" Padding="24,0,24,24">
                    <StackPanel>
                        <TextBlock Text="Active Company Profile" Foreground="#FFA0AEC0" FontSize="12" FontWeight="Medium" Margin="0,0,0,8"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <ComboBox Grid.Column="0" x:Name="CompanySelector" 
                                      Style="{StaticResource ModernComboBoxStyle}"
                                      Height="40"
                                      FontSize="14"
                                      Margin="0,0,8,0"
                                      ItemsSource="{Binding CompanyProfiles}"
                                      SelectedItem="{Binding SelectedProfile}"
                                      DisplayMemberPath="CompanyName">
                            </ComboBox>
                            
                            <Button Grid.Column="1" x:Name="SwitchProfileButton"
                                    Command="{Binding SwitchProfileCommand}"
                                    Background="{StaticResource SuccessGradient}"
                                    BorderThickness="0"
                                    Width="40" Height="40"
                                    Margin="0,0,4,0"
                                    ToolTip="Switch to Selected Company Profile">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                CornerRadius="8"
                                                x:Name="SwitchButtonBorder">
                                            <TextBlock Text="â†’" FontSize="20" FontWeight="Bold"
                                                      Foreground="White" 
                                                      HorizontalAlignment="Center" 
                                                      VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="SwitchButtonBorder" Property="Background">
                                                    <Setter.Value>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                            <GradientStop Color="#FF66BB6A" Offset="0"/>
                                                            <GradientStop Color="#FF4CAF50" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            
                            <Button Grid.Column="2" x:Name="CreateProfileButton"
                                    Command="{Binding CreateProfileCommand}"
                                    Background="{StaticResource AccentGradient}"
                                    BorderThickness="0"
                                    Width="40" Height="40"
                                    Margin="0,0,4,0"
                                    ToolTip="Create New Company Profile">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                CornerRadius="8"
                                                x:Name="CreateButtonBorder">
                                            <TextBlock Text="+" FontSize="24" FontWeight="Bold"
                                                      Foreground="White" 
                                                      HorizontalAlignment="Center" 
                                                      VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="CreateButtonBorder" Property="Background">
                                                    <Setter.Value>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                            <GradientStop Color="#FF5A9FD4" Offset="0"/>
                                                            <GradientStop Color="#FF4A8BC2" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            
                            <Button Grid.Column="3" x:Name="DeleteProfileButton"
                                    Command="{Binding DeleteProfileCommand}"
                                    Background="{StaticResource DangerGradient}"
                                    BorderThickness="0"
                                    Width="40" Height="40"
                                    ToolTip="Delete Selected Company Profile">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                CornerRadius="8"
                                                x:Name="DeleteButtonBorder">
                                            <TextBlock Text="Ã—" FontSize="24" FontWeight="Bold"
                                                      Foreground="White" 
                                                      HorizontalAlignment="Center" 
                                                      VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="DeleteButtonBorder" Property="Background">
                                                    <Setter.Value>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                            <GradientStop Color="#FFE57373" Offset="0"/>
                                                            <GradientStop Color="#FFD32F2F" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Ellipse Width="8" Height="8" Fill="#FF48BB78" Margin="0,0,8,0"/>
                            <TextBlock Text="Profile Active" Foreground="#FF9AE6B4" FontSize="11"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- Quick Actions Panel -->
                <Border Grid.Row="2" Margin="16,0,16,8" Background="Transparent">
                    <StackPanel>
                        <TextBlock Text="ðŸš€ Quick Actions" Foreground="#FFE2E8F0" FontSize="13" FontWeight="Medium" Margin="0,0,0,12"/>
                        
                        <Button x:Name="QuickAppRegistrationButton" 
                                Command="{Binding RunAppRegistrationCommand}"
                                Background="{StaticResource AccentGradient}"
                                BorderThickness="0"
                                Height="36"
                                Margin="0,0,0,8"
                                ToolTip="Setup Azure App Registration">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            CornerRadius="8"
                                            x:Name="ActionButtonBorder">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Setup App Registration" FontSize="12" FontWeight="Medium"
                                                      Foreground="White" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="ActionButtonBorder" Property="Background">
                                                <Setter.Value>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                        <GradientStop Color="#FF5A9FD4" Offset="0"/>
                                                        <GradientStop Color="#FF4A8BC2" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        
                        <Button x:Name="QuickFullDiscoveryButton" 
                                Command="{Binding StartDiscoveryCommand}"
                                Background="{StaticResource SuccessGradient}"
                                BorderThickness="0"
                                Height="36"
                                Margin="0,0,0,8"
                                ToolTip="Run Full Discovery">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            CornerRadius="8"
                                            x:Name="DiscoveryButtonBorder">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Run Full Discovery" FontSize="12" FontWeight="Medium"
                                                      Foreground="White" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="DiscoveryButtonBorder" Property="Background">
                                                <Setter.Value>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                        <GradientStop Color="#FF5CBB5C" Offset="0"/>
                                                        <GradientStop Color="#FF4A9F4A" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        
                        <Button x:Name="QuickReportsButton" 
                                Command="{Binding OpenTabCommand}"
                                CommandParameter="reports"
                                Background="#FF6B46C1"
                                BorderThickness="0"
                                Height="36"
                                ToolTip="Generate Reports">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            CornerRadius="8"
                                            x:Name="ReportsButtonBorder">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Generate Reports" FontSize="12" FontWeight="Medium"
                                                      Foreground="White" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="ReportsButtonBorder" Property="Background" Value="#FF7C5BDC"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Border>
                
                <!-- Navigation Buttons with Scroll Support -->
                <ScrollViewer Grid.Row="4" Margin="0,8,0,0" 
                              VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled"
                              PanningMode="VerticalOnly">
                    <StackPanel>
                    <Button x:Name="OverviewButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="dashboard"
                            ToolTip="Overview Dashboard - View company overview, statistics, and key metrics">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“Š" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Overview"/>
                                <TextBlock Text="Dashboard &amp; Stats" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="DiscoveryButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="discovery">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ”" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Discovery"/>
                                <TextBlock Text="DNS &amp; Domain Enumeration" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="UsersButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="users"
                            ToolTip="Manage user accounts, view profiles, and analyze user permissions">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ‘¥" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Users"/>
                                <TextBlock Text="User Accounts &amp; Profiles" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="ComputersButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="computers"
                            ToolTip="View computer inventory, hardware specifications, and device status">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ’»" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Computers"/>
                                <TextBlock Text="Devices &amp; Hardware" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="InfrastructureButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="infrastructure"
                            ToolTip="Explore network topology, infrastructure components, and connectivity">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸŒ" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Infrastructure"/>
                                <TextBlock Text="Network &amp; Topology" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>

                    <!-- Security Groups button removed - functionality included in Groups section -->


                    <Button x:Name="GroupsButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="groups"
                            ToolTip="Manage security groups, distribution lists, and group memberships">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ‘¥" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Groups"/>
                                <TextBlock Text="Security &amp; Distribution" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>

                    <Button x:Name="FileServersButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="fileservers">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="File Servers"/>
                                <TextBlock Text="File Shares &amp; Storage" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>

                    <Button x:Name="DatabasesButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="databases">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ—„ï¸" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Databases"/>
                                <TextBlock Text="SQL &amp; Database Discovery" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>

                    <Button x:Name="GroupPoliciesButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="grouppolicies">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ›¡ï¸" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Group Policies"/>
                                <TextBlock Text="GPO Management &amp; Policy Analysis" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>

                    <Button x:Name="ApplicationsButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="applications">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“±" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Applications"/>
                                <TextBlock Text="App Discovery &amp; Catalog" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="WavesButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="waves">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸš€" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Migration Waves"/>
                                <TextBlock Text="Planning &amp; Timeline" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="MigrateButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="migrate">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš¡" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Migrate"/>
                                <TextBlock Text="Execute Migration" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="ManagementButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="management"
                            ToolTip="Project management dashboard with Gantt charts, waves, and migration planning">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“Š" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Management"/>
                                <TextBlock Text="Project Planning" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Separator Margin="24,16" Background="#FF2D3748"/>
                    
                    <Button x:Name="ReportsButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="reports"
                            ToolTip="Generate comprehensive reports and analytics for discovered data">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“„" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Reports"/>
                                <TextBlock Text="Analytics &amp; Exports" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="AnalyticsButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="analytics"
                            ToolTip="Interactive data visualization and analytics dashboard">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“Š" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Analytics"/>
                                <TextBlock Text="Charts &amp; Graphs" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="SettingsButton" Style="{StaticResource NavButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="settings"
                            ToolTip="Configure application settings, authentication, and discovery parameters">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš™ï¸" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Settings"/>
                                <TextBlock Text="Configuration &amp; Setup" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                    
                    <Button x:Name="HelpButton" Style="{StaticResource NavButtonStyle}" Click="HelpButton_Click"
                            ToolTip="Show keyboard shortcuts and help information">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="â“" FontSize="18" Margin="0,0,16,0"/>
                            <StackPanel>
                                <TextBlock Text="Help"/>
                                <TextBlock Text="Shortcuts &amp; Info" FontSize="10" Foreground="#FFA0AEC0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </ScrollViewer>
                
                <!-- Spacer -->
                <!-- Theme Toggle and Settings -->
                <Border Grid.Row="5" Padding="24,16">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,16">
                            <TextBlock Text="Theme" FontSize="13" FontWeight="Medium" Foreground="#FFA0AEC0" VerticalAlignment="Center" Margin="0,0,16,0"/>
                            <ToggleButton x:Name="ThemeToggle" Content="ðŸŒ™" Margin="0,0,10,0" Width="32" Height="32" ToolTip="Toggle Dark/Light Theme" 
                                          Command="{Binding ToggleThemeCommand}" IsEnabled="True"/>
                            <Button Content="Theme Options..." 
                                    Command="{Binding ShowThemeSelectionCommand}"
                                    Background="Transparent" 
                                    Foreground="#FFA0AEC0"
                                    BorderBrush="#FF4A5568" 
                                    BorderThickness="1"
                                    Padding="8,4" 
                                    FontSize="11"
                                    ToolTip="Open detailed theme selection and customization options"
                                    Style="{x:Null}"/>
                        </StackPanel>
                        
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,16">
                            <TextBlock Text="Diagnostics" FontSize="13" FontWeight="Medium" Foreground="#FFA0AEC0" VerticalAlignment="Center" Margin="0,0,16,0"/>
                            <Button Content="View Logs &amp; Audit..." 
                                    Command="{Binding ShowLogViewerCommand}"
                                    Background="Transparent" 
                                    Foreground="#FFA0AEC0"
                                    BorderBrush="#FF4A5568" 
                                    BorderThickness="1"
                                    Padding="8,4" 
                                    FontSize="11"
                                    ToolTip="View system logs, audit trails, and diagnostic information"
                                    Style="{x:Null}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- Enhanced Status Bar -->
                <Border Grid.Row="6" Background="{StaticResource PrimaryGradient}" Padding="24,16">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <Ellipse Width="8" Height="8" Fill="#FF48BB78" Margin="0,0,8,0"/>
                            <TextBlock Text="System Ready" Foreground="White" FontSize="13" FontWeight="Medium"/>
                        </StackPanel>
                        <TextBlock x:Name="StatusDetails" Text="Last discovery: 2 hours ago" Foreground="White" FontSize="11" Opacity="0.8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock x:Name="DomainInfo" Text="Domain: Not detected" Foreground="White" FontSize="11" Opacity="0.8" Margin="0,0,16,0"/>
                            <TextBlock x:Name="EnvironmentType" Text="Environment: Unknown" Foreground="White" FontSize="11" Opacity="0.8"/>
                        </StackPanel>
                        <ProgressBar x:Name="DashboardProgressBar" Style="{StaticResource ProgressRingStyle}" Value="{Binding OverallProgress}" Margin="0,8,0,0" Visibility="{Binding IsDiscoveryRunning, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
        
        <!-- Main Content Area -->
        <Grid Grid.Column="1" Background="#FF0F1419">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Breadcrumb Navigation - DISABLED TO FIX BeginInit CRASH -->
            <!-- <controls:BreadcrumbNavigation Grid.Row="0"/> -->
            
            <!-- Tabbed Document Interface -->
            <TabControl Grid.Row="1" x:Name="MainTabControl"
                        Background="Transparent"
                        BorderThickness="0"
                        Margin="0,8,0,0"
                        AutomationProperties.Name="Main Navigation Tabs"
                        AutomationProperties.HelpText="Navigate between different data views using Tab or arrow keys. Press Ctrl+W to close active tab"
                        KeyboardNavigation.TabNavigation="Local"
                        KeyboardNavigation.DirectionalNavigation="Contained">
                
                <!-- TABCONTROL TEMPLATES DISABLED TO FIX BeginInit CRASH -->
                <!--
                <TabControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="12,8">
                            <TextBlock Text="{Binding TabTitle}" 
                                       Foreground="#FFE2E8F0" 
                                       FontSize="14" 
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"/>
                            <Button Content="âœ•" 
                                    Margin="8,0,0,0"
                                    Width="16" Height="16"
                                    FontSize="10"
                                    Background="Transparent"
                                    Foreground="#FFA0AEC0"
                                    BorderThickness="0"
                                    Padding="0"
                                    Visibility="{Binding CanClose, Converter={StaticResource BoolToVisibilityConverter}}"
                                    Command="{Binding DataContext.CloseTabCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                                    CommandParameter="{Binding}"
                                    AutomationProperties.Name="Close Tab"
                                    AutomationProperties.HelpText="{Binding TabTitle, StringFormat='Close {0} tab'}"
                                    ToolTip="{Binding TabTitle, StringFormat='Close {0} (Ctrl+W)'}"/>
                        </StackPanel>
                    </DataTemplate>
                </TabControl.ItemTemplate>
                
                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <ContentPresenter Content="{Binding}"/>
                    </DataTemplate>
                </TabControl.ContentTemplate>
                -->
                
                <!-- Tab Control Style -->
                <!-- TABCONTROL STYLE DISABLED TO FIX BeginInit CRASH -->
                <!--
                <TabControl.Style>
                    <Style TargetType="TabControl">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabControl">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        Tab Headers
                                        <Border Grid.Row="0" Background="#FF1A202C" BorderBrush="#FF2D3748" BorderThickness="0,0,0,1">
                                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Hidden">
                                                <TabPanel x:Name="HeaderPanel" 
                                                         Panel.ZIndex="1" 
                                                         Margin="16,0"
                                                         IsItemsHost="True" 
                                                         Background="Transparent"/>
                                            </ScrollViewer>
                                        </Border>
                                        
                                        Tab Content
                                        <ContentPresenter Grid.Row="1" 
                                                         x:Name="PART_SelectedContentHost" 
                                                         ContentSource="SelectedContent"/>
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Style>
                -->
                
                <!-- TABITEM STYLE DISABLED TO FIX BeginInit CRASH -->
                <!--
                <TabControl.ItemContainerStyle>
                    <Style TargetType="TabItem">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="#FFA0AEC0"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0,0,4,0"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabItem">
                                    <Border x:Name="Border" 
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="4,4,0,0"
                                            Margin="0,4,0,0">
                                        <ContentPresenter x:Name="ContentSite"
                                                         VerticalAlignment="Center"
                                                         HorizontalAlignment="Center"
                                                         ContentSource="Header"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="#FF2D3748"/>
                                            <Setter Property="Foreground" Value="#FFE2E8F0"/>
                                        </Trigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="#FF374151"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.ItemContainerStyle>
                -->
            </TabControl>
            
            <!-- Legacy Dashboard View (will be replaced by TDI) -->
            <!-- DashboardView - DISABLED for unified TabControl system -->
            <ScrollViewer Grid.Row="1" x:Name="DashboardView" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                <Grid Margin="32">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Dashboard Header -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,32">
                        <StackPanel>
                            <TextBlock Text="Discovery Dashboard" Style="{StaticResource HeaderTextStyle}"/>
                            <TextBlock Text="Real-time insights into your M&amp;A discovery progress" Foreground="#FFA0AEC0" FontSize="16"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="32,0,0,0">
                            <!-- Refresh Status Indicator -->
                            <Border Background="#FF2D3748" CornerRadius="4" Padding="8,6" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ•’" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding RefreshService.ViewStatuses[Dashboard].LastRefreshText}" 
                                               Foreground="#FFA0AEC0" FontSize="11" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            <!-- Progress Bar -->
                            <Border Background="#FF2D3748" CornerRadius="4" Padding="4" Margin="0,0,8,0"
                                    Visibility="{Binding RefreshService.ViewStatuses[Dashboard].IsRefreshing, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ProgressBar Width="60" Height="16" 
                                           Value="{Binding RefreshService.ViewStatuses[Dashboard].RefreshProgress}"
                                           Background="#FF1A202C" Foreground="#FF48BB78" BorderThickness="0"/>
                            </Border>
                            <!-- Refresh Button -->
                            <Button Content="ðŸ”„" ToolTip="Refresh Dashboard" Style="{StaticResource ModernButtonStyle}" 
                                    Background="{StaticResource AccentGradient}" Command="{Binding RefreshDashboardCommand}" 
                                    Width="32" Height="32" Margin="0,0,8,0" FontSize="14"/>
                            <Button Content="âš™ï¸" ToolTip="Refresh Settings" Style="{StaticResource ModernButtonStyle}" 
                                    Background="#FF4A5568" Command="{Binding ShowRefreshSettingsCommand}" 
                                    Width="32" Height="32" Margin="0,0,8,0" FontSize="14"/>
                            <Button Content="ðŸ“Š Export Report" Command="{Binding ExportResultsCommand}" Style="{StaticResource ModernButtonStyle}"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Key Metrics Row -->
                    <UniformGrid Grid.Row="1" Columns="4" Margin="0,0,0,32">
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸ‘¥" FontSize="24" Margin="0,0,12,0"/>
                                    <StackPanel>
                                        <TextBlock x:Name="TotalUsersTextBlock" Text="0" Foreground="#FF4299E1" FontSize="28" FontWeight="Bold"/>
                                        <TextBlock Text="Total Users" Foreground="#FFA0AEC0" FontSize="12"/>
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="â†—" Foreground="#FF48BB78" FontSize="14" Margin="0,0,4,0"/>
                                    <TextBlock Text="+12% from last scan" Foreground="#FF9AE6B4" FontSize="11"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸ’»" FontSize="24" Margin="0,0,12,0"/>
                                    <StackPanel>
                                        <TextBlock x:Name="TotalDevicesTextBlock" Text="0" Foreground="#FF48BB78" FontSize="28" FontWeight="Bold"/>
                                        <TextBlock Text="Devices" Foreground="#FFA0AEC0" FontSize="12"/>
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="â†’" Foreground="#FFED8936" FontSize="14" Margin="0,0,4,0"/>
                                    <TextBlock Text="No changes" Foreground="#FFFBB859" FontSize="11"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸŒ" FontSize="24" Margin="0,0,12,0"/>
                                    <StackPanel>
                                        <TextBlock x:Name="TotalInfrastructureTextBlock" Text="0" Foreground="#FFED8936" FontSize="28" FontWeight="Bold"/>
                                        <TextBlock Text="Infrastructure" Foreground="#FFA0AEC0" FontSize="12"/>
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="â†—" Foreground="#FF48BB78" FontSize="14" Margin="0,0,4,0"/>
                                    <TextBlock Text="+3 new devices" Foreground="#FF9AE6B4" FontSize="11"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="âœ…" FontSize="24" Margin="0,0,12,0"/>
                                    <StackPanel>
                                        <TextBlock x:Name="DiscoveryProgressTextBlock" Text="0%" Foreground="#FF9F7AEA" FontSize="28" FontWeight="Bold"/>
                                        <TextBlock Text="Discovery Complete" Foreground="#FFA0AEC0" FontSize="12"/>
                                    </StackPanel>
                                </StackPanel>
                                <ProgressBar x:Name="DiscoveryProgressBar" Value="{Binding OverallProgress}" Maximum="100" Height="4" Background="#FF2D3748" Foreground="#FF9F7AEA" BorderThickness="0"/>
                            </StackPanel>
                        </Border>
                    </UniformGrid>
                    
                    <!-- Discovery Status Grid -->
                    <Border Grid.Row="2" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,32">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Discovery Module Status" Style="{StaticResource SectionHeaderStyle}"/>
                                <ItemsControl x:Name="DashboardModules">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#FF2D3748" CornerRadius="6" Padding="16" Margin="0,0,0,8">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <TextBlock Grid.Column="0" Text="{Binding Icon}" FontSize="20" Margin="0,0,16,0"/>
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding Name}" Foreground="#FFE2E8F0" FontSize="14" FontWeight="Medium"/>
                                                        <TextBlock Text="{Binding Description}" Foreground="#FFA0AEC0" FontSize="11" TextWrapping="Wrap"/>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="16,0">
                                                        <Ellipse Width="8" Height="8" Fill="{Binding StatusColor}" Margin="0,0,6,0"/>
                                                        <TextBlock Text="{Binding Status}" Foreground="#FFA0AEC0" FontSize="12"/>
                                                    </StackPanel>
                                                    <Button Grid.Column="3" Content="View" 
                                                            Background="{StaticResource PrimaryGradient}" 
                                                            Foreground="White" 
                                                            BorderThickness="0" 
                                                            Padding="12,6" 
                                                            FontSize="11"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="32,0,0,0">
                                <TextBlock Text="Recent Activity" Style="{StaticResource SectionHeaderStyle}"/>
                                <Border Background="#FF2D3748" CornerRadius="6" Padding="16">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <Ellipse Width="6" Height="6" Fill="#FF48BB78" Margin="0,0,8,0"/>
                                            <StackPanel>
                                                <TextBlock Text="Palo Alto Discovery" Foreground="#FFE2E8F0" FontSize="12" FontWeight="Medium"/>
                                                <TextBlock Text="2 minutes ago" Foreground="#FFA0AEC0" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <Ellipse Width="6" Height="6" Fill="#FF4299E1" Margin="0,0,8,0"/>
                                            <StackPanel>
                                                <TextBlock Text="User Data Updated" Foreground="#FFE2E8F0" FontSize="12" FontWeight="Medium"/>
                                                <TextBlock Text="15 minutes ago" Foreground="#FFA0AEC0" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <Ellipse Width="6" Height="6" Fill="#FFED8936" Margin="0,0,8,0"/>
                                            <StackPanel>
                                                <TextBlock Text="Exchange Discovery" Foreground="#FFE2E8F0" FontSize="12" FontWeight="Medium"/>
                                                <TextBlock Text="1 hour ago" Foreground="#FFA0AEC0" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <Button Content="View All Activity" 
                                                Background="Transparent" 
                                                Foreground="#FF4299E1" 
                                                BorderThickness="0" 
                                                HorizontalAlignment="Left"
                                                Padding="0,8,0,0"
                                                FontSize="11"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Quick Actions Panel -->
                    <Border Grid.Row="3" Style="{StaticResource ModernCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Quick Actions" Style="{StaticResource SectionHeaderStyle}"/>
                                <Button x:Name="RunFullDiscoveryButton" Command="{Binding StartDiscoveryCommand}" Style="{StaticResource ModernButtonStyle}" Margin="0,0,0,12">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="Run Full Discovery"/>
                                    </StackPanel>
                                </Button>
                                <Button x:Name="ImportDataButton" Command="{Binding ImportDataCommand}" Style="{StaticResource ModernButtonStyle}" Background="{StaticResource AccentGradient}" Margin="0,0,0,12">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“‚" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="Import Existing Data"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernButtonStyle}" Background="#FF2D3748">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="Generate Report"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="32,0">
                                <TextBlock Text="Data Quality" Style="{StaticResource SectionHeaderStyle}"/>
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBlock Text="User Data" Foreground="#FFE2E8F0" FontSize="13" Width="100"/>
                                        <ProgressBar Value="95" Maximum="100" Height="6" Width="120" Background="#FF2D3748" Foreground="#FF48BB78" BorderThickness="0"/>
                                        <TextBlock Text="95%" Foreground="#FF48BB78" FontSize="12" Margin="8,0,0,0"/>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBlock Text="Computer Data" Foreground="#FFE2E8F0" FontSize="13" Width="100"/>
                                        <ProgressBar Value="87" Maximum="100" Height="6" Width="120" Background="#FF2D3748" Foreground="#FF4299E1" BorderThickness="0"/>
                                        <TextBlock Text="87%" Foreground="#FF4299E1" FontSize="12" Margin="8,0,0,0"/>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBlock Text="Infrastructure" Foreground="#FFE2E8F0" FontSize="13" Width="100"/>
                                        <ProgressBar Value="73" Maximum="100" Height="6" Width="120" Background="#FF2D3748" Foreground="#FFED8936" BorderThickness="0"/>
                                        <TextBlock Text="73%" Foreground="#FFED8936" FontSize="12" Margin="8,0,0,0"/>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Applications" Foreground="#FFE2E8F0" FontSize="13" Width="100"/>
                                        <ProgressBar Value="91" Maximum="100" Height="6" Width="120" Background="#FF2D3748" Foreground="#FF9F7AEA" BorderThickness="0"/>
                                        <TextBlock Text="91%" Foreground="#FF9F7AEA" FontSize="12" Margin="8,0,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="System Health" Style="{StaticResource SectionHeaderStyle}"/>
                                <Border Background="#FF2D3748" CornerRadius="6" Padding="16">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Ellipse Width="8" Height="8" Fill="#FF48BB78" Margin="0,0,8,0"/>
                                            <TextBlock Text="PowerShell Modules" Foreground="#FFE2E8F0" FontSize="12"/>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Ellipse Width="8" Height="8" Fill="#FF48BB78" Margin="0,0,8,0"/>
                                            <TextBlock Text="Network Connectivity" Foreground="#FFE2E8F0" FontSize="12"/>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Ellipse Width="8" Height="8" Fill="#FFED8936" Margin="0,0,8,0"/>
                                            <TextBlock Text="API Credentials" Foreground="#FFE2E8F0" FontSize="12"/>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal">
                                            <Ellipse Width="8" Height="8" Fill="#FF48BB78" Margin="0,0,8,0"/>
                                            <TextBlock Text="Data Storage" Foreground="#FFE2E8F0" FontSize="12"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </ScrollViewer>
            
            <!-- Legacy Discovery View - REMOVED to prevent conflicts -->
            <ScrollViewer Grid.Row="1" x:Name="DiscoveryView" Visibility="Collapsed" VerticalScrollBarVisibility="Auto" Opacity="0" IsEnabled="False">
                <Grid Margin="32">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,32">
                        <StackPanel>
                            <TextBlock Text="Discovery Modules" Style="{StaticResource HeaderTextStyle}"/>
                            <TextBlock Text="Run discovery modules to gather comprehensive organizational data" Foreground="#FFA0AEC0" FontSize="16"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="32,0,0,0">
                            <Button Content="ðŸ”„ Refresh Data" Style="{StaticResource ModernButtonStyle}" 
                                    Background="{StaticResource AccentGradient}" Command="{Binding RefreshDataCommand}" 
                                    Margin="0,0,12,0"/>
                            <Button x:Name="RunAllDiscoveryButton" Content="â–¶ï¸ Run All Modules" Style="{StaticResource ModernButtonStyle}"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <WrapPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,32">
                        <Button x:Name="ADDiscoveryBtn" Style="{StaticResource ModernButtonStyle}" Background="{StaticResource AccentGradient}" Margin="0,0,12,8" Command="{Binding ToggleModuleCommand}" CommandParameter="ActiveDirectory">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Active Directory" Foreground="White"/>
                                    <Ellipse x:Name="ADStatusIndicator" Width="8" Height="8" Fill="#FFF59E0B" Margin="8,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="ADStatusText" Text="Ready" FontSize="10" Foreground="#FFA0AEC0" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="EntraDiscoveryBtn" Style="{StaticResource ModernButtonStyle}" Background="#FF2D3748" Margin="0,0,12,8" Command="{Binding ToggleModuleCommand}" CommandParameter="AzureAD">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Azure AD / Entra" Foreground="White"/>
                                    <Ellipse x:Name="EntraStatusIndicator" Width="8" Height="8" Fill="#FFF59E0B" Margin="8,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="EntraStatusText" Text="Ready" FontSize="10" Foreground="#FFA0AEC0" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="InfraDiscoveryBtn" Style="{StaticResource ModernButtonStyle}" Background="#FF2D3748" Margin="0,0,12,8" Command="{Binding ToggleModuleCommand}" CommandParameter="NetworkInfrastructure">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Infrastructure" Foreground="White"/>
                                    <Ellipse x:Name="InfraStatusIndicator" Width="8" Height="8" Fill="#FFF59E0B" Margin="8,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="InfraStatusText" Text="Ready" FontSize="10" Foreground="#FFA0AEC0" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="AppsDiscoveryBtn" Style="{StaticResource ModernButtonStyle}" Background="#FF2D3748" Margin="0,0,12,8" Command="{Binding ToggleModuleCommand}" CommandParameter="applications">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Applications" Foreground="White"/>
                                    <Ellipse x:Name="AppsStatusIndicator" Width="8" Height="8" Fill="#FFF59E0B" Margin="8,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="AppsStatusText" Text="Ready" FontSize="10" Foreground="#FFA0AEC0" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="DomainDiscoveryBtn" Command="{Binding OpenTabCommand}" CommandParameter="domaindiscovery" Style="{StaticResource ModernButtonStyle}" Background="#FF2D3748" Margin="0,0,12,8">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Domain Discovery" Foreground="White"/>
                                    <Ellipse x:Name="DomainStatusIndicator" Width="8" Height="8" Fill="#FFF59E0B" Margin="8,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="DomainStatusText" Text="Ready" FontSize="10" Foreground="#FFA0AEC0" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="FileServersDiscoveryBtn" Command="{Binding OpenTabCommand}" CommandParameter="fileservers" Style="{StaticResource ModernButtonStyle}" Background="#FF2D3748" Margin="0,0,12,8">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="File Servers" Foreground="White"/>
                                    <Ellipse x:Name="FileServersStatusIndicator" Width="8" Height="8" Fill="#FFF59E0B" Margin="8,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="FileServersStatusText" Text="Ready" FontSize="10" Foreground="#FFA0AEC0" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="DatabasesDiscoveryBtn" Command="{Binding OpenTabCommand}" CommandParameter="databases" Style="{StaticResource ModernButtonStyle}" Background="#FF2D3748" Margin="0,0,12,8">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Databases" Foreground="White"/>
                                    <Ellipse x:Name="DatabasesStatusIndicator" Width="8" Height="8" Fill="#FFF59E0B" Margin="8,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="DatabasesStatusText" Text="Ready" FontSize="10" Foreground="#FFA0AEC0" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="GroupPoliciesDiscoveryBtn" Command="{Binding OpenTabCommand}" CommandParameter="grouppolicies" Style="{StaticResource ModernButtonStyle}" Background="#FF2D3748" Margin="0,0,12,8">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Group Policies" Foreground="White"/>
                                    <Ellipse x:Name="GroupPoliciesStatusIndicator" Width="8" Height="8" Fill="#FFF59E0B" Margin="8,0,0,0"/>
                                </StackPanel>
                                <TextBlock x:Name="GroupPoliciesStatusText" Text="Ready" FontSize="10" Foreground="#FFA0AEC0" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Content="ðŸ‘ï¸ Show All" Style="{StaticResource ModernButtonStyle}" Background="Transparent" BorderBrush="#FF4A5568" BorderThickness="1" Command="{Binding ShowAllDiscoveryDataCommand}"/>
                        <Button Content="ðŸ‘¤ Select Manager" Style="{StaticResource ModernButtonStyle}" Background="#FF9F7AEA" Margin="12,0,0,8" Command="{Binding SelectManagerCommand}" ToolTip="Demo: Manager Selection Dialog"/>
                    </WrapPanel>
                    
                    <ItemsControl Grid.Row="2" x:Name="DiscoveryModules" ItemsSource="{Binding DiscoveryModules}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource ModernCardStyle}" Width="380" Height="220">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        
                                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                                            <TextBlock Text="{Binding Icon}" FontSize="32" Margin="0,0,16,0"/>
                                            <StackPanel>
                                                <TextBlock Text="{Binding DisplayName}" Foreground="#FFE2E8F0" FontSize="18" FontWeight="SemiBold"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                    <Ellipse Width="8" Height="8" Fill="{Binding StatusColor}" Margin="0,0,8,0"/>
                                                    <TextBlock Text="{Binding StatusText}" Foreground="#FFA0AEC0" FontSize="12"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <TextBlock Grid.Row="1" Text="{Binding Description}" 
                                                   Foreground="#FFA0AEC0" FontSize="13" 
                                                   TextWrapping="Wrap" LineHeight="20"/>
                                        
                                        <ProgressBar Grid.Row="2" Value="0" Maximum="100" Height="4" 
                                                     Background="#FF2D3748" Foreground="{StaticResource PrimaryGradient}" 
                                                     BorderThickness="0" Margin="0,16,0,16" 
                                                     Visibility="Collapsed"/>
                                        
                                        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
                                            <Button Content="Configure" 
                                                    Command="{Binding ConfigureCommand}"
                                                    Style="{StaticResource ModernButtonStyle}"
                                                    Background="#FF4A5568" Foreground="#FFE2E8F0"
                                                    FontSize="12" Padding="16,8" Margin="0,0,8,0"
                                                    IsEnabled="{Binding CanConfigure}"/>
                                            <Button Content="Run Discovery" 
                                                    Command="{Binding RunDiscoveryCommand}"
                                                    Style="{StaticResource ModernButtonStyle}" 
                                                    FontSize="12" Padding="16,8"
                                                    IsEnabled="{Binding CanRun}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
            </ScrollViewer>
            
            <!-- Enhanced Users View -->
            <!-- UsersView - DISABLED for unified TabControl system -->
            <ScrollViewer Grid.Row="1" x:Name="UsersView" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                <Grid Margin="32">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,24">
                        <StackPanel>
                            <TextBlock Text="User Accounts" Style="{StaticResource HeaderTextStyle}"/>
                            <TextBlock Text="Comprehensive view of all discovered user accounts and profiles" Foreground="#FFA0AEC0" FontSize="16"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="32,0,0,0">
                            <!-- Refresh Status Indicator -->
                            <Border Background="#FF2D3748" CornerRadius="4" Padding="8,6" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ•’" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding RefreshService.ViewStatuses[Users].LastRefreshText}" 
                                               Foreground="#FFA0AEC0" FontSize="11" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            <!-- Progress Bar -->
                            <Border Background="#FF2D3748" CornerRadius="4" Padding="4" Margin="0,0,8,0"
                                    Visibility="{Binding RefreshService.ViewStatuses[Users].IsRefreshing, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ProgressBar Width="60" Height="16" 
                                           Value="{Binding RefreshService.ViewStatuses[Users].RefreshProgress}"
                                           Background="#FF1A202C" Foreground="#FF48BB78" BorderThickness="0"/>
                            </Border>
                            <!-- User Count -->
                            <Border Background="#FF2D3748" CornerRadius="4" Padding="8,6" Margin="0,0,12,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ“Š" FontSize="14" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="UserResultCount" Text="0 users" Foreground="#FF4299E1" 
                                               FontSize="12" FontWeight="Medium" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            <!-- Refresh Buttons -->
                            <Button Content="ðŸ”„" ToolTip="Refresh Users" Style="{StaticResource ModernButtonStyle}" 
                                    Background="{StaticResource AccentGradient}" Command="{Binding RefreshUsersCommand}" 
                                    Width="32" Height="32" Margin="0,0,8,0" FontSize="14"/>
                            <Button Content="âš™ï¸" ToolTip="Refresh Settings" Style="{StaticResource ModernButtonStyle}" 
                                    Background="#FF4A5568" Command="{Binding ShowRefreshSettingsCommand}" 
                                    Width="32" Height="32" Margin="0,0,12,0" FontSize="14"/>
                            <TextBox x:Name="UserSearchBox" Width="250" Height="32" 
                                     Background="#FF2D3748" Foreground="#FFE2E8F0" 
                                     BorderBrush="#FF4A5568" Padding="12,6"
                                     FontSize="13" Text="{Binding UserSearchText, UpdateSourceTrigger=PropertyChanged}"
                                     behaviors:WatermarkBehavior.Watermark="Search users..."
                                     behaviors:VisualFeedbackBehavior.EnableHoverEffect="True"
                                     behaviors:VisualFeedbackBehavior.HoverScale="1.02"
                                     behaviors:KeyboardNavigationBehavior.EnableEnhancedNavigation="True"/>
                            <Button Content="â˜‘ï¸ Select All" Style="{StaticResource ModernButtonStyle}" Margin="12,0,0,0" Command="{Binding SelectAllUsersCommand}"/>
                            <Button Content="â˜ Deselect All" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding DeselectAllUsersCommand}"/>
                            <Button Content="ðŸ“¤ Export Selected" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding ExportSelectedUsersCommand}"/>
                            <Button Content="ðŸ“‹ Copy Selected" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding CopySelectedUsersCommand}"/>
                            <Button Content="ðŸ“‹ Copy All" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding CopyAllUsersCommand}"/>
                            <Button Content="ðŸ‘ï¸ Columns" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding ShowColumnVisibilityCommand}" CommandParameter="users"/>
                            <Button Content="ðŸ” Advanced Search" Style="{StaticResource ModernButtonStyle}" Background="#FF4299E1" Margin="8,0,0,0" Command="{Binding ShowUsersAdvancedSearchCommand}"/>
                            <Button Content="ðŸ—‘ï¸ Delete Selected" Style="{StaticResource ModernButtonStyle}" Background="{StaticResource DangerGradient}" Margin="8,0,0,0" Command="{Binding DeleteSelectedUsersCommand}"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <UniformGrid Grid.Row="1" Columns="5" Margin="0,0,0,24">
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <TextBlock Text="{Binding Users.Count}" Foreground="#FF4299E1" FontSize="24" FontWeight="Bold"/>
                                <TextBlock Text="Total Users" Foreground="#FFA0AEC0" FontSize="11"/>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <TextBlock Text="{Binding Users.Count}" Foreground="#FF48BB78" FontSize="24" FontWeight="Bold"/>
                                <TextBlock Text="Active Users" Foreground="#FFA0AEC0" FontSize="11"/>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <TextBlock Text="91" Foreground="#FFED8936" FontSize="24" FontWeight="Bold"/>
                                <TextBlock Text="Disabled Users" Foreground="#FFA0AEC0" FontSize="11"/>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <TextBlock x:Name="ServiceAccountsTextBlock" Text="0" Foreground="#FF9F7AEA" FontSize="24" FontWeight="Bold"/>
                                <TextBlock Text="Service Accounts" Foreground="#FFA0AEC0" FontSize="11"/>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <TextBlock Text="67" Foreground="#FFED8936" FontSize="24" FontWeight="Bold"/>
                                <TextBlock Text="Privileged Users" Foreground="#FFA0AEC0" FontSize="11"/>
                            </StackPanel>
                        </Border>
                    </UniformGrid>
                    
                    <Border Grid.Row="2" Style="{StaticResource ModernCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Loading Indicator for Users -->
                            <Border Grid.Row="0" Background="#FF1A202C" Padding="10" 
                                    Visibility="{Binding IsUsersLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ”„" FontSize="16" Margin="0,0,10,0" RenderTransformOrigin="0.5,0.5">
                                        <TextBlock.RenderTransform>
                                            <RotateTransform x:Name="LoadingRotation"/>
                                        </TextBlock.RenderTransform>
                                        <TextBlock.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation Storyboard.TargetName="LoadingRotation" 
                                                                       Storyboard.TargetProperty="Angle" 
                                                                       From="0" To="360" Duration="0:0:2"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </TextBlock.Triggers>
                                    </TextBlock>
                                    <StackPanel>
                                        <TextBlock Text="{Binding UsersLoadingMessage}" Foreground="#FF67D391" FontWeight="Medium"/>
                                        <ProgressBar Value="{Binding UsersLoadingProgress}" Maximum="100" Width="200" Height="4" 
                                                   Background="#FF374151" Foreground="#FF10B981" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            <DataGrid x:Name="UsersDataGrid" Grid.Row="1" ItemsSource="{Binding Users}" Style="{StaticResource ModernDataGridStyle}" 
                                      CanUserSortColumns="True" AutoGenerateColumns="False" SelectionMode="Extended"
                                      VirtualizingStackPanel.IsVirtualizing="True" 
                                      EnableRowVirtualization="True" 
                                      EnableColumnVirtualization="True"
                                      behaviors:ColumnVisibilityBehavior.GridName="Users"
                                      behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                      behaviors:VirtualizationBehavior.VirtualizationMode="Recycling"
                                      behaviors:VirtualizationBehavior.ScrollUnit="Item"
                                      behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                      behaviors:VirtualizationBehavior.EnableRowVirtualization="True"
                                      behaviors:VisualFeedbackBehavior.EnableHoverEffect="True"
                                      behaviors:VisualFeedbackBehavior.EnableLoadingState="True"
                                      behaviors:VisualFeedbackBehavior.IsLoading="{Binding IsUsersLoading}"
                                      behaviors:KeyboardNavigationBehavior.EnableVirtualizedNavigation="True"
                                      behaviors:ResponsiveLayoutBehavior.AdaptiveColumns="True">
                                <DataGrid.Columns>
                                    <DataGridCheckBoxColumn Header="âœ“" Width="40" Binding="{Binding IsSelected, Mode=TwoWay}"/>
                                    <DataGridTextColumn Header="Display Name" Binding="{Binding Name}" Width="180" CanUserSort="True" SortMemberPath="Name">
                                        <DataGridTextColumn.HeaderStyle>
                                            <Style TargetType="DataGridColumnHeader">
                                                <Setter Property="Background" Value="{StaticResource PrimaryGradient}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Setter Property="Padding" Value="12,8"/>
                                                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                            </Style>
                                        </DataGridTextColumn.HeaderStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="200" CanUserSort="True" SortMemberPath="Email"/>
                                    <DataGridTextColumn Header="Department" Binding="{Binding Department}" Width="150" CanUserSort="True" SortMemberPath="Department"/>
                                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100" CanUserSort="True" SortMemberPath="Status"/>
                                    <DataGridTextColumn Header="UPN" Binding="{Binding UserPrincipalName}" Width="200" CanUserSort="True" SortMemberPath="UserPrincipalName"/>
                                    <DataGridTextColumn Header="Last Sign-In" Binding="{Binding LastSignInDateTime}" Width="140" CanUserSort="True" SortMemberPath="LastSignInDateTime"/>
                                    <DataGridTextColumn Header="Groups" Binding="{Binding GroupMembershipCount}" Width="60" CanUserSort="True" SortMemberPath="GroupMembershipCount"/>
                                    <DataGridTextColumn Header="Manager" Binding="{Binding ManagerDisplayName}" Width="150" CanUserSort="True" SortMemberPath="ManagerDisplayName"/>
                                    <DataGridTextColumn Header="Job Title" Binding="{Binding JobTitle}" Width="150" CanUserSort="True" SortMemberPath="JobTitle"/>
                                    <DataGridTextColumn Header="City" Binding="{Binding City}" Width="120" CanUserSort="True" SortMemberPath="City"/>
                                    <DataGridTemplateColumn Header="Actions" Width="80">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Content="View" 
                                                        Background="#FF4299E1" 
                                                        Foreground="White" 
                                                        BorderThickness="0" 
                                                        Padding="8,4" 
                                                        FontSize="10"
                                                        Command="{Binding ViewUserCommand}"
                                                        Tag="{Binding}"
                                                        Cursor="Hand"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                            
                            <!-- Empty State Message -->
                            <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Users.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock Text="ðŸ“„" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16" Opacity="0.3"/>
                                <TextBlock Text="No users found" 
                                           FontSize="18" 
                                           FontWeight="SemiBold" 
                                           Foreground="#FFA0AEC0" 
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,8"/>
                                <TextBlock Text="Run a discovery operation to populate user data"
                                           FontSize="14"
                                           Foreground="#FF718096"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Users Pagination Controls -->
                            <Border Grid.Row="2" Background="#FF2D3748" Margin="0,8,0,0" CornerRadius="8" Padding="12,8">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Users.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Page Info -->
                                    <TextBlock Grid.Column="0" 
                                               Text="{Binding UserPageInfo}" 
                                               Foreground="#FFE2E8F0" 
                                               VerticalAlignment="Center"
                                               FontSize="13"/>
                                    
                                    <!-- Page Navigation -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                        <!-- First Page Button -->
                                        <Button Content="â®ï¸" 
                                                Command="{Binding FirstUserPageCommand}"
                                                IsEnabled="{Binding HasPreviousUserPage}"
                                                Style="{StaticResource ModernButtonStyle}"
                                                Width="32" Height="32" 
                                                Margin="0,0,4,0"
                                                ToolTip="First Page"
                                                FontSize="14"/>
                                        
                                        <!-- Previous Page Button -->
                                        <Button Content="â—€ï¸" 
                                                Command="{Binding PreviousUserPageCommand}"
                                                IsEnabled="{Binding HasPreviousUserPage}"
                                                Style="{StaticResource ModernButtonStyle}"
                                                Width="32" Height="32" 
                                                Margin="0,0,4,0"
                                                ToolTip="Previous Page"
                                                FontSize="14"/>
                                        
                                        <!-- Current Page Info -->
                                        <Border Background="#FF4A5568" 
                                                CornerRadius="4" 
                                                Padding="8,4" 
                                                Margin="0,0,4,0">
                                            <TextBlock>
                                                <Run Text="Page "/>
                                                <Run Text="{Binding CurrentUserPage, Mode=OneWay}"/>
                                                <Run Text=" of "/>
                                                <Run Text="{Binding TotalUserPages, Mode=OneWay}"/>
                                            </TextBlock>
                                        </Border>
                                        
                                        <!-- Next Page Button -->
                                        <Button Content="â–¶ï¸" 
                                                Command="{Binding NextUserPageCommand}"
                                                IsEnabled="{Binding HasNextUserPage}"
                                                Style="{StaticResource ModernButtonStyle}"
                                                Width="32" Height="32" 
                                                Margin="0,0,4,0"
                                                ToolTip="Next Page"
                                                FontSize="14"/>
                                        
                                        <!-- Last Page Button -->
                                        <Button Content="â­ï¸" 
                                                Command="{Binding LastUserPageCommand}"
                                                IsEnabled="{Binding HasNextUserPage}"
                                                Style="{StaticResource ModernButtonStyle}"
                                                Width="32" Height="32"
                                                ToolTip="Last Page"
                                                FontSize="14"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </ScrollViewer>
            
            
            <!-- Enhanced Infrastructure View -->
            <!-- InfrastructureView - DISABLED for unified TabControl system -->
            <ScrollViewer Grid.Row="1" x:Name="InfrastructureView" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                <Grid Margin="32">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,24">
                        <StackPanel>
                            <TextBlock Text="Network Infrastructure" Style="{StaticResource HeaderTextStyle}"/>
                            <TextBlock Text="Network topology, security devices, and infrastructure components" Foreground="#FFA0AEC0" FontSize="16"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="32,0,0,0">
                            <!-- Refresh Status Indicator -->
                            <Border Background="#FF2D3748" CornerRadius="4" Padding="8,6" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ•’" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding RefreshService.ViewStatuses[Infrastructure].LastRefreshText}" 
                                               Foreground="#FFA0AEC0" FontSize="11" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            <!-- Progress Bar -->
                            <Border Background="#FF2D3748" CornerRadius="4" Padding="4" Margin="0,0,8,0"
                                    Visibility="{Binding RefreshService.ViewStatuses[Infrastructure].IsRefreshing, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ProgressBar Width="60" Height="16" 
                                           Value="{Binding RefreshService.ViewStatuses[Infrastructure].RefreshProgress}"
                                           Background="#FF1A202C" Foreground="#FF48BB78" BorderThickness="0"/>
                            </Border>
                            <!-- Refresh Button -->
                            <Button Content="ðŸ”„" ToolTip="Refresh Infrastructure" Style="{StaticResource ModernButtonStyle}" 
                                    Background="{StaticResource AccentGradient}" Command="{Binding RefreshInfrastructureCommand}" 
                                    Width="32" Height="32" Margin="0,0,8,0" FontSize="14"/>
                            <Button Content="ðŸŒ Network Map" Style="{StaticResource ModernButtonStyle}" Background="{StaticResource AccentGradient}" Margin="0,0,8,0"/>
                            <Button Content="ðŸ”’ Security Scan" Style="{StaticResource ModernButtonStyle}" Background="{StaticResource DangerGradient}"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <UniformGrid Grid.Row="1" Columns="4" Margin="0,0,0,24">
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸ”¥" FontSize="20" Margin="0,0,8,0"/>
                                    <StackPanel>
                                        <TextBlock Text="5" Foreground="#FFED8936" FontSize="24" FontWeight="Bold"/>
                                        <TextBlock Text="Palo Alto Devices" Foreground="#FFA0AEC0" FontSize="11"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Text="2 HA Pairs" Foreground="#FF9AE6B4" FontSize="10"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸŒ" FontSize="20" Margin="0,0,8,0"/>
                                    <StackPanel>
                                        <TextBlock Text="12" Foreground="#FF4299E1" FontSize="24" FontWeight="Bold"/>
                                        <TextBlock Text="Network Devices" Foreground="#FFA0AEC0" FontSize="11"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Text="Switches &amp; Routers" Foreground="#FF63B3ED" FontSize="10"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸ–¥ï¸" FontSize="20" Margin="0,0,8,0"/>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Infrastructure.Count}" Foreground="#FF48BB78" FontSize="24" FontWeight="Bold"/>
                                        <TextBlock Text="Servers" Foreground="#FFA0AEC0" FontSize="11"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Text="Physical &amp; Virtual" Foreground="#FF9AE6B4" FontSize="10"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="â˜ï¸" FontSize="20" Margin="0,0,8,0"/>
                                    <StackPanel>
                                        <TextBlock Text="8" Foreground="#FF9F7AEA" FontSize="24" FontWeight="Bold"/>
                                        <TextBlock Text="Cloud Services" Foreground="#FFA0AEC0" FontSize="11"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Text="Azure &amp; AWS" Foreground="#FFD6BCFA" FontSize="10"/>
                            </StackPanel>
                        </Border>
                    </UniformGrid>
                    
                    <!-- Dynamic Network Topology Visualization -->
                    <Border Grid.Row="2" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="Network Topology" Style="{StaticResource SectionHeaderStyle}" VerticalAlignment="Center"/>
                                    <Button x:Name="RefreshTopologyButton" Content="ðŸ”„ Refresh" 
                                            Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF4299E1" Margin="16,0,0,0" Padding="8,4"
                                            Command="{Binding RefreshTopologyCommand}" FontSize="12"/>
                                    <Button x:Name="AutoLayoutButton" Content="ðŸ“ Auto Layout" 
                                            Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF48BB78" Margin="8,0,0,0" Padding="8,4"
                                            Command="{Binding AutoLayoutTopologyCommand}" FontSize="12"/>
                                </StackPanel>
                                <Border Background="#FF2D3748" CornerRadius="8" Height="300" Padding="10">
                                    <Grid>
                                        <Canvas x:Name="NetworkTopologyCanvas" ClipToBounds="True">
                                            <!-- Dynamic network nodes and connections will be added here -->
                                        </Canvas>
                                        
                                        <!-- Loading Indicator -->
                                        <Border x:Name="TopologyLoadingPanel" Background="#AA1A202C" 
                                                CornerRadius="8" Visibility="Collapsed">
                                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <TextBlock Text="â³" FontSize="24" HorizontalAlignment="Center" 
                                                           Foreground="#FF4299E1" Margin="0,0,0,8"/>
                                                <TextBlock Text="Scanning network topology..." 
                                                           Foreground="#FFE2E8F0" FontSize="14" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- No Data Indicator -->
                                        <Border x:Name="TopologyNoDataPanel" Background="Transparent" 
                                                CornerRadius="8" Visibility="Collapsed">
                                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <TextBlock Text="ðŸ”" FontSize="32" HorizontalAlignment="Center" 
                                                           Foreground="#FF718096" Margin="0,0,0,8"/>
                                                <TextBlock Text="No network topology data available" 
                                                           Foreground="#FF718096" FontSize="14" HorizontalAlignment="Center"/>
                                                <TextBlock Text="Run Network Infrastructure Discovery to populate this view" 
                                                           Foreground="#FF4A5568" FontSize="12" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Border>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="24,0,0,0">
                                <TextBlock Text="Security Posture" Style="{StaticResource SectionHeaderStyle}"/>
                                <Border Background="#FF2D3748" CornerRadius="6" Padding="16">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <Ellipse Width="8" Height="8" Fill="#FF48BB78" Margin="0,0,8,0"/>
                                            <StackPanel>
                                                <TextBlock Text="Firewall Rules" Foreground="#FFE2E8F0" FontSize="12" FontWeight="Medium"/>
                                                <TextBlock Text="347 rules optimized" Foreground="#FF9AE6B4" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <Ellipse Width="8" Height="8" Fill="#FFED8936" Margin="0,0,8,0"/>
                                            <StackPanel>
                                                <TextBlock Text="VPN Tunnels" Foreground="#FFE2E8F0" FontSize="12" FontWeight="Medium"/>
                                                <TextBlock Text="12 active connections" Foreground="#FFFBB859" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <Ellipse Width="8" Height="8" Fill="#FF4299E1" Margin="0,0,8,0"/>
                                            <StackPanel>
                                                <TextBlock Text="SSL Decryption" Foreground="#FFE2E8F0" FontSize="12" FontWeight="Medium"/>
                                                <TextBlock Text="89% coverage" Foreground="#FF63B3ED" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal">
                                            <Ellipse Width="8" Height="8" Fill="#FFF56565" Margin="0,0,8,0"/>
                                            <StackPanel>
                                                <TextBlock Text="Threat Detection" Foreground="#FFE2E8F0" FontSize="12" FontWeight="Medium"/>
                                                <TextBlock Text="3 alerts today" Foreground="#FFFED7D7" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                                
                                <TextBlock Text="Device Health" Style="{StaticResource SectionHeaderStyle}" Margin="0,16,0,8"/>
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBlock Text="PA-5220-1" Foreground="#FFE2E8F0" FontSize="12" Width="80"/>
                                        <ProgressBar Value="95" Maximum="100" Height="4" Width="80" Background="#FF2D3748" Foreground="#FF48BB78" BorderThickness="0"/>
                                        <TextBlock Text="95%" Foreground="#FF48BB78" FontSize="10" Margin="8,0,0,0"/>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBlock Text="PA-5220-2" Foreground="#FFE2E8F0" FontSize="12" Width="80"/>
                                        <ProgressBar Value="97" Maximum="100" Height="4" Width="80" Background="#FF2D3748" Foreground="#FF48BB78" BorderThickness="0"/>
                                        <TextBlock Text="97%" Foreground="#FF48BB78" FontSize="10" Margin="8,0,0,0"/>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBlock Text="Panorama" Foreground="#FFE2E8F0" FontSize="12" Width="80"/>
                                        <ProgressBar Value="92" Maximum="100" Height="4" Width="80" Background="#FF2D3748" Foreground="#FF4299E1" BorderThickness="0"/>
                                        <TextBlock Text="92%" Foreground="#FF4299E1" FontSize="10" Margin="8,0,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Infrastructure Device List -->
                    <Border Grid.Row="3" Style="{StaticResource ModernCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Infrastructure Toolbar -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                                <StackPanel>
                                    <TextBlock Text="Infrastructure Devices" Style="{StaticResource SectionHeaderStyle}"/>
                                    <TextBlock Text="Network devices, servers, and infrastructure components" Foreground="#FFA0AEC0" FontSize="12"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="32,0,0,0">
                                    <Border Background="#FF2D3748" CornerRadius="4" Padding="8,6" Margin="0,0,12,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ’»" FontSize="14" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                            <TextBlock x:Name="InfrastructureResultCount" Text="0 devices" Foreground="#FF4299E1" 
                                                       FontSize="12" FontWeight="Medium" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                    <TextBox x:Name="InfrastructureSearchBox" Width="250" Height="32" 
                                             Background="#FF2D3748" Foreground="#FFE2E8F0" 
                                             BorderBrush="#FF4A5568" Padding="12,6"
                                             FontSize="13" Text="{Binding InfrastructureSearchText, UpdateSourceTrigger=PropertyChanged}"
                                             behaviors:WatermarkBehavior.Watermark="Search infrastructure..."
                                             behaviors:VisualFeedbackBehavior.EnableHoverEffect="True"
                                             behaviors:VisualFeedbackBehavior.HoverScale="1.02"
                                             behaviors:KeyboardNavigationBehavior.EnableEnhancedNavigation="True"/>
                                    <Button Content="â˜‘ï¸ Select All" Style="{StaticResource ModernButtonStyle}" Margin="12,0,0,0" Command="{Binding SelectAllInfrastructureCommand}"/>
                                    <Button Content="â˜ Deselect All" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding DeselectAllInfrastructureCommand}"/>
                                    <Button Content="ðŸ“¤ Export Selected" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding ExportSelectedInfrastructureCommand}"/>
                                    <Button Content="ðŸ“‹ Copy Selected" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding CopySelectedInfrastructureCommand}"/>
                                    <Button Content="ðŸ“‹ Copy All" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding CopyAllInfrastructureCommand}"/>
                                    <Button Content="ðŸ‘ï¸ Columns" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding ShowColumnVisibilityCommand}" CommandParameter="infrastructure"/>
                                    <Button Content="ðŸ” Advanced Search" Style="{StaticResource ModernButtonStyle}" Background="#FF4299E1" Margin="8,0,0,0" Command="{Binding ShowInfrastructureAdvancedSearchCommand}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Loading Indicator for Infrastructure -->
                            <Border Grid.Row="1" Background="#FF1A202C" Padding="10" 
                                    Visibility="{Binding IsInfrastructureLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ”„" FontSize="16" Margin="0,0,10,0" RenderTransformOrigin="0.5,0.5">
                                        <TextBlock.RenderTransform>
                                            <RotateTransform x:Name="InfraLoadingRotation"/>
                                        </TextBlock.RenderTransform>
                                        <TextBlock.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation Storyboard.TargetName="InfraLoadingRotation" 
                                                                       Storyboard.TargetProperty="Angle" 
                                                                       From="0" To="360" Duration="0:0:2"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </TextBlock.Triggers>
                                    </TextBlock>
                                    <StackPanel>
                                        <TextBlock Text="{Binding InfrastructureLoadingMessage}" Foreground="#FF67D391" FontWeight="Medium"/>
                                        <ProgressBar Value="{Binding InfrastructureLoadingProgress}" Maximum="100" Width="200" Height="4" 
                                                   Background="#FF374151" Foreground="#FF10B981" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            
                            <DataGrid x:Name="InfrastructureDataGrid" Grid.Row="1" ItemsSource="{Binding Infrastructure}" Style="{StaticResource ModernDataGridStyle}"
                                      CanUserSortColumns="True" AutoGenerateColumns="False" SelectionMode="Extended"
                                      VirtualizingStackPanel.IsVirtualizing="True" 
                                      EnableRowVirtualization="True" 
                                      EnableColumnVirtualization="True"
                                      behaviors:ColumnVisibilityBehavior.GridName="Infrastructure"
                                      behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                      behaviors:VirtualizationBehavior.VirtualizationMode="Recycling"
                                      behaviors:VirtualizationBehavior.ScrollUnit="Item"
                                      behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                      behaviors:VirtualizationBehavior.EnableRowVirtualization="True"
                                      behaviors:VisualFeedbackBehavior.EnableHoverEffect="True"
                                      behaviors:VisualFeedbackBehavior.EnableLoadingState="True"
                                      behaviors:VisualFeedbackBehavior.IsLoading="{Binding IsInfrastructureLoading}"
                                      behaviors:KeyboardNavigationBehavior.EnableVirtualizedNavigation="True"
                                      behaviors:ResponsiveLayoutBehavior.AdaptiveColumns="True">
                                <DataGrid.Columns>
                                    <DataGridCheckBoxColumn Header="âœ“" Width="40" Binding="{Binding IsSelected, Mode=TwoWay}"/>
                                    <DataGridTextColumn Header="Device Name" Binding="{Binding Name}" Width="200" CanUserSort="True" SortMemberPath="Name">
                                        <DataGridTextColumn.HeaderStyle>
                                            <Style TargetType="DataGridColumnHeader">
                                                <Setter Property="Background" Value="{StaticResource PrimaryGradient}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Setter Property="Padding" Value="12,8"/>
                                                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                            </Style>
                                        </DataGridTextColumn.HeaderStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="150" CanUserSort="True" SortMemberPath="Type"/>
                                    <DataGridTextColumn Header="IP Address" Binding="{Binding IPAddress}" Width="120" CanUserSort="True" SortMemberPath="IPAddress"/>
                                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100" CanUserSort="True" SortMemberPath="Status"/>
                                    <DataGridTextColumn Header="OS" Binding="{Binding OperatingSystem}" Width="150" CanUserSort="True" SortMemberPath="OperatingSystem"/>
                                    <DataGridTextColumn Header="Version" Binding="{Binding Version}" Width="120" CanUserSort="True" SortMemberPath="Version"/>
                                    <DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="120" CanUserSort="True" SortMemberPath="Location"/>
                                    <DataGridTextColumn Header="Manufacturer" Binding="{Binding Manufacturer}" Width="120" CanUserSort="True" SortMemberPath="Manufacturer"/>
                                    <DataGridTextColumn Header="Model" Binding="{Binding Model}" Width="140" CanUserSort="True" SortMemberPath="Model"/>
                                    <DataGridTextColumn Header="Last Seen" Binding="{Binding LastSeen}" Width="140" CanUserSort="True" SortMemberPath="LastSeen"/>
                                    <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="200" CanUserSort="True" SortMemberPath="Description"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            
                            <!-- Empty State Message -->
                            <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Infrastructure.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock Text="ðŸ’»" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16" Opacity="0.3"/>
                                <TextBlock Text="No infrastructure devices found" 
                                           FontSize="18" 
                                           FontWeight="SemiBold" 
                                           Foreground="#FFA0AEC0" 
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,8"/>
                                <TextBlock Text="Run a discovery operation to populate infrastructure data"
                                           FontSize="14"
                                           Foreground="#FF718096"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Infrastructure Pagination Controls -->
                            <Border Grid.Row="2" Background="#FF2D3748" Margin="0,8,0,0" CornerRadius="8" Padding="12,8">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Infrastructure.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Page Info -->
                                    <TextBlock Grid.Column="0" 
                                               Text="{Binding InfrastructurePageInfo}" 
                                               Foreground="#FFE2E8F0" 
                                               VerticalAlignment="Center"
                                               FontSize="13"/>
                                    
                                    <!-- Page Navigation -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                        <!-- First Page Button -->
                                        <Button Content="â®ï¸" 
                                                Command="{Binding FirstInfrastructurePageCommand}"
                                                IsEnabled="{Binding HasPreviousInfrastructurePage}"
                                                Style="{StaticResource ModernButtonStyle}"
                                                Width="32" Height="32" 
                                                Margin="0,0,4,0"
                                                ToolTip="First Page"
                                                FontSize="14"/>
                                        
                                        <!-- Previous Page Button -->
                                        <Button Content="â—€ï¸" 
                                                Command="{Binding PreviousInfrastructurePageCommand}"
                                                IsEnabled="{Binding HasPreviousInfrastructurePage}"
                                                Style="{StaticResource ModernButtonStyle}"
                                                Width="32" Height="32" 
                                                Margin="0,0,4,0"
                                                ToolTip="Previous Page"
                                                FontSize="14"/>
                                        
                                        <!-- Current Page Info -->
                                        <Border Background="#FF4A5568" 
                                                CornerRadius="4" 
                                                Padding="8,4" 
                                                Margin="0,0,4,0">
                                            <TextBlock>
                                                <Run Text="Page "/>
                                                <Run Text="{Binding CurrentInfrastructurePage, Mode=OneWay}"/>
                                                <Run Text=" of "/>
                                                <Run Text="{Binding TotalInfrastructurePages, Mode=OneWay}"/>
                                            </TextBlock>
                                        </Border>
                                        
                                        <!-- Next Page Button -->
                                        <Button Content="â–¶ï¸" 
                                                Command="{Binding NextInfrastructurePageCommand}"
                                                IsEnabled="{Binding HasNextInfrastructurePage}"
                                                Style="{StaticResource ModernButtonStyle}"
                                                Width="32" Height="32" 
                                                Margin="0,0,4,0"
                                                ToolTip="Next Page"
                                                FontSize="14"/>
                                        
                                        <!-- Last Page Button -->
                                        <Button Content="â­ï¸" 
                                                Command="{Binding LastInfrastructurePageCommand}"
                                                IsEnabled="{Binding HasNextInfrastructurePage}"
                                                Style="{StaticResource ModernButtonStyle}"
                                                Width="32" Height="32"
                                                ToolTip="Last Page"
                                                FontSize="14"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </ScrollViewer>
            
            <!-- Enhanced Groups View -->
            <!-- GroupsView - DISABLED for unified TabControl system -->
            <ScrollViewer Grid.Row="1" x:Name="GroupsView" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                <Grid Margin="32">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <Border Grid.Row="0" Style="{StaticResource SectionBorderStyle}" Margin="0,0,0,24">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Groups" Style="{StaticResource HeaderTextStyle}"/>
                                <TextBlock Text="Manage security groups, distribution lists, and group memberships" Foreground="#FFA0AEC0" FontSize="16"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Bottom">
                                <!-- Refresh Status Indicator -->
                                <Border Background="#FF2D3748" CornerRadius="4" Padding="8,6" Margin="0,0,8,0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ•’" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding RefreshService.ViewStatuses[Groups].LastRefreshText}" 
                                                   Foreground="#FFA0AEC0" FontSize="11" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                <!-- Progress Bar -->
                                <Border Background="#FF2D3748" CornerRadius="4" Padding="4" Margin="0,0,8,0"
                                        Visibility="{Binding RefreshService.ViewStatuses[Groups].IsRefreshing, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <ProgressBar Width="60" Height="16" 
                                               Value="{Binding RefreshService.ViewStatuses[Groups].RefreshProgress}"
                                               Background="#FF1A202C" Foreground="#FF48BB78" BorderThickness="0"/>
                                </Border>
                                <!-- Refresh Button -->
                                <Button Content="ðŸ”„" ToolTip="Refresh Groups" Style="{StaticResource ModernButtonStyle}" 
                                        Background="{StaticResource AccentGradient}" Command="{Binding RefreshGroupsCommand}" 
                                        Width="32" Height="32" Margin="0,0,8,0" FontSize="14"/>
                                <Button Content="ðŸ“¤ Export Groups" Style="{StaticResource ModernButtonStyle}" 
                                        Background="{StaticResource AccentGradient}" Command="{Binding ExportGroupsCommand}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Toolbar -->
                    <Border Grid.Row="1" Style="{StaticResource SectionBorderStyle}" Padding="20" Margin="0,0,0,16">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBox x:Name="GroupSearchBox" Width="300" Height="36" Padding="12,8"
                                     Style="{StaticResource ModernTextBoxStyle}"
                                     FontSize="13" Text="{Binding GroupSearchText, UpdateSourceTrigger=PropertyChanged}"
                                     behaviors:WatermarkBehavior.Watermark="Search groups..."/>
                            <Button Content="â˜‘ï¸ Select All" Style="{StaticResource ModernButtonStyle}" Margin="12,0,0,0" Command="{Binding SelectAllGroupsCommand}"/>
                            <Button Content="â˜ Deselect All" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding DeselectAllGroupsCommand}"/>
                            <Button Content="ðŸ“¤ Export Selected" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding ExportSelectedGroupsCommand}"/>
                            <Button Content="ðŸ“‹ Copy Selected" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding CopySelectedGroupsCommand}"/>
                            <Button Content="ðŸ“‹ Copy All" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding CopyAllGroupsCommand}"/>
                            <Button Content="ðŸ‘ï¸ Columns" Style="{StaticResource ModernButtonStyle}" Margin="8,0,0,0" Command="{Binding ShowColumnVisibilityCommand}" CommandParameter="groups"/>
                            <Button Content="ðŸ” Advanced Search" Style="{StaticResource ModernButtonStyle}" Background="#FF4299E1" Margin="8,0,0,0" Command="{Binding ShowGroupsAdvancedSearchCommand}"/>
                            <Button Content="ðŸ—‘ï¸ Delete Selected" Style="{StaticResource ModernButtonStyle}" Background="{StaticResource DangerGradient}" Margin="8,0,0,0" Command="{Binding DeleteSelectedGroupsCommand}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Data Grid -->
                    <Border Grid.Row="2" Style="{StaticResource SectionBorderStyle}" Padding="0" Margin="0,0,0,16">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Loading Indicator for Groups -->
                            <Border Grid.Row="0" Background="#FF1A202C" Padding="10" 
                                    Visibility="{Binding IsGroupsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ”„" FontSize="16" Margin="0,0,10,0" RenderTransformOrigin="0.5,0.5">
                                        <TextBlock.RenderTransform>
                                            <RotateTransform x:Name="GroupsLoadingRotation"/>
                                        </TextBlock.RenderTransform>
                                        <TextBlock.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation Storyboard.TargetName="GroupsLoadingRotation" 
                                                                       Storyboard.TargetProperty="Angle" 
                                                                       From="0" To="360" Duration="0:0:2"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </TextBlock.Triggers>
                                    </TextBlock>
                                    <StackPanel>
                                        <TextBlock Text="{Binding GroupsLoadingMessage}" Foreground="#FF67D391" FontWeight="Medium"/>
                                        <ProgressBar Value="{Binding GroupsLoadingProgress}" Maximum="100" Width="200" Height="4" 
                                                   Background="#FF374151" Foreground="#FF10B981" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            
                            <DataGrid x:Name="GroupsDataGrid" Grid.Row="1" ItemsSource="{Binding Groups}" Style="{StaticResource ModernDataGridStyle}" 
                                      CanUserSortColumns="True" AutoGenerateColumns="False" SelectionMode="Extended"
                                      VirtualizingStackPanel.IsVirtualizing="True" 
                                      EnableRowVirtualization="True" 
                                      EnableColumnVirtualization="True"
                                      behaviors:ColumnVisibilityBehavior.GridName="Groups"
                                      behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                      behaviors:VirtualizationBehavior.VirtualizationMode="Recycling"
                                      behaviors:VirtualizationBehavior.ScrollUnit="Item"
                                      behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                      behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                <DataGrid.Columns>
                                    <DataGridCheckBoxColumn Header="âœ“" Width="40" Binding="{Binding IsSelected, Mode=TwoWay}"/>
                                    <DataGridTextColumn Header="Name" Binding="{Binding DisplayName}" Width="200" CanUserSort="True" SortMemberPath="DisplayName"/>
                                    <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="250" CanUserSort="True" SortMemberPath="Description"/>
                                    <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="120" CanUserSort="True" SortMemberPath="Type"/>
                                    <DataGridTextColumn Header="Email" Binding="{Binding Mail}" Width="200" CanUserSort="True" SortMemberPath="Mail"/>
                                    <DataGridTextColumn Header="Members" Binding="{Binding MemberCount}" Width="80" CanUserSort="True" SortMemberPath="MemberCount"/>
                                    <DataGridTextColumn Header="Owners" Binding="{Binding OwnerCount}" Width="80" CanUserSort="True" SortMemberPath="OwnerCount"/>
                                    <DataGridTextColumn Header="Created" Binding="{Binding CreatedDateTime}" Width="140" CanUserSort="True" SortMemberPath="CreatedDateTime"/>
                                    <DataGridTextColumn Header="Visibility" Binding="{Binding Visibility}" Width="100" CanUserSort="True" SortMemberPath="Visibility"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </Border>
                    
                    <!-- Pagination -->
                    <Border Grid.Row="3" Style="{StaticResource SectionBorderStyle}" Padding="20">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Items Info -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding GroupPageInfo}" 
                                           FontSize="14" Foreground="#FFA0AEC0" VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Navigation Controls -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                <!-- First Page Button -->
                                <Button Content="â®ï¸" 
                                        Command="{Binding FirstGroupPageCommand}"
                                        IsEnabled="{Binding HasPreviousGroupPage}"
                                        Style="{StaticResource ModernButtonStyle}"
                                        Width="32" Height="32"
                                        ToolTip="First Page"
                                        FontSize="14"/>
                                
                                <!-- Previous Page Button -->
                                <Button Content="â—€ï¸" 
                                        Command="{Binding PreviousGroupPageCommand}"
                                        IsEnabled="{Binding HasPreviousGroupPage}"
                                        Style="{StaticResource ModernButtonStyle}"
                                        Width="32" Height="32"
                                        ToolTip="Previous Page"
                                        FontSize="14" Margin="4,0"/>
                                
                                <!-- Page Info -->
                                <Border Background="#FF2D3748" CornerRadius="6" Padding="12,6" Margin="8,0">
                                    <TextBlock FontSize="14" Foreground="#FFA0AEC0" VerticalAlignment="Center">
                                        <Run Text="Page"/>
                                        <Run Text="{Binding CurrentGroupPage, Mode=OneWay}"/>
                                        <Run Text="of"/>
                                        <Run Text="{Binding TotalGroupPages, Mode=OneWay}"/>
                                    </TextBlock>
                                </Border>
                                
                                <!-- Next Page Button -->
                                <Button Content="â–¶ï¸" 
                                        Command="{Binding NextGroupPageCommand}"
                                        IsEnabled="{Binding HasNextGroupPage}"
                                        Style="{StaticResource ModernButtonStyle}"
                                        Width="32" Height="32"
                                        ToolTip="Next Page"
                                        FontSize="14" Margin="4,0"/>
                                
                                <!-- Last Page Button -->
                                <Button Content="â­ï¸" 
                                        Command="{Binding LastGroupPageCommand}"
                                        IsEnabled="{Binding HasNextGroupPage}"
                                        Style="{StaticResource ModernButtonStyle}"
                                        Width="32" Height="32"
                                        ToolTip="Last Page"
                                        FontSize="14"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </ScrollViewer>
            
            <!-- Enhanced Migration Waves View -->
            <!-- WavesView - DISABLED for unified TabControl system -->
            <ScrollViewer Grid.Row="1" x:Name="WavesView" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                <Grid Margin="32">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,24">
                        <StackPanel>
                            <TextBlock Text="Migration Waves" Style="{StaticResource HeaderTextStyle}"/>
                            <TextBlock Text="Strategic migration planning with dependency mapping and timeline visualization" Foreground="#FFA0AEC0" FontSize="16"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="32,0,0,0">
                            <Button Content="ðŸ”„ Refresh Data" Style="{StaticResource ModernButtonStyle}" 
                                    Background="{StaticResource AccentGradient}" Command="{Binding RefreshDataCommand}" 
                                    Margin="0,0,12,0"/>
                            <Button Content="ðŸŒŠ Generate Waves" Command="{Binding GenerateWavesCommand}" Style="{StaticResource ModernButtonStyle}" Background="{StaticResource AccentGradient}" Margin="0,0,12,0"/>
                            <Button Content="ðŸ“… Timeline View" Command="{Binding TimelineViewCommand}" Style="{StaticResource ModernButtonStyle}" Background="{StaticResource SuccessGradient}"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <Grid Grid.Row="1" Margin="0,0,0,24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <Border Grid.Column="0" Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸŒŠ" FontSize="20" Margin="0,0,8,0"/>
                                    <StackPanel>
                                        <TextBlock Text="5" Foreground="#FF4299E1" FontSize="24" FontWeight="Bold"/>
                                        <TextBlock Text="Migration Waves" Foreground="#FFA0AEC0" FontSize="11"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Text="Optimized grouping" Foreground="#FF63B3ED" FontSize="10"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Grid.Column="1" Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="âš¡" FontSize="20" Margin="0,0,8,0"/>
                                    <StackPanel>
                                        <TextBlock x:Name="HighPriorityUsersTextBlock" Text="0" Foreground="#FF48BB78" FontSize="24" FontWeight="Bold"/>
                                        <TextBlock Text="High Priority Users" Foreground="#FFA0AEC0" FontSize="11"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Text="Wave 1 candidates" Foreground="#FF9AE6B4" FontSize="10"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Grid.Column="2" Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸ”„" FontSize="20" Margin="0,0,8,0"/>
                                    <StackPanel>
                                        <TextBlock Text="67" Foreground="#FFED8936" FontSize="24" FontWeight="Bold"/>
                                        <TextBlock Text="Dependencies" Foreground="#FFA0AEC0" FontSize="11"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Text="Mapped relations" Foreground="#FFFBB859" FontSize="10"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Grid.Column="3" Style="{StaticResource MetricCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸ“…" FontSize="20" Margin="0,0,8,0"/>
                                    <StackPanel>
                                        <TextBlock Text="12" Foreground="#FF9F7AEA" FontSize="24" FontWeight="Bold"/>
                                        <TextBlock Text="Weeks Timeline" Foreground="#FFA0AEC0" FontSize="11"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Text="Estimated duration" Foreground="#FFD6BCFA" FontSize="10"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                    
                    <Border Grid.Row="2" Style="{StaticResource ModernCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Wave Assignment Details" Style="{StaticResource SectionHeaderStyle}"/>
                                <DataGrid x:Name="WavesDataGrid" Style="{StaticResource ModernDataGridStyle}" Height="400" 
                                          AllowDrop="True" Drop="WavesDataGrid_Drop" DragOver="WavesDataGrid_DragOver"
                                          MouseMove="WavesDataGrid_MouseMove" PreviewMouseLeftButtonDown="WavesDataGrid_PreviewMouseLeftButtonDown"
                                          VirtualizingStackPanel.IsVirtualizing="True" 
                                          EnableRowVirtualization="True" 
                                          EnableColumnVirtualization="True"
                                          behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                          behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                          behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="User Name" Binding="{Binding UserName}" Width="150">
                                            <DataGridTextColumn.HeaderStyle>
                                                <Style TargetType="DataGridColumnHeader">
                                                    <Setter Property="Background" Value="{StaticResource PrimaryGradient}"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                    <Setter Property="Padding" Value="12,8"/>
                                                </Style>
                                            </DataGridTextColumn.HeaderStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="200"/>
                                        <DataGridTextColumn Header="Department" Binding="{Binding Department}" Width="120"/>
                                        <DataGridTextColumn Header="Wave" Binding="{Binding Wave}" Width="60"/>
                                        <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="80"/>
                                        <DataGridTextColumn Header="Complexity" Binding="{Binding Complexity}" Width="80"/>
                                        <DataGridTextColumn Header="Dependencies" Binding="{Binding Dependencies}" Width="100"/>
                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                        <DataGridTextColumn Header="Est. Duration" Binding="{Binding EstimatedDuration}" Width="100"/>
                                        <DataGridTextColumn Header="Risk Level" Binding="{Binding RiskLevel}" Width="100"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="24,0,0,0">
                                <TextBlock Text="Wave Timeline" Style="{StaticResource SectionHeaderStyle}"/>
                                <Border Background="#FF2D3748" CornerRadius="6" Padding="16">
                                    <StackPanel>
                                        <Border x:Name="Wave1DropZone" Tag="1" Margin="0,0,0,16" Background="Transparent" 
                                                AllowDrop="True" Drop="WaveDropZone_Drop" DragOver="WaveDropZone_DragOver" 
                                                DragLeave="WaveDropZone_DragLeave" CornerRadius="4" BorderThickness="2" BorderBrush="Transparent">
                                            <StackPanel>
                                                <TextBlock Text="Wave 1 - Executive &amp; IT" Foreground="#FF4299E1" FontSize="13" FontWeight="Medium"/>
                                                <TextBlock x:Name="Wave1UserCount" Text="Week 1-2 â€¢ 0 users" Foreground="#FFA0AEC0" FontSize="11"/>
                                                <ProgressBar Value="100" Maximum="100" Height="4" Background="#FF1A202C" Foreground="#FF4299E1" BorderThickness="0" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <Border x:Name="Wave2DropZone" Tag="2" Margin="0,0,0,16" Background="Transparent" 
                                                AllowDrop="True" Drop="WaveDropZone_Drop" DragOver="WaveDropZone_DragOver" 
                                                DragLeave="WaveDropZone_DragLeave" CornerRadius="4" BorderThickness="2" BorderBrush="Transparent">
                                            <StackPanel>
                                                <TextBlock Text="Wave 2 - Finance &amp; Legal" Foreground="#FF48BB78" FontSize="13" FontWeight="Medium"/>
                                                <TextBlock x:Name="Wave2UserCount" Text="Week 3-5 â€¢ 189 users" Foreground="#FFA0AEC0" FontSize="11"/>
                                                <ProgressBar Value="65" Maximum="100" Height="4" Background="#FF1A202C" Foreground="#FF48BB78" BorderThickness="0" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <Border x:Name="Wave3DropZone" Tag="3" Margin="0,0,0,16" Background="Transparent" 
                                                AllowDrop="True" Drop="WaveDropZone_Drop" DragOver="WaveDropZone_DragOver" 
                                                DragLeave="WaveDropZone_DragLeave" CornerRadius="4" BorderThickness="2" BorderBrush="Transparent">
                                            <StackPanel>
                                                <TextBlock Text="Wave 3 - Sales &amp; Marketing" Foreground="#FFED8936" FontSize="13" FontWeight="Medium"/>
                                                <TextBlock x:Name="Wave3UserCount" Text="Week 6-8 â€¢ 456 users" Foreground="#FFA0AEC0" FontSize="11"/>
                                                <ProgressBar Value="20" Maximum="100" Height="4" Background="#FF1A202C" Foreground="#FFED8936" BorderThickness="0" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <Border x:Name="Wave4DropZone" Tag="4" Margin="0,0,0,16" Background="Transparent" 
                                                AllowDrop="True" Drop="WaveDropZone_Drop" DragOver="WaveDropZone_DragOver" 
                                                DragLeave="WaveDropZone_DragLeave" CornerRadius="4" BorderThickness="2" BorderBrush="Transparent">
                                            <StackPanel>
                                                <TextBlock Text="Wave 4 - Operations" Foreground="#FF9F7AEA" FontSize="13" FontWeight="Medium"/>
                                                <TextBlock x:Name="Wave4UserCount" Text="Week 9-11 â€¢ 298 users" Foreground="#FFA0AEC0" FontSize="11"/>
                                                <ProgressBar Value="0" Maximum="100" Height="4" Background="#FF1A202C" Foreground="#FF9F7AEA" BorderThickness="0" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <Border x:Name="Wave5DropZone" Tag="5" Background="Transparent" 
                                                AllowDrop="True" Drop="WaveDropZone_Drop" DragOver="WaveDropZone_DragOver" 
                                                DragLeave="WaveDropZone_DragLeave" CornerRadius="4" BorderThickness="2" BorderBrush="Transparent">
                                            <StackPanel>
                                                <TextBlock Text="Wave 5 - General Users" Foreground="#FFF56565" FontSize="13" FontWeight="Medium"/>
                                                <TextBlock x:Name="Wave5UserCount" Text="Week 12+ â€¢ 70 users" Foreground="#FFA0AEC0" FontSize="11"/>
                                                <ProgressBar Value="0" Maximum="100" Height="4" Background="#FF1A202C" Foreground="#FFF56565" BorderThickness="0" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </Border>
                                
                                <TextBlock Text="Risk Assessment" Style="{StaticResource SectionHeaderStyle}" Margin="0,16,0,8"/>
                                <Border Background="#FF2D3748" CornerRadius="6" Padding="16">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Ellipse Width="8" Height="8" Fill="#FF48BB78" Margin="0,0,8,0"/>
                                            <TextBlock Text="Low Risk: 67%" Foreground="#FF9AE6B4" FontSize="12"/>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Ellipse Width="8" Height="8" Fill="#FFED8936" Margin="0,0,8,0"/>
                                            <TextBlock Text="Medium Risk: 28%" Foreground="#FFFBB859" FontSize="12"/>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal">
                                            <Ellipse Width="8" Height="8" Fill="#FFF56565" Margin="0,0,8,0"/>
                                            <TextBlock Text="High Risk: 5%" Foreground="#FFFED7D7" FontSize="12"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </ScrollViewer>
            
            <!-- Migrate View - DISABLED for unified TabControl system -->
            <Grid Grid.Row="1" x:Name="MigrateView" Visibility="Collapsed" Margin="30">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" Text="Migration" Style="{StaticResource HeaderTextStyle}"/>
                
                <TabControl Grid.Row="1" Background="Transparent" BorderThickness="0">
                    <TabControl.Resources>
                        <Style TargetType="TabItem">
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="Background" Value="#FF2D2D30"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Padding" Value="20,10"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TabItem">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                Margin="0,0,2,0">
                                            <ContentPresenter x:Name="ContentSite2"
                                                              VerticalAlignment="Center"
                                                              HorizontalAlignment="Center"
                                                              ContentSource="Header"
                                                              Margin="{TemplateBinding Padding}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter Property="Background" Value="#FF007ACC"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TabControl.Resources>
                    
                    <TabItem Header="User Migration">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Text="User Account Migration" 
                                       Foreground="White" FontSize="18" Margin="0,0,0,20"/>
                            
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,20">
                                <Button Content="Select Users" Command="{Binding SelectUsersCommand}"
                                        Background="#FF3E3E42" Foreground="White"
                                        Padding="15,8" Margin="0,0,10,0" BorderThickness="0"/>
                                <Button Content="Map Security Groups" Command="{Binding MapSecurityGroupsCommand}"
                                        Background="#FF3E3E42" Foreground="White"
                                        Padding="15,8" Margin="0,0,10,0" BorderThickness="0"/>
                                <Button Content="Start Migration" Command="{Binding StartUserMigrationCommand}"
                                        Background="#FF007ACC" Foreground="White"
                                        Padding="15,8" BorderThickness="0"/>
                            </StackPanel>
                            
                            <DataGrid Grid.Row="2" x:Name="UserMigrationGrid"
                                      Background="#FF2D2D30" Foreground="White"
                                      BorderBrush="#FF3E3E42"
                                      VirtualizingStackPanel.IsVirtualizing="True" 
                                      EnableRowVirtualization="True" 
                                      EnableColumnVirtualization="True"
                                      behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                      behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                      behaviors:VirtualizationBehavior.EnableRowVirtualization="True"/>
                        </Grid>
                    </TabItem>
                    
                    <TabItem Header="Mailbox Migration">
                        <Grid Margin="20">
                            <TextBlock Text="Mailbox Migration Module" Foreground="White" FontSize="16"/>
                        </Grid>
                    </TabItem>
                    
                    <TabItem Header="SharePoint Migration">
                        <Grid Margin="20">
                            <TextBlock Text="SharePoint Migration Module" Foreground="White" FontSize="16"/>
                        </Grid>
                    </TabItem>
                    
                    <TabItem Header="Teams Migration">
                        <Grid Margin="20">
                            <TextBlock Text="Teams Migration Module" Foreground="White" FontSize="16"/>
                        </Grid>
                    </TabItem>
                    
                    <TabItem Header="OneDrive Migration">
                        <Grid Margin="20">
                            <TextBlock Text="OneDrive Migration Module" Foreground="White" FontSize="16"/>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>
            
            <!-- Reports View -->
            <!-- ReportsView - DISABLED for unified TabControl system -->
            <Grid Grid.Row="1" x:Name="ReportsView" Visibility="Collapsed" Margin="32">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" Text="Reports &amp; Analytics" Style="{StaticResource HeaderTextStyle}"/>
                
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Executive Summary Reports -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Executive Summary Reports" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="High-level overview reports for management and stakeholders" 
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <WrapPanel>
                                    <Button Style="{StaticResource ModernButtonStyle}" 
                                            Background="{StaticResource AccentGradient}"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding GenerateReportCommand}" CommandParameter="Discovery Summary">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ“Š" FontSize="24" Margin="0,0,0,4"/>
                                            <TextBlock Text="Discovery Summary"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF2D3748"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding GenerateReportCommand}" CommandParameter="User Analytics">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ“ˆ" FontSize="24" Margin="0,0,0,4"/>
                                            <TextBlock Text="User Analytics"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF2D3748"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding GenerateReportCommand}" CommandParameter="Infrastructure Report">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ¢" FontSize="24" Margin="0,0,0,4"/>
                                            <TextBlock Text="Infrastructure Report"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF2D3748"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding GenerateReportCommand}" CommandParameter="Migration Readiness">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ“‰" FontSize="24" Margin="0,0,0,4"/>
                                            <TextBlock Text="Migration Readiness"/>
                                        </StackPanel>
                                    </Button>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Technical Reports -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Technical Reports" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Detailed technical reports for IT teams and architects" 
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <WrapPanel>
                                    <Button Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF2D3748"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding GenerateReportCommand}" CommandParameter="Security Audit">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ”’" FontSize="24" Margin="0,0,0,4"/>
                                            <TextBlock Text="Security Audit"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF2D3748"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding GenerateReportCommand}" CommandParameter="Dependency Map">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ”—" FontSize="24" Margin="0,0,0,4"/>
                                            <TextBlock Text="Dependency Map"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF2D3748"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding GenerateReportCommand}" CommandParameter="Configuration Report">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ”§" FontSize="24" Margin="0,0,0,4"/>
                                            <TextBlock Text="Configuration Report"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF2D3748"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding GenerateReportCommand}" CommandParameter="Network Topology">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ“¡" FontSize="24" Margin="0,0,0,4"/>
                                            <TextBlock Text="Network Topology"/>
                                        </StackPanel>
                                    </Button>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Custom Reports -->
                        <Border Style="{StaticResource ModernCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Custom Reports" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Create custom reports based on discovery data" 
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Report Type:" Foreground="#FFE2E8F0" FontSize="13" Margin="0,0,0,8"/>
                                        <ComboBox Background="#FF2D3748" Foreground="#FFE2E8F0"
                                                  BorderBrush="#FF4A5568" Height="36" Margin="0,0,0,12">
                                            <ComboBoxItem>User Distribution by Department</ComboBoxItem>
                                            <ComboBoxItem>Device Compliance Status</ComboBoxItem>
                                            <ComboBoxItem>Application Usage Analysis</ComboBoxItem>
                                            <ComboBoxItem>Security Group Membership</ComboBoxItem>
                                            <ComboBoxItem>Migration Wave Summary</ComboBoxItem>
                                        </ComboBox>
                                        
                                        <TextBlock Text="Format:" Foreground="#FFE2E8F0" FontSize="13" Margin="0,0,0,8"/>
                                        <WrapPanel>
                                            <RadioButton Content="PDF" Foreground="#FFE2E8F0" IsChecked="True" Margin="0,0,20,0"/>
                                            <RadioButton Content="Excel" Foreground="#FFE2E8F0" Margin="0,0,20,0"/>
                                            <RadioButton Content="HTML" Foreground="#FFE2E8F0" Margin="0,0,20,0"/>
                                            <RadioButton Content="CSV" Foreground="#FFE2E8F0"/>
                                        </WrapPanel>
                                    </StackPanel>
                                    
                                    <Button Grid.Column="1" Content="Generate Report" 
                                            Style="{StaticResource ModernButtonStyle}" 
                                            Background="{StaticResource SuccessGradient}"
                                            VerticalAlignment="Bottom" Margin="16,0,0,0"
                                            Command="{Binding GenerateReportCommand}" CommandParameter="Custom Report"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
            
            <!-- Analytics View -->
            <!-- AnalyticsView - DISABLED for unified TabControl system -->
            <Grid Grid.Row="1" x:Name="AnalyticsView" Visibility="Collapsed" Margin="32">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,24">
                    <TextBlock Text="Analytics Dashboard" Style="{StaticResource HeaderTextStyle}" Margin="0,0,24,0"/>
                    
                    <!-- Chart Type Selector -->
                    <ComboBox Width="200" Height="32" 
                              Background="#FF2D3748" Foreground="#FFE2E8F0" 
                              BorderBrush="#FF4A5568" Padding="12,6"
                              FontSize="13" 
                              ItemsSource="{Binding DataVisualization.ChartTypes}"
                              SelectedValue="{Binding DataVisualization.SelectedChartType}"
                              SelectedValuePath="Key"
                              DisplayMemberPath="DisplayName"
                              Margin="0,0,12,0"/>
                    
                    <!-- Time Period Selector -->
                    <ComboBox Width="150" Height="32" 
                              Background="#FF2D3748" Foreground="#FFE2E8F0" 
                              BorderBrush="#FF4A5568" Padding="12,6"
                              FontSize="13" 
                              ItemsSource="{Binding DataVisualization.TimePeriods}"
                              SelectedItem="{Binding DataVisualization.SelectedTimePeriod}"
                              Margin="0,0,12,0"/>
                    
                    <!-- Refresh Button -->
                    <Button Content="ðŸ”„ Refresh" Style="{StaticResource ModernButtonStyle}" 
                            Background="{StaticResource AccentGradient}" 
                            Command="{Binding DataVisualization.RefreshDataCommand}" 
                            Width="100" Height="32" FontSize="13"/>
                </StackPanel>
                
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Key Statistics -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Key Statistics" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <UniformGrid Columns="4" Margin="0,16,0,0">
                                    <Border Style="{StaticResource MetricCardStyle}" Margin="0,0,8,0">
                                        <StackPanel>
                                            <TextBlock Text="{Binding DataVisualization.TotalItems}" Foreground="#FF4299E1" FontSize="24" FontWeight="Bold"/>
                                            <TextBlock Text="Total Items" Foreground="#FFA0AEC0" FontSize="12"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Style="{StaticResource MetricCardStyle}" Margin="4,0">
                                        <StackPanel>
                                            <TextBlock Text="{Binding DataVisualization.TotalModules}" Foreground="#FF48BB78" FontSize="24" FontWeight="Bold"/>
                                            <TextBlock Text="Total Modules" Foreground="#FFA0AEC0" FontSize="12"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Style="{StaticResource MetricCardStyle}" Margin="4,0">
                                        <StackPanel>
                                            <TextBlock Text="{Binding DataVisualization.AverageItemsPerModule, StringFormat=N0}" Foreground="#FFED8936" FontSize="24" FontWeight="Bold"/>
                                            <TextBlock Text="Avg Items/Module" Foreground="#FFA0AEC0" FontSize="12"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Style="{StaticResource MetricCardStyle}" Margin="8,0,0,0">
                                        <StackPanel>
                                            <TextBlock Text="{Binding DataVisualization.LastDiscoveryTime, StringFormat=MM/dd HH:mm}" Foreground="#FF9F7AEA" FontSize="16" FontWeight="Bold"/>
                                            <TextBlock Text="Last Discovery" Foreground="#FFA0AEC0" FontSize="12"/>
                                        </StackPanel>
                                    </Border>
                                </UniformGrid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Main Chart Area -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Data Visualization" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <Grid Height="400">
                                    <!-- Pie Chart -->
                                    <controls:PieChart x:Name="MainPieChart"
                                                      Data="{Binding DataVisualization.ChartData}"
                                                      ShowLabels="True"
                                                      ShowLegend="True"
                                                      Background="#FF1A202C"/>
                                    
                                    <!-- Bar Chart -->
                                    <controls:BarChart x:Name="MainBarChart"
                                                      Data="{Binding DataVisualization.ChartData}"
                                                      ShowValues="True"
                                                      ShowGrid="True"
                                                      Background="#FF1A202C"
                                                      Visibility="Collapsed"/>
                                    
                                    <!-- Line Chart -->
                                    <controls:LineChart x:Name="MainLineChart"
                                                       TimeSeriesData="{Binding DataVisualization.TimeSeriesData}"
                                                       ShowPoints="True"
                                                       ShowGrid="True"
                                                       Background="#FF1A202C"
                                                       Visibility="Collapsed"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Chart Export and Options -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                            <StackPanel>
                                <TextBlock Text="Chart Options" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                                        <CheckBox Content="Show Percentages" IsChecked="{Binding DataVisualization.ShowPercentages}"
                                                  Foreground="#FFE2E8F0" Margin="0,0,20,0"/>
                                        <CheckBox Content="Auto Refresh" IsChecked="True"
                                                  Foreground="#FFE2E8F0" Margin="0,0,20,0"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button Content="ðŸ“¤ Export Chart" Style="{StaticResource ModernButtonStyle}" 
                                                Background="#FF4299E1" Command="{Binding DataVisualization.ExportChartCommand}" 
                                                Margin="0,0,12,0"/>
                                        <Button Content="ðŸ” Drill Down" Style="{StaticResource ModernButtonStyle}" 
                                                Background="#FF48BB78" Command="{Binding DataVisualization.DrillDownCommand}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Additional Statistics -->
                        <Border Style="{StaticResource ModernCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Detailed Statistics" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <ItemsControl ItemsSource="{Binding DataVisualization.Statistics}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Columns="3"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource MetricCardStyle}" Margin="4">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding Icon}" FontSize="20" Margin="0,0,12,0"/>
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Value}" Foreground="#FF4299E1" FontSize="18" FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding Name}" Foreground="#FFA0AEC0" FontSize="11"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
            
            <!-- Settings View - DISABLED for unified TabControl system -->
            <Grid Grid.Row="0" Grid.Column="1" x:Name="SettingsView" Visibility="Collapsed" Margin="32">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" Text="Settings &amp; Configuration" Style="{StaticResource HeaderTextStyle}"/>
                
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Discovery Data Path Settings -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Discovery Data Location" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Configure where company profiles and discovery data are stored" 
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" Text="Current Path:" 
                                               Foreground="#FFE2E8F0" FontSize="14" 
                                               VerticalAlignment="Center" Margin="0,0,16,0"/>
                                    
                                    <TextBox Grid.Column="1" x:Name="DataPathTextBox" 
                                             Background="#FF2D3748" Foreground="#FFE2E8F0"
                                             BorderBrush="#FF4A5568" BorderThickness="1"
                                             Padding="12,8" FontSize="13"
                                             Text="c:\discoverydata (default)" IsReadOnly="True"/>
                                    
                                    <Button Grid.Column="2" Content="Change Path" 
                                            Command="{Binding ChangeDataPathCommand}"
                                            Style="{StaticResource ModernButtonStyle}" 
                                            Margin="12,0,0,0"/>
                                </Grid>
                                
                                <TextBlock Text="Note: Changing the path will require restarting the application" 
                                           Foreground="#FFFBB859" FontSize="11" Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- App Registration Setup -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Azure App Registration Setup" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Configure Azure AD app registration for discovery modules" 
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <WrapPanel>
                                    <Button Content="Run App Registration Script" 
                                            Command="{Binding RunAppRegistrationCommand}"
                                            Style="{StaticResource ModernButtonStyle}" 
                                            Background="{StaticResource AccentGradient}"
                                            Margin="0,0,12,8">
                                        <Button.ToolTip>
                                            <ToolTip>
                                                <TextBlock Text="Creates Azure AD app registration with required permissions for discovery"/>
                                            </ToolTip>
                                        </Button.ToolTip>
                                    </Button>
                                    
                                    <Button Content="ðŸ” App Registration" 
                                            Command="{Binding AppRegistrationCommand}"
                                            Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF6B46C1"
                                            Margin="0,0,12,8">
                                        <Button.ToolTip>
                                            <ToolTip>
                                                <TextBlock Text="Create Azure AD App Registration with required permissions for M&amp;A Discovery" 
                                                           MaxWidth="300" TextWrapping="Wrap"/>
                                            </ToolTip>
                                        </Button.ToolTip>
                                    </Button>
                                    
                                    <Button Content="Configure Credentials" 
                                            Command="{Binding ConfigureCredentialsCommand}"
                                            Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF2D3748"
                                            Margin="0,0,12,8">
                                        <Button.ToolTip>
                                            <ToolTip>
                                                <TextBlock Text="Configure credentials for the selected company profile"/>
                                            </ToolTip>
                                        </Button.ToolTip>
                                    </Button>
                                    
                                    <Button Content="Test Connection" 
                                            Command="{Binding TestConnectionCommand}"
                                            Style="{StaticResource ModernButtonStyle}" 
                                            Background="#FF2D3748">
                                        <Button.ToolTip>
                                            <ToolTip>
                                                <TextBlock Text="Test Azure AD connection with current credentials"/>
                                            </ToolTip>
                                        </Button.ToolTip>
                                    </Button>
                                </WrapPanel>
                                
                                <Border Background="#FF2D3748" CornerRadius="6" Padding="16" Margin="0,16,0,0">
                                    <StackPanel>
                                        <TextBlock Text="Required Permissions:" Foreground="#FFE2E8F0" FontSize="13" FontWeight="Medium" Margin="0,0,0,8"/>
                                        <TextBlock Text="â€¢ Directory.Read.All - Read directory data" Foreground="#FFA0AEC0" FontSize="12"/>
                                        <TextBlock Text="â€¢ User.Read.All - Read all users' profiles" Foreground="#FFA0AEC0" FontSize="12"/>
                                        <TextBlock Text="â€¢ Group.Read.All - Read all groups" Foreground="#FFA0AEC0" FontSize="12"/>
                                        <TextBlock Text="â€¢ Application.Read.All - Read all applications" Foreground="#FFA0AEC0" FontSize="12"/>
                                        <TextBlock Text="â€¢ Policy.Read.All - Read organization policies" Foreground="#FFA0AEC0" FontSize="12"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>
                        
                        <!-- Module Settings -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Discovery Module Settings" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Configure default settings for discovery modules" 
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Network Ranges -->
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Default Network Ranges:" 
                                               Foreground="#FFE2E8F0" FontSize="13" 
                                               VerticalAlignment="Center"/>
                                    <StackPanel Grid.Row="0" Grid.Column="1">
                                        <TextBox x:Name="NetworkRangesTextBox"
                                                 Background="#FF2D3748" Foreground="#FFE2E8F0"
                                                 BorderBrush="#FF4A5568" BorderThickness="1"
                                                 Padding="8,6" FontSize="12"
                                                 Text="10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16"
                                                 TextChanged="NetworkRangesTextBox_TextChanged"/>
                                        <TextBlock x:Name="NetworkRangesValidationText" 
                                                   Style="{StaticResource ValidationErrorTextStyle}"
                                                   Visibility="Collapsed"/>
                                    </StackPanel>
                                    
                                    <!-- Timeout -->
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Discovery Timeout (min):" 
                                               Foreground="#FFE2E8F0" FontSize="13" 
                                               VerticalAlignment="Center"/>
                                    <StackPanel Grid.Row="1" Grid.Column="1">
                                        <Border Background="#FF2D3748" BorderBrush="#FF4A5568" BorderThickness="1" 
                                                CornerRadius="4" Padding="4,2">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <TextBox x:Name="TimeoutTextBox" Grid.Column="0"
                                                         Background="Transparent" Foreground="#FFE2E8F0"
                                                         BorderThickness="0" Padding="4,2" FontSize="12"
                                                         Text="30" TextAlignment="Center"
                                                         TextChanged="TimeoutTextBox_TextChanged"/>
                                                
                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="â–²" FontSize="8" Height="12" Width="16" 
                                                            Background="Transparent" Foreground="#FF4299E1" 
                                                            BorderThickness="0" Padding="0" Margin="1,0" 
                                                            Command="{Binding TimeoutUpCommand}"/>
                                                    <Button Content="â–¼" FontSize="8" Height="12" Width="16"
                                                            Background="Transparent" Foreground="#FF4299E1" 
                                                            BorderThickness="0" Padding="0" Margin="1,0"
                                                            Command="{Binding TimeoutDownCommand}"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                        <TextBlock x:Name="TimeoutValidationText" 
                                                   Style="{StaticResource ValidationErrorTextStyle}"
                                                   Visibility="Collapsed"/>
                                    </StackPanel>
                                    
                                    <!-- Threads -->
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Max Concurrent Threads:" 
                                               Foreground="#FFE2E8F0" FontSize="13" 
                                               VerticalAlignment="Center"/>
                                    <StackPanel Grid.Row="2" Grid.Column="1">
                                        <Border Background="#FF2D3748" BorderBrush="#FF4A5568" BorderThickness="1" 
                                                CornerRadius="4" Padding="4,2">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <TextBox x:Name="ThreadsTextBox" Grid.Column="0"
                                                         Background="Transparent" Foreground="#FFE2E8F0"
                                                         BorderThickness="0" Padding="4,2" FontSize="12"
                                                         Text="10" TextAlignment="Center"
                                                         TextChanged="ThreadsTextBox_TextChanged"/>
                                                
                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="â–²" FontSize="8" Height="12" Width="16" 
                                                            Background="Transparent" Foreground="#FF4299E1" 
                                                            BorderThickness="0" Padding="0" Margin="1,0" 
                                                            Command="{Binding ThreadsUpCommand}"/>
                                                    <Button Content="â–¼" FontSize="8" Height="12" Width="16"
                                                            Background="Transparent" Foreground="#FF4299E1" 
                                                            BorderThickness="0" Padding="0" Margin="1,0"
                                                            Command="{Binding ThreadsDownCommand}"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                        <TextBlock x:Name="ThreadsValidationText" 
                                                   Style="{StaticResource ValidationErrorTextStyle}"
                                                   Visibility="Collapsed"/>
                                    </StackPanel>
                                </Grid>
                                
                                <Button Content="Save Module Settings" 
                                        Command="{Binding SaveModuleSettingsCommand}"
                                        Style="{StaticResource ModernButtonStyle}" 
                                        HorizontalAlignment="Right" Margin="0,16,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
            
            <!-- Applications View -->
            <!-- ApplicationsView - DISABLED for unified TabControl system -->
            <Grid Grid.Row="0" Grid.Column="1" x:Name="ApplicationsView" Visibility="Collapsed" Margin="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,24">
                <TextBlock Text="Application Discovery &amp; Catalog" Style="{StaticResource HeaderTextStyle}"/>
                <Button Content="Refresh Data" Style="{StaticResource ModernButtonStyle}" 
                        Background="{StaticResource AccentGradient}" Command="{Binding RefreshDataCommand}" 
                        HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="32,0,0,0"/>
            </StackPanel>
            
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Discovery Overview Cards -->
                    <Grid Margin="0,0,0,24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <Border Grid.Column="0" Style="{StaticResource ModernCardStyle}" Margin="0,0,8,0">
                            <StackPanel>
                                <TextBlock Text="ðŸ“±" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock x:Name="TotalAppsCount" Text="0" FontSize="24" FontWeight="Bold" 
                                           Foreground="#FF4299E1" HorizontalAlignment="Center"/>
                                <TextBlock Text="Total Applications" FontSize="12" Foreground="#FFA0AEC0" 
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Grid.Column="1" Style="{StaticResource ModernCardStyle}" Margin="8,0">
                            <StackPanel>
                                <TextBlock Text="âš ï¸" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock x:Name="HighRiskAppsCount" Text="0" FontSize="24" FontWeight="Bold" 
                                           Foreground="#FFE53E3E" HorizontalAlignment="Center"/>
                                <TextBlock Text="High Risk Apps" FontSize="12" Foreground="#FFA0AEC0" 
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Grid.Column="2" Style="{StaticResource ModernCardStyle}" Margin="8,0">
                            <StackPanel>
                                <TextBlock Text="â˜ï¸" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock x:Name="CloudReadyAppsCount" Text="0" FontSize="24" FontWeight="Bold" 
                                           Foreground="#FF48BB78" HorizontalAlignment="Center"/>
                                <TextBlock Text="Cloud Ready" FontSize="12" Foreground="#FFA0AEC0" 
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Grid.Column="3" Style="{StaticResource ModernCardStyle}" Margin="8,0,0,0">
                            <StackPanel>
                                <TextBlock Text="ðŸ”„" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock x:Name="PendingReviewCount" Text="0" FontSize="24" FontWeight="Bold" 
                                           Foreground="#FFFBB859" HorizontalAlignment="Center"/>
                                <TextBlock Text="Pending Review" FontSize="12" Foreground="#FFA0AEC0" 
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                    
                    <!-- Application Discovery Actions -->
                    <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                        <StackPanel>
                            <TextBlock Text="Application Discovery" Style="{StaticResource SectionHeaderStyle}"/>
                            <TextBlock Text="Discover and catalog applications across your infrastructure" 
                                       Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                            
                            <WrapPanel>
                                <Button x:Name="RunAppDiscoveryButton" Style="{StaticResource ModernButtonStyle}" 
                                        Background="{StaticResource AccentGradient}"
                                        Margin="0,0,12,12" Padding="20,12"
                                        Command="{Binding RunAppDiscoveryCommand}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="Run Full App Discovery"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button x:Name="ImportAppListButton" Style="{StaticResource ModernButtonStyle}" 
                                        Background="#FF48BB78" Foreground="White"
                                        Margin="0,0,12,12" Padding="20,12"
                                        Command="{Binding ImportAppListCommand}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“‚" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="Import App List"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button x:Name="RefreshAppsButton" Style="{StaticResource ModernButtonStyle}" 
                                        Background="#FF805AD5" Foreground="White"
                                        Margin="0,0,12,12" Padding="20,12"
                                        Command="{Binding RefreshAppsCommand}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ”„" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="Refresh Data"/>
                                    </StackPanel>
                                </Button>
                            </WrapPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Applications Grid -->
                    <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                        <StackPanel>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="Discovered Applications" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <TextBox x:Name="AppSearchBox" Width="200" Height="32" 
                                             Background="#FF2D3748" Foreground="White" BorderBrush="#FF4A5568"
                                             Padding="12,8" FontSize="13" Margin="0,0,12,0"
                                             TextChanged="AppSearchBox_TextChanged">
                                        <TextBox.Resources>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="ðŸ” Search applications..." 
                                                                                   Foreground="#FFA0AEC0" FontSize="13" 
                                                                                   Margin="4,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Resources>
                                    </TextBox>
                                    
                                    <ComboBox x:Name="AppFilterCombo" Width="140" Height="32" 
                                              Background="#FF2D3748" Foreground="White" BorderBrush="#FF4A5568"
                                              SelectionChanged="AppFilterCombo_SelectionChanged">
                                        <ComboBoxItem Content="All Apps" IsSelected="True"/>
                                        <ComboBoxItem Content="High Risk"/>
                                        <ComboBoxItem Content="Cloud Ready"/>
                                        <ComboBoxItem Content="Legacy"/>
                                        <ComboBoxItem Content="Pending Review"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>
                            
                            <DataGrid x:Name="ApplicationsGrid" Margin="0,16,0,0" Height="400"
                                      Background="#FF1A202C" Foreground="White" BorderBrush="#FF2D3748"
                                      HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                                      RowBackground="#FF2D2D30" AlternatingRowBackground="#FF1A202C"
                                      SelectionMode="Single" IsReadOnly="True"
                                      AutoGenerateColumns="False"
                                      behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                      behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                      behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Display Name" Binding="{Binding DisplayName}" Width="200"/>
                                    <DataGridTextColumn Header="App ID" Binding="{Binding AppId}" Width="160"/>
                                    <DataGridTextColumn Header="Object Type" Binding="{Binding ObjectType}" Width="120"/>
                                    <DataGridTextColumn Header="Publisher Domain" Binding="{Binding PublisherDomain}" Width="150"/>
                                    <DataGridTextColumn Header="Sign-In Audience" Binding="{Binding SignInAudience}" Width="120"/>
                                    <DataGridTextColumn Header="Created Date" Binding="{Binding CreatedDateTime}" Width="140"/>
                                    <DataGridTextColumn Header="Required Resources" Binding="{Binding RequiredResourceAccessCount}" Width="100"/>
                                </DataGrid.Columns>
                                <DataGrid.RowStyle>
                                    <Style TargetType="DataGridRow">
                                        <Setter Property="Background" Value="#FF2D2D30"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#FF3E3E42"/>
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter Property="Background" Value="#FF007ACC"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGrid.RowStyle>
                            </DataGrid>
                        </StackPanel>
                    </Border>
                    
                    <!-- Application Risk Assessment -->
                    <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                        <StackPanel>
                            <TextBlock Text="Risk Assessment Overview" Style="{StaticResource SectionHeaderStyle}"/>
                            <TextBlock Text="Application migration risk analysis and recommendations" 
                                       Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Risk Chart Placeholder -->
                                <Border Grid.Column="0" Background="#FF1A202C" CornerRadius="8" Margin="0,0,8,0" Height="200">
                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <TextBlock Text="ðŸ“Š" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBlock Text="Risk Distribution Chart" FontSize="16" Foreground="#FFA0AEC0" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Coming Soon" FontSize="12" Foreground="#FF4299E1" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Recommendations -->
                                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                    <TextBlock Text="Top Recommendations" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,12"/>
                                    
                                    <Border Background="#FF2D3748" CornerRadius="6" Padding="12" Margin="0,0,0,8">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ”´ High Priority" FontSize="12" FontWeight="Medium" Foreground="#FFE53E3E"/>
                                            <TextBlock Text="Review legacy applications for cloud compatibility" FontSize="11" Foreground="#FFA0AEC0" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Background="#FF2D3748" CornerRadius="6" Padding="12" Margin="0,0,0,8">
                                        <StackPanel>
                                            <TextBlock Text="ðŸŸ¡ Medium Priority" FontSize="12" FontWeight="Medium" Foreground="#FFFBB859"/>
                                            <TextBlock Text="Update application inventory with latest versions" FontSize="11" Foreground="#FFA0AEC0" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Background="#FF2D3748" CornerRadius="6" Padding="12">
                                        <StackPanel>
                                            <TextBlock Text="ðŸŸ¢ Low Priority" FontSize="12" FontWeight="Medium" Foreground="#FF48BB78"/>
                                            <TextBlock Text="Optimize application licensing for cost savings" FontSize="11" Foreground="#FFA0AEC0" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                    
                    <!-- Application Dependencies -->
                    <Border Style="{StaticResource ModernCardStyle}">
                        <StackPanel>
                            <TextBlock Text="Application Dependencies" Style="{StaticResource SectionHeaderStyle}"/>
                            <TextBlock Text="Dependency mapping and migration impact analysis" 
                                       Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Dependency Visualization Placeholder -->
                                <Border Grid.Column="0" Background="#FF1A202C" CornerRadius="8" Margin="0,0,8,0" Height="250">
                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <TextBlock Text="ðŸ•¸ï¸" FontSize="64" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                                        <TextBlock Text="Dependency Map" FontSize="18" Foreground="#FFA0AEC0" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                        <TextBlock Text="Interactive dependency visualization" FontSize="12" Foreground="#FF4299E1" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Dependency Stats -->
                                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                    <TextBlock Text="Dependency Statistics" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,16"/>
                                    
                                    <StackPanel Margin="0,0,0,12">
                                        <TextBlock Text="Critical Dependencies" FontSize="12" Foreground="#FFA0AEC0"/>
                                        <TextBlock x:Name="CriticalDepsCount" Text="0" FontSize="20" FontWeight="Bold" Foreground="#FFE53E3E"/>
                                    </StackPanel>
                                    
                                    <StackPanel Margin="0,0,0,12">
                                        <TextBlock Text="Circular Dependencies" FontSize="12" Foreground="#FFA0AEC0"/>
                                        <TextBlock x:Name="CircularDepsCount" Text="0" FontSize="20" FontWeight="Bold" Foreground="#FFFBB859"/>
                                    </StackPanel>
                                    
                                    <StackPanel Margin="0,0,0,16">
                                        <TextBlock Text="Isolated Applications" FontSize="12" Foreground="#FFA0AEC0"/>
                                        <TextBlock x:Name="IsolatedAppsCount" Text="0" FontSize="20" FontWeight="Bold" Foreground="#FF48BB78"/>
                                    </StackPanel>
                                    
                                    <Button x:Name="AnalyzeDependenciesButton" Style="{StaticResource ModernButtonStyle}" 
                                            Background="{StaticResource AccentGradient}" 
                                            Padding="16,8" HorizontalAlignment="Stretch"
                                            Command="{Binding AnalyzeDependenciesCommand}">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="ðŸ”" FontSize="14" Margin="0,0,6,0"/>
                                            <TextBlock Text="Analyze Dependencies"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>
        </Grid>
        
        <!-- Enhanced Progress Overlay -->
        <Grid x:Name="ProgressOverlay" Grid.ColumnSpan="2" 
              Background="#DD000000" Visibility="Collapsed">
            <Border Background="#FF1A202C" BorderBrush="#FF2D3748" BorderThickness="1"
                    CornerRadius="12" Width="500" Height="280"
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border.Effect>
                    <DropShadowEffect Color="#FF000000" Direction="270" ShadowDepth="8" BlurRadius="24" Opacity="0.4"/>
                </Border.Effect>
                <Grid Margin="40">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Grid.Row="0" x:Name="ProgressTitle" 
                               Text="Operation in Progress" 
                               Foreground="#FFF7FAFC" FontSize="20" FontWeight="SemiBold"
                               HorizontalAlignment="Center" Margin="0,0,0,24"/>
                    
                    <ProgressBar Grid.Row="1" x:Name="ProgressBar" 
                                 Height="8" Margin="0,0,0,16"
                                 Background="#FF2D3748" Foreground="{StaticResource PrimaryGradient}"
                                 BorderThickness="0"/>
                    
                    <TextBlock Grid.Row="2" x:Name="ProgressStatus" 
                               Text="Processing..." 
                               Foreground="#FFA0AEC0" FontSize="14" TextAlignment="Center"
                               Margin="0,0,0,24"/>
                    
                    <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,16">
                        <TextBlock Text="â±ï¸" FontSize="16" Margin="0,0,8,0"/>
                        <TextBlock x:Name="ProgressTimer" Text="00:00" Foreground="#FF4299E1" FontSize="14"/>
                    </StackPanel>
                    
                    <Button Grid.Row="4" Content="Cancel Operation" 
                            Command="{Binding CancelOperationCommand}"
                            Background="{StaticResource DangerGradient}" Foreground="White"
                            Padding="24,10" BorderThickness="0"
                            HorizontalAlignment="Center" Style="{StaticResource ModernButtonStyle}"/>
                </Grid>
            </Border>
        </Grid>

            <!-- Domain Discovery View -->
            <!-- DomainDiscoveryView - DISABLED for unified TabControl system -->
            <Grid Grid.Row="0" Grid.Column="1" x:Name="DomainDiscoveryView" Visibility="Collapsed" Margin="32">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Header -->
                <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Domain Discovery &amp; DNS Enumeration" Style="{StaticResource PageHeaderStyle}"/>
                            <TextBlock Text="Discover and enumerate domain names, DNS records, and related infrastructure"
                                       Foreground="#FFA0AEC0" FontSize="14" Margin="0,8,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Refresh Data" Style="{StaticResource ModernButtonStyle}" 
                                Background="{StaticResource AccentGradient}" Command="{Binding RefreshDataCommand}" 
                                VerticalAlignment="Bottom"/>
                    </Grid>
                </Border>
                
                <!-- Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Domain Discovery Actions -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Domain Discovery Tools" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Run comprehensive domain and DNS enumeration scans"
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <WrapPanel>
                                    <Button x:Name="RunDomainScanButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="{StaticResource AccentGradient}"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding RunDomainScanCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Full Domain Scan"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="DnsLookupButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF48BB78" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding DnsLookupCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸŒ" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="DNS Lookup"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="SubdomainEnumButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF9F7AEA" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding SubdomainEnumCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ”—" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Subdomain Enumeration"/>
                                        </StackPanel>
                                    </Button>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Domain Results -->
                        <Border Style="{StaticResource ModernCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Discovered Domains" Style="{StaticResource SectionHeaderStyle}"/>
                                <DataGrid x:Name="DomainsDataGrid" Style="{StaticResource ModernDataGridStyle}"
                                          Margin="0,16,0,0" Height="300"
                                          behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                          behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                          behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Domain Name" Binding="{Binding DomainName}" Width="200"/>
                                        <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100"/>
                                        <DataGridTextColumn Header="IP Address" Binding="{Binding IPAddress}" Width="150"/>
                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                        <DataGridTextColumn Header="Last Checked" Binding="{Binding LastChecked}" Width="150"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <!-- File Servers View -->
            <!-- FileServersView - DISABLED for unified TabControl system -->
            <Grid Grid.Row="0" Grid.Column="1" x:Name="FileServersView" Visibility="Collapsed" Margin="32">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Header -->
                <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="File Servers &amp; Storage Discovery" Style="{StaticResource PageHeaderStyle}"/>
                            <TextBlock Text="Discover and analyze file servers, shares, and storage infrastructure"
                                       Foreground="#FFA0AEC0" FontSize="14" Margin="0,8,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Refresh Data" Style="{StaticResource ModernButtonStyle}" 
                                Background="{StaticResource AccentGradient}" Command="{Binding RefreshDataCommand}" 
                                VerticalAlignment="Bottom"/>
                    </Grid>
                </Border>
                
                <!-- Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- File Server Discovery Actions -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="File Server Discovery Tools" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Scan network for file servers and analyze storage usage"
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <WrapPanel>
                                    <Button x:Name="ScanFileServersButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="{StaticResource AccentGradient}"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding ScanFileServersCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Scan File Servers"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="AnalyzeSharesButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF48BB78" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding AnalyzeSharesCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Analyze Shares"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="StorageReportButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF9F7AEA" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding StorageReportCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ“ˆ" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Storage Report"/>
                                        </StackPanel>
                                    </Button>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- File Servers Results -->
                        <Border Style="{StaticResource ModernCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Discovered File Servers" Style="{StaticResource SectionHeaderStyle}"/>
                                <DataGrid x:Name="FileServersDataGrid" Style="{StaticResource ModernDataGridStyle}"
                                          Margin="0,16,0,0" Height="350"
                                          behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                          behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                          behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Server Name" Binding="{Binding ServerName}" Width="150"/>
                                        <DataGridTextColumn Header="IP Address" Binding="{Binding IPAddress}" Width="120"/>
                                        <DataGridTextColumn Header="Share Count" Binding="{Binding ShareCount}" Width="100"/>
                                        <DataGridTextColumn Header="Total Size" Binding="{Binding TotalSize}" Width="120"/>
                                        <DataGridTextColumn Header="Used Space" Binding="{Binding UsedSpace}" Width="120"/>
                                        <DataGridTextColumn Header="Free Space" Binding="{Binding FreeSpace}" Width="120"/>
                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                        <DataGridTextColumn Header="Last Scanned" Binding="{Binding LastScanned}" Width="150"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <!-- Databases View -->
            <!-- DatabasesView - DISABLED for unified TabControl system -->
            <Grid Grid.Row="0" Grid.Column="1" x:Name="DatabasesView" Visibility="Collapsed" Margin="32">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Header -->
                <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Database Discovery &amp; Analysis" Style="{StaticResource PageHeaderStyle}"/>
                            <TextBlock Text="Discover SQL Server, Oracle, MySQL, and other database systems across your infrastructure"
                                       Foreground="#FFA0AEC0" FontSize="14" Margin="0,8,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Refresh Data" Style="{StaticResource ModernButtonStyle}" 
                                Background="{StaticResource AccentGradient}" Command="{Binding RefreshDataCommand}" 
                                VerticalAlignment="Bottom"/>
                    </Grid>
                </Border>
                
                <!-- Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Database Discovery Actions -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Database Discovery Tools" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Scan network for database servers and analyze database configurations"
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <WrapPanel>
                                    <Button x:Name="ScanDatabasesButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="{StaticResource AccentGradient}"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding ScanDatabasesCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Scan Database Servers"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="AnalyzeSQLButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF48BB78" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding AnalyzeSQLCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ—ƒï¸" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Analyze SQL Servers"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="DatabaseReportButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF9F7AEA" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding DatabaseReportCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Database Report"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="CheckDatabaseVersionsButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FFE53E3E" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding CheckDatabaseVersionsCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="âš ï¸" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Check Versions"/>
                                        </StackPanel>
                                    </Button>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Database Results -->
                        <Border Style="{StaticResource ModernCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Discovered Database Servers" Style="{StaticResource SectionHeaderStyle}"/>
                                <DataGrid x:Name="DatabasesDataGrid" Style="{StaticResource ModernDataGridStyle}"
                                          Margin="0,16,0,0" Height="350"
                                          behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                          behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                          behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Server Name" Binding="{Binding ServerName}" Width="150"/>
                                        <DataGridTextColumn Header="IP Address" Binding="{Binding IPAddress}" Width="120"/>
                                        <DataGridTextColumn Header="Database Type" Binding="{Binding DatabaseType}" Width="100"/>
                                        <DataGridTextColumn Header="Version" Binding="{Binding Version}" Width="120"/>
                                        <DataGridTextColumn Header="Instance Name" Binding="{Binding InstanceName}" Width="120"/>
                                        <DataGridTextColumn Header="Database Count" Binding="{Binding DatabaseCount}" Width="100"/>
                                        <DataGridTextColumn Header="Total Size" Binding="{Binding TotalSize}" Width="120"/>
                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                        <DataGridTextColumn Header="Last Scanned" Binding="{Binding LastScanned}" Width="150"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <!-- Security View -->
            <!-- SecurityView - DISABLED for unified TabControl system -->
            <Grid Grid.Row="0" Grid.Column="1" x:Name="SecurityView" Visibility="Collapsed" Margin="32">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Header -->
                <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Group Policy &amp; Security Discovery" Style="{StaticResource PageHeaderStyle}"/>
                            <TextBlock Text="Analyze Group Policy settings, security configurations, and compliance posture across your domain"
                                       Foreground="#FFA0AEC0" FontSize="14" Margin="0,8,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Refresh Data" Style="{StaticResource ModernButtonStyle}" 
                                Background="{StaticResource AccentGradient}" Command="{Binding RefreshDataCommand}" 
                                VerticalAlignment="Bottom"/>
                    </Grid>
                </Border>
                
                <!-- Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Security Discovery Actions -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Security Assessment Tools" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Analyze Group Policy Objects, security settings, and compliance status"
                                           Foreground="#FFA0AEC0" FontSize="13" Margin="0,0,0,16"/>
                                
                                <WrapPanel>
                                    <Button x:Name="ScanGPOButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="{StaticResource AccentGradient}"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding ScanGPOCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Scan Group Policies"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="SecurityAuditButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FFE53E3E" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding SecurityAuditCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ›¡ï¸" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Security Audit"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="ComplianceCheckButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF48BB78" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding ComplianceCheckCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="âœ…" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Compliance Check"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="VulnerabilityAssessmentButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF9F7AEA" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding VulnerabilityAssessmentCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="âš ï¸" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Vulnerability Scan"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="PasswordPolicyButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FFED8936" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding PasswordPolicyCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Password Policies"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="PasswordGeneratorButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF9F7AEA" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding PasswordGeneratorCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸŽ²" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Password Generator"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="FirewallAnalysisButton" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF38B2AC" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding FirewallAnalysisCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ”¥" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Firewall Analysis"/>
                                        </StackPanel>
                                    </Button>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Security Results Tabs -->
                        <Border Style="{StaticResource ModernCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Security Assessment Results" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <!-- Tab Headers -->
                                <StackPanel Orientation="Horizontal" Margin="0,16,0,16">
                                    <Button x:Name="GPOTabButton" Content="Group Policies" Style="{StaticResource ModernButtonStyle}"
                                            Background="{StaticResource AccentGradient}" Margin="0,0,8,0" Padding="16,8"
                                            Command="{Binding SecurityTabCommand}" CommandParameter="GPO"/>
                                    <Button x:Name="SecurityTabButton" Content="Security Issues" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF4A5568" Margin="0,0,8,0" Padding="16,8"
                                            Command="{Binding SecurityTabCommand}" CommandParameter="security"/>
                                    <Button x:Name="ComplianceTabButton" Content="Compliance" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF4A5568" Margin="0,0,8,0" Padding="16,8"
                                            Command="{Binding SecurityTabCommand}" CommandParameter="Compliance"/>
                                    <Button x:Name="VulnerabilitiesTabButton" Content="Vulnerabilities" Style="{StaticResource ModernButtonStyle}"
                                            Background="#FF4A5568" Margin="0,0,8,0" Padding="16,8"
                                            Command="{Binding SecurityTabCommand}" CommandParameter="Vulnerabilities"/>
                                </StackPanel>
                                
                                <!-- GPO Results -->
                                <Grid x:Name="GPOResultsPanel" Visibility="Visible">
                                    <DataGrid x:Name="GPODataGrid" Style="{StaticResource ModernDataGridStyle}"
                                              Height="300"
                                              behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="GPO Name" Binding="{Binding Name}" Width="200"/>
                                            <DataGridTextColumn Header="Domain" Binding="{Binding Domain}" Width="150"/>
                                            <DataGridTextColumn Header="Linked To" Binding="{Binding LinkedTo}" Width="200"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                            <DataGridTextColumn Header="Settings Count" Binding="{Binding SettingsCount}" Width="120"/>
                                            <DataGridTextColumn Header="Risk Level" Binding="{Binding RiskLevel}" Width="100"/>
                                            <DataGridTextColumn Header="Last Modified" Binding="{Binding LastModified}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                                
                                <!-- Security Issues Results -->
                                <Grid x:Name="SecurityResultsPanel" Visibility="Collapsed">
                                    <DataGrid x:Name="SecurityIssuesDataGrid" Style="{StaticResource ModernDataGridStyle}"
                                              Height="300"
                                              behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Issue Type" Binding="{Binding IssueType}" Width="150"/>
                                            <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="100"/>
                                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="300"/>
                                            <DataGridTextColumn Header="Affected System" Binding="{Binding AffectedSystem}" Width="200"/>
                                            <DataGridTextColumn Header="Recommendation" Binding="{Binding Recommendation}" Width="250"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                                
                                <!-- Compliance Results -->
                                <Grid x:Name="ComplianceResultsPanel" Visibility="Collapsed">
                                    <DataGrid x:Name="ComplianceDataGrid" Style="{StaticResource ModernDataGridStyle}"
                                              Height="300"
                                              behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Control ID" Binding="{Binding ControlId}" Width="100"/>
                                            <DataGridTextColumn Header="Control Name" Binding="{Binding ControlName}" Width="200"/>
                                            <DataGridTextColumn Header="Framework" Binding="{Binding Framework}" Width="120"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                            <DataGridTextColumn Header="Score" Binding="{Binding Score}" Width="80"/>
                                            <DataGridTextColumn Header="Evidence" Binding="{Binding Evidence}" Width="200"/>
                                            <DataGridTextColumn Header="Gap Analysis" Binding="{Binding GapAnalysis}" Width="250"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                                
                                <!-- Vulnerabilities Results -->
                                <Grid x:Name="VulnerabilitiesResultsPanel" Visibility="Collapsed">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    
                                    <!-- Toolbar with Column Chooser -->
                                    <Border Grid.Row="0" Background="#FF2D3748" Padding="8,4">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <Button x:Name="VulnerabilitiesColumnChooserButton" Content="âš™ Columns" 
                                                    Click="VulnerabilitiesColumnChooser_Click"
                                                    Background="#FF4A5568" Foreground="#FFE2E8F0" 
                                                    BorderBrush="#FF63B3ED" Padding="8,4" Margin="4,0"
                                                    ToolTip="Choose which columns to display"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <DataGrid Grid.Row="1" x:Name="VulnerabilitiesDataGrid" Style="{StaticResource ModernDataGridStyle}"
                                              Height="300"
                                              behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="CVE ID" Binding="{Binding CveId}" Width="120"/>
                                            <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="250"/>
                                            <DataGridTextColumn Header="CVSS Score" Binding="{Binding CvssScore}" Width="100"/>
                                            <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="100"/>
                                            <DataGridTextColumn Header="Affected Systems" Binding="{Binding AffectedSystems}" Width="200"/>
                                            <DataGridTextColumn Header="Patch Available" Binding="{Binding PatchAvailable}" Width="120"/>
                                            <DataGridTextColumn Header="Exploit Available" Binding="{Binding ExploitAvailable}" Width="120"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
            
            <!-- Notification Area -->
            <Border Grid.Row="2" Background="#FF2D3748" BorderBrush="#FF4A5568" BorderThickness="0,1,0,0" Height="24"
                    Visibility="{Binding HasNotification, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="â„¹ï¸" FontSize="12" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding NotificationMessage}" Foreground="#FFE2E8F0" FontSize="11" FontWeight="Medium"/>
                </StackPanel>
            </Border>
            
            
            <!-- Command Palette Overlay -->
            <Grid x:Name="CommandPaletteOverlay" 
                  Background="#80000000" 
                  Visibility="{Binding IsCommandPaletteVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                  MouseDown="CommandPaletteOverlay_MouseDown">
                <controls:CommandPalette x:Name="CommandPaletteControl"
                                       DataContext="{Binding CommandPaletteViewModel}"
                                       MaxWidth="600"
                                       MaxHeight="400"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Top"
                                       Margin="0,100,0,0"/>
            </Grid>
    </Grid>
</Window>
