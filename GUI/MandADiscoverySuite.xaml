<!-- Version: 1.0.1 - PHASE 3 OPTIMIZED ARCHITECTURE -->
<!-- Author: Lukian Poleschtschuk -->
<!-- Date Modified: 2025-09-18 -->
<!-- REFACTORED: Modern Tab-Based Navigation with ViewFactory Lazy Loading -->
<Window x:Class="MandADiscoverySuite.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:behaviors="clr-namespace:MandADiscoverySuite.Behaviors"
        xmlns:converters="clr-namespace:MandADiscoverySuite.Converters"
        xmlns:controls="clr-namespace:MandADiscoverySuite.Controls"
        xmlns:collections="clr-namespace:MandADiscoverySuite.Collections"
        xmlns:helpers="clr-namespace:MandADiscoverySuite.Helpers"
        xmlns:views="clr-namespace:MandADiscoverySuite.Views"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="M&amp;A Discovery Suite - Enterprise Edition" Height="1000" Width="1600"
        WindowStartupLocation="CenterScreen" WindowState="Maximized"
        Background="{DynamicResource BackgroundBrush}" KeyDown="MainWindow_KeyDown"
        Closing="Window_Closing"
        behaviors:KeyboardNavigationBehavior.EnableEnhancedNavigation="True"
        behaviors:ResponsiveLayoutBehavior.EnableResponsiveLayout="False"
        AutomationProperties.Name="M&amp;A Discovery Suite Main Window"
        AutomationProperties.HelpText="Main application window for M&amp;A Discovery Suite with navigation tabs and data views">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- REFACTORED: Extracted modular resources -->
                <ResourceDictionary Source="Resources/Converters/Converters.xaml"/>
                <ResourceDictionary Source="Resources/Templates/DataTemplates.xaml"/>
                <ResourceDictionary Source="Resources/Styles/MainStyles.xaml"/>

                <!-- Existing theme resources -->
                <ResourceDictionary Source="Themes/DashboardWidgets.xaml"/>
                <ResourceDictionary Source="Styles/AccessibilityStyles.xaml"/>
                <ResourceDictionary Source="Themes/ThemeStyles.xaml"/>
                <ResourceDictionary Source="Themes/SpacingSystem.xaml"/>
                <ResourceDictionary Source="Themes/CustomTooltips.xaml"/>
                <ResourceDictionary Source="Controls/ChartControls.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- All resources extracted to modular files -->
            <!-- Converters: Resources/Converters/Converters.xaml -->
            <!-- Templates: Resources/Templates/DataTemplates.xaml -->
            <!-- Styles: Resources/Styles/MainStyles.xaml -->
        </ResourceDictionary>
    </Window.Resources>

    <Window.InputBindings>
        <!-- Navigation Shortcuts -->
        <KeyBinding Key="F1" Command="{Binding ShowDashboardViewCommand}"/>
        <KeyBinding Key="F2" Command="{Binding ShowDiscoveryViewCommand}"/>
        <KeyBinding Key="F3" Command="{Binding ShowUsersViewCommand}"/>
        <KeyBinding Key="F4" Command="{Binding ShowComputersViewCommand}"/>
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}"/>

        <!-- Action Shortcuts -->
        <KeyBinding Key="F6" Command="{Binding StartDiscoveryCommand}"/>
        <KeyBinding Key="F9" Command="{Binding ShowSettingsViewCommand}"/>
        <KeyBinding Key="F10" Command="{Binding ShowReportsViewCommand}"/>

        <!-- Standard Shortcuts -->
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding SearchCommand}"/>
        <KeyBinding Key="R" Modifiers="Ctrl" Command="{Binding RefreshCommand}"/>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding NewProfileCommand}"/>
        <KeyBinding Key="P" Modifiers="Ctrl+Shift" Command="{Binding ShowCommandPaletteCommand}"/>

        <!-- Theme Toggle -->
        <KeyBinding Key="T" Modifiers="Ctrl+Alt" Command="{Binding ToggleThemeCommand}"/>
        <!-- Theme Selection Dialog -->
        <KeyBinding Key="T" Modifiers="Ctrl+Shift" Command="{Binding ShowThemeSelectionCommand}"/>
        <!-- Log Viewer -->
        <KeyBinding Key="L" Modifiers="Ctrl+Shift" Command="{Binding ShowLogViewerCommand}"/>

        <!-- Close/Exit -->
        <KeyBinding Key="F4" Modifiers="Alt" Command="{Binding ExitCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CancelCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Enhanced Sidebar -->
        <Border Grid.Column="0" Background="{DynamicResource CardBrush}" BorderBrush="#2D3748" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Enhanced Logo/Title -->
                <Border Grid.Row="0" Padding="24,32,24,24">
                    <StackPanel>
                        <TextBlock Text="M&amp;A Discovery" Foreground="#F7FAFC" FontSize="24" FontWeight="Bold"/>
                        <TextBlock Text="Suite" Foreground="{DynamicResource AccentBrush}" FontSize="24" FontWeight="Light"/>
                        <TextBlock Text="Enterprise Edition" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" FontWeight="Medium" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Company Selector with Status -->
                <Border Grid.Row="1" Padding="24,0,24,24" Visibility="Visible" MinHeight="150">
                    <StackPanel>
                        <TextBlock Text="Source Company Profile" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="12" FontWeight="Medium" Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Source Company Profile ComboBox -->
                            <ComboBox Grid.Column="0"
                                      ItemsSource="{Binding CompanyProfiles}"
                                      SelectedItem="{Binding SelectedProfile, Mode=TwoWay}"
                                      DisplayMemberPath="CompanyName"
                                      Style="{StaticResource ModernComboBoxStyle}"
                                      Margin="0,0,8,0"
                                      VerticalAlignment="Center">
                                <ComboBox.ToolTip>
                                    <TextBlock Text="Select the source company profile for discovery operations" />
                                </ComboBox.ToolTip>
                            </ComboBox>

                            <Button Grid.Column="1" x:Name="TestSourceConnectionButton"
                                    Command="{Binding TestSourceConnectionCommand}"
                                    Background="#4A5568"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Test Source Connection">
                                <TextBlock Text="ðŸ”—" FontSize="14" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>

                            <Button Grid.Column="2" x:Name="SwitchProfileButton"
                                    Command="{Binding SwitchProfileCommand}"
                                    Background="{StaticResource SuccessGradient}"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Switch to Selected Source Profile">
                                <TextBlock Text="â†’" FontSize="16" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>

                            <Button Grid.Column="3" x:Name="CreateProfileButton"
                                    Command="{Binding CreateProfileCommand}"
                                    Background="{StaticResource AccentGradient}"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Create New Source Profile">
                                <TextBlock Text="+" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>

                            <Button Grid.Column="4" x:Name="DeleteProfileButton"
                                    Command="{Binding DeleteProfileCommand}"
                                    Background="{StaticResource DangerGradient}"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Delete Selected Source Profile">
                                <TextBlock Text="Ã—" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>

                            <Button Grid.Column="5" x:Name="SourceAppRegistrationButton"
                                    Command="{Binding RunAppRegistrationCommand}"
                                    Background="#10B981"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Setup Source App Registration">
                                <TextBlock Text="ðŸ”" FontSize="14" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>
                        </Grid>

                        <!-- Source Status Indicators -->
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,16">
                            <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Environment: " Foreground="{DynamicResource SecondaryTextBrush}" FontSize="10"/>
                                    <TextBlock Text="{Binding SourceEnvironmentStatus}" Foreground="#9AE6B4" FontSize="10" FontWeight="Medium"/>
                                </StackPanel>
                            </Border>
                            <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="8,4">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Connection: " Foreground="{DynamicResource SecondaryTextBrush}" FontSize="10"/>
                                    <TextBlock Text="{Binding SourceConnectionStatus}" Foreground="#9AE6B4" FontSize="10" FontWeight="Medium"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Separator -->
                        <Border Height="1" Background="#4A5568" Margin="0,12,0,12" Opacity="0.3"/>

                        <!-- Target Company Profile Section -->
                        <TextBlock Text="Target Company Profile" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="12" FontWeight="Medium" Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Target Company Profile ComboBox -->
                            <ComboBox Grid.Column="0"
                                      ItemsSource="{Binding TargetCompanyProfiles}"
                                      SelectedItem="{Binding SelectedTargetCompany, Mode=TwoWay}"
                                      DisplayMemberPath="CompanyName"
                                      Style="{StaticResource ModernComboBoxStyle}"
                                      Margin="0,0,8,0"
                                      VerticalAlignment="Center">
                                <ComboBox.ToolTip>
                                    <TextBlock Text="Select the target company profile for migration operations" />
                                </ComboBox.ToolTip>
                            </ComboBox>

                            <Button Grid.Column="1" x:Name="TestTargetConnectionButton"
                                    Command="{Binding TestTargetConnectionCommand}"
                                    Background="#4A5568"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Test Target Connection">
                                <TextBlock Text="ðŸ”—" FontSize="14" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>

                            <Button Grid.Column="2" x:Name="SwitchTargetProfileButton"
                                    Command="{Binding SetActiveTargetProfileCommand}"
                                    Background="{StaticResource SuccessGradient}"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Switch to Selected Target Profile">
                                <TextBlock Text="â†’" FontSize="16" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>

                            <Button Grid.Column="3" x:Name="AddTargetProfileButton"
                                    Command="{Binding AddTargetProfileCommand}"
                                    Background="{StaticResource AccentGradient}"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Add New Target Profile">
                                <TextBlock Text="+" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>

                            <Button Grid.Column="4" x:Name="ManageTargetProfilesButton"
                                    Command="{Binding ShowTargetProfilesCommand}"
                                    Background="{StaticResource DangerGradient}"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Manage Target Profiles">
                                <TextBlock Text="Ã—" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>

                            <Button Grid.Column="5" x:Name="TargetAppRegistrationButton"
                                    Command="{Binding RunTargetAppRegistrationCommand}"
                                    Background="#10B981"
                                    BorderThickness="0"
                                    Width="32" Height="36"
                                    Margin="0,0,4,0"
                                    ToolTip="Setup Target App Registration">
                                <TextBlock Text="ðŸ”" FontSize="14" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>
                        </Grid>

                        <!-- Target Status Indicators -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                            <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Environment: " Foreground="{DynamicResource SecondaryTextBrush}" FontSize="10"/>
                                    <TextBlock Text="{Binding TargetEnvironmentStatus}" Foreground="#FF9800" FontSize="10" FontWeight="Medium"/>
                                </StackPanel>
                            </Border>
                            <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="8,4">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Connection: " Foreground="{DynamicResource SecondaryTextBrush}" FontSize="10"/>
                                    <TextBlock Text="{Binding TargetConnectionStatus}" Foreground="#FF9800" FontSize="10" FontWeight="Medium"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Navigation Buttons with Scroll Support -->
                <ScrollViewer Grid.Row="2" Margin="0,8,0,0"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              PanningMode="VerticalOnly">
                    <StackPanel>
                        <Button x:Name="OverviewButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="dashboard"
                                ToolTip="Overview Dashboard - View company overview, statistics, and key metrics">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#x1F4CA;" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Overview"/>
                                    <TextBlock Text="Dashboard &amp; Stats" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="DiscoveryButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="domaindiscovery">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#x1F50D;" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Discovery"/>
                                    <TextBlock Text="DNS &amp; Domain Enumeration" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <!-- Dynamic Module Entries Under Discovery Section -->
                        <TextBlock Text="Discovery Modules" FontSize="11" FontWeight="SemiBold"
                                   Foreground="{DynamicResource SecondaryTextBrush}" Margin="24,12,0,4"/>
                        <ItemsControl ItemsSource="{Binding DiscoveryModules}" Margin="0,0,0,8">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource RoundedButtonStyle}"
                                            Command="{Binding DataContext.OpenTabCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding CommandParameter}">
                                        <Button.Content>
                                             <StackPanel Orientation="Horizontal">
                                                     <TextBlock Text="{Binding Icon}" FontSize="18" Margin="0,0,16,0"/>
                                                     <StackPanel>
                                                         <TextBlock Text="{Binding DisplayName}"/>
                                                         <TextBlock Text="{Binding Description}" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                                     </StackPanel>
                                                 </StackPanel>
                                        </Button.Content>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <Button x:Name="UsersButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="users"
                                ToolTip="Manage user accounts, view profiles, and analyze user permissions">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#x1F465;" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Users"/>
                                    <TextBlock Text="User Accounts &amp; Profiles" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="GroupsButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="groups"
                                ToolTip="Manage security groups, distribution lists, and group memberships">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#x1F465;" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Groups"/>
                                    <TextBlock Text="Security &amp; Distribution" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="InfrastructureButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="infrastructure"
                                ToolTip="Explore network topology, infrastructure components, and connectivity">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#x1F310;" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Infrastructure"/>
                                    <TextBlock Text="Network &amp; Topology" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="ApplicationsButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="applications">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“±" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Applications"/>
                                    <TextBlock Text="App Discovery &amp; Catalog" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="WavesButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="waves">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸš€" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Migration Waves"/>
                                    <TextBlock Text="Planning &amp; Timeline" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="MigrateButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="migrate">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âš¡" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Migrate"/>
                                    <TextBlock Text="Execute Migration" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="ManagementButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="management"
                                ToolTip="Project management dashboard with Gantt charts, waves, and migration planning">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#x1F4CA;" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Management"/>
                                    <TextBlock Text="Project Planning" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Separator Margin="24,16" Background="{DynamicResource SurfaceBrush}"/>

                        <Button x:Name="ReportsButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="reports"
                                ToolTip="Generate comprehensive reports and analytics for discovered data">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“„" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Reports"/>
                                    <TextBlock Text="Analytics &amp; Exports" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="AnalyticsButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="analytics"
                                ToolTip="Interactive data visualization and analytics dashboard">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#x1F4CA;" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Analytics"/>
                                    <TextBlock Text="Charts &amp; Graphs" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="SettingsButton" Style="{StaticResource RoundedButtonStyle}" Command="{Binding OpenTabCommand}" CommandParameter="settings"
                                ToolTip="Configure application settings, authentication, and discovery parameters">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âš™ï¸" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Settings"/>
                                    <TextBlock Text="Configuration &amp; Setup" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button x:Name="HelpButton" Style="{StaticResource RoundedButtonStyle}" Click="HelpButton_Click"
                                ToolTip="Show keyboard shortcuts and help information">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="â“" FontSize="18" Margin="0,0,16,0"/>
                                <StackPanel>
                                    <TextBlock Text="Help"/>
                                    <TextBlock Text="Shortcuts &amp; Info" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </ScrollViewer>

                <!-- Theme Toggle and Settings -->
                <Border Grid.Row="3" Padding="24,16" Visibility="Visible" MinHeight="60">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,16">
                            <TextBlock Text="Theme" FontSize="13" FontWeight="Medium" Foreground="{DynamicResource SecondaryTextBrush}" VerticalAlignment="Center" Margin="0,0,16,0"/>
                            <ToggleButton x:Name="ThemeToggle" Content="ðŸŒ™" Margin="0,0,10,0" Width="32" Height="32" ToolTip="Toggle Dark/Light Theme"
                                          Command="{Binding ToggleThemeCommand}" IsEnabled="True"/>
                            <Button Content="Theme Options..."
                                    Command="{Binding ShowThemeSelectionCommand}"
                                    Background="Transparent"
                                    Foreground="{DynamicResource SecondaryTextBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    Padding="8,4"
                                    FontSize="11"
                                    ToolTip="Open detailed theme selection and customization options"
                                    Style="{x:Null}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,16">
                            <TextBlock Text="Diagnostics" FontSize="13" FontWeight="Medium" Foreground="{DynamicResource SecondaryTextBrush}" VerticalAlignment="Center" Margin="0,0,16,0"/>
                            <Button Content="View Logs &amp; Audit..."
                                    Command="{Binding ShowLogViewerCommand}"
                                    Background="Transparent"
                                    Foreground="{DynamicResource SecondaryTextBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    Padding="8,4"
                                    FontSize="11"
                                    ToolTip="View system logs, audit trails, and diagnostic information"
                                    Style="{x:Null}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- System Ready Status in Sidebar -->
                <Border Grid.Row="5" Background="{StaticResource PrimaryGradient}" Padding="24,16">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <Ellipse Width="8" Height="8" Fill="#48BB78" Margin="0,0,8,0"/>
                            <TextBlock Text="System Ready" Foreground="White" FontSize="13" FontWeight="Medium"/>
                        </StackPanel>
                        <TextBlock x:Name="StatusDetails" Text="Last discovery: 2 hours ago" Foreground="White" FontSize="11" Opacity="0.8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock x:Name="DomainInfo" Text="Domain: Not detected" Foreground="White" FontSize="11" Opacity="0.8" Margin="0,0,16,0"/>
                            <TextBlock x:Name="EnvironmentType" Text="Environment: Unknown" Foreground="White" FontSize="11" Opacity="0.8"/>
                        </StackPanel>
                        <ProgressBar x:Name="DashboardProgressBar" Style="{StaticResource ProgressRingStyle}" Value="{Binding OverallProgress}" Margin="0,8,0,0" Visibility="{Binding IsDiscoveryRunning, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>

                <!-- Exit Button -->
                <Border Grid.Row="6" Padding="24,16">
                    <Button x:Name="ExitButton"
                            Command="{Binding ExitCommand}"
                            Background="#4A5568"
                            Foreground="{DynamicResource PrimaryTextBrush}"
                            BorderBrush="#718096"
                            BorderThickness="1"
                            Padding="12,8"
                            HorizontalAlignment="Stretch"
                            ToolTip="Exit Application (Alt+F4)">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸšª" FontSize="14" Margin="0,0,8,0"/>
                            <TextBlock Text="Exit" FontSize="13" FontWeight="Medium"/>
                        </StackPanel>
                    </Button>
                </Border>
            </Grid>
        </Border>

        <!-- OPTIMIZED: Modern Tab-Based Content Area with ViewFactory Lazy Loading -->
        <Grid Grid.Column="1" Background="#0F1419">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Optimized Tabbed Document Interface - All Views Loaded via ViewRegistry -->
            <TabControl Grid.Row="0" x:Name="MainTabControlInstance"
                        ItemsSource="{Binding OpenTabs}"
                        SelectedItem="{Binding SelectedTab}"
                        Background="Transparent"
                        BorderThickness="0"
                        Margin="0,8,0,0"
                        AutomationProperties.Name="Main Navigation Tabs"
                        AutomationProperties.HelpText="Navigate between different data views using Tab or arrow keys. Press Ctrl+W to close active tab"
                        KeyboardNavigation.TabNavigation="Local"
                        KeyboardNavigation.DirectionalNavigation="Contained">

                <!-- Tab Header Template -->
                <TabControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="12,8">
                            <TextBlock Text="{Binding Header}"
                                       Foreground="{DynamicResource PrimaryTextBrush}"
                                       FontSize="16"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"/>
                            <Button Content="âœ•"
                                    Margin="8,0,0,0"
                                    Width="16" Height="16"
                                    FontSize="10"
                                    Background="Transparent"
                                    Foreground="{DynamicResource SecondaryTextBrush}"
                                    BorderThickness="0"
                                    Padding="0"
                                    Visibility="Visible"
                                    Command="{Binding DataContext.CloseTabCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                                    CommandParameter="{Binding}"
                                    AutomationProperties.Name="Close Tab"
                                    AutomationProperties.HelpText="{Binding Header, StringFormat='Close {0} tab'}"
                                    ToolTip="{Binding Header, StringFormat='Close {0} (Ctrl+W)'}"/>
                        </StackPanel>
                    </DataTemplate>
                </TabControl.ItemTemplate>

                <!-- Tab Content Template - ViewRegistry Lazy Loading -->
                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <ContentPresenter Content="{Binding Content}"/>
                    </DataTemplate>
                </TabControl.ContentTemplate>

                <!-- Tab Control Style -->
                <TabControl.Style>
                    <Style TargetType="TabControl">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabControl">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <!-- Tab Headers -->
                                        <Border Grid.Row="0" Background="{DynamicResource CardBrush}" BorderBrush="#2D3748" BorderThickness="0,0,0,1">
                                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Hidden">
                                                <TabPanel x:Name="HeaderPanel"
                                                         Panel.ZIndex="1"
                                                         Margin="16,0"
                                                         IsItemsHost="True"
                                                         Background="Transparent"/>
                                            </ScrollViewer>
                                        </Border>

                                        <!-- Tab Content -->
                                        <ContentPresenter Grid.Row="1"
                                                         x:Name="PART_SelectedContentHost"
                                                         ContentSource="SelectedContent"/>
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Style>

                <!-- Tab Item Style -->
                <TabControl.ItemContainerStyle>
                    <Style TargetType="TabItem">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="{DynamicResource MutedForegroundBrush}"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0,0,4,0"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabItem">
                                    <Border x:Name="Border"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="4,4,0,0"
                                            Margin="0,4,0,0">
                                        <ContentPresenter x:Name="ContentSite"
                                                         VerticalAlignment="Center"
                                                         HorizontalAlignment="Center"
                                                         ContentSource="Header"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="#2D3748"/>
                                            <Setter Property="Foreground" Value="#E2E8F0"/>
                                        </Trigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="#374151"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.ItemContainerStyle>
            </TabControl>

            <!-- Status Bar -->
            <StatusBar Grid.Row="1" Background="{DynamicResource CardBrush}" Padding="16,8">
                <StatusBar.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                        </Grid>
                    </ItemsPanelTemplate>
                </StatusBar.ItemsPanel>

                <StatusBarItem Grid.Column="0">
                    <TextBlock x:Name="StatusText" Text="Ready" Foreground="{DynamicResource SecondaryTextBrush}"/>
                </StatusBarItem>

                <StatusBarItem Grid.Column="1">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Profile: " Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,4,0"/>
                        <TextBlock Text="{Binding CurrentProfileName}" Foreground="{DynamicResource AccentBrush}"/>
                    </StackPanel>
                </StatusBarItem>

                <StatusBarItem Grid.Column="2">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="View: " Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,4,0"/>
                        <TextBlock Text="{Binding CurrentView}" Foreground="{DynamicResource AccentBrush}"/>
                    </StackPanel>
                </StatusBarItem>

                <StatusBarItem Grid.Column="3">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="#48BB78" Margin="0,0,8,0"/>
                        <TextBlock Text="Connected" Foreground="#48BB78"/>
                    </StackPanel>
                </StatusBarItem>
            </StatusBar>
        </Grid>

        <!-- Enhanced Progress Overlay -->
        <Grid x:Name="ProgressOverlay" Grid.ColumnSpan="2"
              Background="#DD000000" Visibility="Collapsed">
            <Border Background="{DynamicResource CardBrush}"
                    CornerRadius="12"
                    Padding="40"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    MinWidth="400">
                <StackPanel>
                    <TextBlock x:Name="ProgressTitle"
                               Text="Processing..."
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,16"/>

                    <ProgressBar x:Name="MainProgressBar"
                                 Height="8"
                                 Style="{StaticResource ProgressRingStyle}"
                                 IsIndeterminate="True"
                                 Margin="0,0,0,16"/>

                    <TextBlock x:Name="ProgressMessage"
                               Text="Please wait while the operation completes..."
                               FontSize="14"
                               Foreground="{DynamicResource SecondaryTextBrush}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>