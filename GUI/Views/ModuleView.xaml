

<UserControl x:Class="MandADiscoverySuite.Views.ModuleView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:MandADiscoverySuite.Converters"
             xmlns:collections="clr-namespace:MandADiscoverySuite.Collections"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="1200"
             DataContext="{Binding ModuleViewModel}">

    <UserControl.Resources>
        <!-- Boolean to Visibility converter -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Background="{DynamicResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <!-- Header Section -->
            <RowDefinition Height="Auto"/>
            <!-- Error Banner Section -->
            <RowDefinition Height="Auto"/>
            <!-- Content Section -->
            <RowDefinition Height="*"/>
            <!-- Footer Section -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Module Header with Icon and Actions -->
        <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1"
                Padding="20,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Module Icon and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="{Binding Icon}" FontSize="32" VerticalAlignment="Center" Margin="0,0,16,0"/>
                    <StackPanel>
                        <TextBlock Text="{Binding DisplayName}" FontSize="24" FontWeight="SemiBold"
                                 Foreground="{DynamicResource PrimaryTextBrush}" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding Category}" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"
                                 VerticalAlignment="Center" Margin="0,2,0,0"/>
                    </StackPanel>
                </StackPanel>

                <!-- Module Description -->
                <TextBlock Grid.Column="1" Text="{Binding Description}" FontSize="13"
                         Foreground="{DynamicResource SecondaryTextBrush}" VerticalAlignment="Center"
                         TextWrapping="Wrap" Margin="24,0"/>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="🔄 View Logs" Command="{Binding ViewLogsCommand}"
                            Style="{StaticResource ModernButtonStyle}" Margin="0,0,12,0"
                            Background="{DynamicResource SurfaceBrush}"
                            Foreground="{DynamicResource PrimaryTextBrush}"/>
                    <Button Content="📤 Export Results" Command="{Binding ExportResultsCommand}"
                            Style="{StaticResource ModernButtonStyle}" Margin="0,0,12,0"
                            Background="{DynamicResource SuccessBrush}"
                            Foreground="White"/>
                    <Button Content="▶️ Run Module" Command="{Binding RunModuleCommand}"
                            Style="{StaticResource ModernButtonStyle}"
                            Background="{StaticResource PrimaryGradient}"
                            Foreground="White" FontWeight="Medium"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Error Banner (Red Alert for CSV/Module Issues) -->
        <Border Grid.Row="1" Background="{DynamicResource ErrorBrush}" Padding="20,12"
                Visibility="{Binding HasErrors, Converter={StaticResource BoolToVisibilityConverter}}"
                BorderBrush="{DynamicResource ErrorDarkBrush}" BorderThickness="0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="⚠️" FontSize="20" VerticalAlignment="Center" Margin="0,0,12,0"/>
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding ErrorTitle}" FontWeight="Medium" Foreground="White" FontSize="14"/>
                    <TextBlock Text="{Binding ErrorMessage}" Foreground="White" FontSize="12" TextWrapping="Wrap" Margin="0,4,0,0"/>
                </StackPanel>
                <Button Grid.Column="2" Content="×" FontSize="16" Background="Transparent" Foreground="White"
                        BorderThickness="0" Width="24" Height="24"
                        Command="{Binding DismissErrorCommand}" VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Border Grid.Row="2" Padding="24,20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Module Status and Metrics -->
                <Border Grid.Row="0" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Status Indicator -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,24,0">
                            <Ellipse Width="12" Height="12" Fill="{Binding StatusColor}" Margin="0,0,8,0"/>
                            <StackPanel>
                                <TextBlock Text="{Binding StatusText}" FontSize="14" FontWeight="Medium"
                                         Foreground="{DynamicResource PrimaryTextBrush}"/>
                                <TextBlock Text="{Binding StatusDetailText}" FontSize="11"
                                         Foreground="{DynamicResource SecondaryTextBrush}"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Results Count -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,0,32,0">
                            <TextBlock Text="{Binding ResultsCount}" FontSize="24" FontWeight="Bold"
                                     Foreground="{DynamicResource AccentBrush}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Results" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}"
                                     HorizontalAlignment="Center"/>
                        </StackPanel>

                        <!-- Processing Progress Bar -->
                        <ProgressBar Grid.Column="2" Value="{Binding ProgressValue}" Maximum="100" Width="150" Height="8"
                                   Background="{DynamicResource SurfaceBrush}" Foreground="{DynamicResource AccentBrush}"
                                   Margin="0,0,32,0" VerticalAlignment="Center"
                                   Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <!-- Processing Text -->
                        <TextBlock Grid.Column="3" Text="{Binding ProcessingMessage}" VerticalAlignment="Center"
                                 Foreground="{DynamicResource PrimaryTextBrush}" FontSize="12"
                                 Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <!-- Last Updated -->
                        <StackPanel Grid.Column="4" VerticalAlignment="Center" HorizontalAlignment="Right">
                            <TextBlock Text="⏱️" FontSize="11" Margin="0,0,4,0" VerticalAlignment="Center"/>
                            <StackPanel>
                                <TextBlock Text="Last updated:" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                <TextBlock Text="{Binding LastUpdatedText}" FontSize="11" FontWeight="Medium"
                                         Foreground="{DynamicResource PrimaryTextBrush}"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Dynamic Content Area - To be customized per module type -->
                <Border Grid.Row="1" Style="{StaticResource ModernCardStyle}">
                    <Grid>
                        <!-- Default Empty State -->
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                  Visibility="{Binding HasResults, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                            <TextBlock Text="🔍" FontSize="48" Opacity="0.3" HorizontalAlignment="Center"/>
                            <TextBlock Text="No data available" FontSize="18" FontWeight="SemiBold"
                                     Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,12,0,8"
                                     HorizontalAlignment="Center"/>
                            <TextBlock Text="Click 'Run Module' to start discovery or load existing CSV data"
                                     FontSize="14" Foreground="{DynamicResource SecondaryTextBrush}"
                                     HorizontalAlignment="Center" TextAlignment="Center" MaxWidth="400"
                                     TextWrapping="Wrap"/>
                        </StackPanel>

                        <!-- Results Grid - To be replaced by module-specific templates -->
                        <DataGrid ItemsSource="{Binding Results}" Style="{StaticResource ModernDataGridStyle}"
                                AutoGenerateColumns="True" CanUserSortColumns="True"
                                Visibility="{Binding HasResults, Converter={StaticResource BoolToVisibilityConverter}}"
                                HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"
                                VirtualizingStackPanel.IsVirtualizing="True"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Footer with Metadata -->
        <Border Grid.Row="3" Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0"
                Padding="24,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- File Path -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center" Margin="0,0,24,0">
                    <TextBlock Text="Module File:" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}"/>
                    <TextBlock Text="{Binding FilePath}" FontSize="12" Foreground="{DynamicResource PrimaryTextBrush}"/>
                </StackPanel>

                <!-- Priority -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,0,24,0">
                    <TextBlock Text="Priority:" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}"/>
                    <TextBlock Text="{Binding PriorityText}" FontSize="12" Foreground="{DynamicResource PrimaryTextBrush}"/>
                </StackPanel>

                <!-- Timeout -->
                <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="0,0,24,0">
                    <TextBlock Text="Timeout:" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}"/>
                    <TextBlock Text="{Binding TimeoutText}" FontSize="12" Foreground="{DynamicResource PrimaryTextBrush}"/>
                </StackPanel>

                <!-- CSV Status -->
                <StackPanel Grid.Column="3" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding CsvStatusText}" FontSize="12" FontWeight="Medium"
                             Foreground="{Binding CsvStatusColor}"/>
                    <TextBlock Text="{Binding CsvFileName}" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"
                             Margin="0,2,0,0"/>
                </StackPanel>

                <!-- Enabled Status -->
                <Border Grid.Column="4" CornerRadius="4" Padding="8,4" Background="{DynamicResource SuccessBrush}"
                       VerticalAlignment="Center">
                    <TextBlock Text="Enabled" Foreground="White" FontSize="11" FontWeight="Medium"/>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>