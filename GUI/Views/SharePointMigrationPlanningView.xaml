<UserControl x:Class="MandADiscoverySuite.Views.SharePointMigrationPlanningView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewmodels="clr-namespace:MandADiscoverySuite.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             Background="#FF0F1419">
    
    <UserControl.DataContext>
        <viewmodels:SharePointMigrationPlanningViewModel />
    </UserControl.DataContext>

    <UserControl.Resources>
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="#2C3E50" />
            <Setter Property="Margin" Value="0,0,0,10" />
        </Style>
        
        <Style x:Key="StatisticCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#F8F9FA" />
            <Setter Property="BorderBrush" Value="#E9ECEF" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="15,10" />
            <Setter Property="Margin" Value="5" />
        </Style>
        
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#3498DB" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="15,8" />
            <Setter Property="Margin" Value="5,0" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" Background="#00897B" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="SharePoint Migration Planning" 
                             FontSize="24" FontWeight="Bold" Foreground="White" />
                    <TextBlock Text="{Binding StatusMessage}" 
                             FontSize="14" Foreground="#B2DFDB" Margin="0,5,0,0" />
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="ðŸ” Discover Sites" Command="{Binding DiscoverSitesCommand}" 
                          Style="{StaticResource ActionButtonStyle}" />
                    <Button Content="ðŸ“Š Analyze Content" Command="{Binding AnalyzeContentCommand}" 
                          Style="{StaticResource ActionButtonStyle}" Background="#FF6F00" />
                    <Button Content="âœˆï¸ Pre-Flight Check" Command="{Binding PreFlightCheckCommand}" 
                          Style="{StaticResource ActionButtonStyle}" Background="#D84315" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Statistics Cards -->
        <WrapPanel Grid.Row="1" Margin="10" HorizontalAlignment="Center">
            <Border Style="{StaticResource StatisticCardStyle}">
                <StackPanel>
                    <TextBlock Text="{Binding TotalSites}" FontSize="28" FontWeight="Bold" 
                             Foreground="#00897B" HorizontalAlignment="Center" />
                    <TextBlock Text="Total Sites" FontSize="12" Foreground="#7F8C8D" 
                             HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
            
            <Border Style="{StaticResource StatisticCardStyle}">
                <StackPanel>
                    <TextBlock Text="{Binding TotalLibraries}" FontSize="28" FontWeight="Bold" 
                             Foreground="#43A047" HorizontalAlignment="Center" />
                    <TextBlock Text="Libraries" FontSize="12" Foreground="#7F8C8D" 
                             HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
            
            <Border Style="{StaticResource StatisticCardStyle}">
                <StackPanel>
                    <TextBlock Text="{Binding TotalLists}" FontSize="28" FontWeight="Bold" 
                             Foreground="#1E88E5" HorizontalAlignment="Center" />
                    <TextBlock Text="Lists" FontSize="12" Foreground="#7F8C8D" 
                             HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
            
            <Border Style="{StaticResource StatisticCardStyle}">
                <StackPanel>
                    <TextBlock Text="{Binding TotalContentSizeGB, StringFormat='{}{0:N0} GB'}" 
                             FontSize="28" FontWeight="Bold" 
                             Foreground="#FB8C00" HorizontalAlignment="Center" />
                    <TextBlock Text="Content Size" FontSize="12" Foreground="#7F8C8D" 
                             HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
            
            <Border Style="{StaticResource StatisticCardStyle}">
                <StackPanel>
                    <TextBlock Text="{Binding TotalFiles, StringFormat='{}{0:N0}'}" 
                             FontSize="28" FontWeight="Bold" 
                             Foreground="#8E24AA" HorizontalAlignment="Center" />
                    <TextBlock Text="Total Files" FontSize="12" Foreground="#7F8C8D" 
                             HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
            
            <Border Style="{StaticResource StatisticCardStyle}">
                <StackPanel>
                    <TextBlock Text="{Binding TotalWorkflows}" FontSize="28" FontWeight="Bold" 
                             Foreground="#D32F2F" HorizontalAlignment="Center" />
                    <TextBlock Text="Workflows" FontSize="12" Foreground="#7F8C8D" 
                             HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
            
            <Border Style="{StaticResource StatisticCardStyle}">
                <StackPanel>
                    <TextBlock Text="{Binding EstimatedMigrationHours, StringFormat='{}{0} hrs'}" 
                             FontSize="28" FontWeight="Bold" 
                             Foreground="#00ACC1" HorizontalAlignment="Center" />
                    <TextBlock Text="Est. Duration" FontSize="12" Foreground="#7F8C8D" 
                             HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
        </WrapPanel>

        <!-- Main Content Tabs -->
        <TabControl Grid.Row="2" Margin="10" Background="#FF1E1E1E">
            
            <!-- Sites & Libraries Tab -->
            <TabItem Header="Sites &amp; Libraries" FontSize="14" FontWeight="Medium">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="5" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- Sites Section -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        
                        <!-- Sites Filter -->
                        <Border Grid.Row="0" Background="#F8F9FA" BorderBrush="#E9ECEF" 
                              BorderThickness="0,0,0,1" Padding="10">
                            <StackPanel>
                                <TextBlock Text="SharePoint Sites" Style="{StaticResource HeaderTextStyle}" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBox Grid.Column="0" Text="{Binding SiteSearchText, UpdateSourceTrigger=PropertyChanged}" 
                                           Tag="Search sites..." Padding="8" Margin="0,0,10,0" />
                                    
                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <CheckBox Content="Large sites only" IsChecked="{Binding ShowOnlyLargeSites}" 
                                                VerticalAlignment="Center" Margin="0,0,10,0" />
                                        <CheckBox Content="With issues" IsChecked="{Binding ShowOnlyIssues}" 
                                                VerticalAlignment="Center" />
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Sites DataGrid -->
                        <DataGrid Grid.Row="1" ItemsSource="{Binding SitesView}" 
                                SelectedItem="{Binding SelectedSite}"
                                AutoGenerateColumns="False" CanUserAddRows="False" 
                                GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#E9ECEF">
                            
                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="View Details" Command="{Binding ViewSiteDetailsCommand}"
                                            CommandParameter="{Binding SelectedSite}" />
                                </ContextMenu>
                            </DataGrid.ContextMenu>
                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Site Name" 
                                                  Binding="{Binding Properties[SiteName]}" 
                                                  Width="200" />
                                <DataGridTextColumn Header="URL" 
                                                  Binding="{Binding SourceIdentity}" 
                                                  Width="250" />
                                <DataGridTextColumn Header="Size (GB)" 
                                                  Binding="{Binding Properties[SizeGB], StringFormat='{}{0:N2}'}" 
                                                  Width="80" />
                                <DataGridTextColumn Header="Subsites" 
                                                  Binding="{Binding Properties[SubsiteCount]}" 
                                                  Width="80" />
                                <DataGridTextColumn Header="Status" 
                                                  Binding="{Binding Status}" 
                                                  Width="100" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                    
                    <!-- Splitter -->
                    <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" 
                                Background="#E9ECEF" />
                    
                    <!-- Libraries Section -->
                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        
                        <!-- Libraries Filter -->
                        <Border Grid.Row="0" Background="#F8F9FA" BorderBrush="#E9ECEF" 
                              BorderThickness="0,0,0,1" Padding="10">
                            <StackPanel>
                                <TextBlock Text="Document Libraries" Style="{StaticResource HeaderTextStyle}" />
                                <TextBox Text="{Binding LibrarySearchText, UpdateSourceTrigger=PropertyChanged}" 
                                       Tag="Search libraries..." Padding="8" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Libraries DataGrid -->
                        <DataGrid Grid.Row="1" ItemsSource="{Binding LibrariesView}" 
                                SelectedItem="{Binding SelectedLibrary}"
                                AutoGenerateColumns="False" CanUserAddRows="False" 
                                GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#E9ECEF">
                            
                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="View Details" Command="{Binding ViewLibraryDetailsCommand}"
                                            CommandParameter="{Binding SelectedLibrary}" />
                                </ContextMenu>
                            </DataGrid.ContextMenu>
                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Library" 
                                                  Binding="{Binding Properties[LibraryName]}" 
                                                  Width="150" />
                                <DataGridTextColumn Header="Items" 
                                                  Binding="{Binding Properties[ItemCount], StringFormat='{}{0:N0}'}" 
                                                  Width="80" />
                                <DataGridTextColumn Header="Size (GB)" 
                                                  Binding="{Binding Properties[SizeGB], StringFormat='{}{0:N2}'}" 
                                                  Width="80" />
                                <DataGridCheckBoxColumn Header="Workflows" 
                                                       Binding="{Binding Properties[HasWorkflows]}" 
                                                       Width="80" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Grid>
            </TabItem>
            
            <!-- Migration Configuration Tab -->
            <TabItem Header="Migration Configuration" FontSize="14" FontWeight="Medium">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="20" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        
                        <!-- Left Column -->
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Content Settings" Style="{StaticResource HeaderTextStyle}" />
                            
                            <CheckBox Content="Migrate Permissions" IsChecked="{Binding MigratePermissions}" 
                                    Margin="0,0,0,10" />
                            <CheckBox Content="Migrate Version History" IsChecked="{Binding MigrateVersionHistory}" 
                                    Margin="0,0,0,10" />
                            <CheckBox Content="Migrate Workflows" IsChecked="{Binding MigrateWorkflows}" 
                                    Margin="0,0,0,10" />
                            <CheckBox Content="Migrate Customizations" IsChecked="{Binding MigrateCustomizations}" 
                                    Margin="0,0,0,10" />
                            <CheckBox Content="Preserve Metadata" IsChecked="{Binding PreserveMetadata}" 
                                    Margin="0,0,0,10" />
                            <CheckBox Content="Enable Incremental Migration" IsChecked="{Binding EnableIncrementalMigration}" 
                                    Margin="0,0,0,15" />
                            
                            <TextBlock Text="Version History Limit:" FontWeight="Medium" Margin="0,0,0,5" />
                            <TextBox Text="{Binding VersionHistoryLimit}" Margin="0,0,0,15" Padding="8" />
                        </StackPanel>
                        
                        <!-- Right Column -->
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Performance Settings" Style="{StaticResource HeaderTextStyle}" />
                            
                            <TextBlock Text="Max Concurrent Migrations:" FontWeight="Medium" Margin="0,0,0,5" />
                            <TextBox Text="{Binding MaxConcurrentMigrations}" Margin="0,0,0,15" Padding="8" />
                            
                            <TextBlock Text="Project Information" Style="{StaticResource HeaderTextStyle}" 
                                     Margin="0,20,0,10" />
                            
                            <TextBlock Text="Project Name:" FontWeight="Medium" Margin="0,0,0,5" />
                            <TextBox Text="{Binding ProjectName}" Margin="0,0,0,15" Padding="8" />
                            
                            <TextBlock Text="Description:" FontWeight="Medium" Margin="0,0,0,5" />
                            <TextBox Text="{Binding ProjectDescription}" Margin="0,0,0,15" Padding="8" 
                                   TextWrapping="Wrap" Height="60" AcceptsReturn="True" />
                            
                            <TextBlock Text="Planned Start Date:" FontWeight="Medium" Margin="0,0,0,5" />
                            <DatePicker SelectedDate="{Binding PlannedStartDate}" Margin="0,0,0,15" />
                            
                            <TextBlock Text="Planned End Date:" FontWeight="Medium" Margin="0,0,0,5" />
                            <DatePicker SelectedDate="{Binding PlannedEndDate}" Margin="0,0,0,15" />
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </TabItem>
            
            <!-- Migration Batches Tab -->
            <TabItem Header="Migration Batches" FontSize="14" FontWeight="Medium">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    
                    <!-- Batch Actions -->
                    <Border Grid.Row="0" Background="#F8F9FA" BorderBrush="#E9ECEF" 
                          BorderThickness="0,0,0,1" Padding="15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" Text="{Binding TotalBatches, StringFormat='Total Batches: {0}'}" 
                                     VerticalAlignment="Center" FontSize="14" />
                            
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Content="Generate Batches" Command="{Binding GenerateBatchesCommand}" 
                                      Style="{StaticResource ActionButtonStyle}" Background="#43A047" />
                                <Button Content="Export Plan" Command="{Binding ExportMigrationPlanCommand}" 
                                      Style="{StaticResource ActionButtonStyle}" Background="#FF6F00" />
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Batches DataGrid -->
                    <DataGrid Grid.Row="1" ItemsSource="{Binding BatchesView}" 
                            SelectedItem="{Binding SelectedBatch}"
                            AutoGenerateColumns="False" CanUserAddRows="False" 
                            GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#E9ECEF">
                        
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Batch Name" Binding="{Binding Name}" 
                                              Width="200" />
                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" 
                                              Width="300" />
                            <DataGridTextColumn Header="Site Count" Binding="{Binding Items.Count}" 
                                              Width="100" />
                            <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" 
                                              Width="80" />
                            <DataGridTextColumn Header="Scheduled Start" 
                                              Binding="{Binding PlannedStartDate, StringFormat='yyyy-MM-dd'}" 
                                              Width="120" />
                            <DataGridTextColumn Header="Est. Duration" 
                                              Binding="{Binding EstimatedDuration.TotalHours, StringFormat='{}{0:N0} hrs'}" 
                                              Width="100" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
            
            <!-- Content Issues Tab -->
            <TabItem Header="Content Issues" FontSize="14" FontWeight="Medium">
                <DataGrid ItemsSource="{Binding ContentIssues}" 
                        AutoGenerateColumns="False" CanUserAddRows="False" 
                        GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#E9ECEF">
                    
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" 
                                          Width="100" />
                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" 
                                          Width="150" />
                        <DataGridTextColumn Header="Item" Binding="{Binding ItemName}" 
                                          Width="200" />
                        <DataGridTextColumn Header="Description" Binding="{Binding Description}" 
                                          Width="400" />
                        <DataGridTextColumn Header="Recommended Action" Binding="{Binding RecommendedAction}" 
                                          Width="300" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
        </TabControl>

        <!-- Discovery Progress Bar -->
        <ProgressBar Grid.Row="2" Height="4" Minimum="0" Maximum="100" 
                   Value="{Binding DiscoveryProgress}" 
                   Visibility="{Binding IsDiscoveryRunning, Converter={StaticResource BooleanToVisibilityConverter}}"
                   VerticalAlignment="Top" Foreground="#00897B" />

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#ECF0F1" BorderBrush="#BDC3C7" 
              BorderThickness="0,1,0,0" Padding="15,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" 
                         FontSize="12" Foreground="#34495E" VerticalAlignment="Center" />
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Clear Filters" Command="{Binding ClearFiltersCommand}" 
                          Style="{StaticResource ActionButtonStyle}" Background="#95A5A6" 
                          FontSize="12" Padding="10,5" />
                    <Button Content="Refresh Statistics" Command="{Binding RefreshStatisticsCommand}" 
                          Style="{StaticResource ActionButtonStyle}" Background="#7F8C8D" 
                          FontSize="12" Padding="10,5" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>