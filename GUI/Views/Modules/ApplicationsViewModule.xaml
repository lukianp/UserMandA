<UserControl x:Class="GUI.Views.Modules.ApplicationsViewModule"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:behaviors="clr-namespace:MandADiscoverySuite.Behaviors"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid Margin="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,24">
            <TextBlock Text="Application Discovery &amp; Catalog" Style="{StaticResource HeaderTextStyle}"/>
            <Button Content="Refresh Data" Style="{StaticResource RoundedButtonStyle}"
                    Background="{StaticResource AccentGradient}" Command="{Binding RefreshDataCommand}"
                    HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="32,0,0,0"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Discovery Overview Cards -->
                <Grid Margin="0,0,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Style="{StaticResource ModernCardStyle}" Margin="0,0,8,0">
                        <StackPanel>
                            <TextBlock Text="📱" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                            <TextBlock x:Name="TotalAppsCount" Text="0" FontSize="24" FontWeight="Bold"
                                       Foreground="{DynamicResource AccentBrush}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Total Applications" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <Border Grid.Column="1" Style="{StaticResource ModernCardStyle}" Margin="8,0">
                        <StackPanel>
                            <TextBlock Text="⚠️" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                            <TextBlock x:Name="HighRiskAppsCount" Text="0" FontSize="24" FontWeight="Bold"
                                       Foreground="{DynamicResource ErrorBrush}" HorizontalAlignment="Center"/>
                            <TextBlock Text="High Risk Apps" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <Border Grid.Column="2" Style="{StaticResource ModernCardStyle}" Margin="8,0">
                        <StackPanel>
                            <TextBlock Text="☁️" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                            <TextBlock x:Name="CloudReadyAppsCount" Text="0" FontSize="24" FontWeight="Bold"
                                       Foreground="{DynamicResource SuccessBrush}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Cloud Ready" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <Border Grid.Column="3" Style="{StaticResource ModernCardStyle}" Margin="8,0,0,0">
                        <StackPanel>
                            <TextBlock Text="🔄" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                            <TextBlock x:Name="PendingReviewCount" Text="0" FontSize="24" FontWeight="Bold"
                                       Foreground="#FBB859" HorizontalAlignment="Center"/>
                            <TextBlock Text="Pending Review" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Application Discovery Actions -->
                <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Application Discovery" Style="{StaticResource SectionHeaderStyle}"/>
                        <TextBlock Text="Discover and catalog applications across your infrastructure"
                                   Foreground="{DynamicResource SecondaryTextBrush}" FontSize="13" Margin="0,0,0,16"/>

                        <WrapPanel>
                            <Button x:Name="RunAppDiscoveryButton" Style="{StaticResource RoundedButtonStyle}"
                                    Background="{StaticResource AccentGradient}"
                                    Margin="0,0,12,12" Padding="20,12"
                                    Command="{Binding RunAppDiscoveryCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="&#x1F50D;" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="Run Full App Discovery"/>
                                </StackPanel>
                            </Button>

                            <Button x:Name="ImportAppListButton" Style="{StaticResource RoundedButtonStyle}"
                                    Background="#48BB78" Foreground="White"
                                    Margin="0,0,12,12" Padding="20,12"
                                    Command="{Binding ImportAppListCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="📂" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="Import App List"/>
                                </StackPanel>
                            </Button>

                            <Button x:Name="RefreshAppsButton" Style="{StaticResource RoundedButtonStyle}"
                                    Background="#805AD5" Foreground="White"
                                    Margin="0,0,12,12" Padding="20,12"
                                    Command="{Binding RefreshAppsCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="🔄" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="Refresh Data"/>
                                </StackPanel>
                            </Button>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <!-- Applications Grid -->
                <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Discovered Applications" Style="{StaticResource SectionHeaderStyle}"/>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <TextBox x:Name="AppSearchBox" Width="200" Height="32"
                                         Background="{DynamicResource SurfaceBrush}" Foreground="White" BorderBrush="{DynamicResource BorderBrush}"
                                         Padding="12,8" FontSize="13" Margin="0,0,12,0"
                                         TextChanged="AppSearchBox_TextChanged">
                                    <TextBox.Resources>
                                        <Style TargetType="TextBox">
                                            <Style.Triggers>
                                                <Trigger Property="Text" Value="">
                                                    <Setter Property="Background">
                                                        <Setter.Value>
                                                            <VisualBrush Stretch="None">
                                                                <VisualBrush.Visual>
                                                                    <TextBlock Text="&#x1F50D; Search applications..."
                                                                               Foreground="{DynamicResource SecondaryTextBrush}" FontSize="13"
                                                                               Margin="4,0,0,0"/>
                                                                </VisualBrush.Visual>
                                                            </VisualBrush>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Resources>
                                </TextBox>

                                <ComboBox x:Name="AppFilterCombo" Width="140" Height="32"
                                          Background="{DynamicResource SurfaceBrush}" Foreground="White" BorderBrush="{DynamicResource BorderBrush}"
                                          SelectionChanged="AppFilterCombo_SelectionChanged">
                                    <ComboBoxItem Content="All Apps" IsSelected="True"/>
                                    <ComboBoxItem Content="High Risk"/>
                                    <ComboBoxItem Content="Cloud Ready"/>
                                    <ComboBoxItem Content="Legacy"/>
                                    <ComboBoxItem Content="Pending Review"/>
                                </ComboBox>
                            </StackPanel>
                        </Grid>

                        <DataGrid x:Name="ApplicationsGrid" Margin="0,16,0,0" Height="400"
                                  Background="{DynamicResource CardBrush}" Foreground="White" BorderBrush="#2D3748"
                                  HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                                  RowBackground="#2D2D30" AlternatingRowBackground="{DynamicResource CardBrush}"
                                  SelectionMode="Single" IsReadOnly="True"
                                  AutoGenerateColumns="False"
                                  behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                  behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                  behaviors:VirtualizationBehavior.EnableRowVirtualization="True" VirtualizingStackPanel.IsVirtualizing="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Display Name" Binding="{Binding DisplayName}" Width="200"/>
                                <DataGridTextColumn Header="App ID" Binding="{Binding AppId}" Width="160"/>
                                <DataGridTextColumn Header="Object Type" Binding="{Binding ObjectType}" Width="120"/>
                                <DataGridTextColumn Header="Publisher Domain" Binding="{Binding PublisherDomain}" Width="150"/>
                                <DataGridTextColumn Header="Sign-In Audience" Binding="{Binding SignInAudience}" Width="120"/>
                                <DataGridTextColumn Header="Created Date" Binding="{Binding CreatedDateTime}" Width="140"/>
                                <DataGridTextColumn Header="Required Resources" Binding="{Binding RequiredResourceAccessCount}" Width="100"/>
                            </DataGrid.Columns>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="Background" Value="#2D2D30"/>
                                    <Setter Property="Foreground" Value="White"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#3E3E42"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#007ACC"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <!-- Application Risk Assessment -->
                <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Risk Assessment Overview" Style="{StaticResource SectionHeaderStyle}"/>
                        <TextBlock Text="Application migration risk analysis and recommendations"
                                   Foreground="{DynamicResource SecondaryTextBrush}" FontSize="13" Margin="0,0,0,16"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Risk Chart Placeholder -->
                            <Border Grid.Column="0" Background="{DynamicResource CardBrush}" CornerRadius="8" Margin="0,0,8,0" Height="200">
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock Text="&#x1F4CA;" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                    <TextBlock Text="Risk Distribution Chart" FontSize="16" Foreground="{DynamicResource SecondaryTextBrush}" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Coming Soon" FontSize="12" Foreground="{DynamicResource AccentBrush}" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Border>

                            <!-- Recommendations -->
                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                <TextBlock Text="Top Recommendations" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,12"/>

                                <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="6" Padding="12" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="🔴 High Priority" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource ErrorBrush}"/>
                                        <TextBlock Text="Review legacy applications for cloud compatibility" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>

                                <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="6" Padding="12" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="🟡 Medium Priority" FontSize="12" FontWeight="Medium" Foreground="#FBB859"/>
                                        <TextBlock Text="Update application inventory with latest versions" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>

                                <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="6" Padding="12">
                                    <StackPanel>
                                        <TextBlock Text="🟢 Low Priority" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource SuccessBrush}"/>
                                        <TextBlock Text="Optimize application licensing for cost savings" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Application Dependencies -->
                <Border Style="{StaticResource ModernCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Application Dependencies" Style="{StaticResource SectionHeaderStyle}"/>
                        <TextBlock Text="Dependency mapping and migration impact analysis"
                                   Foreground="{DynamicResource SecondaryTextBrush}" FontSize="13" Margin="0,0,0,16"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Dependency Visualization Placeholder -->
                            <Border Grid.Column="0" Background="{DynamicResource CardBrush}" CornerRadius="8" Margin="0,0,8,0" Height="250">
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock Text="🕸️" FontSize="64" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                                    <TextBlock Text="Dependency Map" FontSize="18" Foreground="{DynamicResource SecondaryTextBrush}" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                    <TextBlock Text="Interactive dependency visualization" FontSize="12" Foreground="{DynamicResource AccentBrush}" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Border>

                            <!-- Dependency Stats -->
                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                <TextBlock Text="Dependency Statistics" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,16"/>

                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="Critical Dependencies" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <TextBlock x:Name="CriticalDepsCount" Text="0" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource ErrorBrush}"/>
                                </StackPanel>

                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="Circular Dependencies" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <TextBlock x:Name="CircularDepsCount" Text="0" FontSize="20" FontWeight="Bold" Foreground="#FBB859"/>
                                </StackPanel>

                                <StackPanel Margin="0,0,0,16">
                                    <TextBlock Text="Isolated Applications" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <TextBlock x:Name="IsolatedAppsCount" Text="0" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource SuccessBrush}"/>
                                </StackPanel>

                                <Button x:Name="AnalyzeDependenciesButton" Style="{StaticResource RoundedButtonStyle}"
                                        Background="{StaticResource AccentGradient}"
                                        Padding="16,8" HorizontalAlignment="Stretch"
                                        Command="{Binding AnalyzeDependenciesCommand}">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <TextBlock Text="&#x1F50D;" FontSize="14" Margin="0,0,6,0"/>
                                        <TextBlock Text="Analyze Dependencies"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Enhanced Progress Overlay -->
        <Grid x:Name="ProgressOverlay" Grid.ColumnSpan="2"
              Background="#DD000000" Visibility="Collapsed">
            <Border Background="{DynamicResource CardBrush}" BorderBrush="#2D3748" BorderThickness="1"
                    CornerRadius="12" Width="500" Height="280"
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border.Effect>
                    <DropShadowEffect Color="#000000" Direction="270" ShadowDepth="8" BlurRadius="24" Opacity="0.4"/>
                </Border.Effect>
                <Grid Margin="40">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" x:Name="ProgressTitle"
                               Text="Operation in Progress"
                               Foreground="#F7FAFC" FontSize="20" FontWeight="SemiBold"
                               HorizontalAlignment="Center" Margin="0,0,0,24"/>

                    <ProgressBar Grid.Row="1" x:Name="ProgressBar"
                                 Height="8" Margin="0,0,0,16"
                                 Background="{DynamicResource SurfaceBrush}" Foreground="{StaticResource PrimaryGradient}"
                                 BorderThickness="0"/>

                    <TextBlock Grid.Row="2" x:Name="ProgressStatus"
                               Text="Processing..."
                               Foreground="{DynamicResource SecondaryTextBrush}" FontSize="14" TextAlignment="Center"
                               Margin="0,0,0,24"/>

                    <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,16">
                        <TextBlock Text="⏱️" FontSize="16" Margin="0,0,8,0"/>
                        <TextBlock x:Name="ProgressTimer" Text="00:00" Foreground="{DynamicResource AccentBrush}" FontSize="14"/>
                    </StackPanel>

                    <Button Grid.Row="4" Content="Cancel Operation"
                            Command="{Binding CancelOperationCommand}"
                            Background="{StaticResource DangerGradient}" Foreground="White"
                            Padding="24,10" BorderThickness="0"
                            HorizontalAlignment="Center" Style="{StaticResource RoundedButtonStyle}"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>