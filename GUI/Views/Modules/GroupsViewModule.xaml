<UserControl x:Class="GUI.Views.Modules.GroupsViewModule"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:behaviors="clr-namespace:MandADiscoverySuite.Behaviors"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Style="{StaticResource SectionBorderStyle}" Margin="0,0,0,24">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Groups" Style="{StaticResource HeaderTextStyle}"/>
                        <TextBlock Text="Manage security groups, distribution lists, and group memberships" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="16"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Bottom">
                        <!-- Refresh Status Indicator -->
                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="8,6" Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ•’" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding RefreshService.ViewStatuses[Groups].LastRefreshText}"
                                           Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <!-- Progress Bar -->
                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="4" Margin="0,0,8,0"
                                Visibility="{Binding RefreshService.ViewStatuses[Groups].IsRefreshing, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ProgressBar Width="60" Height="16"
                                       Value="{Binding RefreshService.ViewStatuses[Groups].RefreshProgress}"
                                       Background="{DynamicResource CardBrush}" Foreground="{DynamicResource SuccessBrush}" BorderThickness="0"/>
                        </Border>
                        <!-- Refresh Button -->
                        <Button Content="ðŸ”„" ToolTip="Refresh Groups" Style="{StaticResource RoundedButtonStyle}"
                                Background="{StaticResource AccentGradient}" Command="{Binding RefreshGroupsCommand}"
                                Width="32" Height="32" Margin="0,0,8,0" FontSize="14"/>
                        <Button Content="ðŸ“¤ Export Groups" Style="{StaticResource RoundedButtonStyle}"
                                Background="{StaticResource AccentGradient}" Command="{Binding ExportGroupsCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Toolbar -->
            <Border Grid.Row="1" Style="{StaticResource SectionBorderStyle}" Padding="20" Margin="0,0,0,16">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBox x:Name="GroupSearchBox" Width="300" Height="36" Padding="12,8"
                             Style="{StaticResource ModernTextBoxStyle}"
                             FontSize="13" Text="{Binding GroupSearchText, UpdateSourceTrigger=PropertyChanged}"
                             behaviors:WatermarkBehavior.Watermark="Search groups..."/>
                    <Button Content="â˜‘ï¸ Select All" Style="{StaticResource RoundedButtonStyle}" Margin="12,0,0,0" Command="{Binding SelectAllGroupsCommand}"/>
                    <Button Content="â˜ Deselect All" Style="{StaticResource RoundedButtonStyle}" Margin="8,0,0,0" Command="{Binding DeselectAllGroupsCommand}"/>
                    <Button Content="ðŸ“¤ Export Selected" Style="{StaticResource RoundedButtonStyle}" Margin="8,0,0,0" Command="{Binding ExportSelectedGroupsCommand}"/>
                    <Button Content="ðŸ“‹ Copy Selected" Style="{StaticResource RoundedButtonStyle}" Margin="8,0,0,0" Command="{Binding CopySelectedGroupsCommand}"/>
                    <Button Content="ðŸ“‹ Copy All" Style="{StaticResource RoundedButtonStyle}" Margin="8,0,0,0" Command="{Binding CopyAllGroupsCommand}"/>
                    <Button Content="ðŸ‘ï¸ Columns" Style="{StaticResource RoundedButtonStyle}" Margin="8,0,0,0" Command="{Binding ShowColumnVisibilityCommand}" CommandParameter="groups"/>
                    <Button Content="&#x1F50D; Advanced Search" Style="{StaticResource RoundedButtonStyle}" Background="#4299E1" Margin="8,0,0,0" Command="{Binding ShowGroupsAdvancedSearchCommand}"/>
                    <Button Content="ðŸ—‘ï¸ Delete Selected" Style="{StaticResource RoundedButtonStyle}" Background="{StaticResource DangerGradient}" Margin="8,0,0,0" Command="{Binding DeleteSelectedGroupsCommand}"/>
                </StackPanel>
            </Border>

            <!-- Data Grid -->
            <Border Grid.Row="2" Style="{StaticResource SectionBorderStyle}" Padding="0" Margin="0,0,0,16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Loading Indicator for Groups -->
                    <Border Grid.Row="0" Background="{DynamicResource CardBrush}" Padding="10"
                            Visibility="{Binding IsGroupsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ”„" FontSize="16" Margin="0,0,10,0" RenderTransformOrigin="0.5,0.5">
                                <TextBlock.RenderTransform>
                                    <RotateTransform x:Name="GroupsLoadingRotation"/>
                                </TextBlock.RenderTransform>
                                <TextBlock.Triggers>
                                    <EventTrigger RoutedEvent="Loaded">
                                        <BeginStoryboard>
                                            <Storyboard RepeatBehavior="Forever">
                                                <DoubleAnimation Storyboard.TargetName="GroupsLoadingRotation"
                                                               Storyboard.TargetProperty="Angle"
                                                               From="0" To="360" Duration="0:0:2"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </TextBlock.Triggers>
                            </TextBlock>
                            <StackPanel>
                                <TextBlock Text="{Binding GroupsLoadingMessage}" Foreground="#67D391" FontWeight="Medium"/>
                                <ProgressBar Value="{Binding GroupsLoadingProgress}" Maximum="100" Width="200" Height="4"
                                           Background="#374151" Foreground="#10B981" Margin="0,5,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <DataGrid x:Name="GroupsDataGrid" Grid.Row="1" ItemsSource="{Binding Groups}" Style="{StaticResource ModernDataGridStyle}"
                              CanUserSortColumns="True" AutoGenerateColumns="False" SelectionMode="Extended"
                              VirtualizingStackPanel.IsVirtualizing="True"
                              EnableRowVirtualization="True"
                              EnableColumnVirtualization="True"
                              behaviors:ColumnVisibilityBehavior.GridName="Groups"
                              behaviors:VirtualizationBehavior.EnableVirtualization="True"
                              behaviors:VirtualizationBehavior.VirtualizationMode="Recycling"
                              behaviors:VirtualizationBehavior.ScrollUnit="Item"
                              behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                              behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="âœ“" Width="40" Binding="{Binding IsSelected, Mode=TwoWay}"/>
                            <DataGridTextColumn Header="Name" Binding="{Binding DisplayName}" Width="200" CanUserSort="True" SortMemberPath="DisplayName"/>
                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="250" CanUserSort="True" SortMemberPath="Description"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="120" CanUserSort="True" SortMemberPath="Type"/>
                            <DataGridTextColumn Header="Email" Binding="{Binding Mail}" Width="200" CanUserSort="True" SortMemberPath="Mail"/>
                            <DataGridTextColumn Header="Members" Binding="{Binding MemberCount}" Width="80" CanUserSort="True" SortMemberPath="MemberCount"/>
                            <DataGridTextColumn Header="Owners" Binding="{Binding OwnerCount}" Width="80" CanUserSort="True" SortMemberPath="OwnerCount"/>
                            <DataGridTextColumn Header="Created" Binding="{Binding CreatedDateTime}" Width="140" CanUserSort="True" SortMemberPath="CreatedDateTime"/>
                            <DataGridTextColumn Header="Visibility" Binding="{Binding Visibility}" Width="100" CanUserSort="True" SortMemberPath="Visibility"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <!-- Pagination -->
            <Border Grid.Row="3" Style="{StaticResource SectionBorderStyle}" Padding="20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Items Info -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="&#x1F4CA;" FontSize="16" Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding GroupPageInfo}"
                                   FontSize="14" Foreground="{DynamicResource SecondaryTextBrush}" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Navigation Controls -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                        <!-- First Page Button -->
                        <Button Content="â®ï¸"
                                Command="{Binding FirstGroupPageCommand}"
                                IsEnabled="{Binding HasPreviousGroupPage}"
                                Style="{StaticResource RoundedButtonStyle}"
                                Width="32" Height="32"
                                ToolTip="First Page"
                                FontSize="14"/>

                        <!-- Previous Page Button -->
                        <Button Content="â—€ï¸"
                                Command="{Binding PreviousGroupPageCommand}"
                                IsEnabled="{Binding HasPreviousGroupPage}"
                                Style="{StaticResource RoundedButtonStyle}"
                                Width="32" Height="32"
                                ToolTip="Previous Page"
                                FontSize="14" Margin="4,0"/>

                        <!-- Page Info -->
                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="6" Padding="12,6" Margin="8,0">
                            <TextBlock FontSize="14" Foreground="{DynamicResource SecondaryTextBrush}" VerticalAlignment="Center">
                                <Run Text="Page"/>
                                <Run Text="{Binding CurrentGroupPage, Mode=OneWay}"/>
                                <Run Text="of"/>
                                <Run Text="{Binding TotalGroupPages, Mode=OneWay}"/>
                            </TextBlock>
                        </Border>

                        <!-- Next Page Button -->
                        <Button Content="â–¶ï¸"
                                Command="{Binding NextGroupPageCommand}"
                                IsEnabled="{Binding HasNextGroupPage}"
                                Style="{StaticResource RoundedButtonStyle}"
                                Width="32" Height="32"
                                ToolTip="Next Page"
                                FontSize="14" Margin="4,0"/>

                        <!-- Last Page Button -->
                        <Button Content="â­ï¸"
                                Command="{Binding LastGroupPageCommand}"
                                IsEnabled="{Binding HasNextGroupPage}"
                                Style="{StaticResource RoundedButtonStyle}"
                                Width="32" Height="32"
                                ToolTip="Last Page"
                                FontSize="14"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>