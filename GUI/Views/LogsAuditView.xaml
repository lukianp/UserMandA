<UserControl x:Class="MandADiscoverySuite.Views.LogsAuditView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:MandADiscoverySuite.Converters"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/MandADiscoverySuite;component/Resources/Converters.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- Converters -->
            <converters:LogLevelToBrushConverter x:Key="LogLevelToBrushConverter"/>
        
        <!-- Log Level Brushes -->
        <SolidColorBrush x:Key="CriticalBrush" Color="#DC2626"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#EF4444"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#F59E0B"/>
        <SolidColorBrush x:Key="InfoBrush" Color="#3B82F6"/>
        <SolidColorBrush x:Key="DebugBrush" Color="#6B7280"/>
        <SolidColorBrush x:Key="TraceBrush" Color="#9CA3AF"/>
        
        <!-- Data Template for Log Entries -->
        <DataTemplate x:Key="LogAuditEntryTemplate">
            <Border Padding="8,4" Margin="0,1" 
                    Background="{DynamicResource SurfaceBrush}"
                    BorderBrush="{DynamicResource BorderBrush}" 
                    BorderThickness="0,0,0,1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="140"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" 
                               Text="{Binding FormattedTimestamp}"
                               FontFamily="Consolas"
                               FontSize="11"
                               Foreground="{DynamicResource MutedForegroundBrush}"/>
                    
                    <Border Grid.Column="1" 
                            Background="{Binding Level, Converter={StaticResource LogLevelToBrushConverter}}"
                            CornerRadius="3" Padding="4,2" Margin="2,0">
                        <TextBlock Text="{Binding LevelString}"
                                   FontSize="10"
                                   FontWeight="Bold"
                                   Foreground="White"
                                   HorizontalAlignment="Center"/>
                    </Border>
                    
                    <TextBlock Grid.Column="2"
                               Text="{Binding CategoryString}"
                               FontSize="11"
                               Foreground="{DynamicResource AccentBrush}"/>
                    
                    <TextBlock Grid.Column="3"
                               Text="{Binding Source}"
                               FontSize="11"
                               FontWeight="Medium"
                               Foreground="{DynamicResource ForegroundBrush}"/>
                    
                    <TextBlock Grid.Column="4"
                               Text="{Binding Message}"
                               FontSize="11"
                               TextWrapping="NoWrap"
                               TextTrimming="CharacterEllipsis"
                               Foreground="{DynamicResource ForegroundBrush}"/>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- Style for Filter CheckBoxes -->
        <Style x:Key="FilterCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
        </Style>

        <!-- Style for Filter Buttons -->
        <Style x:Key="FilterButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Background="{DynamicResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{DynamicResource SurfaceBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="0,0,0,1" 
                Padding="16,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Vertical">
                    <TextBlock Text="Logs &amp; Audit" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               Foreground="{DynamicResource ForegroundBrush}"/>
                    <TextBlock Text="View and analyze application logs from all sources" 
                               FontSize="12" 
                               Foreground="{DynamicResource MutedForegroundBrush}" 
                               Margin="0,2,0,0"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Refresh" 
                            Command="{Binding RefreshLogsCommand}"
                            Style="{StaticResource FilterButtonStyle}"
                            Margin="4,0"/>
                    <Button Content="Clear Filters" 
                            Command="{Binding ClearFiltersCommand}"
                            Style="{StaticResource FilterButtonStyle}"
                            Margin="4,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Search and Filters -->
        <Expander Grid.Row="1" 
                  Header="Search &amp; Filters" 
                  IsExpanded="True"
                  Background="{DynamicResource SurfaceBrush}"
                  BorderBrush="{DynamicResource BorderBrush}"
                  BorderThickness="0,0,0,1">
            <Grid Margin="16,8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Search -->
                <StackPanel Grid.Row="0" Grid.ColumnSpan="3" Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="Search:" 
                               VerticalAlignment="Center" 
                               Margin="0,0,8,0"
                               Foreground="{DynamicResource ForegroundBrush}"/>
                    <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                             Width="300" 
                             Padding="8,4"
                             Background="{DynamicResource SurfaceBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"
                             Foreground="{DynamicResource ForegroundBrush}"
                             Margin="0,0,16,0"/>
                    
                    <TextBlock Text="Source:" 
                               VerticalAlignment="Center" 
                               Margin="0,0,8,0"
                               Foreground="{DynamicResource ForegroundBrush}"/>
                    <TextBox Text="{Binding SourceFilter, UpdateSourceTrigger=PropertyChanged}" 
                             Width="200" 
                             Padding="8,4"
                             Background="{DynamicResource SurfaceBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"
                             Foreground="{DynamicResource ForegroundBrush}"/>
                </StackPanel>

                <!-- Categories -->
                <GroupBox Grid.Row="1" Grid.Column="0" 
                          Header="Categories" 
                          Margin="0,0,8,8"
                          Background="{DynamicResource BackgroundBrush}"
                          BorderBrush="{DynamicResource BorderBrush}"
                          Foreground="{DynamicResource ForegroundBrush}">
                    <StackPanel>
                        <CheckBox Content="Build Logs" 
                                  IsChecked="{Binding ShowBuildLogs}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                        <CheckBox Content="Runtime Logs" 
                                  IsChecked="{Binding ShowRuntimeLogs}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                        <CheckBox Content="Module Logs" 
                                  IsChecked="{Binding ShowModuleLogs}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                        <CheckBox Content="Migration Logs" 
                                  IsChecked="{Binding ShowMigrationLogs}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                    </StackPanel>
                </GroupBox>

                <!-- Log Levels -->
                <GroupBox Grid.Row="1" Grid.Column="1" 
                          Header="Log Levels" 
                          Margin="0,0,8,8"
                          Background="{DynamicResource BackgroundBrush}"
                          BorderBrush="{DynamicResource BorderBrush}"
                          Foreground="{DynamicResource ForegroundBrush}">
                    <StackPanel>
                        <CheckBox Content="Critical" 
                                  IsChecked="{Binding ShowCriticalLevel}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                        <CheckBox Content="Error" 
                                  IsChecked="{Binding ShowErrorLevel}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                        <CheckBox Content="Warning" 
                                  IsChecked="{Binding ShowWarningLevel}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                        <CheckBox Content="Information" 
                                  IsChecked="{Binding ShowInfoLevel}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                        <CheckBox Content="Debug" 
                                  IsChecked="{Binding ShowDebugLevel}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                        <CheckBox Content="Trace" 
                                  IsChecked="{Binding ShowTraceLevel}" 
                                  Style="{StaticResource FilterCheckBoxStyle}"/>
                    </StackPanel>
                </GroupBox>

                <!-- Date Filters -->
                <GroupBox Grid.Row="1" Grid.Column="2" 
                          Header="Date Range" 
                          Margin="0,0,0,8"
                          Background="{DynamicResource BackgroundBrush}"
                          BorderBrush="{DynamicResource BorderBrush}"
                          Foreground="{DynamicResource ForegroundBrush}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="4">
                            <TextBlock Text="From:" Width="40" VerticalAlignment="Center"
                                       Foreground="{DynamicResource ForegroundBrush}"/>
                            <DatePicker SelectedDate="{Binding FilterStartDate}" Width="120"
                                        Background="{DynamicResource SurfaceBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="4">
                            <TextBlock Text="To:" Width="40" VerticalAlignment="Center"
                                       Foreground="{DynamicResource ForegroundBrush}"/>
                            <DatePicker SelectedDate="{Binding FilterEndDate}" Width="120"
                                        Background="{DynamicResource SurfaceBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Quick Date Filters -->
                <StackPanel Grid.Row="2" Grid.ColumnSpan="3" 
                            Orientation="Horizontal" 
                            Margin="0,8,0,0">
                    <TextBlock Text="Quick filters:" 
                               VerticalAlignment="Center" 
                               Margin="0,0,8,0"
                               Foreground="{DynamicResource ForegroundBrush}"/>
                    <Button Content="Last Hour" 
                            Command="{Binding SetLastHourFilterCommand}"
                            Style="{StaticResource FilterButtonStyle}"/>
                    <Button Content="Last 24h" 
                            Command="{Binding SetLast24HoursFilterCommand}"
                            Style="{StaticResource FilterButtonStyle}"/>
                    <Button Content="Today" 
                            Command="{Binding SetTodayFilterCommand}"
                            Style="{StaticResource FilterButtonStyle}"/>
                    <Button Content="Last Week" 
                            Command="{Binding SetLastWeekFilterCommand}"
                            Style="{StaticResource FilterButtonStyle}"/>
                </StackPanel>
            </Grid>
        </Expander>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Logs DataGrid -->
            <Border Grid.Column="0" 
                    BorderBrush="{DynamicResource BorderBrush}" 
                    BorderThickness="1"
                    Margin="8">
                <Grid>
                    <DataGrid ItemsSource="{Binding FilteredLogs}"
                              SelectedItem="{Binding SelectedLogEntry}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              GridLinesVisibility="None"
                              Background="{DynamicResource BackgroundBrush}"
                              RowBackground="{DynamicResource BackgroundBrush}"
                              AlternatingRowBackground="{DynamicResource SurfaceBrush}"
                              HeadersVisibility="Column"
                              SelectionMode="Single"
                              CanUserReorderColumns="True"
                              CanUserResizeColumns="True"
                              CanUserSortColumns="True"
                              VirtualizingPanel.IsVirtualizing="True"
                              VirtualizingPanel.VirtualizationMode="Recycling"
                              ScrollViewer.CanContentScroll="True">
                        
                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
                                <Setter Property="Padding" Value="8,4"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>

                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Padding" Value="8,4"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.CellStyle>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Timestamp" 
                                                Binding="{Binding FormattedTimestamp}"
                                                Width="140"
                                                FontFamily="Consolas"/>
                            
                            <DataGridTemplateColumn Header="Level" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding Level, Converter={StaticResource LogLevelToBrushConverter}}"
                                                CornerRadius="3" Padding="4,2">
                                            <TextBlock Text="{Binding LevelString}"
                                                       FontSize="10"
                                                       FontWeight="Bold"
                                                       Foreground="White"
                                                       HorizontalAlignment="Center"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <DataGridTextColumn Header="Category" 
                                                Binding="{Binding CategoryString}"
                                                Width="100"/>
                            
                            <DataGridTextColumn Header="Source" 
                                                Binding="{Binding Source}"
                                                Width="150"/>
                            
                            <DataGridTextColumn Header="Message" 
                                                Binding="{Binding Message}"
                                                Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextWrapping" Value="NoWrap"/>
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                        <Setter Property="ToolTip" Value="{Binding Message}"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>

                        <DataGrid.ContextMenu>
                            <ContextMenu Background="{DynamicResource SurfaceBrush}"
                                         BorderBrush="{DynamicResource BorderBrush}">
                                <MenuItem Header="Copy Message" 
                                          Command="{Binding CopyToClipboardCommand}"
                                          Foreground="{DynamicResource ForegroundBrush}"/>
                                <MenuItem Header="Show Details" 
                                          Command="{Binding ShowLogDetailsCommand}"
                                          CommandParameter="{Binding SelectedLogEntry}"
                                          Foreground="{DynamicResource ForegroundBrush}"/>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                    </DataGrid>

                    <!-- Loading Overlay -->
                    <Border Background="{DynamicResource OverlayBrush}"
                            Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel HorizontalAlignment="Center" 
                                    VerticalAlignment="Center">
                            <ProgressBar IsIndeterminate="True" 
                                         Width="100" 
                                         Height="20" 
                                         Margin="0,0,0,16"/>
                            <TextBlock Text="Loading logs..." 
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource ForegroundBrush}"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Action Panel -->
            <Border Grid.Column="1" 
                    Background="{DynamicResource SurfaceBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1,1,1,1"
                    Width="200"
                    Margin="0,8,8,8">
                <StackPanel Margin="8">
                    <TextBlock Text="Actions" 
                               FontWeight="Bold" 
                               FontSize="14" 
                               Margin="0,0,0,8"
                               Foreground="{DynamicResource ForegroundBrush}"/>
                    
                    <Button Content="Export Selected" 
                            Command="{Binding ExportSelectedCommand}"
                            Style="{StaticResource FilterButtonStyle}"
                            HorizontalAlignment="Stretch"
                            Margin="0,0,0,4"/>
                    
                    <Button Content="Export Filtered" 
                            Command="{Binding ExportFilteredCommand}"
                            Style="{StaticResource FilterButtonStyle}"
                            HorizontalAlignment="Stretch"
                            Margin="0,0,0,4"/>
                    
                    <Button Content="Export All" 
                            Command="{Binding ExportAllCommand}"
                            Style="{StaticResource FilterButtonStyle}"
                            HorizontalAlignment="Stretch"
                            Margin="0,0,0,4"/>
                    
                    <Separator Margin="0,8" Background="{DynamicResource BorderBrush}"/>
                    
                    <TextBlock Text="Statistics" 
                               FontWeight="Bold" 
                               FontSize="12" 
                               Margin="0,0,0,4"
                               Foreground="{DynamicResource ForegroundBrush}"/>
                    
                    <TextBlock Foreground="{DynamicResource MutedForegroundBrush}" FontSize="11">
                        <Run Text="Total Logs: "/>
                        <Run Text="{Binding TotalLogsCount}" FontWeight="Bold"/>
                    </TextBlock>
                    
                    <TextBlock Foreground="{DynamicResource MutedForegroundBrush}" FontSize="11">
                        <Run Text="Filtered: "/>
                        <Run Text="{Binding FilteredLogsCount}" FontWeight="Bold"/>
                    </TextBlock>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" 
                Background="{DynamicResource SurfaceBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="0,1,0,0" 
                Padding="16,4">
            <TextBlock Text="{Binding StatusMessage}" 
                       FontSize="11" 
                       Foreground="{DynamicResource MutedForegroundBrush}"/>
        </Border>
    </Grid>
</UserControl>