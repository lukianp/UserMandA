<UserControl x:Class="MandADiscoverySuite.Views.GanttView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.Resources>
        <!-- Merged Resources -->
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/Converters.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- Task Bar Styles -->
            <Style x:Key="TaskBar" TargetType="Rectangle">
                <Setter Property="Height" Value="20"/>
                <Setter Property="RadiusX" Value="2"/>
                <Setter Property="RadiusY" Value="2"/>
                <Setter Property="Stroke" Value="#FF334155"/>
                <Setter Property="StrokeThickness" Value="1"/>
            </Style>

            <Style x:Key="CriticalTaskBar" TargetType="Rectangle" BasedOn="{StaticResource TaskBar}">
                <Setter Property="Fill" Value="#FFEF4444"/>
                <Setter Property="Stroke" Value="#FFDC2626"/>
                <Setter Property="StrokeThickness" Value="2"/>
            </Style>

            <!-- Task Status Colors -->
            <SolidColorBrush x:Key="NotStartedBrush" Color="#FF6B7280"/>
            <SolidColorBrush x:Key="InProgressBrush" Color="#FF3B82F6"/>
            <SolidColorBrush x:Key="CompletedBrush" Color="#FF10B981"/>
            <SolidColorBrush x:Key="AtRiskBrush" Color="#FFF59E0B"/>
            <SolidColorBrush x:Key="BlockedBrush" Color="#FFEF4444"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Background="#FF0F172A">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" 
                       Text="Project Gantt Chart" 
                       FontSize="24" 
                       FontWeight="Bold" 
                       Foreground="White"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Border Background="#FFEF4444" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                    <TextBlock Text="Critical Path" Foreground="White" FontSize="12" FontWeight="Bold"/>
                </Border>
                <TextBlock Text="{Binding TimelineDays, StringFormat='Timeline: {0} days'}" 
                           Foreground="#FF94A3B8" 
                           FontSize="14" 
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Timeline Header -->
        <Border Grid.Row="1" Background="#FF1E293B" BorderBrush="#FF334155" BorderThickness="0,1">
            <ScrollViewer x:Name="HeaderScrollViewer" 
                          HorizontalScrollBarVisibility="Hidden" 
                          VerticalScrollBarVisibility="Disabled"
                          Margin="300,0,0,0">
                <Canvas Height="40" Width="{Binding ElementName=TimelineCanvas, Path=ActualWidth}">
                    <!-- Timeline Header will be populated dynamically -->
                    <ItemsControl x:Name="TimelineHeader">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </Canvas>
            </ScrollViewer>
        </Border>

        <!-- Main Gantt Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Task List (Left Panel) -->
            <Border Grid.Column="0" Background="#FF1E293B" BorderBrush="#FF334155" BorderThickness="0,0,1,0">
                <ScrollViewer x:Name="TaskListScrollViewer" 
                              VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled"
                              ScrollChanged="TaskListScrollViewer_ScrollChanged">
                    <ItemsControl ItemsSource="{Binding FlattenedTasks}" Margin="8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#FF334155" 
                                        CornerRadius="4" 
                                        Margin="0,0,0,2" 
                                        Padding="12,8"
                                        Height="32">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" 
                                                       Foreground="{Binding IsCriticalPath, Converter={StaticResource BoolToColorConverter}}" 
                                                       FontWeight="{Binding IsCriticalPath, Converter={StaticResource BoolToFontWeightConverter}}"
                                                       FontSize="12" 
                                                       TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                                            <TextBlock Text="{Binding Owner}" 
                                                       Foreground="#FF94A3B8" 
                                                       FontSize="10" 
                                                       Margin="0,0,8,0"/>
                                            <Border Background="{Binding StatusColor}" 
                                                    CornerRadius="8" 
                                                    Padding="4,2">
                                                <TextBlock Text="{Binding Status}" 
                                                           Foreground="White" 
                                                           FontSize="9"/>
                                            </Border>
                                        </StackPanel>
                                    </Grid>

                                    <Border.ToolTip>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                            <TextBlock Text="{Binding Description}"/>
                                            <TextBlock Text="{Binding Owner, StringFormat='Owner: {0}'}"/>
                                            <TextBlock Text="{Binding StartDate, StringFormat='Start: {0:MMM dd, yyyy}'}"/>
                                            <TextBlock Text="{Binding EndDate, StringFormat='End: {0:MMM dd, yyyy}'}"/>
                                            <TextBlock Text="{Binding Progress, StringFormat='Progress: {0:F0}%'}"/>
                                        </StackPanel>
                                    </Border.ToolTip>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- Timeline Area (Right Panel) -->
            <ScrollViewer Grid.Column="1" 
                          x:Name="TimelineScrollViewer"
                          HorizontalScrollBarVisibility="Auto" 
                          VerticalScrollBarVisibility="Auto"
                          ScrollChanged="TimelineScrollViewer_ScrollChanged">
                <Canvas x:Name="TimelineCanvas" 
                        Background="#FF0F172A" 
                        Height="{Binding FlattenedTasks.Count, Converter={StaticResource TaskCountToHeightConverter}}"
                        Width="2000"
                        MinWidth="800">

                    <!-- Grid Lines -->
                    <Rectangle Fill="#FF334155" Width="1" Height="{Binding ElementName=TimelineCanvas, Path=Height}" 
                               Canvas.Left="0" Opacity="0.3"/>

                    <!-- Task Bars -->
                    <ItemsControl ItemsSource="{Binding FlattenedTasks}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Rectangle Width="{Binding Width}" 
                                           Height="20"
                                           Fill="{Binding Fill}"
                                           Stroke="{Binding Stroke}"
                                           StrokeThickness="{Binding StrokeThickness}"
                                           RadiusX="2"
                                           RadiusY="2">
                                    
                                    <!-- Position calculated in code-behind or converter -->
                                    <Rectangle.RenderTransform>
                                        <TranslateTransform X="{Binding LeftPosition}" Y="{Binding TopPosition}"/>
                                    </Rectangle.RenderTransform>

                                    <Rectangle.ToolTip>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                            <TextBlock Text="{Binding Description}"/>
                                            <TextBlock Text="{Binding StartDate, StringFormat='Start: {0:MMM dd, yyyy}'}"/>
                                            <TextBlock Text="{Binding EndDate, StringFormat='End: {0:MMM dd, yyyy}'}"/>
                                            <TextBlock Text="{Binding Duration, StringFormat='Duration: {0} days'}"/>
                                            <TextBlock Text="{Binding IsCriticalPath, StringFormat='Critical Path: {0}'}"/>
                                        </StackPanel>
                                    </Rectangle.ToolTip>
                                </Rectangle>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- Dependency Lines (simplified representation) -->
                    <!-- This would typically be generated in code-behind based on task dependencies -->
                    
                </Canvas>
            </ScrollViewer>
        </Grid>
    </Grid>
</UserControl>