<UserControl x:Class="MandADiscoverySuite.Views.MigrationExecutionView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:controls="clr-namespace:MandADiscoverySuite.Controls"
             mc:Ignorable="d" 
             d:DesignHeight="1000" d:DesignWidth="1600">

    <UserControl.Resources>
        <!-- Material Design Color Palette -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="#2196F3"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#FF4081"/>
        <SolidColorBrush x:Key="SurfaceBrush" Color="#FAFAFA"/>
        <SolidColorBrush x:Key="CardBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#212121"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#757575"/>
        <SolidColorBrush x:Key="DividerBrush" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#F44336"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#4CAF50"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#FF9800"/>

        <!-- Card Style -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Opacity="0.1" ShadowDepth="2" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Header Style -->
        <Style x:Key="HeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>

        <!-- Subheader Style -->
        <Style x:Key="SubHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <!-- Primary Button Style -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1976D2"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#1565C0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Success Button Style -->
        <Style x:Key="SuccessButtonStyle" TargetType="Button" BasedOn="{StaticResource PrimaryButtonStyle}">
            <Setter Property="Background" Value="{StaticResource SuccessBrush}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#388E3C"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#2E7D32"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Warning Button Style -->
        <Style x:Key="WarningButtonStyle" TargetType="Button" BasedOn="{StaticResource PrimaryButtonStyle}">
            <Setter Property="Background" Value="{StaticResource WarningBrush}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F57C00"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#EF6C00"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Error Button Style -->
        <Style x:Key="ErrorButtonStyle" TargetType="Button" BasedOn="{StaticResource PrimaryButtonStyle}">
            <Setter Property="Background" Value="{StaticResource ErrorBrush}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#D32F2F"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#C62828"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Status Indicator Style -->
        <Style x:Key="StatusIndicatorStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="8"/>
            <Setter Property="Height" Value="8"/>
            <Setter Property="Margin" Value="4"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="NotStarted">
                    <Setter Property="Fill" Value="{StaticResource TextSecondaryBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="InProgress">
                    <Setter Property="Fill" Value="{StaticResource PrimaryBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Completed">
                    <Setter Property="Fill" Value="{StaticResource SuccessBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Failed">
                    <Setter Property="Fill" Value="{StaticResource ErrorBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Skipped">
                    <Setter Property="Fill" Value="{StaticResource WarningBrush}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Check Status Style -->
        <Style x:Key="CheckStatusStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="8"/>
            <Setter Property="Height" Value="8"/>
            <Setter Property="Margin" Value="4"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Pending">
                    <Setter Property="Fill" Value="{StaticResource TextSecondaryBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Running">
                    <Setter Property="Fill" Value="{StaticResource PrimaryBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Passed">
                    <Setter Property="Fill" Value="{StaticResource SuccessBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Warning">
                    <Setter Property="Fill" Value="{StaticResource WarningBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Failed">
                    <Setter Property="Fill" Value="{StaticResource ErrorBrush}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Log Level Style -->
        <Style x:Key="LogLevelStyle" TargetType="TextBlock">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Level}" Value="Information">
                    <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Level}" Value="Warning">
                    <Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Level}" Value="Error">
                    <Setter Property="Foreground" Value="{StaticResource ErrorBrush}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Background="{StaticResource SurfaceBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource CardBrush}" Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Migration Execution" Style="{StaticResource HeaderStyle}"/>
                    <TextBlock Text="Execute migrations with pre-flight validation and live monitoring" 
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <ComboBox ItemsSource="{Binding AvailableProfiles}"
                              SelectedItem="{Binding SelectedProfile}"
                              Width="200" Margin="0,0,8,0"/>
                    <Button Content="Refresh Status" Style="{StaticResource PrimaryButtonStyle}" 
                            Command="{Binding RefreshStatusCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Execution Status Bar -->
        <Border Grid.Row="1" Background="{StaticResource CardBrush}" Padding="24,12" 
                Visibility="{Binding HasData, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status Info -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="{Binding CurrentExecutionPhase}" FontWeight="Medium" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding ExecutionElapsed, StringFormat='Elapsed: {0:hh\\:mm\\:ss}'}" 
                               Margin="16,0,0,0" VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}"/>
                    <TextBlock Text="{Binding EstimatedTimeRemaining, StringFormat='ETA: {0:hh\\:mm\\:ss}'}" 
                               Margin="16,0,0,0" VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>

                <!-- Progress Bar -->
                <ProgressBar Grid.Column="1" Width="200" Height="8" Margin="16,0"
                             Value="{Binding OverallProgressPercentage}" Maximum="100" VerticalAlignment="Center"/>

                <!-- Progress Text -->
                <TextBlock Grid.Column="2" Text="{Binding OverallProgressPercentage, StringFormat={}{0:F1}%}" 
                           VerticalAlignment="Center" Margin="8,0"/>

                <!-- Execution Controls -->
                <StackPanel Grid.Column="3" Orientation="Horizontal">
                    <Button Content="Start" Style="{StaticResource SuccessButtonStyle}" 
                            Command="{Binding StartMigrationCommand}"
                            IsEnabled="{Binding IsExecutionRunning, Converter={StaticResource InvertBooleanConverter}}"/>
                    <Button Content="Pause" Style="{StaticResource WarningButtonStyle}" 
                            Command="{Binding PauseMigrationCommand}"
                            IsEnabled="{Binding IsExecutionRunning}"/>
                    <Button Content="Stop" Style="{StaticResource ErrorButtonStyle}" 
                            Command="{Binding StopMigrationCommand}"
                            IsEnabled="{Binding IsExecutionRunning}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Tabs -->
        <TabControl Grid.Row="2" Margin="0" TabStripPlacement="Top">
            <!-- Pre-flight Validation Tab -->
            <TabItem Header="Pre-flight Validation">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Pre-flight Controls -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Pre-flight Validation" Style="{StaticResource SubHeaderStyle}"/>
                                <TextBlock Text="{Binding PreFlightStatus}" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <Button Grid.Column="1" Content="Run Validation" Style="{StaticResource PrimaryButtonStyle}"
                                    Command="{Binding RunPreFlightValidationCommand}"
                                    IsEnabled="{Binding IsRunningPreFlight, Converter={StaticResource InvertBooleanConverter}}"/>
                        </Grid>
                    </Border>

                    <!-- Pre-flight Statistics -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding TotalChecks}" FontSize="24" FontWeight="Bold" 
                                           Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Total Checks" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding PassedChecks}" FontSize="24" FontWeight="Bold" 
                                           Foreground="{StaticResource SuccessBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Passed" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding WarningChecks}" FontSize="24" FontWeight="Bold" 
                                           Foreground="{StaticResource WarningBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Warnings" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding FailedChecks}" FontSize="24" FontWeight="Bold" 
                                           Foreground="{StaticResource ErrorBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Failed" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                <Ellipse Fill="{StaticResource SuccessBrush}" Width="24" Height="24" 
                                         Visibility="{Binding PreFlightPassed, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                <Ellipse Fill="{StaticResource ErrorBrush}" Width="24" Height="24" 
                                         Visibility="{Binding PreFlightPassed, Converter={StaticResource InvertedBooleanToVisibilityConverter}}"/>
                                <TextBlock Text="Overall" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Pre-flight Checks Grid -->
                    <Border Grid.Row="2" Style="{StaticResource CardStyle}">
                        <DataGrid ItemsSource="{Binding PreFlightChecks}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  BorderThickness="0">
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="Status" Width="60">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Ellipse Style="{StaticResource CheckStatusStyle}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Check Name" Binding="{Binding Name}" Width="200"/>
                                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="100"/>
                                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                                <DataGridCheckBoxColumn Header="Required" Binding="{Binding IsRequired}" Width="80"/>
                                <DataGridTextColumn Header="Duration" Binding="{Binding Duration}" Width="100"/>
                                <DataGridTextColumn Header="Result" Binding="{Binding ResultMessage}" Width="200"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Live Execution Monitor Tab -->
            <TabItem Header="Live Monitor">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Execution Statistics -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <UniformGrid Columns="5">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="{Binding TotalItemsToMigrate}" FontSize="24" FontWeight="Bold" 
                                           Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Total Items" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="{Binding ItemsCompleted}" FontSize="24" FontWeight="Bold" 
                                           Foreground="{StaticResource SuccessBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Completed" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="{Binding ItemsInProgress}" FontSize="24" FontWeight="Bold" 
                                           Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="In Progress" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="{Binding ItemsFailed}" FontSize="24" FontWeight="Bold" 
                                           Foreground="{StaticResource ErrorBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Failed" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="{Binding ItemsSkipped}" FontSize="24" FontWeight="Bold" 
                                           Foreground="{StaticResource WarningBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Skipped" HorizontalAlignment="Center" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>
                        </UniformGrid>
                    </Border>

                    <!-- Filter and Actions -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="0,0,8,0"/>

                            <ComboBox Grid.Column="1" ItemsSource="{Binding MigrationTypes}"
                                      SelectedItem="{Binding SelectedTypeFilter}"
                                      Width="120" Margin="0,0,8,0"/>

                            <ComboBox Grid.Column="2" ItemsSource="{Binding MigrationStatuses}"
                                      SelectedItem="{Binding SelectedStatusFilter}"
                                      Width="100" Margin="0,0,8,0"/>

                            <StackPanel Grid.Column="3" Orientation="Horizontal">
                                <Button Content="Retry Failed" Style="{StaticResource WarningButtonStyle}"
                                        Command="{Binding RetryFailedItemsCommand}"/>
                                <Button Content="Skip Failed" Style="{StaticResource ErrorButtonStyle}"
                                        Command="{Binding SkipFailedItemsCommand}"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Execution Items Grid -->
                    <Border Grid.Row="2" Style="{StaticResource CardStyle}">
                        <DataGrid ItemsSource="{Binding ExecutionItemsView}"
                                  SelectedItem="{Binding SelectedExecutionItem}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  BorderThickness="0">
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="Status" Width="60">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Ellipse Style="{StaticResource StatusIndicatorStyle}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100"/>
                                <DataGridTextColumn Header="Display Name" Binding="{Binding DisplayName}" Width="*"/>
                                <DataGridTextColumn Header="Source" Binding="{Binding SourceIdentity}" Width="200"/>
                                <DataGridTextColumn Header="Target" Binding="{Binding TargetIdentity}" Width="200"/>
                                <DataGridTemplateColumn Header="Progress" Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <ProgressBar Value="{Binding Progress}" Maximum="100" Height="4"/>
                                                <TextBlock Text="{Binding Progress, StringFormat={}{0}%}" 
                                                           HorizontalAlignment="Center" FontSize="10"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="80"/>
                                <DataGridTextColumn Header="Duration" Binding="{Binding ActualDuration}" Width="100"/>
                                <DataGridTextColumn Header="Error" Binding="{Binding ErrorMessage}" Width="150"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Progress by Type Tab -->
            <TabItem Header="Progress by Type">
                <ScrollViewer Margin="16" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- User Migration Progress -->
                        <Border Style="{StaticResource CardStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="User Migration" Style="{StaticResource SubHeaderStyle}"/>
                                    <ProgressBar Value="{Binding UserMigrationProgress.PercentageComplete}" Maximum="100" Height="8" Margin="0,8"/>
                                    <TextBlock Text="{Binding UserMigrationProgress.PercentageComplete, StringFormat={}{0:F1}% Complete}" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding UserMigrationProgress.Completed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Completed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding UserMigrationProgress.Failed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Failed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding UserMigrationProgress.Total}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Total" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Group Migration Progress -->
                        <Border Style="{StaticResource CardStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Group Migration" Style="{StaticResource SubHeaderStyle}"/>
                                    <ProgressBar Value="{Binding GroupMigrationProgress.PercentageComplete}" Maximum="100" Height="8" Margin="0,8"/>
                                    <TextBlock Text="{Binding GroupMigrationProgress.PercentageComplete, StringFormat={}{0:F1}% Complete}" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding GroupMigrationProgress.Completed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Completed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding GroupMigrationProgress.Failed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Failed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding GroupMigrationProgress.Total}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Total" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Mailbox Migration Progress -->
                        <Border Style="{StaticResource CardStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Mailbox Migration" Style="{StaticResource SubHeaderStyle}"/>
                                    <ProgressBar Value="{Binding MailboxMigrationProgress.PercentageComplete}" Maximum="100" Height="8" Margin="0,8"/>
                                    <TextBlock Text="{Binding MailboxMigrationProgress.PercentageComplete, StringFormat={}{0:F1}% Complete}" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding MailboxMigrationProgress.Completed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Completed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding MailboxMigrationProgress.Failed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Failed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding MailboxMigrationProgress.Total}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Total" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- File System Migration Progress -->
                        <Border Style="{StaticResource CardStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="File System Migration" Style="{StaticResource SubHeaderStyle}"/>
                                    <ProgressBar Value="{Binding FileSystemMigrationProgress.PercentageComplete}" Maximum="100" Height="8" Margin="0,8"/>
                                    <TextBlock Text="{Binding FileSystemMigrationProgress.PercentageComplete, StringFormat={}{0:F1}% Complete}" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding FileSystemMigrationProgress.Completed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Completed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding FileSystemMigrationProgress.Failed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Failed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding FileSystemMigrationProgress.Total}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Total" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- VM Migration Progress -->
                        <Border Style="{StaticResource CardStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Virtual Machine Migration" Style="{StaticResource SubHeaderStyle}"/>
                                    <ProgressBar Value="{Binding VMigrationProgress.PercentageComplete}" Maximum="100" Height="8" Margin="0,8"/>
                                    <TextBlock Text="{Binding VMigrationProgress.PercentageComplete, StringFormat={}{0:F1}% Complete}" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding VMigrationProgress.Completed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Completed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding VMigrationProgress.Failed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Failed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding VMigrationProgress.Total}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Total" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Profile Migration Progress -->
                        <Border Style="{StaticResource CardStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="User Profile Migration" Style="{StaticResource SubHeaderStyle}"/>
                                    <ProgressBar Value="{Binding ProfileMigrationProgress.PercentageComplete}" Maximum="100" Height="8" Margin="0,8"/>
                                    <TextBlock Text="{Binding ProfileMigrationProgress.PercentageComplete, StringFormat={}{0:F1}% Complete}" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding ProfileMigrationProgress.Completed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Completed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding ProfileMigrationProgress.Failed}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Failed" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Margin="8">
                                        <TextBlock Text="{Binding ProfileMigrationProgress.Total}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Total" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Rollback Controls Tab -->
            <TabItem Header="Rollback Controls">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Rollback Status -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Rollback Management" Style="{StaticResource SubHeaderStyle}"/>
                                <TextBlock Text="{Binding RollbackStatus}" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Content="Create Rollback Point" Style="{StaticResource PrimaryButtonStyle}"
                                        Command="{Binding CreateRollbackPointCommand}"
                                        IsEnabled="{Binding IsRollbackRunning, Converter={StaticResource InvertBooleanConverter}}"/>
                                <Button Content="Execute Rollback" Style="{StaticResource ErrorButtonStyle}"
                                        Command="{Binding ExecuteRollbackCommand}"
                                        IsEnabled="{Binding IsRollbackAvailable}"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Rollback Points Grid -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <DataGrid ItemsSource="{Binding RollbackPoints}"
                                  SelectedItem="{Binding SelectedRollbackPoint}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  BorderThickness="0">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt}" Width="150"/>
                                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="200"/>
                                <DataGridCheckBoxColumn Header="Auto" Binding="{Binding IsAutomatic}" Width="60"/>
                                <DataGridTextColumn Header="Items" Binding="{Binding MigratedItemsCount}" Width="80"/>
                                <DataGridCheckBoxColumn Header="Can Rollback" Binding="{Binding CanRollback}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>

                    <!-- Rollback Warning -->
                    <Border Grid.Row="2" Style="{StaticResource CardStyle}" Background="#FFF3E0">
                        <StackPanel>
                            <TextBlock Text="⚠️ Rollback Warning" FontWeight="Bold" Foreground="{StaticResource WarningBrush}"/>
                            <TextBlock Text="Rollback operations will undo migration changes and may result in data loss. Ensure you have proper backups before proceeding." 
                                       TextWrapping="Wrap" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Execution Logs Tab -->
            <TabItem Header="Execution Logs">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Log Controls -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                         Width="300" Margin="0,0,8,0"/>
                                <CheckBox Content="Errors Only" IsChecked="{Binding ShowOnlyErrors}" VerticalAlignment="Center"/>
                            </StackPanel>

                            <Button Grid.Column="1" Content="Export Logs" Style="{StaticResource PrimaryButtonStyle}"
                                    Command="{Binding ExportLogsCommand}"/>
                            <Button Grid.Column="2" Content="Clear Logs" Style="{StaticResource ErrorButtonStyle}"
                                    Command="{Binding ClearLogsCommand}"/>
                        </Grid>
                    </Border>

                    <!-- Logs Grid -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <DataGrid ItemsSource="{Binding ExecutionLogsView}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  BorderThickness="0">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="150"/>
                                <DataGridTemplateColumn Header="Level" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Level}" Style="{StaticResource LogLevelStyle}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Source" Binding="{Binding Source}" Width="120"/>
                                <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Loading Overlay -->
        <controls:LoadingOverlay Grid.RowSpan="3" 
                                 Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
    </Grid>
</UserControl>