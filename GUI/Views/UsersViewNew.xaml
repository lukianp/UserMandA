<UserControl x:Class="MandADiscoverySuite.Views.UsersViewNew"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000"
             Background="#FF0F1419">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/Converters.xaml"/>
                <ResourceDictionary Source="../Resources/DataGridTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="20,20,20,10">
            <TextBlock Text="Users" FontSize="24" FontWeight="SemiBold"/>
            <TextBlock Text="User account management and directory information" 
                       FontSize="12" Foreground="Gray" Margin="0,4,0,0"/>
        </StackPanel>
        
        <!-- Header Warnings Banner -->
        <ItemsControl Grid.Row="1" ItemsSource="{Binding HeaderWarnings}"
                      Visibility="{Binding HeaderWarnings.Count, Converter={StaticResource CountToVisibility}}"
                      Margin="20,0,20,10">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Background="#55FF0000" BorderBrush="#FF0000" BorderThickness="1" 
                            CornerRadius="4" Margin="0,0,0,8" Padding="8">
                        <TextBlock Text="{Binding}" TextWrapping="Wrap" Foreground="White" />
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
        
        <!-- Error Banner -->
        <Border Grid.Row="2" Background="#55FF0000" BorderBrush="#FF0000" BorderThickness="1" 
                CornerRadius="4" Margin="20,0,20,10" Padding="8"
                Visibility="{Binding LastError, Converter={StaticResource NullToVisibility}}">
            <TextBlock Text="{Binding LastError}" TextWrapping="Wrap" Foreground="White" />
        </Border>
        
        <!-- Loading Spinner -->
        <Border Grid.Row="3" Background="#FF1E1E1E" 
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
                <TextBlock Text="Loading users..." Margin="0,10,0,0" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
        
        <!-- Data Grid -->
        <DataGrid Grid.Row="3" 
                  ItemsSource="{Binding Users}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  Margin="20,0,20,20"
                  Visibility="{Binding HasData, Converter={StaticResource BoolToVisibility}}">
            
            <DataGrid.Columns>
                <DataGridTextColumn Header="Display Name" 
                                    Binding="{Binding DisplayName}" 
                                    Width="200"/>
                
                <DataGridTextColumn Header="User Principal Name" 
                                    Binding="{Binding UserPrincipalName}" 
                                    Width="250"/>
                
                <DataGridTextColumn Header="Email" 
                                    Binding="{Binding Mail}" 
                                    Width="200"/>
                
                <DataGridTextColumn Header="Department" 
                                    Binding="{Binding Department}" 
                                    Width="150"/>
                
                <DataGridTextColumn Header="Job Title" 
                                    Binding="{Binding JobTitle}" 
                                    Width="150"/>
                
                <DataGridCheckBoxColumn Header="Enabled" 
                                        Binding="{Binding AccountEnabled}" 
                                        Width="70"/>
                
                <DataGridTextColumn Header="SAM Account" 
                                    Binding="{Binding SamAccountName}" 
                                    Width="150"/>
                
                <DataGridTextColumn Header="Company" 
                                    Binding="{Binding CompanyName}" 
                                    Width="150"/>
                
                <DataGridTextColumn Header="Manager" 
                                    Binding="{Binding ManagerDisplayName}" 
                                    Width="150"/>
                
                <DataGridTextColumn Header="Created" 
                                    Binding="{Binding CreatedDateTime, Converter={StaticResource DateFormat}}" 
                                    Width="100"/>
                
                <!-- Detailed View Button -->
                <DataGridTemplateColumn Header="Actions" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="ðŸ“‹ Details" 
                                    Padding="8,4"
                                    Margin="4"
                                    FontSize="11"
                                    Command="{Binding DataContext.ShowUserDetailCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"
                                    ToolTip="Show detailed user information">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background" Value="#FF4299E1"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                            CornerRadius="4"
                                                            BorderThickness="0">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                          VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#FF3182CE"/>
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                            <Setter Property="Background" Value="#FF2C5282"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
            
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#F0F0F0"/>
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#E0E0E0"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>
        
        <!-- No Data Message -->
        <TextBlock Grid.Row="3" 
                   Text="No user data available" 
                   HorizontalAlignment="Center" 
                   VerticalAlignment="Center"
                   FontSize="16"
                   Foreground="Gray"
                   Visibility="{Binding HasData, Converter={StaticResource InverseBoolToVisibility}}"/>
    </Grid>
</UserControl>
