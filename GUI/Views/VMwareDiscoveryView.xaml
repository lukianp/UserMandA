<UserControl x:Class="MandADiscoverySuite.Views.VMwareDiscoveryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:MandADiscoverySuite.Converters"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             Background="{DynamicResource CardBrush}">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Themes/ThemeStyles.xaml"/>
                <ResourceDictionary Source="../Themes/Colors.xaml"/>
                <ResourceDictionary Source="../Resources/Converters.xaml"/>
                <ResourceDictionary Source="../Resources/DataGridTheme.xaml"/>
                <ResourceDictionary Source="../Themes/HighContrastTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
            <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
            <converters:StatusToBrushConverter x:Key="StatusToBrushConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <Grid Margin="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header Section -->
            <Border Grid.Row="0" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Icon Section -->
                    <Border Grid.Column="0" Width="64" Height="64" CornerRadius="12"
                            Background="{StaticResource AccentBrush}"
                            VerticalAlignment="Center" Margin="0,0,24,0">
                        <TextBlock Text="ðŸ”·" FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>

                    <!-- Title and Description -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="VMware Infrastructure Discovery"
                                   Style="{StaticResource HeaderTextStyle}"
                                   FontSize="32"/>
                        <TextBlock Text="Discover and analyze VMware vSphere infrastructure including clusters, hosts, and virtual machines"
                                   FontSize="16" Foreground="{DynamicResource MutedForegroundBrush}"
                                   TextWrapping="Wrap" Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- Status Indicator -->
                    <Border Grid.Column="2" Padding="16,8" CornerRadius="8"
                            Background="{Binding StatusColor, Converter={StaticResource StatusToBrushConverter}}">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="{Binding StatusText}" FontWeight="SemiBold"
                                       Foreground="White" FontSize="14"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Summary Cards -->
            <Grid Grid.Row="1" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Clusters -->
                <Border Grid.Column="0" Style="{StaticResource ModernCardStyle}" Margin="0,0,16,0">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="16">
                        <TextBlock Text="{Binding TotalClusters}" FontSize="28" FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryTextBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="Clusters" FontSize="14" Foreground="{StaticResource MutedForegroundBrush}"
                                   HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Total Hosts -->
                <Border Grid.Column="1" Style="{StaticResource ModernCardStyle}" Margin="0,0,16,0">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="16">
                        <TextBlock Text="{Binding TotalHosts}" FontSize="28" FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryTextBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="Hosts" FontSize="14" Foreground="{StaticResource MutedForegroundBrush}"
                                   HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Total VMs -->
                <Border Grid.Column="2" Style="{StaticResource ModernCardStyle}" Margin="0,0,16,0">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="16">
                        <TextBlock Text="{Binding TotalVMs}" FontSize="28" FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryTextBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding TotalVMsText}" FontSize="14" Foreground="{StaticResource MutedForegroundBrush}"
                                   HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Last Update -->
                <Border Grid.Column="3" Style="{StaticResource ModernCardStyle}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="16">
                        <TextBlock Text="{Binding LastUpdatedText}" FontSize="16" FontWeight="SemiBold"
                                   Foreground="{StaticResource SecondaryTextBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="Last Updated" FontSize="12" Foreground="{StaticResource MutedForegroundBrush}"
                                   HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Action Buttons -->
            <Border Grid.Row="2" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Left Side - Actions Label -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="ðŸ“‹ Actions" FontSize="18" FontWeight="SemiBold"
                                   Foreground="{StaticResource SecondaryTextBrush}" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Progress Bar -->
                    <ProgressBar Grid.Column="1" Value="{Binding ProgressValue}" Maximum="100"
                                Height="6" Margin="24,0"
                                Background="{StaticResource SurfaceBrush}"
                                Foreground="{StaticResource AccentBrush}"
                                Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}"/>

                    <!-- Right Side - Action Buttons -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Button Content="ðŸ”„ Run Discovery"
                                Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding RunDiscoveryCommand}"
                                Background="{StaticResource SuccessBrush}"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                                Margin="0,0,12,0"
                                ToolTip="Execute VMware infrastructure discovery"/>
                        <Button Content="ðŸ”„ Refresh Data"
                                Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding RefreshDataCommand}"
                                Background="{StaticResource AccentBrush}"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                                Margin="0,0,12,0"
                                ToolTip="Reload VMware discovery data"/>
                        <Button Content="ðŸ’¾ Export Data"
                                Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding ExportCommand}"
                                Background="{StaticResource SecondaryBrush}"
                                IsEnabled="{Binding HasResults}"
                                Margin="0,0,12,0"
                                ToolTip="Export VMware data to CSV/Excel"/>
                        <Button Content="ðŸ“‹ View Logs"
                                Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding ViewLogsCommand}"
                                Background="{StaticResource WarningBrush}"
                                Margin="0"
                                ToolTip="View discovery logs"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Data Grid -->
            <Border Grid.Row="3" Style="{StaticResource ModernCardStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Data Grid Header -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="24,24,24,16">
                        <TextBlock Text="VMware Infrastructure" FontSize="18" FontWeight="SemiBold"
                                   Foreground="{StaticResource SecondaryTextBrush}"/>
                        <TextBlock Text="{Binding ResultsCount, StringFormat=' ({0} items)'}"
                                   FontSize="14" Foreground="{StaticResource MutedForegroundBrush}"
                                   Margin="12,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Data Grid -->
                    <DataGrid Grid.Row="1" x:Name="dataGrid"
                              ItemsSource="{Binding SelectedResults}"
                              SelectedItem="{Binding SelectedItem}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserReorderColumns="True"
                              CanUserResizeColumns="True"
                              CanUserSortColumns="True"
                              HeadersVisibility="Column"
                              GridLinesVisibility="Horizontal"
                              BorderThickness="0"
                              Background="Transparent"
                              AlternationCount="2"
                              Margin="24,0,24,24">

                        <DataGrid.Columns>
                            <!-- Cluster Name Column -->
                            <DataGridTextColumn Header="Cluster Name" Binding="{Binding ClusterName}"
                                                Width="*" MinWidth="150" CanUserSort="True">
                                <DataGridTextColumn.HeaderStyle>
                                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource DataGridColumnHeaderStyle}">
                                        <Setter Property="ContentTemplate">
                                            <Setter.Value>
                                                <DataTemplate>
                                                    <TextBlock Text="ðŸ¢ Cluster Name" FontWeight="SemiBold"/>
                                                </DataTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </DataGridTextColumn.HeaderStyle>
                            </DataGridTextColumn>

                            <!-- Host Name Column -->
                            <DataGridTextColumn Header="Host Name" Binding="{Binding HostName}"
                                                Width="*" MinWidth="150" CanUserSort="True">
                                <DataGridTextColumn.HeaderStyle>
                                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource DataGridColumnHeaderStyle}">
                                        <Setter Property="ContentTemplate">
                                            <Setter.Value>
                                                <DataTemplate>
                                                    <TextBlock Text="ðŸ–¥ï¸ Host Name" FontWeight="SemiBold"/>
                                                </DataTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </DataGridTextColumn.HeaderStyle>
                            </DataGridTextColumn>

                            <!-- VM Count Column -->
                            <DataGridTextColumn Header="VM Count" Binding="{Binding VMCount, StringFormat={}{0:N0}}"
                                                Width="120" CanUserSort="True">
                                <DataGridTextColumn.HeaderStyle>
                                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource DataGridColumnHeaderStyle}">
                                        <Setter Property="ContentTemplate">
                                            <Setter.Value>
                                                <DataTemplate>
                                                    <TextBlock Text="ðŸ”¢ VM Count" FontWeight="SemiBold"/>
                                                </DataTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </DataGridTextColumn.HeaderStyle>
                            </DataGridTextColumn>

                            <!-- vSphere Version Column -->
                            <DataGridTextColumn Header="vSphere Version" Binding="{Binding vSphereVersion}"
                                                Width="150" CanUserSort="True">
                                <DataGridTextColumn.HeaderStyle>
                                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource DataGridColumnHeaderStyle}">
                                        <Setter Property="ContentTemplate">
                                            <Setter.Value>
                                                <DataTemplate>
                                                    <TextBlock Text="âš™ï¸ vSphere Version" FontWeight="SemiBold"/>
                                                </DataTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </DataGridTextColumn.HeaderStyle>
                            </DataGridTextColumn>

                            <!-- Status Column -->
                            <DataGridTemplateColumn Header="Status" Width="150" CanUserSort="True">
                                <DataGridTemplateColumn.HeaderStyle>
                                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource DataGridColumnHeaderStyle}">
                                        <Setter Property="ContentTemplate">
                                            <Setter.Value>
                                                <DataTemplate>
                                                    <TextBlock Text="ðŸ”´ Status" FontWeight="SemiBold"/>
                                                </DataTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </DataGridTemplateColumn.HeaderStyle>
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Padding="8,4" CornerRadius="12">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="{StaticResource SuccessBrush}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="Offline">
                                                            <Setter Property="Background" Value="{StaticResource ErrorBrush}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Disconnected">
                                                            <Setter Property="Background" Value="{StaticResource WarningBrush}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Unknown">
                                                            <Setter Property="Background" Value="{StaticResource MutedBrush}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding Status}" FontSize="12" FontWeight="Medium"
                                                       Foreground="White" HorizontalAlignment="Center"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>

                        <!-- Row Styles -->
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow" BasedOn="{StaticResource DataGridRowStyle}">
                                <Style.Triggers>
                                    <Trigger Property="AlternationIndex" Value="1">
                                        <Setter Property="Background" Value="{StaticResource AlternateRowBrush}"/>
                                    </Trigger>
                                    <DataTrigger Binding="{Binding Status}" Value="Offline">
                                        <Setter Property="Background" Value="{StaticResource ErrorRowBrush}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>

                        <!-- Empty State -->
                        <DataGrid.Template>
                            <ControlTemplate TargetType="DataGrid">
                                <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                                    <Grid>
                                        <ScrollViewer x:Name="DG_ScrollViewer" Focusable="false">
                                            <ScrollViewer.Template>
                                                <ControlTemplate TargetType="ScrollViewer">
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="*"/>
                                                        </Grid.RowDefinitions>
                                                        <DataGridColumnHeadersPresenter x:Name="PART_ColumnHeadersPresenter" Grid.Row="0"/>
                                                        <ScrollContentPresenter x:Name="PART_ScrollContentPresenter" Grid.Row="1" CanContentScroll="{TemplateBinding CanContentScroll}"/>
                                                    </Grid>
                                                </ControlTemplate>
                                            </ScrollViewer.Template>
                                            <ItemsPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                        </ScrollViewer>
                                        <!-- Empty Content Overlay -->
                                        <Border Grid.Row="1" Background="{StaticResource CardBrush}"
                                                Visibility="{Binding HasResults, Converter={StaticResource InverseBoolConverter}, ConverterParameter=True}">
                                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <TextBlock Text="ðŸ”" FontSize="64" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                                                <TextBlock Text="No VMware Infrastructure Found"
                                                           FontSize="24" FontWeight="SemiBold"
                                                           Foreground="{StaticResource SecondaryTextBrush}"
                                                           HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                                <TextBlock Text="Click 'Run Discovery' to start scanning your VMware environment"
                                                           FontSize="16" Foreground="{StaticResource MutedForegroundBrush}"
                                                           HorizontalAlignment="Center" TextWrapping="Wrap"/>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Border>
                            </ControlTemplate>
                        </DataGrid.Template>
                    </DataGrid>

                    <!-- Loading Indicator -->
                    <Border Grid.Row="2" Background="{StaticResource CardBrush}" CornerRadius="0,0,12,12"
                            Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="24">
                            <ProgressBar Value="{Binding ProgressValue}" Width="200" Height="4"
                                        Background="{StaticResource SurfaceBrush}"
                                        Foreground="{StaticResource AccentBrush}"/>
                            <TextBlock Text="{Binding ProcessingMessage}" FontSize="14"
                                       Foreground="{StaticResource SecondaryTextBrush}" Margin="16,0,0,0"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>