<UserControl x:Class="MandADiscoverySuite.Views.DiscoveryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:MandADiscoverySuite.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200"
             Background="{DynamicResource CardBrush}">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            
            <!-- Modern Card Style -->
            <Style x:Key="ModernCardStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                <Setter Property="CornerRadius" Value="12"/>
                <Setter Property="Padding" Value="24"/>
                <Setter Property="Effect">
                    <Setter.Value>
                        <DropShadowEffect Color="{DynamicResource BlackColor}" BlurRadius="20" Opacity="0.1" ShadowDepth="8" Direction="270"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Header Style -->
            <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="28"/>
                <Setter Property="FontWeight" Value="Bold"/>
                <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            </Style>

            <!-- Section Header Style -->
            <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="18"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Foreground" Value="{DynamicResource SecondaryTextBrush}"/>
                <Setter Property="Margin" Value="0,0,0,16"/>
            </Style>

            <!-- Modern Button Style -->
            <Style x:Key="ModernButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="16,12"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontWeight" Value="Medium"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" 
                                    CornerRadius="8"
                                    x:Name="ButtonBorder">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource AccentHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource AccentPressedBrush}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Module Card Style -->
            <Style x:Key="ModuleCardStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                <Setter Property="CornerRadius" Value="12"/>
                <Setter Property="Padding" Value="20"/>
                <Setter Property="Margin" Value="12"/>
                <Setter Property="MinWidth" Value="320"/>
                <Setter Property="MinHeight" Value="180"/>
                <Setter Property="Effect">
                    <Setter.Value>
                        <DropShadowEffect Color="{DynamicResource BlackColor}" BlurRadius="12" Opacity="0.15" ShadowDepth="4" Direction="270"/>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                        <Setter Property="Effect">
                            <Setter.Value>
                                <DropShadowEffect Color="{DynamicResource BlackColor}" BlurRadius="16" Opacity="0.25" ShadowDepth="6" Direction="270"/>
                            </Setter.Value>
                        </Setter>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Modern Progress Bar Style -->
            <Style x:Key="ModernProgressBarStyle" TargetType="ProgressBar">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ProgressBar">
                            <Border CornerRadius="8" Background="{TemplateBinding Background}" 
                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                    BorderThickness="{TemplateBinding BorderThickness}">
                                <Grid>
                                    <Border Name="PART_Track" CornerRadius="8" Background="Transparent"/>
                                    <Border Name="PART_Indicator" CornerRadius="8" 
                                            HorizontalAlignment="Left" 
                                            Background="{DynamicResource AccentBrush}">
                                        <Border.Effect>
                                            <DropShadowEffect Color="{DynamicResource AccentBrush}" BlurRadius="8" Opacity="0.6" ShadowDepth="0"/>
                                        </Border.Effect>
                                    </Border>
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <Grid Margin="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header Section -->
            <StackPanel Grid.Row="0" Margin="0,0,0,32">
                <TextBlock Text="Discovery Modules" Style="{StaticResource HeaderTextStyle}"/>
                <TextBlock Text="Run discovery modules to gather comprehensive organizational data for migration planning" 
                           Foreground="{DynamicResource MutedForegroundBrush}" FontSize="16" Margin="0,8,0,0"/>
            </StackPanel>

            <!-- Quick Actions Section -->
            <Border Grid.Row="1" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Quick Actions" Style="{StaticResource SectionHeaderStyle}"/>
                        <TextBlock Text="Execute discovery operations and manage data collection" 
                                   Foreground="{DynamicResource MutedForegroundBrush}" FontSize="14"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Content="🔄 Refresh Data" 
                                Style="{StaticResource ModernButtonStyle}" 
                                Background="{DynamicResource SuccessBrush}"
                                Command="{Binding RefreshDataCommand}" 
                                Margin="0,0,12,0"
                                ToolTip="Reload discovery data from CSV files"/>
                        
                        <Button Content="▶️ Run All Modules" 
                                Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding StartDiscoveryCommand}"
                                ToolTip="Execute all enabled discovery modules"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Discovery Modules Grid -->
            <Border Grid.Row="2" Style="{StaticResource ModernCardStyle}">
                <StackPanel>
                    <TextBlock Text="Available Discovery Modules" Style="{StaticResource SectionHeaderStyle}"/>
                    
                    <ItemsControl ItemsSource="{Binding DiscoveryModules}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" HorizontalAlignment="Stretch"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource ModuleCardStyle}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Module Header -->
                                        <Grid Grid.Row="0" Margin="0,0,0,16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Icon with background circle -->
                                            <Border Grid.Column="0" Background="{DynamicResource BorderBrush}" CornerRadius="20" 
                                                    Width="40" Height="40" Margin="0,0,16,0">
                                                <TextBlock Text="{Binding Icon}" FontSize="18" 
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            
                                            <!-- Module info -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding DisplayName}" 
                                                           FontSize="16" FontWeight="SemiBold" 
                                                           Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,2"/>
                                                <TextBlock Text="{Binding Category}" 
                                                           FontSize="11" FontWeight="Medium"
                                                           Foreground="{DynamicResource MutedForegroundBrush}"/>
                                            </StackPanel>
                                            
                                            <!-- Status indicator with better styling -->
                                            <Border Grid.Column="2" CornerRadius="10" Padding="8,4" 
                                                    VerticalAlignment="Top">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="{DynamicResource SuccessBrush}"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Status}" Value="Running">
                                                                <Setter Property="Background" Value="{DynamicResource WarningBrush}"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="Failed">
                                                                <Setter Property="Background" Value="{DynamicResource ErrorBrush}"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock Text="{Binding Status}" 
                                                           FontSize="10" FontWeight="Medium"
                                                           Foreground="{DynamicResource WhiteBrush}"/>
                                            </Border>
                                        </Grid>


                                        <!-- Module Description -->
                                        <TextBlock Grid.Row="2" 
                                                   Text="{Binding Description}" 
                                                   FontSize="12" 
                                                   Foreground="{DynamicResource MutedForegroundBrush}"
                                                   TextWrapping="Wrap"
                                                   Margin="0,0,0,12"/>

                                        <!-- Progress Bar -->
                                        <Border Grid.Row="3" CornerRadius="8" Background="{DynamicResource CardBrush}" Height="6" 
                                                Margin="0,0,0,16"
                                                Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <ProgressBar Value="{Binding Progress}" 
                                                         Maximum="100"
                                                         Background="Transparent" 
                                                         BorderThickness="0"
                                                         Style="{StaticResource ModernProgressBarStyle}"/>
                                        </Border>

                                        <!-- Module Actions -->
                                        <Grid Grid.Row="3">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <CheckBox Grid.Column="0" Content="Enabled" 
                                                      IsChecked="{Binding Enabled}"
                                                      Foreground="{DynamicResource SecondaryTextBrush}" 
                                                      FontSize="12" FontWeight="Medium"
                                                      VerticalAlignment="Center"/>
                                            <Button Grid.Column="1" Content="▶ Run" 
                                                    Command="{Binding RunDiscoveryCommand}"
                                                    Style="{StaticResource ModernButtonStyle}"
                                                    Background="{DynamicResource SuccessBrush}"
                                                    Padding="12,8"
                                                    FontSize="11" FontWeight="SemiBold"
                                                    IsEnabled="{Binding IsEnabled}"/>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- Empty State -->
                    <Border Background="{DynamicResource CardBrush}" 
                            CornerRadius="8" 
                            Padding="32" 
                            Margin="0,24,0,0"
                            Visibility="{Binding HasNoModules, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="🔍" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                            <TextBlock Text="No Discovery Modules Found" 
                                       FontSize="18" FontWeight="SemiBold" 
                                       Foreground="{DynamicResource SecondaryTextBrush}" 
                                       HorizontalAlignment="Center" 
                                       Margin="0,0,0,8"/>
                            <TextBlock Text="Check that discovery modules are properly configured and enabled" 
                                       FontSize="14" 
                                       Foreground="{DynamicResource MutedForegroundBrush}" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>
