<UserControl x:Class="MandADiscoverySuite.Controls.QuickActionsBar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="60" d:DesignWidth="800">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Themes/ThemeStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Quick Actions Bar Style -->
            <Style x:Key="QuickActionsBarStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="0,1,0,0"/>
                <Setter Property="Padding" Value="12,8"/>
            </Style>

            <!-- Quick Action Button Style -->
            <Style x:Key="QuickActionButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="8,6"/>
                <Setter Property="Margin" Value="0,0,4,0"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="MinWidth" Value="80"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource HoverBrush}"/>
                    </Trigger>
                    <Trigger Property="IsPressed" Value="True">
                        <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                        <Setter Property="Foreground" Value="White"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Action Category Style -->
            <Style x:Key="ActionCategoryStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource CardBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="4"/>
                <Setter Property="Padding" Value="8,4"/>
                <Setter Property="Margin" Value="0,0,8,0"/>
            </Style>

            <!-- Floating Action Button Style -->
            <Style x:Key="FloatingActionButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Width" Value="56"/>
                <Setter Property="Height" Value="56"/>
                <Setter Property="FontSize" Value="20"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Effect" Value="{StaticResource DropShadowEffect}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Ellipse Fill="{TemplateBinding Background}"
                                     Effect="{TemplateBinding Effect}">
                                <Ellipse.RenderTransform>
                                    <ScaleTransform x:Name="ScaleTransform" ScaleX="1" ScaleY="1"/>
                                </Ellipse.RenderTransform>
                            </Ellipse>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1.1" Duration="0:0:0.1"/>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1.1" Duration="0:0:0.1"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1" Duration="0:0:0.1"/>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1" Duration="0:0:0.1"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <!-- Main Quick Actions Bar -->
        <Border Style="{StaticResource QuickActionsBarStyle}"
                Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Primary Actions -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <ItemsControl ItemsSource="{Binding PrimaryActions}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Content="{Binding DisplayText}"
                                        Command="{Binding Command}"
                                        CommandParameter="{Binding CommandParameter}"
                                        ToolTip="{Binding Tooltip}"
                                        Style="{StaticResource QuickActionButtonStyle}"
                                        IsEnabled="{Binding IsEnabled}"
                                        Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Button.ContextMenu>
                                        <ContextMenu ItemsSource="{Binding ContextActions}">
                                            <ContextMenu.ItemTemplate>
                                                <DataTemplate>
                                                    <MenuItem Header="{Binding DisplayText}"
                                                              Command="{Binding Command}"
                                                              CommandParameter="{Binding CommandParameter}"
                                                              ToolTip="{Binding Tooltip}"/>
                                                </DataTemplate>
                                            </ContextMenu.ItemTemplate>
                                        </ContextMenu>
                                    </Button.ContextMenu>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- Context Actions (dynamically populated) -->
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            Visibility="{Binding HasContextActions, Converter={StaticResource BoolToVisibilityConverter}}">
                    
                    <Rectangle Width="1" 
                               Fill="{DynamicResource BorderBrush}"
                               Margin="8,4"/>
                    
                    <ItemsControl ItemsSource="{Binding ContextActions}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Content="{Binding DisplayText}"
                                        Command="{Binding Command}"
                                        CommandParameter="{Binding CommandParameter}"
                                        ToolTip="{Binding Tooltip}"
                                        Style="{StaticResource QuickActionButtonStyle}"
                                        IsEnabled="{Binding IsEnabled}"
                                        Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- Status Indicator -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal"
                            VerticalAlignment="Center"
                            Visibility="{Binding ShowStatus, Converter={StaticResource BoolToVisibilityConverter}}">
                    
                    <Rectangle Width="1" 
                               Fill="{DynamicResource BorderBrush}"
                               Margin="8,4"/>
                    
                    <Ellipse Width="8" Height="8" 
                             Fill="{Binding StatusColor}"
                             VerticalAlignment="Center"
                             Margin="0,0,6,0"/>
                    
                    <TextBlock Text="{Binding StatusText}"
                               FontSize="11"
                               Foreground="{DynamicResource MutedForegroundBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Secondary Actions -->
                <StackPanel Grid.Column="3" Orientation="Horizontal">
                    <Rectangle Width="1" 
                               Fill="{DynamicResource BorderBrush}"
                               Margin="8,4"/>
                    
                    <ItemsControl ItemsSource="{Binding SecondaryActions}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Content="{Binding DisplayText}"
                                        Command="{Binding Command}"
                                        CommandParameter="{Binding CommandParameter}"
                                        ToolTip="{Binding Tooltip}"
                                        Style="{StaticResource QuickActionButtonStyle}"
                                        IsEnabled="{Binding IsEnabled}"
                                        Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Toggle Button -->
                    <Button Content="⚡"
                            ToolTip="Toggle Quick Actions"
                            Command="{Binding ToggleVisibilityCommand}"
                            Style="{StaticResource QuickActionButtonStyle}"
                            FontSize="14"
                            MinWidth="32"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Collapsed State Indicator -->
        <Border Background="{DynamicResource AccentBrush}"
                CornerRadius="0,4,0,0"
                Padding="8,2"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Cursor="Hand"
                Visibility="{Binding IsCollapsed, Converter={StaticResource BoolToVisibilityConverter}}"
                MouseLeftButtonDown="CollapsedIndicator_Click">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="⚡" 
                           FontSize="12" 
                           Foreground="White"
                           VerticalAlignment="Center"
                           Margin="0,0,4,0"/>
                <TextBlock Text="{Binding ActiveActionCount, StringFormat='{0} actions'}"
                           FontSize="10"
                           Foreground="White"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Floating Action Button -->
        <Button x:Name="FloatingActionButton"
                Style="{StaticResource FloatingActionButtonStyle}"
                Content="+"
                ToolTip="Quick Actions Menu"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Margin="0,0,20,20"
                Visibility="{Binding ShowFloatingButton, Converter={StaticResource BoolToVisibilityConverter}}"
                Click="FloatingActionButton_Click">
            <Button.ContextMenu>
                <ContextMenu x:Name="FloatingContextMenu">
                    <MenuItem Header="📊 New Dashboard" Command="{Binding NewDashboardCommand}"/>
                    <MenuItem Header="🔍 New Discovery" Command="{Binding NewDiscoveryCommand}"/>
                    <MenuItem Header="📈 New Report" Command="{Binding NewReportCommand}"/>
                    <Separator/>
                    <MenuItem Header="📂 Open File" Command="{Binding OpenFileCommand}"/>
                    <MenuItem Header="💾 Save All" Command="{Binding SaveAllCommand}"/>
                    <Separator/>
                    <MenuItem Header="⚙️ Settings" Command="{Binding ShowSettingsCommand}"/>
                    <MenuItem Header="❓ Help" Command="{Binding ShowHelpCommand}"/>
                </ContextMenu>
            </Button.ContextMenu>
        </Button>

        <!-- Action Categories Popup -->
        <Popup x:Name="ActionCategoriesPopup"
               PlacementTarget="{Binding ElementName=FloatingActionButton}"
               Placement="Top"
               StaysOpen="False"
               AllowsTransparency="True">
            <Border Style="{StaticResource ActionCategoryStyle}"
                    MaxWidth="300">
                <StackPanel>
                    <TextBlock Text="Quick Actions"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource ForegroundBrush}"
                               Margin="0,0,0,8"/>
                    
                    <ItemsControl ItemsSource="{Binding ActionCategories}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Expander Header="{Binding CategoryName}"
                                          IsExpanded="{Binding IsExpanded}"
                                          Margin="0,0,0,4">
                                    <ItemsControl ItemsSource="{Binding Actions}"
                                                  Margin="16,4,0,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Content="{Binding DisplayText}"
                                                        Command="{Binding Command}"
                                                        CommandParameter="{Binding CommandParameter}"
                                                        ToolTip="{Binding Tooltip}"
                                                        Style="{StaticResource ThemedSecondaryButtonStyle}"
                                                        HorizontalAlignment="Left"
                                                        Margin="0,0,0,2"
                                                        Padding="6,3"
                                                        FontSize="11"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Expander>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</UserControl>