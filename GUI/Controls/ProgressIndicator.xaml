<UserControl x:Class="MandADiscoverySuite.Controls.ProgressIndicator"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <Border Background="#f8f9fa" 
            BorderBrush="#dee2e6" 
            BorderThickness="1" 
            CornerRadius="8" 
            Padding="20">
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="10" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="10" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="10" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal">
                <TextBlock Text="{Binding CurrentOperation}" 
                          FontSize="16" 
                          FontWeight="Bold" 
                          VerticalAlignment="Center" />
                
                <TextBlock Text="{Binding ElapsedTime, StringFormat='({0:mm\\:ss})'}" 
                          FontSize="12" 
                          Foreground="#6c757d" 
                          Margin="10,0,0,0"
                          VerticalAlignment="Center" />
                
                <Button Content="Cancel" 
                       Command="{Binding StopDiscoveryCommand}"
                       Margin="20,0,0,0"
                       Padding="10,5"
                       Background="#dc3545"
                       Foreground="White"
                       BorderThickness="0"
                       FontSize="12"
                       Visibility="{Binding IsDiscoveryRunning, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StackPanel>
            
            <!-- Overall Progress -->
            <Grid Grid.Row="2">
                <ProgressBar Value="{Binding OverallProgress}" 
                           Maximum="100" 
                           Height="20" 
                           Background="#e9ecef"
                           Foreground="#28a745" />
                
                <TextBlock Text="{Binding OverallProgress, StringFormat='{}{0:F0}%'}" 
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center" 
                          FontSize="12" 
                          FontWeight="Bold"
                          Foreground="White" />
            </Grid>
            
            <!-- Module Progress List -->
            <ScrollViewer Grid.Row="4" 
                         MaxHeight="200" 
                         VerticalScrollBarVisibility="Auto"
                         Visibility="{Binding IsDiscoveryRunning, Converter={StaticResource BooleanToVisibilityConverter}}">
                
                <ItemsControl ItemsSource="{Binding DiscoveryModules}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,2">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="30" />
                                    <ColumnDefinition Width="150" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="60" />
                                </Grid.ColumnDefinitions>
                                
                                <!-- Status Icon -->
                                <TextBlock Grid.Column="0" 
                                          Text="{Binding Icon}" 
                                          FontSize="16" 
                                          VerticalAlignment="Center" />
                                
                                <!-- Module Name -->
                                <TextBlock Grid.Column="1" 
                                          Text="{Binding DisplayName}" 
                                          FontSize="12" 
                                          VerticalAlignment="Center"
                                          TextTrimming="CharacterEllipsis" />
                                
                                <!-- Progress Bar -->
                                <Grid Grid.Column="2" Margin="10,0">
                                    <ProgressBar Value="{Binding Progress}" 
                                               Maximum="100" 
                                               Height="12" 
                                               Background="#e9ecef">
                                        <ProgressBar.Style>
                                            <Style TargetType="ProgressBar">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Status}" Value="Completed">
                                                        <Setter Property="Foreground" Value="#28a745" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Failed">
                                                        <Setter Property="Foreground" Value="#dc3545" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Running">
                                                        <Setter Property="Foreground" Value="#007bff" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ProgressBar.Style>
                                    </ProgressBar>
                                </Grid>
                                
                                <!-- Percentage -->
                                <TextBlock Grid.Column="3" 
                                          Text="{Binding Progress, StringFormat='{}{0:F0}%'}" 
                                          FontSize="10" 
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Right" />
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            
            <!-- Status Message -->
            <TextBlock Grid.Row="6" 
                      Text="{Binding StatusMessage}" 
                      FontSize="12" 
                      Foreground="#6c757d" 
                      TextWrapping="Wrap" />
        </Grid>
    </Border>
</UserControl>