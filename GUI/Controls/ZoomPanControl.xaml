<UserControl x:Class="MandADiscoverySuite.Controls.ZoomPanControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Themes/ThemeStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Zoom Control Style -->
            <Style x:Key="ZoomControlStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="4"/>
                <Setter Property="Padding" Value="8,4"/>
                <Setter Property="Effect" Value="{StaticResource DropShadowEffect}"/>
            </Style>

            <!-- Zoom Button Style -->
            <Style x:Key="ZoomButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="8,4"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="FontSize" Value="14"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource HoverBrush}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Minimap Style -->
            <Style x:Key="MinimapStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource CardBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="3"/>
                <Setter Property="Effect" Value="{StaticResource DropShadowEffect}"/>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <!-- Main Content Area with Zoom and Pan -->
        <ScrollViewer x:Name="MainScrollViewer"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      ZoomMode="Enabled"
                      ScrollChanged="MainScrollViewer_ScrollChanged"
                      PreviewMouseWheel="MainScrollViewer_PreviewMouseWheel">
            
            <Canvas x:Name="MainCanvas"
                    Background="Transparent"
                    Width="{Binding CanvasWidth}"
                    Height="{Binding CanvasHeight}"
                    MouseMove="Canvas_MouseMove"
                    MouseLeftButtonDown="Canvas_MouseLeftButtonDown"
                    MouseLeftButtonUp="Canvas_MouseLeftButtonUp">
                
                <!-- Content Container -->
                <Border x:Name="ContentContainer"
                        Background="{DynamicResource BackgroundBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        Width="{Binding ContentWidth}"
                        Height="{Binding ContentHeight}">
                    <ContentPresenter Content="{Binding ZoomableContent}"/>
                </Border>

                <!-- Grid Overlay (optional) -->
                <Canvas x:Name="GridOverlay" 
                        Visibility="{Binding ShowGrid, Converter={StaticResource BoolToVisibilityConverter}}"
                        Width="{Binding CanvasWidth}"
                        Height="{Binding CanvasHeight}"
                        IsHitTestVisible="False">
                    <!-- Grid lines will be drawn here programmatically -->
                </Canvas>
            </Canvas>
        </ScrollViewer>

        <!-- Zoom Controls -->
        <Border Style="{StaticResource ZoomControlStyle}"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="16">
            <StackPanel Orientation="Vertical">
                <Button Content="ðŸ”+" 
                        ToolTip="Zoom In (Ctrl+Plus)"
                        Command="{Binding ZoomInCommand}"
                        Style="{StaticResource ZoomButtonStyle}"/>
                
                <Slider x:Name="ZoomSlider"
                        Orientation="Vertical"
                        Height="100"
                        Minimum="{Binding MinZoom}"
                        Maximum="{Binding MaxZoom}"
                        Value="{Binding ZoomLevel, Mode=TwoWay}"
                        TickPlacement="BottomRight"
                        TickFrequency="0.25"
                        IsSnapToTickEnabled="True"
                        Margin="0,4"/>
                
                <Button Content="ðŸ”-" 
                        ToolTip="Zoom Out (Ctrl+Minus)"
                        Command="{Binding ZoomOutCommand}"
                        Style="{StaticResource ZoomButtonStyle}"/>
                
                <Rectangle Height="1" 
                           Fill="{DynamicResource BorderBrush}"
                           Margin="0,4"/>
                
                <Button Content="ðŸŽ¯" 
                        ToolTip="Fit to Window"
                        Command="{Binding FitToWindowCommand}"
                        Style="{StaticResource ZoomButtonStyle}"/>
                
                <Button Content="ðŸ“" 
                        ToolTip="Actual Size (100%)"
                        Command="{Binding ActualSizeCommand}"
                        Style="{StaticResource ZoomButtonStyle}"/>
                
                <Button Content="ðŸ“" 
                        ToolTip="Toggle Grid"
                        Command="{Binding ToggleGridCommand}"
                        Style="{StaticResource ZoomButtonStyle}"/>

                <!-- Zoom Level Display -->
                <TextBlock Text="{Binding ZoomLevel, StringFormat={}{0:P0}}" 
                           HorizontalAlignment="Center"
                           FontSize="10"
                           Foreground="{DynamicResource MutedForegroundBrush}"
                           Margin="0,4,0,0"/>
            </StackPanel>
        </Border>

        <!-- Pan Controls -->
        <Border Style="{StaticResource ZoomControlStyle}"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="16">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Pan Up -->
                <Button Grid.Row="0" Grid.Column="1"
                        Content="â–²"
                        ToolTip="Pan Up"
                        Command="{Binding PanCommand}"
                        CommandParameter="Up"
                        Style="{StaticResource ZoomButtonStyle}"
                        FontSize="12"/>

                <!-- Pan Left -->
                <Button Grid.Row="1" Grid.Column="0"
                        Content="â—„"
                        ToolTip="Pan Left"
                        Command="{Binding PanCommand}"
                        CommandParameter="Left"
                        Style="{StaticResource ZoomButtonStyle}"
                        FontSize="12"/>

                <!-- Pan Center -->
                <Button Grid.Row="1" Grid.Column="1"
                        Content="ðŸ "
                        ToolTip="Center View"
                        Command="{Binding CenterViewCommand}"
                        Style="{StaticResource ZoomButtonStyle}"
                        FontSize="10"/>

                <!-- Pan Right -->
                <Button Grid.Row="1" Grid.Column="2"
                        Content="â–º"
                        ToolTip="Pan Right"
                        Command="{Binding PanCommand}"
                        CommandParameter="Right"
                        Style="{StaticResource ZoomButtonStyle}"
                        FontSize="12"/>

                <!-- Pan Down -->
                <Button Grid.Row="2" Grid.Column="1"
                        Content="â–¼"
                        ToolTip="Pan Down"
                        Command="{Binding PanCommand}"
                        CommandParameter="Down"
                        Style="{StaticResource ZoomButtonStyle}"
                        FontSize="12"/>
            </Grid>
        </Border>

        <!-- Minimap -->
        <Border Style="{StaticResource MinimapStyle}"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Width="150"
                Height="100"
                Margin="16"
                Visibility="{Binding ShowMinimap, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <!-- Minimap Content -->
                <Border Background="{DynamicResource BackgroundBrush}"
                        Opacity="0.7">
                    <Viewbox Stretch="Uniform">
                        <Rectangle Width="{Binding ContentWidth}"
                                   Height="{Binding ContentHeight}"
                                   Fill="{DynamicResource CardBrush}"
                                   Stroke="{DynamicResource BorderBrush}"
                                   StrokeThickness="1"/>
                    </Viewbox>
                </Border>

                <!-- Viewport Indicator -->
                <Rectangle x:Name="ViewportIndicator"
                           Fill="Transparent"
                           Stroke="{DynamicResource AccentBrush}"
                           StrokeThickness="2"
                           Width="{Binding ViewportWidth}"
                           Height="{Binding ViewportHeight}"
                           Canvas.Left="{Binding ViewportX}"
                           Canvas.Top="{Binding ViewportY}"/>

                <!-- Minimap Controls -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="4">
                    <Button Content="ðŸ“" 
                            ToolTip="Toggle Minimap"
                            Command="{Binding ToggleMinimapCommand}"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="2"
                            FontSize="8"
                            Cursor="Hand"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Border Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                VerticalAlignment="Bottom"
                Padding="12,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ðŸ“" 
                               FontSize="12"
                               VerticalAlignment="Center"
                               Margin="0,0,4,0"/>
                    <TextBlock Text="{Binding MousePosition, StringFormat='Position: {0}'}" 
                               FontSize="11"
                               Foreground="{DynamicResource MutedForegroundBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,16,0"/>
                    
                    <TextBlock Text="ðŸ”" 
                               FontSize="12"
                               VerticalAlignment="Center"
                               Margin="0,0,4,0"/>
                    <TextBlock Text="{Binding ZoomLevel, StringFormat='Zoom: {0:P0}'}" 
                               FontSize="11"
                               Foreground="{DynamicResource MutedForegroundBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,16,0"/>
                    
                    <TextBlock Text="ðŸ“" 
                               FontSize="12"
                               VerticalAlignment="Center"
                               Margin="0,0,4,0"/>
                    <TextBlock Text="{Binding CanvasSize, StringFormat='Canvas: {0}'}" 
                               FontSize="11"
                               Foreground="{DynamicResource MutedForegroundBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="âš™ï¸" 
                            ToolTip="Zoom Options"
                            Command="{Binding ShowZoomOptionsCommand}"
                            Style="{StaticResource ThemedSecondaryButtonStyle}"
                            Padding="4,2"
                            FontSize="10"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Zoom Rectangle (for zoom-to-rectangle functionality) -->
        <Rectangle x:Name="ZoomRectangle"
                   Fill="Transparent"
                   Stroke="{DynamicResource AccentBrush}"
                   StrokeThickness="2"
                   StrokeDashArray="5,3"
                   Visibility="Collapsed"
                   IsHitTestVisible="False"/>
    </Grid>
</UserControl>