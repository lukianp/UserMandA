<UserControl x:Class="MandADiscoverySuite.Controls.LoadingOverlay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid Background="#88000000" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource AncestorType=UserControl}}">
        <Border Background="#FF1A202C" BorderBrush="#FF4A5568" BorderThickness="2" 
                CornerRadius="8" Width="320" Height="180" 
                HorizontalAlignment="Center" VerticalAlignment="Center">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Loading Animation -->
                <Viewbox Grid.Row="0" Width="50" Height="50" HorizontalAlignment="Center" Margin="0,20,0,0">
                    <Grid x:Name="LoadingSpinner" RenderTransformOrigin="0.5,0.5">
                        <Grid.RenderTransform>
                            <RotateTransform x:Name="SpinnerRotation"/>
                        </Grid.RenderTransform>
                        <Grid.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimation
                                            Storyboard.TargetName="SpinnerRotation"
                                            Storyboard.TargetProperty="Angle"
                                            From="0" To="360" Duration="0:0:1.5"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Grid.Triggers>
                        <Path Data="M 20,10 A 10,10 0 1,1 10,20" 
                              Stroke="#FF9F7AEA" StrokeThickness="3" 
                              StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                    </Grid>
                </Viewbox>
                
                <!-- Loading Text -->
                <TextBlock Grid.Row="1" x:Name="LoadingText" 
                           Text="{Binding LoadingMessage, RelativeSource={RelativeSource AncestorType=UserControl}, FallbackValue='Loading...'}" 
                           HorizontalAlignment="Center" Margin="0,10,0,0"
                           FontSize="16" FontWeight="SemiBold" Foreground="#FFE2E8F0"/>
                
                <!-- Progress Bar -->
                <ProgressBar Grid.Row="2" x:Name="LoadingProgressBar" 
                             Width="250" Height="6" Margin="0,10,0,0"
                             Background="#FF2D3748" Foreground="#FF9F7AEA" BorderThickness="0"
                             Value="{Binding LoadingProgress, RelativeSource={RelativeSource AncestorType=UserControl}}"
                             Maximum="100"
                             Visibility="{Binding ShowProgress, RelativeSource={RelativeSource AncestorType=UserControl}, 
                                         Converter={StaticResource BoolToVisibilityConverter}}"/>
                
                <!-- Cancel Button (optional) -->
                <Button Grid.Row="3" x:Name="CancelButton" 
                        Content="Cancel" Width="80" Height="28" 
                        Margin="0,10,0,20" VerticalAlignment="Top"
                        Background="#FF4A5568" Foreground="#FFE2E8F0" BorderBrush="#FF63B3ED"
                        Click="CancelButton_Click"
                        Visibility="{Binding ShowCancelButton, RelativeSource={RelativeSource AncestorType=UserControl}, 
                                    Converter={StaticResource BoolToVisibilityConverter}}"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>