<Window x:Class="MandADiscoverySuite.Dialogs.WaveSchedulingDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Schedule Migration Wave" 
        Height="700" Width="900"
        WindowStartupLocation="CenterOwner"
        Background="#FF0F172A"
        WindowStyle="SingleBorderWindow"
        ResizeMode="CanResize">

    <Window.Resources>
        <!-- Modern Dark Theme Styles -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#FF3B82F6"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF2563EB"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#FF6B7280"/>
                                <Setter Property="Cursor" Value="Arrow"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CancelButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#FF374151"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF4B5563"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#FF374151"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#FF4B5563"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <Style x:Key="ModernDatePicker" TargetType="DatePicker">
            <Setter Property="Background" Value="#FF374151"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#FF4B5563"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
        </Style>

        <Style x:Key="ModernComboBox" TargetType="ComboBox">
            <Setter Property="Background" Value="#FF374151"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#FF4B5563"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
        </Style>

        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#FFE2E8F0"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>

        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FF94A3B8"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>

        <Style x:Key="InfoCard" TargetType="Border">
            <Setter Property="Background" Value="#FF1E293B"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderBrush" Value="#FF334155"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="Schedule Migration Wave" 
                       FontSize="24" 
                       FontWeight="Bold" 
                       Foreground="White"/>
            <TextBlock Text="Configure scheduling, concurrency, and notification settings for the migration wave." 
                       Foreground="#FF94A3B8" 
                       FontSize="14" 
                       Margin="0,4,0,0"/>
        </StackPanel>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                
                <!-- Basic Wave Information -->
                <Border Style="{StaticResource InfoCard}">
                    <StackPanel>
                        <TextBlock Text="Wave Information" Style="{StaticResource SectionTitle}"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Wave Name -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,12,16">
                                <TextBlock Text="Wave Name" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding WaveName, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"/>
                            </StackPanel>

                            <!-- Wave Description -->
                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="12,0,0,16">
                                <TextBlock Text="Description" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding WaveDescription, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"/>
                            </StackPanel>

                            <!-- Priority -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,12,16">
                                <TextBlock Text="Priority" Style="{StaticResource FieldLabel}"/>
                                <ComboBox SelectedItem="{Binding WavePriority, Mode=TwoWay}"
                                          Style="{StaticResource ModernComboBox}">
                                    <ComboBoxItem Content="Low"/>
                                    <ComboBoxItem Content="Normal"/>
                                    <ComboBoxItem Content="High"/>
                                    <ComboBoxItem Content="Critical"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Wave Type -->
                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="12,0,0,16">
                                <TextBlock Text="Wave Type" Style="{StaticResource FieldLabel}"/>
                                <ComboBox SelectedItem="{Binding WaveType, Mode=TwoWay}"
                                          Style="{StaticResource ModernComboBox}">
                                    <ComboBoxItem Content="Users Only"/>
                                    <ComboBoxItem Content="Files Only"/>
                                    <ComboBoxItem Content="Mixed Content"/>
                                    <ComboBoxItem Content="Full Migration"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Estimated Items -->
                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,12,0">
                                <TextBlock Text="Estimated Items" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding EstimatedItems, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"/>
                            </StackPanel>

                            <!-- Dependencies -->
                            <StackPanel Grid.Row="2" Grid.Column="1" Margin="12,0,0,0">
                                <TextBlock Text="Dependencies (Wave IDs)" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding Dependencies, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"
                                         ToolTip="Comma-separated list of wave IDs that must complete first"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Scheduling Settings -->
                <Border Style="{StaticResource InfoCard}">
                    <StackPanel>
                        <TextBlock Text="Scheduling Settings" Style="{StaticResource SectionTitle}"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Scheduled Date -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,12,16">
                                <TextBlock Text="Scheduled Date" Style="{StaticResource FieldLabel}"/>
                                <DatePicker SelectedDate="{Binding ScheduledDate, Mode=TwoWay}"
                                           Style="{StaticResource ModernDatePicker}"/>
                            </StackPanel>

                            <!-- Scheduled Time -->
                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="12,0,0,16">
                                <TextBlock Text="Scheduled Time" Style="{StaticResource FieldLabel}"/>
                                <ComboBox SelectedItem="{Binding ScheduledTime, Mode=TwoWay}"
                                          Style="{StaticResource ModernComboBox}">
                                    <ComboBoxItem Content="00:00"/>
                                    <ComboBoxItem Content="01:00"/>
                                    <ComboBoxItem Content="02:00"/>
                                    <ComboBoxItem Content="03:00"/>
                                    <ComboBoxItem Content="04:00"/>
                                    <ComboBoxItem Content="05:00"/>
                                    <ComboBoxItem Content="06:00"/>
                                    <ComboBoxItem Content="07:00"/>
                                    <ComboBoxItem Content="08:00"/>
                                    <ComboBoxItem Content="09:00"/>
                                    <ComboBoxItem Content="10:00"/>
                                    <ComboBoxItem Content="11:00"/>
                                    <ComboBoxItem Content="12:00"/>
                                    <ComboBoxItem Content="13:00"/>
                                    <ComboBoxItem Content="14:00"/>
                                    <ComboBoxItem Content="15:00"/>
                                    <ComboBoxItem Content="16:00"/>
                                    <ComboBoxItem Content="17:00"/>
                                    <ComboBoxItem Content="18:00"/>
                                    <ComboBoxItem Content="19:00"/>
                                    <ComboBoxItem Content="20:00"/>
                                    <ComboBoxItem Content="21:00"/>
                                    <ComboBoxItem Content="22:00"/>
                                    <ComboBoxItem Content="23:00"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Max Concurrent Tasks -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,12,16">
                                <TextBlock Text="Max Concurrent Tasks" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding MaxConcurrentTasks, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"
                                         ToolTip="Maximum number of concurrent migration tasks"/>
                            </StackPanel>

                            <!-- Retry Settings -->
                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="12,0,0,16">
                                <TextBlock Text="Retry Count" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding RetryCount, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"
                                         ToolTip="Number of retry attempts for failed items"/>
                            </StackPanel>

                            <!-- Retry Delay -->
                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,12,16">
                                <TextBlock Text="Retry Delay (minutes)" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding RetryDelayMinutes, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"
                                         ToolTip="Delay between retry attempts"/>
                            </StackPanel>

                            <!-- Timeout -->
                            <StackPanel Grid.Row="2" Grid.Column="1" Margin="12,0,0,16">
                                <TextBlock Text="Timeout (hours)" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding TimeoutHours, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"
                                         ToolTip="Maximum time to wait for wave completion"/>
                            </StackPanel>

                            <!-- Advanced Options -->
                            <StackPanel Grid.Row="3" Grid.ColumnSpan="2">
                                <CheckBox Content="Skip weekends when rescheduling" 
                                          IsChecked="{Binding SkipWeekends, Mode=TwoWay}"
                                          Foreground="White" 
                                          Margin="0,0,0,8"/>
                                <CheckBox Content="Allow parallel batch execution" 
                                          IsChecked="{Binding AllowParallelBatches, Mode=TwoWay}"
                                          Foreground="White" 
                                          Margin="0,0,0,8"/>
                                <CheckBox Content="Continue on batch failure" 
                                          IsChecked="{Binding ContinueOnFailure, Mode=TwoWay}"
                                          Foreground="White"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Blackout Periods -->
                <Border Style="{StaticResource InfoCard}">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" 
                                       Text="Blackout Periods" 
                                       Style="{StaticResource SectionTitle}"/>
                            
                            <Button Grid.Column="1" 
                                    Content="Add Blackout Period" 
                                    Style="{StaticResource ModernButton}"
                                    Padding="8,4"
                                    FontSize="12"
                                    Command="{Binding AddBlackoutPeriodCommand}"/>
                        </Grid>

                        <DataGrid ItemsSource="{Binding BlackoutPeriods}"
                                  Background="#FF374151"
                                  BorderThickness="1"
                                  BorderBrush="#FF4B5563"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="True"
                                  Height="150">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Description" 
                                                    Binding="{Binding Description}" 
                                                    Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="Padding" Value="8,4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Start" 
                                                    Binding="{Binding StartTime, StringFormat='yyyy-MM-dd HH:mm'}" 
                                                    Width="140">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#FF94A3B8"/>
                                            <Setter Property="Padding" Value="8,4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="End" 
                                                    Binding="{Binding EndTime, StringFormat='yyyy-MM-dd HH:mm'}" 
                                                    Width="140">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#FF94A3B8"/>
                                            <Setter Property="Padding" Value="8,4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Type" 
                                                    Binding="{Binding Type}" 
                                                    Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#FF94A3B8"/>
                                            <Setter Property="Padding" Value="8,4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTemplateColumn Width="60">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="×" 
                                                    Style="{StaticResource CancelButton}"
                                                    Padding="4"
                                                    FontSize="14"
                                                    FontWeight="Bold"
                                                    Command="{Binding DataContext.RemoveBlackoutPeriodCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <!-- Notification Settings -->
                <Border Style="{StaticResource InfoCard}">
                    <StackPanel>
                        <TextBlock Text="Notification Settings" Style="{StaticResource SectionTitle}"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Notification Options -->
                            <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Margin="0,0,0,16">
                                <CheckBox Content="Send pre-migration notifications" 
                                          IsChecked="{Binding SendPreMigrationNotifications, Mode=TwoWay}"
                                          Foreground="White" 
                                          Margin="0,0,0,8"/>
                                <CheckBox Content="Send post-migration notifications" 
                                          IsChecked="{Binding SendPostMigrationNotifications, Mode=TwoWay}"
                                          Foreground="White" 
                                          Margin="0,0,0,8"/>
                                <CheckBox Content="Send progress notifications" 
                                          IsChecked="{Binding SendProgressNotifications, Mode=TwoWay}"
                                          Foreground="White"/>
                            </StackPanel>

                            <!-- Pre-migration Hours -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,12,16">
                                <TextBlock Text="Pre-migration Notification Hours" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding PreMigrationNotificationHours, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"
                                         ToolTip="Hours before migration to send notification"/>
                            </StackPanel>

                            <!-- Notification Template -->
                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="12,0,0,16">
                                <TextBlock Text="Notification Template" Style="{StaticResource FieldLabel}"/>
                                <ComboBox SelectedItem="{Binding NotificationTemplateId, Mode=TwoWay}"
                                          ItemsSource="{Binding AvailableTemplates}"
                                          DisplayMemberPath="Name"
                                          SelectedValuePath="Id"
                                          Style="{StaticResource ModernComboBox}"/>
                            </StackPanel>

                            <!-- Additional Recipients -->
                            <StackPanel Grid.Row="2" Grid.ColumnSpan="2">
                                <TextBlock Text="Additional Recipients" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding AdditionalRecipients, Mode=TwoWay}" 
                                         Style="{StaticResource ModernTextBox}"
                                         Height="60"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         VerticalScrollBarVisibility="Auto"
                                         ToolTip="Comma-separated email addresses"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Validation Summary -->
                <Border Style="{StaticResource InfoCard}" 
                        Background="#FF1F2937"
                        Visibility="{Binding HasValidationErrors, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="Validation Issues" 
                                   Style="{StaticResource SectionTitle}"
                                   Foreground="#FFEF4444"/>
                        <ItemsControl ItemsSource="{Binding ValidationErrors}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" 
                                               Foreground="#FFEF4444" 
                                               Margin="0,0,0,4"
                                               FontSize="12"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Dialog Buttons -->
        <Grid Grid.Row="2" Margin="0,24,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Preview Button -->
            <Button Grid.Column="0"
                    Content="Preview Schedule"
                    Style="{StaticResource CancelButton}"
                    Command="{Binding PreviewScheduleCommand}"
                    Margin="0,0,12,0"/>

            <!-- Test Notifications Button -->
            <Button Grid.Column="2"
                    Content="Test Notifications"
                    Style="{StaticResource CancelButton}"
                    Command="{Binding TestNotificationsCommand}"
                    Margin="0,0,12,0"/>

            <!-- Action Buttons -->
            <StackPanel Grid.Column="3" Orientation="Horizontal">
                <Button Content="Cancel" 
                        Style="{StaticResource CancelButton}"
                        Command="{Binding CancelCommand}"
                        Margin="0,0,12,0"/>
                <Button Content="Schedule Wave" 
                        Style="{StaticResource ModernButton}"
                        Command="{Binding ScheduleWaveCommand}"
                        IsEnabled="{Binding CanScheduleWave}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>