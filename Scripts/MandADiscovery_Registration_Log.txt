Enhanced M&A Discovery Suite - Azure AD App Registration
Version: 4.0.1
Started: 2025-06-24 12:07:07
User: lukia
Computer: DADDY_WALRUS
Domain: DADDY_WALRUS
PowerShell: 5.1.26100.4202
[2025-06-24 12:07:07] [INFO] Script Information:
[2025-06-24 12:07:07] [INFO]   Name: Enhanced M&A Discovery Suite - App Registration
[2025-06-24 12:07:07] [INFO]   Version: 4.0.1
[2025-06-24 12:07:07] [INFO]   Author: M&A Discovery Team
[2025-06-24 12:07:07] [INFO] Execution Parameters:
[2025-06-24 12:07:07] [INFO]   Log Path: .\MandADiscovery_Registration_Log.txt
[2025-06-24 12:07:07] [INFO]   Output Path: C:\DiscoveryData\discoverycredentials.config
[2025-06-24 12:07:07] [INFO]   Force Mode: False
[2025-06-24 12:07:07] [INFO]   Validate Only: False
[2025-06-24 12:07:07] [INFO]   Skip Azure Roles: False
[2025-06-24 12:07:07] [INFO]   Secret Validity: 2 years
[2025-06-24 12:07:07] [PROGRESS] ?? Starting: ModuleManagement
[2025-06-24 12:07:07] [PROGRESS] Performing comprehensive module cleanup...
[2025-06-24 12:07:07] [SUCCESS] Module cleanup completed
[2025-06-24 12:07:07] [PROGRESS] Processing module: Az.Accounts
[2025-06-24 12:07:07] [INFO] Found Az.Accounts v5.1.0
[2025-06-24 12:07:09] [SUCCESS] Az.Accounts is up to date (v5.1.0)
[2025-06-24 12:07:09] [PROGRESS] Importing Az module with conflict prevention...
[2025-06-24 12:07:10] [SUCCESS] Imported Az.Accounts v5.1.0
[2025-06-24 12:07:10] [PROGRESS] Processing module: Az.Resources
[2025-06-24 12:07:10] [INFO] Found Az.Resources v8.0.0
[2025-06-24 12:07:12] [SUCCESS] Az.Resources is up to date (v8.0.0)
[2025-06-24 12:07:12] [PROGRESS] Importing Az module with conflict prevention...
[2025-06-24 12:07:15] [SUCCESS] Imported Az.Resources v8.0.0
[2025-06-24 12:07:15] [PROGRESS] Processing module: Microsoft.Graph.Applications
[2025-06-24 12:07:15] [INFO] Found Microsoft.Graph.Applications v2.28.0
[2025-06-24 12:07:17] [SUCCESS] Microsoft.Graph.Applications is up to date (v2.28.0)
[2025-06-24 12:07:19] [SUCCESS] Imported Microsoft.Graph.Applications v2.28.0
[2025-06-24 12:07:19] [PROGRESS] Processing module: Microsoft.Graph.Authentication
[2025-06-24 12:07:19] [INFO] Found Microsoft.Graph.Authentication v2.28.0
[2025-06-24 12:07:22] [SUCCESS] Microsoft.Graph.Authentication is up to date (v2.28.0)
[2025-06-24 12:07:22] [SUCCESS] Imported Microsoft.Graph.Authentication v2.28.0
[2025-06-24 12:07:22] [PROGRESS] Processing module: Microsoft.Graph.Identity.DirectoryManagement
[2025-06-24 12:07:22] [INFO] Found Microsoft.Graph.Identity.DirectoryManagement v2.28.0
[2025-06-24 12:07:25] [SUCCESS] Microsoft.Graph.Identity.DirectoryManagement is up to date (v2.28.0)
[2025-06-24 12:07:26] [SUCCESS] Imported Microsoft.Graph.Identity.DirectoryManagement v2.28.0
[2025-06-24 12:07:26] [INFO] Module processing summary:
[2025-06-24 12:07:26] [SUCCESS]   Successful: 5
[2025-06-24 12:07:26] [SUCCESS]   Failed: 0
[2025-06-24 12:07:26] [SUCCESS] Successfully processed modules:
[2025-06-24 12:07:26] [SUCCESS]   ✓ Az.Accounts
[2025-06-24 12:07:26] [SUCCESS]   ✓ Az.Resources
[2025-06-24 12:07:26] [SUCCESS]   ✓ Microsoft.Graph.Applications
[2025-06-24 12:07:26] [SUCCESS]   ✓ Microsoft.Graph.Authentication
[2025-06-24 12:07:26] [SUCCESS]   ✓ Microsoft.Graph.Identity.DirectoryManagement
[2025-06-24 12:07:26] [SUCCESS] Essential module verified: Az.Accounts v5.1.0
[2025-06-24 12:07:26] [SUCCESS] Essential module verified: Microsoft.Graph.Authentication v2.28.0
[2025-06-24 12:07:26] [SUCCESS] All essential modules are loaded and ready
[2025-06-24 12:07:26] [SUCCESS] [OK] ModuleManagement (?? 19.21s)
[2025-06-24 12:07:26] [PROGRESS] ?? Starting: Prerequisites
[2025-06-24 12:07:26] [SUCCESS] Running with administrator privileges
[2025-06-24 12:07:26] [PROGRESS] Testing network connectivity to 4 endpoints...
[2025-06-24 12:07:27] [SUCCESS] Connectivity to Microsoft Graph: Available
[2025-06-24 12:07:27] [SUCCESS] Connectivity to Azure Management: Available
[2025-06-24 12:07:27] [SUCCESS] Connectivity to Azure AD Authentication: Available
[2025-06-24 12:07:27] [SUCCESS] Connectivity to Azure AD Graph (Legacy): Available
[2025-06-24 12:07:27] [SUCCESS] Network connectivity: 4/4 endpoints accessible
[2025-06-24 12:07:27] [SUCCESS] Available memory: 61.22GB
[2025-06-24 12:07:27] [SUCCESS] Available disk space: 276.44GB
[2025-06-24 12:07:27] [SUCCESS] Output directory accessible with write permissions: C:\DiscoveryData
[2025-06-24 12:07:27] [PROGRESS] Checking PowerShell modules...
[2025-06-24 12:07:27] [SUCCESS] Module available: Az.Accounts v5.1.0
[2025-06-24 12:07:27] [SUCCESS] Module available: Az.Resources v8.0.0
[2025-06-24 12:07:27] [SUCCESS] Module available: Microsoft.Graph.Applications v2.28.0
[2025-06-24 12:07:27] [SUCCESS] Module available: Microsoft.Graph.Authentication v2.28.0
[2025-06-24 12:07:27] [SUCCESS] Module available: Microsoft.Graph.Identity.DirectoryManagement v2.28.0
[2025-06-24 12:07:27] [WARN] Prerequisites validation found 1 warning(s):
[2025-06-24 12:07:27] [WARN]   PowerShell 5.1 detected. PowerShell 7+ recommended for enhanced performance and compatibility
[2025-06-24 12:07:27] [SUCCESS] All prerequisites validated successfully
[2025-06-24 12:07:27] [SUCCESS] [OK] Prerequisites (?? 1.31s)
[2025-06-24 12:07:27] [PROGRESS] ?? Starting: GraphConnection
[2025-06-24 12:07:27] [PROGRESS] Connection attempt 1 of 3...
[2025-06-24 12:07:27] [PROGRESS] Connecting to Microsoft Graph with required scopes...
[2025-06-24 12:08:30] [ERROR] Graph connection attempt 1 failed: Failed to establish valid Graph context
[2025-06-24 12:08:30] [PROGRESS] Retrying in 5 seconds...
[2025-06-24 12:08:35] [PROGRESS] Connection attempt 2 of 3...
[2025-06-24 12:08:35] [INFO] Disconnected existing Graph session
[2025-06-24 12:08:35] [PROGRESS] Connecting to Microsoft Graph with required scopes...
[2025-06-24 12:09:00] [ERROR] Graph connection attempt 2 failed: Failed to establish valid Graph context
[2025-06-24 12:09:00] [PROGRESS] Retrying in 7 seconds...
[2025-06-24 12:09:07] [PROGRESS] Connection attempt 3 of 3...
[2025-06-24 12:09:07] [INFO] Disconnected existing Graph session
[2025-06-24 12:09:07] [PROGRESS] Connecting to Microsoft Graph with required scopes...
[2025-06-24 12:10:10] [ERROR] Graph connection attempt 3 failed: Failed to establish valid Graph context
[2025-06-24 12:10:10] [ERROR] Failed to establish Graph connection after 3 attempts
[2025-06-24 12:10:10] [ERROR] [X] GraphConnection (?? 162.12s)
[2025-06-24 12:10:10] [PROGRESS] ?? Starting: AzureConnection
[2025-06-24 12:10:10] [PROGRESS] Azure connection attempt 1 of 3...
[2025-06-24 12:10:10] [PROGRESS] Connecting to Azure...
[2025-06-24 12:10:59] [SUCCESS] Successfully connected to Azure
[2025-06-24 12:10:59] [INFO]   Account: lukian@ljpops.com
[2025-06-24 12:10:59] [INFO]   Tenant: 4c54e13b-5380-483b-a9af-32e1f265f614
[2025-06-24 12:10:59] [INFO]   Total Subscriptions: 1
[2025-06-24 12:10:59] [INFO]   Active Subscriptions: 1
[2025-06-24 12:10:59] [INFO]     * LJP Production Subscription (Enabled)
[2025-06-24 12:10:59] [SUCCESS] [OK] AzureConnection (?? 49.68s)
[2025-06-24 12:11:23] [SUCCESS] Operating in tenant: 
[2025-06-24 12:11:23] [INFO]   Organization: 
[2025-06-24 12:11:23] [INFO]   Verified Domains: 0
[2025-06-24 12:11:23] [PROGRESS] ?? Starting: AppRegistration
[2025-06-24 12:11:23] [PROGRESS] Checking for existing application 'MandADiscovery'...
[2025-06-24 12:11:23] [PROGRESS] Fetching Microsoft Graph service principal...
[2025-06-24 12:11:23] [ERROR] Failed to create application registration: [BadRequest] : This API is not supported for MSA accounts (no addressUrl for Microsoft.DirectoryServices,False).
[2025-06-24 12:11:23] [ERROR] [X] AppRegistration (?? 0.70s)
[2025-06-24 12:11:23] [CRITICAL] CRITICAL ERROR: [BadRequest] : This API is not supported for MSA accounts (no addressUrl for Microsoft.DirectoryServices,False).
[2025-06-24 12:11:23] [DEBUG] Stack Trace: at Get-MgServicePrincipal<Process>, C:\Users\lukia\OneDrive\Photo Backup\Old Photos (1)\Documents\WindowsPowerShell\Modules\Microsoft.Graph.Applications\2.28.0\exports\ProxyCmdletDefinitions.ps1: line 32686 at New-EnhancedAppRegistration, D:\Scripts\UserMandA\Scripts\DiscoveryCreateAppRegistration.ps1: line 897 at <ScriptBlock>, D:\Scripts\UserMandA\Scripts\DiscoveryCreateAppRegistration.ps1: line 1633 at <ScriptBlock>, D:\Scripts\UserMandA\Scripts\Run-DiscoverySetup.ps1: line 126 at <ScriptBlock>, <No file>: line 1
[2025-06-24 12:11:23] [ERROR] Check the log file for detailed error information: .\MandADiscovery_Registration_Log.txt
[2025-06-24 12:11:23] [PROGRESS] Performing cleanup operations...
[2025-06-24 12:11:23] [SUCCESS] Disconnected from Microsoft Graph
[2025-06-24 12:11:24] [SUCCESS] Disconnected from Azure
[2025-06-24 12:11:24] [SUCCESS] Metrics saved: MandADiscovery_Registration_Log_metrics.json
[2025-06-24 12:11:24] [SUCCESS] Cleanup completed. Full log: .\MandADiscovery_Registration_Log.txt
