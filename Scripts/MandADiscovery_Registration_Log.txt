Enhanced M&A Discovery Suite - Azure AD App Registration
Version: 4.0.0
Started: 2025-08-01 13:24:06
User: lukia
Computer: URAN
Domain: URAN
PowerShell: 5.1.26100.4202
[2025-08-01 13:24:06] [INFO] Script Information:
[2025-08-01 13:24:06] [INFO]   Name: Enhanced M&A Discovery Suite - App Registration
[2025-08-01 13:24:06] [INFO]   Version: 4.0.0
[2025-08-01 13:24:06] [INFO]   Author: M&A Discovery Team
[2025-08-01 13:24:06] [INFO] Execution Parameters:
[2025-08-01 13:24:06] [INFO]   Log Path: .\MandADiscovery_Registration_Log.txt
[2025-08-01 13:24:06] [INFO]   Output Path: C:\DiscoveryData\discoverycredentials.config
[2025-08-01 13:24:06] [INFO]   Force Mode: False
[2025-08-01 13:24:06] [INFO]   Validate Only: False
[2025-08-01 13:24:06] [INFO]   Skip Azure Roles: False
[2025-08-01 13:24:06] [INFO]   Secret Validity: 2 years
[2025-08-01 13:24:06] [PROGRESS] ?? Starting: Prerequisites
[2025-08-01 13:24:06] [PROGRESS] Testing network connectivity to 4 endpoints...
[2025-08-01 13:24:08] [SUCCESS] Connectivity to Microsoft Graph: Available
[2025-08-01 13:24:08] [SUCCESS] Connectivity to Azure Management: Available
[2025-08-01 13:24:08] [SUCCESS] Connectivity to Azure AD Authentication: Available
[2025-08-01 13:24:08] [SUCCESS] Connectivity to Azure AD Graph (Legacy): Available
[2025-08-01 13:24:08] [SUCCESS] Network connectivity: 4/4 endpoints accessible
[2025-08-01 13:24:11] [SUCCESS] Available disk space: 77.11GB
[2025-08-01 13:24:11] [SUCCESS] Output directory accessible with write permissions: C:\DiscoveryData
[2025-08-01 13:24:11] [PROGRESS] Checking and installing PowerShell modules...
[2025-08-01 13:24:11] [SUCCESS] Module available: Az.Accounts v5.1.1
[2025-08-01 13:24:11] [SUCCESS] Module available: Az.Resources v8.0.1
[2025-08-01 13:24:11] [SUCCESS] Module available: Microsoft.Graph.Applications v2.29.1
[2025-08-01 13:24:12] [SUCCESS] Module available: Microsoft.Graph.Authentication v2.29.1
[2025-08-01 13:24:12] [SUCCESS] Module available: Microsoft.Graph.Identity.DirectoryManagement v2.29.1
[2025-08-01 13:24:12] [WARN] Prerequisites validation found 3 warning(s):
[2025-08-01 13:24:12] [WARN]   PowerShell 5.1 detected. PowerShell 7+ recommended for enhanced performance and compatibility
[2025-08-01 13:24:12] [WARN]   Not running as administrator/root. Some operations may require elevation
[2025-08-01 13:24:13] [WARN]   Low available memory: 0.01GB. Minimum recommended: 2GB
[2025-08-01 13:24:13] [SUCCESS] All prerequisites validated successfully
[2025-08-01 13:24:13] [SUCCESS] [OK] Prerequisites (?? 6.29s)
[2025-08-01 13:24:13] [PROGRESS] ?? Starting: ModuleManagement
[2025-08-01 13:24:13] [PROGRESS] Unloading potentially conflicting modules...
[2025-08-01 13:24:13] [PROGRESS] Processing module: Az.Accounts
[2025-08-01 13:24:13] [INFO] Found Az.Accounts v5.1.1
[2025-08-01 13:24:25] [SUCCESS] Az.Accounts is up to date (v5.1.1)
[2025-08-01 13:24:27] [SUCCESS] Imported Az.Accounts v5.1.1
[2025-08-01 13:24:27] [PROGRESS] Processing module: Az.Resources
[2025-08-01 13:24:27] [INFO] Found Az.Resources v8.0.1
[2025-08-01 13:24:31] [SUCCESS] Az.Resources is up to date (v8.0.1)
[2025-08-01 13:24:33] [SUCCESS] Imported Az.Resources v8.0.1
[2025-08-01 13:24:33] [PROGRESS] Processing module: Microsoft.Graph.Applications
[2025-08-01 13:24:33] [INFO] Found Microsoft.Graph.Applications v2.29.1
[2025-08-01 13:24:35] [SUCCESS] Microsoft.Graph.Applications is up to date (v2.29.1)
[2025-08-01 13:24:37] [SUCCESS] Imported Microsoft.Graph.Applications v2.29.1
[2025-08-01 13:24:37] [PROGRESS] Processing module: Microsoft.Graph.Authentication
[2025-08-01 13:24:37] [INFO] Found Microsoft.Graph.Authentication v2.29.1
[2025-08-01 13:24:39] [SUCCESS] Microsoft.Graph.Authentication is up to date (v2.29.1)
[2025-08-01 13:24:40] [SUCCESS] Imported Microsoft.Graph.Authentication v2.29.1
[2025-08-01 13:24:40] [PROGRESS] Processing module: Microsoft.Graph.Identity.DirectoryManagement
[2025-08-01 13:24:40] [INFO] Found Microsoft.Graph.Identity.DirectoryManagement v2.29.1
[2025-08-01 13:24:42] [SUCCESS] Microsoft.Graph.Identity.DirectoryManagement is up to date (v2.29.1)
[2025-08-01 13:24:43] [SUCCESS] Imported Microsoft.Graph.Identity.DirectoryManagement v2.29.1
[2025-08-01 13:24:43] [SUCCESS] All 5 modules processed successfully
[2025-08-01 13:24:43] [SUCCESS] [OK] ModuleManagement (?? 30.33s)
[2025-08-01 13:24:43] [PROGRESS] ?? Starting: GraphConnection
[2025-08-01 13:24:43] [PROGRESS] Connection attempt 1 of 3...
[2025-08-01 13:24:43] [PROGRESS] Connecting to Microsoft Graph with required scopes...
[2025-08-01 13:25:00] [ERROR] Graph connection attempt 1 failed: Failed to establish valid Graph context
[2025-08-01 13:25:00] [PROGRESS] Retrying in 5 seconds...
[2025-08-01 13:25:05] [PROGRESS] Connection attempt 2 of 3...
[2025-08-01 13:25:05] [INFO] Disconnected existing Graph session
[2025-08-01 13:25:05] [PROGRESS] Connecting to Microsoft Graph with required scopes...
[2025-08-01 13:27:06] [ERROR] Graph connection attempt 2 failed: An error occurred when writing to a listener.
[2025-08-01 13:27:06] [PROGRESS] Retrying in 7 seconds...
[2025-08-01 13:27:13] [PROGRESS] Connection attempt 3 of 3...
[2025-08-01 13:27:13] [PROGRESS] Connecting to Microsoft Graph with required scopes...
[2025-08-01 13:29:13] [ERROR] Graph connection attempt 3 failed: An error occurred when writing to a listener.
[2025-08-01 13:29:13] [ERROR] Failed to establish Graph connection after 3 attempts
[2025-08-01 13:29:13] [ERROR] [X] GraphConnection (?? 270.41s)
[2025-08-01 13:29:13] [PROGRESS] ?? Starting: AzureConnection
[2025-08-01 13:29:13] [PROGRESS] Azure connection attempt 1 of 3...
[2025-08-01 13:29:15] [SUCCESS] Using existing Azure connection
[2025-08-01 13:29:15] [SUCCESS] [OK] AzureConnection (?? 1.37s)
[2025-08-01 13:29:15] [SUCCESS] Operating in tenant: 
[2025-08-01 13:29:15] [INFO]   Organization: 
[2025-08-01 13:29:15] [INFO]   Verified Domains: 0
[2025-08-01 13:29:15] [PROGRESS] ?? Starting: AppRegistration
[2025-08-01 13:29:15] [PROGRESS] Checking for existing application 'MandADiscovery'...
[2025-08-01 13:29:15] [PROGRESS] Fetching Microsoft Graph service principal...
[2025-08-01 13:29:15] [ERROR] Failed to create application registration: Authentication needed. Please call Connect-MgGraph.
[2025-08-01 13:29:15] [ERROR] [X] AppRegistration (?? 0.16s)
[2025-08-01 13:29:15] [CRITICAL] CRITICAL ERROR: Authentication needed. Please call Connect-MgGraph.
[2025-08-01 13:29:15] [DEBUG] Stack Trace: at Get-MgServicePrincipal<Process>, C:\Users\lukia\Documents\WindowsPowerShell\Modules\Microsoft.Graph.Applications\2.29.1\exports\ProxyCmdletDefinitions.ps1: line 32686 at New-EnhancedAppRegistration, D:\Scripts\UserMandA-1\Scripts\DiscoveryCreateAppRegistration_backup.ps1: line 820 at <ScriptBlock>, D:\Scripts\UserMandA-1\Scripts\DiscoveryCreateAppRegistration_backup.ps1: line 1575 at <ScriptBlock>, <No file>: line 1
[2025-08-01 13:29:16] [ERROR] Check the log file for detailed error information: .\MandADiscovery_Registration_Log.txt
[2025-08-01 13:29:16] [PROGRESS] Performing cleanup operations...
[2025-08-01 13:29:16] [SUCCESS] Disconnected from Azure
[2025-08-01 13:29:16] [SUCCESS] Metrics saved: MandADiscovery_Registration_Log_metrics.json
[2025-08-01 13:29:16] [SUCCESS] Cleanup completed. Full log: .\MandADiscovery_Registration_Log.txt
