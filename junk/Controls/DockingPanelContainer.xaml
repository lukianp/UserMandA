<UserControl x:Class="MandADiscoverySuite.Controls.DockingPanelContainer"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Themes/ThemeStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Panel Header Style -->
            <Style x:Key="PanelHeaderStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="0,0,0,1"/>
                <Setter Property="Padding" Value="8,6"/>
                <Setter Property="Cursor" Value="SizeAll"/>
            </Style>

            <!-- Panel Content Style -->
            <Style x:Key="PanelContentStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource BackgroundBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
            </Style>

            <!-- Floating Panel Style -->
            <Style x:Key="FloatingPanelStyle" TargetType="Window">
                <Setter Property="Background" Value="{DynamicResource BackgroundBrush}"/>
                <Setter Property="WindowStyle" Value="ToolWindow"/>
                <Setter Property="ShowInTaskbar" Value="False"/>
                <Setter Property="Topmost" Value="False"/>
                <Setter Property="ResizeMode" Value="CanResizeWithGrip"/>
            </Style>

            <!-- Dock Target Style -->
            <Style x:Key="DockTargetStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                <Setter Property="Opacity" Value="0.3"/>
                <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                <Setter Property="BorderThickness" Value="2"/>
                <Setter Property="Visibility" Value="Collapsed"/>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid x:Name="MainGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250" MinWidth="150"/>
            <ColumnDefinition Width="4"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="4"/>
            <ColumnDefinition Width="300" MinWidth="200"/>
        </Grid.ColumnDefinitions>

        <!-- Left Panel -->
        <Border Grid.Column="0" Style="{StaticResource PanelContentStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Left Panel Header -->
                <Border Grid.Row="0" Style="{StaticResource PanelHeaderStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" 
                                   Text="ðŸ—‚ï¸" 
                                   FontSize="14"
                                   VerticalAlignment="Center"
                                   Margin="0,0,6,0"/>

                        <TextBlock Grid.Column="1" 
                                   Text="Explorer" 
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   VerticalAlignment="Center"/>

                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button Content="ðŸ“Œ" 
                                    ToolTip="Pin/Unpin Panel"
                                    Command="{Binding TogglePinCommand}"
                                    CommandParameter="Left"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4"
                                    FontSize="10"
                                    Cursor="Hand"/>
                            <Button Content="â†—ï¸" 
                                    ToolTip="Float Panel"
                                    Command="{Binding FloatPanelCommand}"
                                    CommandParameter="Left"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4"
                                    FontSize="10"
                                    Cursor="Hand"/>
                            <Button Content="âœ•" 
                                    ToolTip="Close Panel"
                                    Command="{Binding ClosePanelCommand}"
                                    CommandParameter="Left"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4"
                                    FontSize="10"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Left Panel Content -->
                <ContentPresenter Grid.Row="1" 
                                  Content="{Binding LeftPanelContent}"
                                  Margin="8"/>
            </Grid>
        </Border>

        <!-- Left Splitter -->
        <GridSplitter Grid.Column="1" 
                      Background="{DynamicResource BorderBrush}"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      ResizeBehavior="PreviousAndNext"
                      ResizeDirection="Columns"/>

        <!-- Center Panel -->
        <Border Grid.Column="2" Style="{StaticResource PanelContentStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="4"/>
                    <RowDefinition Height="200" MinHeight="100"/>
                </Grid.RowDefinitions>

                <!-- Main Content Area -->
                <Border Grid.Row="0" Background="{DynamicResource BackgroundBrush}">
                    <ContentPresenter Content="{Binding MainContent}"/>
                </Border>

                <!-- Horizontal Splitter -->
                <GridSplitter Grid.Row="1" 
                              Background="{DynamicResource BorderBrush}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              ResizeBehavior="PreviousAndNext"
                              ResizeDirection="Rows"/>

                <!-- Bottom Panel -->
                <Border Grid.Row="2" Style="{StaticResource PanelContentStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Bottom Panel Header -->
                        <Border Grid.Row="0" Style="{StaticResource PanelHeaderStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" 
                                           Text="ðŸ“Š" 
                                           FontSize="14"
                                           VerticalAlignment="Center"
                                           Margin="0,0,6,0"/>

                                <TextBlock Grid.Column="1" 
                                           Text="Output" 
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           VerticalAlignment="Center"/>

                                <StackPanel Grid.Column="2" Orientation="Horizontal">
                                    <Button Content="ðŸ“Œ" 
                                            ToolTip="Pin/Unpin Panel"
                                            Command="{Binding TogglePinCommand}"
                                            CommandParameter="Bottom"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Padding="4"
                                            FontSize="10"
                                            Cursor="Hand"/>
                                    <Button Content="â†—ï¸" 
                                            ToolTip="Float Panel"
                                            Command="{Binding FloatPanelCommand}"
                                            CommandParameter="Bottom"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Padding="4"
                                            FontSize="10"
                                            Cursor="Hand"/>
                                    <Button Content="âœ•" 
                                            ToolTip="Close Panel"
                                            Command="{Binding ClosePanelCommand}"
                                            CommandParameter="Bottom"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Padding="4"
                                            FontSize="10"
                                            Cursor="Hand"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Bottom Panel Content -->
                        <ContentPresenter Grid.Row="1" 
                                          Content="{Binding BottomPanelContent}"
                                          Margin="8"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Right Splitter -->
        <GridSplitter Grid.Column="3" 
                      Background="{DynamicResource BorderBrush}"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      ResizeBehavior="PreviousAndNext"
                      ResizeDirection="Columns"/>

        <!-- Right Panel -->
        <Border Grid.Column="4" Style="{StaticResource PanelContentStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Right Panel Header -->
                <Border Grid.Row="0" Style="{StaticResource PanelHeaderStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" 
                                   Text="âš™ï¸" 
                                   FontSize="14"
                                   VerticalAlignment="Center"
                                   Margin="0,0,6,0"/>

                        <TextBlock Grid.Column="1" 
                                   Text="Properties" 
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   VerticalAlignment="Center"/>

                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button Content="ðŸ“Œ" 
                                    ToolTip="Pin/Unpin Panel"
                                    Command="{Binding TogglePinCommand}"
                                    CommandParameter="Right"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4"
                                    FontSize="10"
                                    Cursor="Hand"/>
                            <Button Content="â†—ï¸" 
                                    ToolTip="Float Panel"
                                    Command="{Binding FloatPanelCommand}"
                                    CommandParameter="Right"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4"
                                    FontSize="10"
                                    Cursor="Hand"/>
                            <Button Content="âœ•" 
                                    ToolTip="Close Panel"
                                    Command="{Binding ClosePanelCommand}"
                                    CommandParameter="Right"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4"
                                    FontSize="10"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Right Panel Content -->
                <ContentPresenter Grid.Row="1" 
                                  Content="{Binding RightPanelContent}"
                                  Margin="8"/>
            </Grid>
        </Border>

        <!-- Dock Targets (shown during drag operations) -->
        <Border x:Name="LeftDockTarget" 
                Grid.Column="0" 
                Style="{StaticResource DockTargetStyle}"
                Panel.ZIndex="1000"/>
        
        <Border x:Name="RightDockTarget" 
                Grid.Column="4" 
                Style="{StaticResource DockTargetStyle}"
                Panel.ZIndex="1000"/>
        
        <Border x:Name="BottomDockTarget" 
                Grid.Column="2" 
                Grid.Row="0"
                Style="{StaticResource DockTargetStyle}"
                Panel.ZIndex="1000"
                VerticalAlignment="Bottom"
                Height="100"/>

        <!-- Panel Management Menu -->
        <StackPanel Grid.Column="2" 
                    HorizontalAlignment="Right" 
                    VerticalAlignment="Top"
                    Orientation="Horizontal"
                    Margin="0,8,8,0"
                    Panel.ZIndex="100">
            <Button Content="ðŸ’¾" 
                    ToolTip="Save Layout"
                    Command="{Binding SaveLayoutCommand}"
                    Style="{StaticResource ThemedSecondaryButtonStyle}"
                    Padding="6"
                    FontSize="12"
                    Margin="0,0,4,0"/>
            <Button Content="ðŸ“" 
                    ToolTip="Load Layout"
                    Command="{Binding LoadLayoutCommand}"
                    Style="{StaticResource ThemedSecondaryButtonStyle}"
                    Padding="6"
                    FontSize="12"
                    Margin="0,0,4,0"/>
            <Button Content="ðŸ’¾+" 
                    ToolTip="Save Layout As..."
                    Command="{Binding SaveLayoutAsCommand}"
                    Style="{StaticResource ThemedSecondaryButtonStyle}"
                    Padding="6"
                    FontSize="12"
                    Margin="0,0,4,0"/>
            <Button Content="ðŸ“‹" 
                    ToolTip="Manage Layouts"
                    Command="{Binding ManageLayoutsCommand}"
                    Style="{StaticResource ThemedSecondaryButtonStyle}"
                    Padding="6"
                    FontSize="12"
                    Margin="0,0,4,0"/>
            <Button Content="âš™ï¸" 
                    ToolTip="Panel Options"
                    Command="{Binding ShowPanelOptionsCommand}"
                    Style="{StaticResource ThemedSecondaryButtonStyle}"
                    Padding="6"
                    FontSize="12"
                    Margin="0,0,4,0"/>
            <Button Content="ðŸ”„" 
                    ToolTip="Reset Layout"
                    Command="{Binding ResetLayoutCommand}"
                    Style="{StaticResource ThemedSecondaryButtonStyle}"
                    Padding="6"
                    FontSize="12"/>
        </StackPanel>
    </Grid>
</UserControl>