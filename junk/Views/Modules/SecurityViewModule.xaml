<UserControl x:Class="MandADiscoverySuite.Views.Modules.SecurityViewModule"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:behaviors="clr-namespace:MandADiscoverySuite.Behaviors"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200">
    <Grid Margin="32">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Header -->
                <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,24">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Group Policy &amp; Security Discovery" Style="{StaticResource PageHeaderStyle}"/>
                            <TextBlock Text="Analyze Group Policy settings, security configurations, and compliance posture across your domain"
                                       Foreground="{DynamicResource SecondaryTextBrush}" FontSize="14" Margin="0,8,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Refresh Data" Style="{StaticResource RoundedButtonStyle}" 
                                Background="{StaticResource AccentGradient}" Command="{Binding RefreshDataCommand}" 
                                VerticalAlignment="Bottom"/>
                    </Grid>
                </Border>
                
                <!-- Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Security Discovery Actions -->
                        <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Security Assessment Tools" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="Analyze Group Policy Objects, security settings, and compliance status"
                                           Foreground="{DynamicResource SecondaryTextBrush}" FontSize="13" Margin="0,0,0,16"/>
                                
                                <WrapPanel>
                                    <Button x:Name="ScanGPOButton" Style="{StaticResource RoundedButtonStyle}"
                                            Background="{StaticResource AccentGradient}"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding ScanGPOCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="&#x1F50D;" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Scan Group Policies"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="SecurityAuditButton" Style="{StaticResource RoundedButtonStyle}"
                                            Background="#E53E3E" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding SecurityAuditCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ›¡ï¸" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Security Audit"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="ComplianceCheckButton" Style="{StaticResource RoundedButtonStyle}"
                                            Background="#48BB78" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding ComplianceCheckCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="âœ…" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Compliance Check"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="VulnerabilityAssessmentButton" Style="{StaticResource RoundedButtonStyle}"
                                            Background="#9F7AEA" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding VulnerabilityAssessmentCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="âš ï¸" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Vulnerability Scan"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="PasswordPolicyButton" Style="{StaticResource RoundedButtonStyle}"
                                            Background="#ED8936" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding PasswordPolicyCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Password Policies"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="PasswordGeneratorButton" Style="{StaticResource RoundedButtonStyle}"
                                            Background="#9F7AEA" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding PasswordGeneratorCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸŽ²" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Password Generator"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button x:Name="FirewallAnalysisButton" Style="{StaticResource RoundedButtonStyle}"
                                            Background="#38B2AC" Foreground="White"
                                            Margin="0,0,12,12" Padding="20,12"
                                            Command="{Binding FirewallAnalysisCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ”¥" FontSize="16" Margin="0,0,8,0"/>
                                            <TextBlock Text="Firewall Analysis"/>
                                        </StackPanel>
                                    </Button>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Security Results Tabs -->
                        <Border Style="{StaticResource ModernCardStyle}">
                            <StackPanel>
                                <TextBlock Text="Security Assessment Results" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <!-- Tab Headers -->
                                <StackPanel Orientation="Horizontal" Margin="0,16,0,16">
                                    <Button x:Name="GPOTabButton" Content="Group Policies" Style="{StaticResource RoundedButtonStyle}"
                                            Background="{StaticResource AccentGradient}" Margin="0,0,8,0" Padding="16,8"
                                            Command="{Binding SecurityTabCommand}" CommandParameter="GPO"/>
                                    <Button x:Name="SecurityTabButton" Content="Security Issues" Style="{StaticResource RoundedButtonStyle}"
                                            Background="#4A5568" Margin="0,0,8,0" Padding="16,8"
                                            Command="{Binding SecurityTabCommand}" CommandParameter="security"/>
                                    <Button x:Name="ComplianceTabButton" Content="Compliance" Style="{StaticResource RoundedButtonStyle}"
                                            Background="#4A5568" Margin="0,0,8,0" Padding="16,8"
                                            Command="{Binding SecurityTabCommand}" CommandParameter="Compliance"/>
                                    <Button x:Name="VulnerabilitiesTabButton" Content="Vulnerabilities" Style="{StaticResource RoundedButtonStyle}"
                                            Background="#4A5568" Margin="0,0,8,0" Padding="16,8"
                                            Command="{Binding SecurityTabCommand}" CommandParameter="Vulnerabilities"/>
                                </StackPanel>
                                
                                <!-- GPO Results -->
                                <Grid x:Name="GPOResultsPanel" Visibility="Visible">
                                    <DataGrid x:Name="GPODataGrid" Style="{StaticResource ModernDataGridStyle}"
                                              Height="300"
                                              behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="GPO Name" Binding="{Binding Name}" Width="200"/>
                                            <DataGridTextColumn Header="Domain" Binding="{Binding Domain}" Width="150"/>
                                            <DataGridTextColumn Header="Linked To" Binding="{Binding LinkedTo}" Width="200"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                            <DataGridTextColumn Header="Settings Count" Binding="{Binding SettingsCount}" Width="120"/>
                                            <DataGridTextColumn Header="Risk Level" Binding="{Binding RiskLevel}" Width="100"/>
                                            <DataGridTextColumn Header="Last Modified" Binding="{Binding LastModified}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                                
                                <!-- Security Issues Results -->
                                <Grid x:Name="SecurityResultsPanel" Visibility="Collapsed">
                                    <DataGrid x:Name="SecurityIssuesDataGrid" Style="{StaticResource ModernDataGridStyle}"
                                              Height="300"
                                              behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Issue Type" Binding="{Binding IssueType}" Width="150"/>
                                            <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="100"/>
                                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="300"/>
                                            <DataGridTextColumn Header="Affected System" Binding="{Binding AffectedSystem}" Width="200"/>
                                            <DataGridTextColumn Header="Recommendation" Binding="{Binding Recommendation}" Width="250"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                                
                                <!-- Compliance Results -->
                                <Grid x:Name="ComplianceResultsPanel" Visibility="Collapsed">
                                    <DataGrid x:Name="ComplianceDataGrid" Style="{StaticResource ModernDataGridStyle}"
                                              Height="300"
                                              behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Control ID" Binding="{Binding ControlId}" Width="100"/>
                                            <DataGridTextColumn Header="Control Name" Binding="{Binding ControlName}" Width="200"/>
                                            <DataGridTextColumn Header="Framework" Binding="{Binding Framework}" Width="120"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                            <DataGridTextColumn Header="Score" Binding="{Binding Score}" Width="80"/>
                                            <DataGridTextColumn Header="Evidence" Binding="{Binding Evidence}" Width="200"/>
                                            <DataGridTextColumn Header="Gap Analysis" Binding="{Binding GapAnalysis}" Width="250"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                                
                                <!-- Vulnerabilities Results -->
                                <Grid x:Name="VulnerabilitiesResultsPanel" Visibility="Collapsed">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    
                                    <!-- Toolbar with Column Chooser -->
                                    <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" Padding="8,4">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <Button x:Name="VulnerabilitiesColumnChooserButton" Content="âš™ Columns" 
                                                    Click="VulnerabilitiesColumnChooser_Click"
                                                    Background="#4A5568" Foreground="{DynamicResource PrimaryTextBrush}" 
                                                    BorderBrush="#63B3ED" Padding="8,4" Margin="4,0"
                                                    ToolTip="Choose which columns to display"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <DataGrid Grid.Row="1" x:Name="VulnerabilitiesDataGridInstance" Style="{StaticResource ModernDataGridStyle}"
                                              Height="300"
                                              behaviors:VirtualizationBehavior.EnableVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableColumnVirtualization="True"
                                              behaviors:VirtualizationBehavior.EnableRowVirtualization="True">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="CVE ID" Binding="{Binding CveId}" Width="120"/>
                                            <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="250"/>
                                            <DataGridTextColumn Header="CVSS Score" Binding="{Binding CvssScore}" Width="100"/>
                                            <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="100"/>
                                            <DataGridTextColumn Header="Affected Systems" Binding="{Binding AffectedSystems}" Width="200"/>
                                            <DataGridTextColumn Header="Patch Available" Binding="{Binding PatchAvailable}" Width="120"/>
                                            <DataGridTextColumn Header="Exploit Available" Binding="{Binding ExploitAvailable}" Width="120"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
    </Grid>
</UserControl>
